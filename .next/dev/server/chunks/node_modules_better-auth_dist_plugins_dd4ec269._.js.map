{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/access/access.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/access/access.ts"],"sourcesContent":["import { BetterAuthError } from \"@better-auth/core/error\";\nimport type { Statements, Subset } from \"./types\";\n\nexport type AuthorizeResponse =\n\t| { success: false; error: string }\n\t| { success: true; error?: never | undefined };\n\nexport function role<TStatements extends Statements>(statements: TStatements) {\n\treturn {\n\t\tauthorize<K extends keyof TStatements>(\n\t\t\trequest: {\n\t\t\t\t[key in K]?:\n\t\t\t\t\t| TStatements[key]\n\t\t\t\t\t| {\n\t\t\t\t\t\t\tactions: TStatements[key];\n\t\t\t\t\t\t\tconnector: \"OR\" | \"AND\";\n\t\t\t\t\t  };\n\t\t\t},\n\t\t\tconnector: \"OR\" | \"AND\" = \"AND\",\n\t\t): AuthorizeResponse {\n\t\t\tlet success = false;\n\t\t\tfor (const [requestedResource, requestedActions] of Object.entries(\n\t\t\t\trequest,\n\t\t\t)) {\n\t\t\t\tconst allowedActions = statements[requestedResource];\n\t\t\t\tif (!allowedActions) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\terror: `You are not allowed to access resource: ${requestedResource}`,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tif (Array.isArray(requestedActions)) {\n\t\t\t\t\tsuccess = (requestedActions as string[]).every((requestedAction) =>\n\t\t\t\t\t\tallowedActions.includes(requestedAction),\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tif (typeof requestedActions === \"object\") {\n\t\t\t\t\t\tconst actions = requestedActions as {\n\t\t\t\t\t\t\tactions: string[];\n\t\t\t\t\t\t\tconnector: \"OR\" | \"AND\";\n\t\t\t\t\t\t};\n\t\t\t\t\t\tif (actions.connector === \"OR\") {\n\t\t\t\t\t\t\tsuccess = actions.actions.some((requestedAction) =>\n\t\t\t\t\t\t\t\tallowedActions.includes(requestedAction),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsuccess = actions.actions.every((requestedAction) =>\n\t\t\t\t\t\t\t\tallowedActions.includes(requestedAction),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new BetterAuthError(\"Invalid access control request\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (success && connector === \"OR\") {\n\t\t\t\t\treturn { success };\n\t\t\t\t}\n\t\t\t\tif (!success && connector === \"AND\") {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\terror: `unauthorized to access resource \"${requestedResource}\"`,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (success) {\n\t\t\t\treturn {\n\t\t\t\t\tsuccess,\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"Not authorized\",\n\t\t\t};\n\t\t},\n\t\tstatements,\n\t};\n}\n\nexport function createAccessControl<const TStatements extends Statements>(\n\ts: TStatements,\n) {\n\treturn {\n\t\tnewRole<K extends keyof TStatements>(statements: Subset<K, TStatements>) {\n\t\t\treturn role<Subset<K, TStatements>>(statements);\n\t\t},\n\t\tstatements: s,\n\t};\n}\n"],"names":[],"mappings":";;;;;;;;;AAOA,SAAgB,KAAqC,UAAA,EAAyB;IAC7E,OAAO;QACN,WACC,OAAA,EAQA,YAA0B,KAAA,EACN;YACpB,IAAI,UAAU;YACd,KAAK,MAAM,CAAC,mBAAmB,iBAAA,IAAqB,OAAO,OAAA,CAC1D,QACA,CAAE;gBACF,MAAM,iBAAiB,UAAA,CAAW,kBAAA;gBAClC,IAAI,CAAC,eACJ,CAAA,OAAO;oBACN,SAAS;oBACT,OAAO,CAAA,wCAAA,EAA2C,mBAAA;iBAClD;gBAEF,IAAI,MAAM,OAAA,CAAQ,iBAAiB,CAClC,CAAA,UAAW,iBAA8B,KAAA,CAAA,CAAO,kBAC/C,eAAe,QAAA,CAAS,gBAAgB,CACxC;yBAEG,OAAO,qBAAqB,UAAU;oBACzC,MAAM,UAAU;oBAIhB,IAAI,QAAQ,SAAA,KAAc,KACzB,CAAA,UAAU,QAAQ,OAAA,CAAQ,IAAA,CAAA,CAAM,kBAC/B,eAAe,QAAA,CAAS,gBAAgB,CACxC;yBAED,UAAU,QAAQ,OAAA,CAAQ,KAAA,CAAA,CAAO,kBAChC,eAAe,QAAA,CAAS,gBAAgB,CACxC;sBAGF,CAAA,MAAM,IAAI,wMAAA,CAAgB,iCAAiC;gBAG7D,IAAI,WAAW,cAAc,KAC5B,CAAA,OAAO;oBAAE;gBAAA,CAAS;gBAEnB,IAAI,CAAC,WAAW,cAAc,MAC7B,CAAA,OAAO;oBACN,SAAS;oBACT,OAAO,CAAA,iCAAA,EAAoC,kBAAkB,CAAA,CAAA;iBAC7D;;YAGH,IAAI,QACH,CAAA,OAAO;gBACN;YAAA,CACA;YAEF,OAAO;gBACN,SAAS;gBACT,OAAO;aACP;;QAEF;KACA;;AAGF,SAAgB,oBACf,CAAA,EACC;IACD,OAAO;QACN,SAAqC,UAAA,EAAoC;YACxE,OAAO,KAA6B,WAAW;;QAEhD,YAAY;KACZ"}},
    {"offset": {"line": 62, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/dist/plugins/access/index.mjs"],"sourcesContent":["import { createAccessControl, role } from \"./access.mjs\";\n\nexport { createAccessControl, role };"],"names":[],"mappings":";AAAA","ignoreList":[0]}},
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/two-factor/client.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/two-factor/client.ts"],"sourcesContent":["import type { BetterAuthClientPlugin } from \"@better-auth/core\";\nimport type { twoFactor as twoFa } from \".\";\n\nexport const twoFactorClient = (\n\toptions?:\n\t\t| {\n\t\t\t\t/**\n\t\t\t\t * a redirect function to call if a user needs to verify\n\t\t\t\t * their two factor\n\t\t\t\t */\n\t\t\t\tonTwoFactorRedirect?: () => void | Promise<void>;\n\t\t  }\n\t\t| undefined,\n) => {\n\treturn {\n\t\tid: \"two-factor\",\n\t\t$InferServerPlugin: {} as ReturnType<typeof twoFa>,\n\t\tatomListeners: [\n\t\t\t{\n\t\t\t\tmatcher: (path) => path.startsWith(\"/two-factor/\"),\n\t\t\t\tsignal: \"$sessionSignal\",\n\t\t\t},\n\t\t],\n\t\tpathMethods: {\n\t\t\t\"/two-factor/disable\": \"POST\",\n\t\t\t\"/two-factor/enable\": \"POST\",\n\t\t\t\"/two-factor/send-otp\": \"POST\",\n\t\t\t\"/two-factor/generate-backup-codes\": \"POST\",\n\t\t\t\"/two-factor/get-totp-uri\": \"POST\",\n\t\t\t\"/two-factor/verify-totp\": \"POST\",\n\t\t\t\"/two-factor/verify-otp\": \"POST\",\n\t\t\t\"/two-factor/verify-backup-code\": \"POST\",\n\t\t},\n\t\tfetchPlugins: [\n\t\t\t{\n\t\t\t\tid: \"two-factor\",\n\t\t\t\tname: \"two-factor\",\n\t\t\t\thooks: {\n\t\t\t\t\tasync onSuccess(context) {\n\t\t\t\t\t\tif (context.data?.twoFactorRedirect) {\n\t\t\t\t\t\t\tif (options?.onTwoFactorRedirect) {\n\t\t\t\t\t\t\t\tawait options.onTwoFactorRedirect();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t} satisfies BetterAuthClientPlugin;\n};\n\nexport type * from \"./backup-codes\";\nexport type * from \"./otp\";\nexport type * from \"./totp\";\nexport type * from \"./types\";\n"],"names":[],"mappings":";;;;;AAGA,MAAa,kBAAA,CACZ,YASI;IACJ,OAAO;QACN,IAAI;QACJ,oBAAoB,CAAA,CAAE;QACtB,eAAe;YACd;gBACC,SAAA,CAAU,OAAS,KAAK,UAAA,CAAW,eAAe;gBAClD,QAAQ;aACR;SACD;QACD,aAAa;YACZ,uBAAuB;YACvB,sBAAsB;YACtB,wBAAwB;YACxB,qCAAqC;YACrC,4BAA4B;YAC5B,2BAA2B;YAC3B,0BAA0B;YAC1B,kCAAkC;SAClC;QACD,cAAc;YACb;gBACC,IAAI;gBACJ,MAAM;gBACN,OAAO;oBACN,MAAM,WAAU,OAAA,EAAS;wBACxB,IAAI,QAAQ,IAAA,EAAM,mBACjB;gCAAI,SAAS,oBACZ,CAAA,MAAM,QAAQ,mBAAA,EAAqB;;;iBAItC;aACD;SACD;KACD"}},
    {"offset": {"line": 116, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/two-factor/error-code.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/two-factor/error-code.ts"],"sourcesContent":["import { defineErrorCodes } from \"@better-auth/core/utils\";\n\nexport const TWO_FACTOR_ERROR_CODES = defineErrorCodes({\n\tOTP_NOT_ENABLED: \"OTP not enabled\",\n\tOTP_HAS_EXPIRED: \"OTP has expired\",\n\tTOTP_NOT_ENABLED: \"TOTP not enabled\",\n\tTWO_FACTOR_NOT_ENABLED: \"Two factor isn't enabled\",\n\tBACKUP_CODES_NOT_ENABLED: \"Backup codes aren't enabled\",\n\tINVALID_BACKUP_CODE: \"Invalid backup code\",\n\tINVALID_CODE: \"Invalid code\",\n\tTOO_MANY_ATTEMPTS_REQUEST_NEW_CODE:\n\t\t\"Too many attempts. Please request a new code.\",\n\tINVALID_TWO_FACTOR_COOKIE: \"Invalid two factor cookie\",\n});\n"],"names":[],"mappings":";;;;;;;;AAEA,MAAa,6BAAyB,kMAAA,EAAiB;IACtD,iBAAiB;IACjB,iBAAiB;IACjB,kBAAkB;IAClB,wBAAwB;IACxB,0BAA0B;IAC1B,qBAAqB;IACrB,cAAc;IACd,oCACC;IACD,2BAA2B;CAC3B,CAAC"}},
    {"offset": {"line": 141, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/two-factor/constant.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/two-factor/constant.ts"],"sourcesContent":["export const TWO_FACTOR_COOKIE_NAME = \"two_factor\";\nexport const TRUST_DEVICE_COOKIE_NAME = \"trust_device\";\nexport const TRUST_DEVICE_COOKIE_MAX_AGE = 30 * 24 * 60 * 60; // 30 days\n"],"names":[],"mappings":";;;;;;;;;AAAA,MAAa,yBAAyB;AACtC,MAAa,2BAA2B;AACxC,MAAa,8BAA8B,MAAU,KAAK"}},
    {"offset": {"line": 159, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/two-factor/verify-two-factor.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/two-factor/verify-two-factor.ts"],"sourcesContent":["import type { GenericEndpointContext } from \"@better-auth/core\";\nimport { createHMAC } from \"@better-auth/utils/hmac\";\nimport { APIError } from \"better-call\";\nimport { getSessionFromCtx } from \"../../api\";\nimport { expireCookie, setSessionCookie } from \"../../cookies\";\nimport { generateRandomString } from \"../../crypto/random\";\nimport { parseUserOutput } from \"../../db/schema\";\nimport {\n\tTRUST_DEVICE_COOKIE_MAX_AGE,\n\tTRUST_DEVICE_COOKIE_NAME,\n\tTWO_FACTOR_COOKIE_NAME,\n} from \"./constant\";\nimport { TWO_FACTOR_ERROR_CODES } from \"./error-code\";\nimport type { UserWithTwoFactor } from \"./types\";\n\nexport async function verifyTwoFactor(ctx: GenericEndpointContext) {\n\tconst invalid = (errorKey: keyof typeof TWO_FACTOR_ERROR_CODES) => {\n\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\tmessage: TWO_FACTOR_ERROR_CODES[errorKey],\n\t\t});\n\t};\n\n\tconst session = await getSessionFromCtx(ctx);\n\tif (!session) {\n\t\tconst twoFactorCookie = ctx.context.createAuthCookie(\n\t\t\tTWO_FACTOR_COOKIE_NAME,\n\t\t);\n\t\tconst signedTwoFactorCookie = await ctx.getSignedCookie(\n\t\t\ttwoFactorCookie.name,\n\t\t\tctx.context.secret,\n\t\t);\n\t\tif (!signedTwoFactorCookie) {\n\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\tmessage: TWO_FACTOR_ERROR_CODES.INVALID_TWO_FACTOR_COOKIE,\n\t\t\t});\n\t\t}\n\t\tconst verificationToken =\n\t\t\tawait ctx.context.internalAdapter.findVerificationValue(\n\t\t\t\tsignedTwoFactorCookie,\n\t\t\t);\n\t\tif (!verificationToken) {\n\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\tmessage: TWO_FACTOR_ERROR_CODES.INVALID_TWO_FACTOR_COOKIE,\n\t\t\t});\n\t\t}\n\t\tconst user = (await ctx.context.internalAdapter.findUserById(\n\t\t\tverificationToken.value,\n\t\t)) as UserWithTwoFactor;\n\t\tif (!user) {\n\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\tmessage: TWO_FACTOR_ERROR_CODES.INVALID_TWO_FACTOR_COOKIE,\n\t\t\t});\n\t\t}\n\t\tconst dontRememberMe = await ctx.getSignedCookie(\n\t\t\tctx.context.authCookies.dontRememberToken.name,\n\t\t\tctx.context.secret,\n\t\t);\n\t\treturn {\n\t\t\tvalid: async (ctx: GenericEndpointContext) => {\n\t\t\t\tconst session = await ctx.context.internalAdapter.createSession(\n\t\t\t\t\tverificationToken.value,\n\t\t\t\t\t!!dontRememberMe,\n\t\t\t\t);\n\t\t\t\tif (!session) {\n\t\t\t\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\t\t\tmessage: \"failed to create session\",\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t// Delete the verification token from the database after successful verification\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(\n\t\t\t\t\tverificationToken.id,\n\t\t\t\t);\n\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\tsession,\n\t\t\t\t\tuser,\n\t\t\t\t});\n\t\t\t\t// Always clear the two factor cookie after successful verification\n\t\t\t\texpireCookie(ctx, twoFactorCookie);\n\t\t\t\tif (ctx.body.trustDevice) {\n\t\t\t\t\tconst plugin = ctx.context.getPlugin(\"two-factor\");\n\t\t\t\t\tconst trustDeviceMaxAge = plugin!.options!.trustDeviceMaxAge;\n\t\t\t\t\tconst maxAge = trustDeviceMaxAge ?? TRUST_DEVICE_COOKIE_MAX_AGE;\n\t\t\t\t\tconst trustDeviceCookie = ctx.context.createAuthCookie(\n\t\t\t\t\t\tTRUST_DEVICE_COOKIE_NAME,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmaxAge,\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t\t/**\n\t\t\t\t\t * Create a random identifier for the trust device record.\n\t\t\t\t\t * Store it in the verification table with an expiration\n\t\t\t\t\t * so the server can validate and revoke it.\n\t\t\t\t\t */\n\t\t\t\t\tconst trustIdentifier = `trust-device-${generateRandomString(32)}`;\n\t\t\t\t\tconst token = await createHMAC(\"SHA-256\", \"base64urlnopad\").sign(\n\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t\t`${user.id}!${trustIdentifier}`,\n\t\t\t\t\t);\n\t\t\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\t\t\tvalue: user.id,\n\t\t\t\t\t\tidentifier: trustIdentifier,\n\t\t\t\t\t\texpiresAt: new Date(Date.now() + maxAge * 1000),\n\t\t\t\t\t});\n\t\t\t\t\tawait ctx.setSignedCookie(\n\t\t\t\t\t\ttrustDeviceCookie.name,\n\t\t\t\t\t\t`${token}!${trustIdentifier}`,\n\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t\ttrustDeviceCookie.attributes,\n\t\t\t\t\t);\n\t\t\t\t\t// delete the dont remember me cookie\n\t\t\t\t\texpireCookie(ctx, ctx.context.authCookies.dontRememberToken);\n\t\t\t\t}\n\t\t\t\treturn ctx.json({\n\t\t\t\t\ttoken: session.token,\n\t\t\t\t\tuser: parseUserOutput(ctx.context.options, user),\n\t\t\t\t});\n\t\t\t},\n\t\t\tinvalid,\n\t\t\tsession: {\n\t\t\t\tsession: null,\n\t\t\t\tuser,\n\t\t\t},\n\t\t\tkey: signedTwoFactorCookie,\n\t\t};\n\t}\n\treturn {\n\t\tvalid: async (ctx: GenericEndpointContext) => {\n\t\t\treturn ctx.json({\n\t\t\t\ttoken: session.session.token,\n\t\t\t\tuser: parseUserOutput(ctx.context.options, session.user),\n\t\t\t});\n\t\t},\n\t\tinvalid,\n\t\tsession,\n\t\tkey: `${session.user.id}!${session.session.id}`,\n\t};\n}\n"],"names":["session","ctx"],"mappings":"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"}},
    {"offset": {"line": 267, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/two-factor/backup-codes/index.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/two-factor/backup-codes/index.ts"],"sourcesContent":["import { createAuthEndpoint } from \"@better-auth/core/api\";\nimport { safeJSONParse } from \"@better-auth/core/utils\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { sessionMiddleware } from \"../../../api\";\nimport { symmetricDecrypt, symmetricEncrypt } from \"../../../crypto\";\nimport { generateRandomString } from \"../../../crypto/random\";\nimport { parseUserOutput } from \"../../../db/schema\";\nimport { TWO_FACTOR_ERROR_CODES } from \"../error-code\";\nimport type {\n\tTwoFactorProvider,\n\tTwoFactorTable,\n\tUserWithTwoFactor,\n} from \"../types\";\nimport { verifyTwoFactor } from \"../verify-two-factor\";\n\nexport interface BackupCodeOptions {\n\t/**\n\t * The amount of backup codes to generate\n\t *\n\t * @default 10\n\t */\n\tamount?: number | undefined;\n\t/**\n\t * The length of the backup codes\n\t *\n\t * @default 10\n\t */\n\tlength?: number | undefined;\n\t/**\n\t * An optional custom function to generate backup codes\n\t */\n\tcustomBackupCodesGenerate?: (() => string[]) | undefined;\n\t/**\n\t * How to store the backup codes in the database, whether encrypted or plain.\n\t */\n\tstoreBackupCodes?:\n\t\t| (\n\t\t\t\t| \"plain\"\n\t\t\t\t| \"encrypted\"\n\t\t\t\t| {\n\t\t\t\t\t\tencrypt: (token: string) => Promise<string>;\n\t\t\t\t\t\tdecrypt: (token: string) => Promise<string>;\n\t\t\t\t  }\n\t\t  )\n\t\t| undefined;\n}\n\nfunction generateBackupCodesFn(options?: BackupCodeOptions | undefined) {\n\treturn Array.from({ length: options?.amount ?? 10 })\n\t\t.fill(null)\n\t\t.map(() => generateRandomString(options?.length ?? 10, \"a-z\", \"0-9\", \"A-Z\"))\n\t\t.map((code) => `${code.slice(0, 5)}-${code.slice(5)}`);\n}\n\nexport async function generateBackupCodes(\n\tsecret: string,\n\toptions?: BackupCodeOptions | undefined,\n) {\n\tconst backupCodes = options?.customBackupCodesGenerate\n\t\t? options.customBackupCodesGenerate()\n\t\t: generateBackupCodesFn(options);\n\tif (options?.storeBackupCodes === \"encrypted\") {\n\t\tconst encCodes = await symmetricEncrypt({\n\t\t\tdata: JSON.stringify(backupCodes),\n\t\t\tkey: secret,\n\t\t});\n\t\treturn {\n\t\t\tbackupCodes,\n\t\t\tencryptedBackupCodes: encCodes,\n\t\t};\n\t}\n\tif (\n\t\ttypeof options?.storeBackupCodes === \"object\" &&\n\t\t\"encrypt\" in options?.storeBackupCodes\n\t) {\n\t\treturn {\n\t\t\tbackupCodes,\n\t\t\tencryptedBackupCodes: await options?.storeBackupCodes.encrypt(\n\t\t\t\tJSON.stringify(backupCodes),\n\t\t\t),\n\t\t};\n\t}\n\treturn {\n\t\tbackupCodes,\n\t\tencryptedBackupCodes: JSON.stringify(backupCodes),\n\t};\n}\n\nexport async function verifyBackupCode(\n\tdata: {\n\t\tbackupCodes: string;\n\t\tcode: string;\n\t},\n\tkey: string,\n\toptions?: BackupCodeOptions | undefined,\n) {\n\tconst codes = await getBackupCodes(data.backupCodes, key, options);\n\tif (!codes) {\n\t\treturn {\n\t\t\tstatus: false,\n\t\t\tupdated: null,\n\t\t};\n\t}\n\treturn {\n\t\tstatus: codes.includes(data.code),\n\t\tupdated: codes.filter((code) => code !== data.code),\n\t};\n}\n\nexport async function getBackupCodes(\n\tbackupCodes: string,\n\tkey: string,\n\toptions?: BackupCodeOptions | undefined,\n) {\n\tif (options?.storeBackupCodes === \"encrypted\") {\n\t\tconst decrypted = await symmetricDecrypt({ key, data: backupCodes });\n\t\treturn safeJSONParse<string[]>(decrypted);\n\t}\n\tif (\n\t\ttypeof options?.storeBackupCodes === \"object\" &&\n\t\t\"decrypt\" in options?.storeBackupCodes\n\t) {\n\t\tconst decrypted = await options?.storeBackupCodes.decrypt(backupCodes);\n\t\treturn safeJSONParse<string[]>(decrypted);\n\t}\n\n\treturn safeJSONParse<string[]>(backupCodes);\n}\n\nconst verifyBackupCodeBodySchema = z.object({\n\tcode: z.string().meta({\n\t\tdescription: `A backup code to verify. Eg: \"123456\"`,\n\t}),\n\t/**\n\t * Disable setting the session cookie\n\t */\n\tdisableSession: z\n\t\t.boolean()\n\t\t.meta({\n\t\t\tdescription: \"If true, the session cookie will not be set.\",\n\t\t})\n\t\t.optional(),\n\t/**\n\t * if true, the device will be trusted\n\t * for 30 days. It'll be refreshed on\n\t * every sign in request within this time.\n\t */\n\ttrustDevice: z\n\t\t.boolean()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t\"If true, the device will be trusted for 30 days. It'll be refreshed on every sign in request within this time. Eg: true\",\n\t\t})\n\t\t.optional(),\n});\n\nconst viewBackupCodesBodySchema = z.object({\n\tuserId: z.coerce.string().meta({\n\t\tdescription: `The user ID to view all backup codes. Eg: \"user-id\"`,\n\t}),\n});\n\nconst generateBackupCodesBodySchema = z.object({\n\tpassword: z.string().meta({\n\t\tdescription: \"The users password.\",\n\t}),\n});\n\nexport const backupCode2fa = (opts: BackupCodeOptions) => {\n\tconst twoFactorTable = \"twoFactor\";\n\n\treturn {\n\t\tid: \"backup_code\",\n\t\tendpoints: {\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * POST `/two-factor/verify-backup-code`\n\t\t\t *\n\t\t\t * ### API Methods\n\t\t\t *\n\t\t\t * **server:**\n\t\t\t * `auth.api.verifyBackupCode`\n\t\t\t *\n\t\t\t * **client:**\n\t\t\t * `authClient.twoFactor.verifyBackupCode`\n\t\t\t *\n\t\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/2fa#api-method-two-factor-verify-backup-code)\n\t\t\t */\n\t\t\tverifyBackupCode: createAuthEndpoint(\n\t\t\t\t\"/two-factor/verify-backup-code\",\n\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tbody: verifyBackupCodeBodySchema,\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\tdescription: \"Verify a backup code for two-factor authentication\",\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\t\t\tdescription: \"Backup code verified successfully\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Unique identifier of the user\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\temail: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"email\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's email address\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\temailVerified: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Whether the email is verified\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's name\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\timage: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"uri\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's profile image URL\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttwoFactorEnabled: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Whether two-factor authentication is enabled for the user\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Timestamp when the user was created\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Timestamp when the user was last updated\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"twoFactorEnabled\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"updatedAt\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"The authenticated user object with two-factor details\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tsession: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoken: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Session token\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tuserId: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"ID of the user associated with the session\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Timestamp when the session was created\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\texpiresAt: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Timestamp when the session expires\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"token\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"userId\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"expiresAt\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"The current session object, included unless disableSession is true\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\trequired: [\"user\", \"session\"],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tconst { session, valid } = await verifyTwoFactor(ctx);\n\t\t\t\t\tconst user = session.user as UserWithTwoFactor;\n\t\t\t\t\tconst twoFactor = await ctx.context.adapter.findOne<TwoFactorTable>({\n\t\t\t\t\t\tmodel: twoFactorTable,\n\t\t\t\t\t\twhere: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\t\t\tvalue: user.id,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\t\t\t\t\tif (!twoFactor) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage: TWO_FACTOR_ERROR_CODES.BACKUP_CODES_NOT_ENABLED,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst validate = await verifyBackupCode(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbackupCodes: twoFactor.backupCodes,\n\t\t\t\t\t\t\tcode: ctx.body.code,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t\topts,\n\t\t\t\t\t);\n\t\t\t\t\tif (!validate.status) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\tmessage: TWO_FACTOR_ERROR_CODES.INVALID_BACKUP_CODE,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst updatedBackupCodes = await symmetricEncrypt({\n\t\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\t\tdata: JSON.stringify(validate.updated),\n\t\t\t\t\t});\n\n\t\t\t\t\tconst updated = await ctx.context.adapter.update({\n\t\t\t\t\t\tmodel: twoFactorTable,\n\t\t\t\t\t\tupdate: {\n\t\t\t\t\t\t\tbackupCodes: updatedBackupCodes,\n\t\t\t\t\t\t},\n\t\t\t\t\t\twhere: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\t\t\tvalue: twoFactor.id,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfield: \"backupCodes\",\n\t\t\t\t\t\t\t\tvalue: twoFactor.backupCodes,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\t\t\t\t\tif (!updated) {\n\t\t\t\t\t\tthrow new APIError(\"CONFLICT\", {\n\t\t\t\t\t\t\tmessage: \"Failed to verify backup code. Please try again.\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!ctx.body.disableSession) {\n\t\t\t\t\t\treturn valid(ctx);\n\t\t\t\t\t}\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\ttoken: session.session?.token,\n\t\t\t\t\t\tuser: parseUserOutput(ctx.context.options, session.user),\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t),\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * POST `/two-factor/generate-backup-codes`\n\t\t\t *\n\t\t\t * ### API Methods\n\t\t\t *\n\t\t\t * **server:**\n\t\t\t * `auth.api.generateBackupCodes`\n\t\t\t *\n\t\t\t * **client:**\n\t\t\t * `authClient.twoFactor.generateBackupCodes`\n\t\t\t *\n\t\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/2fa#api-method-two-factor-generate-backup-codes)\n\t\t\t */\n\t\t\tgenerateBackupCodes: createAuthEndpoint(\n\t\t\t\t\"/two-factor/generate-backup-codes\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tbody: generateBackupCodesBodySchema,\n\t\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\"Generate new backup codes for two-factor authentication\",\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\t\t\tdescription: \"Backup codes generated successfully\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tstatus: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Indicates if the backup codes were generated successfully\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tenum: [true],\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tbackupCodes: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\titems: { type: \"string\" },\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Array of generated backup codes in plain text\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\trequired: [\"status\", \"backupCodes\"],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tconst user = ctx.context.session.user as UserWithTwoFactor;\n\t\t\t\t\tif (!user.twoFactorEnabled) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage: TWO_FACTOR_ERROR_CODES.TWO_FACTOR_NOT_ENABLED,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tawait ctx.context.password.checkPassword(user.id, ctx);\n\n\t\t\t\t\t// First, find the twoFactor record to get its id\n\t\t\t\t\tconst twoFactor = await ctx.context.adapter.findOne<TwoFactorTable>({\n\t\t\t\t\t\tmodel: twoFactorTable,\n\t\t\t\t\t\twhere: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\t\t\tvalue: user.id,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\n\t\t\t\t\tif (!twoFactor) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage: TWO_FACTOR_ERROR_CODES.TWO_FACTOR_NOT_ENABLED,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tconst backupCodes = await generateBackupCodes(\n\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t\topts,\n\t\t\t\t\t);\n\n\t\t\t\t\t// Use the id to update the record\n\t\t\t\t\tawait ctx.context.adapter.update({\n\t\t\t\t\t\tmodel: twoFactorTable,\n\t\t\t\t\t\tupdate: {\n\t\t\t\t\t\t\tbackupCodes: backupCodes.encryptedBackupCodes,\n\t\t\t\t\t\t},\n\t\t\t\t\t\twhere: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\t\t\tvalue: twoFactor.id,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\tstatus: true,\n\t\t\t\t\t\tbackupCodes: backupCodes.backupCodes,\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t),\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * POST `/two-factor/view-backup-codes`\n\t\t\t *\n\t\t\t * ### API Methods\n\t\t\t *\n\t\t\t * **server:**\n\t\t\t * `auth.api.viewBackupCodes`\n\t\t\t *\n\t\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/2fa#api-method-two-factor-view-backup-codes)\n\t\t\t */\n\t\t\tviewBackupCodes: createAuthEndpoint(\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tbody: viewBackupCodesBodySchema,\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tconst twoFactor = await ctx.context.adapter.findOne<TwoFactorTable>({\n\t\t\t\t\t\tmodel: twoFactorTable,\n\t\t\t\t\t\twhere: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\t\t\tvalue: ctx.body.userId,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\t\t\t\t\tif (!twoFactor) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage: TWO_FACTOR_ERROR_CODES.BACKUP_CODES_NOT_ENABLED,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst decryptedBackupCodes = await getBackupCodes(\n\t\t\t\t\t\ttwoFactor.backupCodes,\n\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t\topts,\n\t\t\t\t\t);\n\n\t\t\t\t\tif (!decryptedBackupCodes) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage: TWO_FACTOR_ERROR_CODES.INVALID_BACKUP_CODE,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\tstatus: true,\n\t\t\t\t\t\tbackupCodes: decryptedBackupCodes,\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t),\n\t\t},\n\t} satisfies TwoFactorProvider;\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 638, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/two-factor/utils.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/two-factor/utils.ts"],"sourcesContent":["import { base64Url } from \"@better-auth/utils/base64\";\nimport { createHash } from \"@better-auth/utils/hash\";\n\nexport const defaultKeyHasher = async (token: string) => {\n\tconst hash = await createHash(\"SHA-256\").digest(\n\t\tnew TextEncoder().encode(token),\n\t);\n\tconst hashed = base64Url.encode(new Uint8Array(hash), {\n\t\tpadding: false,\n\t});\n\treturn hashed;\n};\n"],"names":[],"mappings":";;;;;;;;;AAGA,MAAa,mBAAmB,OAAO,UAAkB;IACxD,MAAM,OAAO,UAAM,0KAAA,EAAW,UAAU,CAAC,MAAA,CACxC,IAAI,aAAa,CAAC,MAAA,CAAO,MAAM,CAC/B;IAID,OAHe,2KAAA,CAAU,MAAA,CAAO,IAAI,WAAW,KAAK,EAAE;QACrD,SAAS;IAAA,CACT,CAAC"}},
    {"offset": {"line": 659, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/two-factor/otp/index.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/two-factor/otp/index.ts"],"sourcesContent":["import type { Awaitable, GenericEndpointContext } from \"@better-auth/core\";\nimport { createAuthEndpoint } from \"@better-auth/core/api\";\nimport { BASE_ERROR_CODES } from \"@better-auth/core/error\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { setSessionCookie } from \"../../../cookies\";\nimport {\n\tconstantTimeEqual,\n\tgenerateRandomString,\n\tsymmetricDecrypt,\n\tsymmetricEncrypt,\n} from \"../../../crypto\";\nimport { parseUserOutput } from \"../../../db/schema\";\nimport { TWO_FACTOR_ERROR_CODES } from \"../error-code\";\nimport type { TwoFactorProvider, UserWithTwoFactor } from \"../types\";\nimport { defaultKeyHasher } from \"../utils\";\nimport { verifyTwoFactor } from \"../verify-two-factor\";\n\nexport interface OTPOptions {\n\t/**\n\t * How long the opt will be valid for in\n\t * minutes\n\t *\n\t * @default \"3 mins\"\n\t */\n\tperiod?: number | undefined;\n\t/**\n\t * Number of digits for the OTP code\n\t *\n\t * @default 6\n\t */\n\tdigits?: number | undefined;\n\t/**\n\t * Send the otp to the user\n\t *\n\t * @param user - The user to send the otp to\n\t * @param otp - The otp to send\n\t * @param request - The request object\n\t * @returns void | Promise<void>\n\t */\n\tsendOTP?:\n\t\t| ((\n\t\t\t\t/**\n\t\t\t\t * The user to send the otp to\n\t\t\t\t * @type UserWithTwoFactor\n\t\t\t\t * @default UserWithTwoFactors\n\t\t\t\t */\n\t\t\t\tdata: {\n\t\t\t\t\tuser: UserWithTwoFactor;\n\t\t\t\t\totp: string;\n\t\t\t\t},\n\t\t\t\t/**\n\t\t\t\t * The request object\n\t\t\t\t */\n\t\t\t\tctx?: GenericEndpointContext,\n\t\t  ) => Awaitable<void>)\n\t\t| undefined;\n\t/**\n\t * The number of allowed attempts for the OTP\n\t *\n\t * @default 5\n\t */\n\tallowedAttempts?: number | undefined;\n\tstoreOTP?:\n\t\t| (\n\t\t\t\t| \"plain\"\n\t\t\t\t| \"encrypted\"\n\t\t\t\t| \"hashed\"\n\t\t\t\t| { hash: (token: string) => Promise<string> }\n\t\t\t\t| {\n\t\t\t\t\t\tencrypt: (token: string) => Promise<string>;\n\t\t\t\t\t\tdecrypt: (token: string) => Promise<string>;\n\t\t\t\t  }\n\t\t  )\n\t\t| undefined;\n}\n\nconst verifyOTPBodySchema = z.object({\n\tcode: z.string().meta({\n\t\tdescription: 'The otp code to verify. Eg: \"012345\"',\n\t}),\n\t/**\n\t * if true, the device will be trusted\n\t * for 30 days. It'll be refreshed on\n\t * every sign in request within this time.\n\t */\n\ttrustDevice: z.boolean().optional().meta({\n\t\tdescription:\n\t\t\t\"If true, the device will be trusted for 30 days. It'll be refreshed on every sign in request within this time. Eg: true\",\n\t}),\n});\n\nconst send2FaOTPBodySchema = z\n\t.object({\n\t\t/**\n\t\t * if true, the device will be trusted\n\t\t * for 30 days. It'll be refreshed on\n\t\t * every sign in request within this time.\n\t\t */\n\t\ttrustDevice: z.boolean().optional().meta({\n\t\t\tdescription:\n\t\t\t\t\"If true, the device will be trusted for 30 days. It'll be refreshed on every sign in request within this time. Eg: true\",\n\t\t}),\n\t})\n\t.optional();\n\n/**\n * The otp adapter is created from the totp adapter.\n */\nexport const otp2fa = (options?: OTPOptions | undefined) => {\n\tconst opts = {\n\t\tstoreOTP: \"plain\",\n\t\tdigits: 6,\n\t\t...options,\n\t\tperiod: (options?.period || 3) * 60 * 1000,\n\t};\n\n\tasync function storeOTP(ctx: GenericEndpointContext, otp: string) {\n\t\tif (opts.storeOTP === \"hashed\") {\n\t\t\treturn await defaultKeyHasher(otp);\n\t\t}\n\t\tif (typeof opts.storeOTP === \"object\" && \"hash\" in opts.storeOTP) {\n\t\t\treturn await opts.storeOTP.hash(otp);\n\t\t}\n\t\tif (typeof opts.storeOTP === \"object\" && \"encrypt\" in opts.storeOTP) {\n\t\t\treturn await opts.storeOTP.encrypt(otp);\n\t\t}\n\t\tif (opts.storeOTP === \"encrypted\") {\n\t\t\treturn await symmetricEncrypt({\n\t\t\t\tkey: ctx.context.secret,\n\t\t\t\tdata: otp,\n\t\t\t});\n\t\t}\n\t\treturn otp;\n\t}\n\n\tasync function decryptOrHashForComparison(\n\t\tctx: GenericEndpointContext,\n\t\tstoredOtp: string,\n\t\tuserInput: string,\n\t): Promise<[string, string]> {\n\t\tif (opts.storeOTP === \"hashed\") {\n\t\t\t// For hashed storage: hash the user input and compare with stored hash\n\t\t\treturn [storedOtp, await defaultKeyHasher(userInput)];\n\t\t}\n\t\tif (opts.storeOTP === \"encrypted\") {\n\t\t\t// For encrypted storage: decrypt stored value and compare with plain input\n\t\t\tconst decrypted = await symmetricDecrypt({\n\t\t\t\tkey: ctx.context.secret,\n\t\t\t\tdata: storedOtp,\n\t\t\t});\n\t\t\treturn [decrypted, userInput];\n\t\t}\n\t\tif (typeof opts.storeOTP === \"object\" && \"encrypt\" in opts.storeOTP) {\n\t\t\tconst decrypted = await opts.storeOTP.decrypt(storedOtp);\n\t\t\treturn [decrypted, userInput];\n\t\t}\n\t\tif (typeof opts.storeOTP === \"object\" && \"hash\" in opts.storeOTP) {\n\t\t\t// For custom hash: hash the user input and compare with stored hash\n\t\t\treturn [storedOtp, await opts.storeOTP.hash(userInput)];\n\t\t}\n\t\t// Plain storage: compare directly\n\t\treturn [storedOtp, userInput];\n\t}\n\n\t/**\n\t * Generate OTP and send it to the user.\n\t */\n\tconst send2FaOTP = createAuthEndpoint(\n\t\t\"/two-factor/send-otp\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: send2FaOTPBodySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tsummary: \"Send two factor OTP\",\n\t\t\t\t\tdescription: \"Send two factor OTP to the user\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Successful response\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tstatus: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tif (!options || !options.sendOTP) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t\"send otp isn't configured. Please configure the send otp function on otp options.\",\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: \"otp isn't configured\",\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst { session, key } = await verifyTwoFactor(ctx);\n\t\t\tconst code = generateRandomString(opts.digits, \"0-9\");\n\t\t\tconst hashedCode = await storeOTP(ctx, code);\n\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\tvalue: `${hashedCode}:0`,\n\t\t\t\tidentifier: `2fa-otp-${key}`,\n\t\t\t\texpiresAt: new Date(Date.now() + opts.period),\n\t\t\t});\n\t\t\tconst sendOTPResult = options.sendOTP(\n\t\t\t\t{ user: session.user as UserWithTwoFactor, otp: code },\n\t\t\t\tctx,\n\t\t\t);\n\t\t\tif (sendOTPResult instanceof Promise) {\n\t\t\t\tawait ctx.context.runInBackgroundOrAwait(\n\t\t\t\t\tsendOTPResult.catch((e: unknown) => {\n\t\t\t\t\t\tctx.context.logger.error(\"Failed to send two-factor OTP\", e);\n\t\t\t\t\t}),\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn ctx.json({ status: true });\n\t\t},\n\t);\n\n\tconst verifyOTP = createAuthEndpoint(\n\t\t\"/two-factor/verify-otp\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: verifyOTPBodySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tsummary: \"Verify two factor OTP\",\n\t\t\t\t\tdescription: \"Verify two factor OTP\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Two-factor OTP verified successfully\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\ttoken: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Session token for the authenticated session\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Unique identifier of the user\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\temail: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"email\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's email address\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\temailVerified: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Whether the email is verified\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's name\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\timage: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"uri\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's profile image URL\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Timestamp when the user was created\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Timestamp when the user was last updated\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\trequired: [\"id\", \"createdAt\", \"updatedAt\"],\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"The authenticated user object\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\trequired: [\"token\", \"user\"],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst { session, key, valid, invalid } = await verifyTwoFactor(ctx);\n\t\t\tconst toCheckOtp =\n\t\t\t\tawait ctx.context.internalAdapter.findVerificationValue(\n\t\t\t\t\t`2fa-otp-${key}`,\n\t\t\t\t);\n\t\t\tconst [otp, counter] = toCheckOtp?.value?.split(\":\") ?? [];\n\t\t\tif (!toCheckOtp || toCheckOtp.expiresAt < new Date()) {\n\t\t\t\tif (toCheckOtp) {\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(\n\t\t\t\t\t\ttoCheckOtp.id,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: TWO_FACTOR_ERROR_CODES.OTP_HAS_EXPIRED,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst allowedAttempts = options?.allowedAttempts || 5;\n\t\t\tif (parseInt(counter!) >= allowedAttempts) {\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(\n\t\t\t\t\ttoCheckOtp.id,\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: TWO_FACTOR_ERROR_CODES.TOO_MANY_ATTEMPTS_REQUEST_NEW_CODE,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst [storedValue, inputValue] = await decryptOrHashForComparison(\n\t\t\t\tctx,\n\t\t\t\totp!,\n\t\t\t\tctx.body.code,\n\t\t\t);\n\t\t\tconst isCodeValid = constantTimeEqual(\n\t\t\t\tnew TextEncoder().encode(storedValue),\n\t\t\t\tnew TextEncoder().encode(inputValue),\n\t\t\t);\n\t\t\tif (isCodeValid) {\n\t\t\t\tif (!session.user.twoFactorEnabled) {\n\t\t\t\t\tif (!session.session) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage: BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst updatedUser = await ctx.context.internalAdapter.updateUser(\n\t\t\t\t\t\tsession.user.id,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttwoFactorEnabled: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t\tconst newSession = await ctx.context.internalAdapter.createSession(\n\t\t\t\t\t\tsession.user.id,\n\t\t\t\t\t\tfalse,\n\t\t\t\t\t\tsession.session,\n\t\t\t\t\t);\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteSession(\n\t\t\t\t\t\tsession.session.token,\n\t\t\t\t\t);\n\t\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\t\tsession: newSession,\n\t\t\t\t\t\tuser: updatedUser,\n\t\t\t\t\t});\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\ttoken: newSession.token,\n\t\t\t\t\t\tuser: parseUserOutput(ctx.context.options, updatedUser),\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn valid(ctx);\n\t\t\t} else {\n\t\t\t\tawait ctx.context.internalAdapter.updateVerificationValue(\n\t\t\t\t\ttoCheckOtp.id,\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: `${otp}:${(parseInt(counter!, 10) || 0) + 1}`,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\treturn invalid(\"INVALID_CODE\");\n\t\t\t}\n\t\t},\n\t);\n\n\treturn {\n\t\tid: \"otp\",\n\t\tendpoints: {\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * POST `/two-factor/send-otp`\n\t\t\t *\n\t\t\t * ### API Methods\n\t\t\t *\n\t\t\t * **server:**\n\t\t\t * `auth.api.send2FaOTP`\n\t\t\t *\n\t\t\t * **client:**\n\t\t\t * `authClient.twoFactor.sendOtp`\n\t\t\t *\n\t\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/2fa#api-method-two-factor-send-otp)\n\t\t\t */\n\t\t\tsendTwoFactorOTP: send2FaOTP,\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * POST `/two-factor/verify-otp`\n\t\t\t *\n\t\t\t * ### API Methods\n\t\t\t *\n\t\t\t * **server:**\n\t\t\t * `auth.api.verifyOTP`\n\t\t\t *\n\t\t\t * **client:**\n\t\t\t * `authClient.twoFactor.verifyOtp`\n\t\t\t *\n\t\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/2fa#api-method-two-factor-verify-otp)\n\t\t\t */\n\t\t\tverifyTwoFactorOTP: verifyOTP,\n\t\t},\n\t} satisfies TwoFactorProvider;\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 934, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/two-factor/schema.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/two-factor/schema.ts"],"sourcesContent":["import type { BetterAuthPluginDBSchema } from \"@better-auth/core/db\";\n\nexport const schema = {\n\tuser: {\n\t\tfields: {\n\t\t\ttwoFactorEnabled: {\n\t\t\t\ttype: \"boolean\",\n\t\t\t\trequired: false,\n\t\t\t\tdefaultValue: false,\n\t\t\t\tinput: false,\n\t\t\t},\n\t\t},\n\t},\n\ttwoFactor: {\n\t\tfields: {\n\t\t\tsecret: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: true,\n\t\t\t\treturned: false,\n\t\t\t\tindex: true,\n\t\t\t},\n\t\t\tbackupCodes: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: true,\n\t\t\t\treturned: false,\n\t\t\t},\n\t\t\tuserId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: true,\n\t\t\t\treturned: false,\n\t\t\t\treferences: {\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t},\n\t\t\t\tindex: true,\n\t\t\t},\n\t\t},\n\t},\n} satisfies BetterAuthPluginDBSchema;\n"],"names":[],"mappings":";;;;;AAEA,MAAa,SAAS;IACrB,MAAM;QACL,QAAQ;YACP,kBAAkB;gBACjB,MAAM;gBACN,UAAU;gBACV,cAAc;gBACd,OAAO;aACP;QAAA,CACD;IAAA,CACD;IACD,WAAW;QACV,QAAQ;YACP,QAAQ;gBACP,MAAM;gBACN,UAAU;gBACV,UAAU;gBACV,OAAO;aACP;YACD,aAAa;gBACZ,MAAM;gBACN,UAAU;gBACV,UAAU;aACV;YACD,QAAQ;gBACP,MAAM;gBACN,UAAU;gBACV,UAAU;gBACV,YAAY;oBACX,OAAO;oBACP,OAAO;iBACP;gBACD,OAAO;aACP;SACD;IAAA,CACD;CACD"}},
    {"offset": {"line": 982, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/two-factor/totp/index.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/two-factor/totp/index.ts"],"sourcesContent":["import { createAuthEndpoint } from \"@better-auth/core/api\";\nimport { BASE_ERROR_CODES } from \"@better-auth/core/error\";\nimport { createOTP } from \"@better-auth/utils/otp\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { sessionMiddleware } from \"../../../api\";\nimport { setSessionCookie } from \"../../../cookies\";\nimport { symmetricDecrypt } from \"../../../crypto\";\nimport type { BackupCodeOptions } from \"../backup-codes\";\nimport { TWO_FACTOR_ERROR_CODES } from \"../error-code\";\nimport type {\n\tTwoFactorProvider,\n\tTwoFactorTable,\n\tUserWithTwoFactor,\n} from \"../types\";\nimport { verifyTwoFactor } from \"../verify-two-factor\";\n\nexport type TOTPOptions = {\n\t/**\n\t * Issuer\n\t */\n\tissuer?: string | undefined;\n\t/**\n\t * How many digits the otp to be\n\t *\n\t * @default 6\n\t */\n\tdigits?: (6 | 8) | undefined;\n\t/**\n\t * Period for otp in seconds.\n\t * @default 30\n\t */\n\tperiod?: number | undefined;\n\t/**\n\t * Backup codes configuration\n\t */\n\tbackupCodes?: BackupCodeOptions | undefined;\n\t/**\n\t * Disable totp\n\t */\n\tdisable?: boolean | undefined;\n};\n\nconst generateTOTPBodySchema = z.object({\n\tsecret: z.string().meta({\n\t\tdescription: \"The secret to generate the TOTP code\",\n\t}),\n});\n\nconst getTOTPURIBodySchema = z.object({\n\tpassword: z.string().meta({\n\t\tdescription: \"User password\",\n\t}),\n});\n\nconst verifyTOTPBodySchema = z.object({\n\tcode: z.string().meta({\n\t\tdescription: 'The otp code to verify. Eg: \"012345\"',\n\t}),\n\t/**\n\t * if true, the device will be trusted\n\t * for 30 days. It'll be refreshed on\n\t * every sign in request within this time.\n\t */\n\ttrustDevice: z\n\t\t.boolean()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t\"If true, the device will be trusted for 30 days. It'll be refreshed on every sign in request within this time. Eg: true\",\n\t\t})\n\t\t.optional(),\n});\n\nexport const totp2fa = (options?: TOTPOptions | undefined) => {\n\tconst opts = {\n\t\t...options,\n\t\tdigits: options?.digits || 6,\n\t\tperiod: options?.period || 30,\n\t};\n\n\tconst twoFactorTable = \"twoFactor\";\n\n\tconst generateTOTP = createAuthEndpoint(\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: generateTOTPBodySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tsummary: \"Generate TOTP code\",\n\t\t\t\t\tdescription: \"Use this endpoint to generate a TOTP code\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Successful response\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tcode: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tif (options?.disable) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t\"totp isn't configured. please pass totp option on two factor plugin to enable totp\",\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: \"totp isn't configured\",\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst code = await createOTP(ctx.body.secret, {\n\t\t\t\tperiod: opts.period,\n\t\t\t\tdigits: opts.digits,\n\t\t\t}).totp();\n\t\t\treturn { code };\n\t\t},\n\t);\n\n\tconst getTOTPURI = createAuthEndpoint(\n\t\t\"/two-factor/get-totp-uri\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tuse: [sessionMiddleware],\n\t\t\tbody: getTOTPURIBodySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tsummary: \"Get TOTP URI\",\n\t\t\t\t\tdescription: \"Use this endpoint to get the TOTP URI\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Successful response\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\ttotpURI: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tif (options?.disable) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t\"totp isn't configured. please pass totp option on two factor plugin to enable totp\",\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: \"totp isn't configured\",\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst user = ctx.context.session.user as UserWithTwoFactor;\n\t\t\tconst twoFactor = await ctx.context.adapter.findOne<TwoFactorTable>({\n\t\t\t\tmodel: twoFactorTable,\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: user.id,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\tif (!twoFactor) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: TWO_FACTOR_ERROR_CODES.TOTP_NOT_ENABLED,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst secret = await symmetricDecrypt({\n\t\t\t\tkey: ctx.context.secret,\n\t\t\t\tdata: twoFactor.secret,\n\t\t\t});\n\t\t\tawait ctx.context.password.checkPassword(user.id, ctx);\n\t\t\tconst totpURI = createOTP(secret, {\n\t\t\t\tdigits: opts.digits,\n\t\t\t\tperiod: opts.period,\n\t\t\t}).url(options?.issuer || ctx.context.appName, user.email);\n\t\t\treturn {\n\t\t\t\ttotpURI,\n\t\t\t};\n\t\t},\n\t);\n\n\tconst verifyTOTP = createAuthEndpoint(\n\t\t\"/two-factor/verify-totp\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: verifyTOTPBodySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tsummary: \"Verify two factor TOTP\",\n\t\t\t\t\tdescription: \"Verify two factor TOTP\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Successful response\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tstatus: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tif (options?.disable) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t\"totp isn't configured. please pass totp option on two factor plugin to enable totp\",\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: \"totp isn't configured\",\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst { session, valid, invalid } = await verifyTwoFactor(ctx);\n\t\t\tconst user = session.user as UserWithTwoFactor;\n\t\t\tconst twoFactor = await ctx.context.adapter.findOne<TwoFactorTable>({\n\t\t\t\tmodel: twoFactorTable,\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: user.id,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\n\t\t\tif (!twoFactor) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: TWO_FACTOR_ERROR_CODES.TOTP_NOT_ENABLED,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst decrypted = await symmetricDecrypt({\n\t\t\t\tkey: ctx.context.secret,\n\t\t\t\tdata: twoFactor.secret,\n\t\t\t});\n\t\t\tconst status = await createOTP(decrypted, {\n\t\t\t\tperiod: opts.period,\n\t\t\t\tdigits: opts.digits,\n\t\t\t}).verify(ctx.body.code);\n\t\t\tif (!status) {\n\t\t\t\treturn invalid(\"INVALID_CODE\");\n\t\t\t}\n\n\t\t\tif (!user.twoFactorEnabled) {\n\t\t\t\tif (!session.session) {\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\tmessage: BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst updatedUser = await ctx.context.internalAdapter.updateUser(\n\t\t\t\t\tuser.id,\n\t\t\t\t\t{\n\t\t\t\t\t\ttwoFactorEnabled: true,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tconst newSession = await ctx.context.internalAdapter\n\t\t\t\t\t.createSession(user.id, false, session.session)\n\t\t\t\t\t.catch((e) => {\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t});\n\n\t\t\t\tawait ctx.context.internalAdapter.deleteSession(session.session.token);\n\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\tsession: newSession,\n\t\t\t\t\tuser: updatedUser,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn valid(ctx);\n\t\t},\n\t);\n\n\treturn {\n\t\tid: \"totp\",\n\t\tendpoints: {\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * POST `/totp/generate`\n\t\t\t *\n\t\t\t * ### API Methods\n\t\t\t *\n\t\t\t * **server:**\n\t\t\t * `auth.api.generateTOTP`\n\t\t\t *\n\t\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/2fa#totp)\n\t\t\t */\n\t\t\tgenerateTOTP: generateTOTP,\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * POST `/two-factor/get-totp-uri`\n\t\t\t *\n\t\t\t * ### API Methods\n\t\t\t *\n\t\t\t * **server:**\n\t\t\t * `auth.api.getTOTPURI`\n\t\t\t *\n\t\t\t * **client:**\n\t\t\t * `authClient.twoFactor.getTotpUri`\n\t\t\t *\n\t\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/2fa#getting-totp-uri)\n\t\t\t */\n\t\t\tgetTOTPURI: getTOTPURI,\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * POST `/two-factor/verify-totp`\n\t\t\t *\n\t\t\t * ### API Methods\n\t\t\t *\n\t\t\t * **server:**\n\t\t\t * `auth.api.verifyTOTP`\n\t\t\t *\n\t\t\t * **client:**\n\t\t\t * `authClient.twoFactor.verifyTotp`\n\t\t\t *\n\t\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/2fa#verifying-totp)\n\t\t\t */\n\t\t\tverifyTOTP,\n\t\t},\n\t} satisfies TwoFactorProvider;\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1221, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/two-factor/index.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/two-factor/index.ts"],"sourcesContent":["import type { BetterAuthPlugin } from \"@better-auth/core\";\nimport {\n\tcreateAuthEndpoint,\n\tcreateAuthMiddleware,\n} from \"@better-auth/core/api\";\nimport { BASE_ERROR_CODES } from \"@better-auth/core/error\";\nimport { createHMAC } from \"@better-auth/utils/hmac\";\nimport { createOTP } from \"@better-auth/utils/otp\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { sessionMiddleware } from \"../../api\";\nimport {\n\tdeleteSessionCookie,\n\texpireCookie,\n\tsetSessionCookie,\n} from \"../../cookies\";\nimport { symmetricEncrypt } from \"../../crypto\";\nimport { generateRandomString } from \"../../crypto/random\";\nimport { mergeSchema } from \"../../db/schema\";\nimport { validatePassword } from \"../../utils/password\";\nimport type { BackupCodeOptions } from \"./backup-codes\";\nimport { backupCode2fa, generateBackupCodes } from \"./backup-codes\";\nimport {\n\tTRUST_DEVICE_COOKIE_MAX_AGE,\n\tTRUST_DEVICE_COOKIE_NAME,\n\tTWO_FACTOR_COOKIE_NAME,\n} from \"./constant\";\nimport { TWO_FACTOR_ERROR_CODES } from \"./error-code\";\nimport { otp2fa } from \"./otp\";\nimport { schema } from \"./schema\";\nimport { totp2fa } from \"./totp\";\nimport type { TwoFactorOptions, UserWithTwoFactor } from \"./types\";\n\nexport * from \"./error-code\";\n\nconst enableTwoFactorBodySchema = z.object({\n\tpassword: z.string().meta({\n\t\tdescription: \"User password\",\n\t}),\n\tissuer: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: \"Custom issuer for the TOTP URI\",\n\t\t})\n\t\t.optional(),\n});\n\nconst disableTwoFactorBodySchema = z.object({\n\tpassword: z.string().meta({\n\t\tdescription: \"User password\",\n\t}),\n});\n\nexport const twoFactor = <O extends TwoFactorOptions>(options?: O) => {\n\tconst opts = {\n\t\ttwoFactorTable: \"twoFactor\",\n\t};\n\tconst trustDeviceMaxAge =\n\t\toptions?.trustDeviceMaxAge ?? TRUST_DEVICE_COOKIE_MAX_AGE;\n\tconst backupCodeOptions = {\n\t\tstoreBackupCodes: \"encrypted\",\n\t\t...options?.backupCodeOptions,\n\t} satisfies BackupCodeOptions;\n\tconst totp = totp2fa(options?.totpOptions);\n\tconst backupCode = backupCode2fa(backupCodeOptions);\n\tconst otp = otp2fa(options?.otpOptions);\n\n\treturn {\n\t\tid: \"two-factor\",\n\t\tendpoints: {\n\t\t\t...totp.endpoints,\n\t\t\t...otp.endpoints,\n\t\t\t...backupCode.endpoints,\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * POST `/two-factor/enable`\n\t\t\t *\n\t\t\t * ### API Methods\n\t\t\t *\n\t\t\t * **server:**\n\t\t\t * `auth.api.enableTwoFactor`\n\t\t\t *\n\t\t\t * **client:**\n\t\t\t * `authClient.twoFactor.enable`\n\t\t\t *\n\t\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/2fa#api-method-two-factor-enable)\n\t\t\t */\n\t\t\tenableTwoFactor: createAuthEndpoint(\n\t\t\t\t\"/two-factor/enable\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tbody: enableTwoFactorBodySchema,\n\t\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\tsummary: \"Enable two factor authentication\",\n\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\"Use this endpoint to enable two factor authentication. This will generate a TOTP URI and backup codes. Once the user verifies the TOTP URI, the two factor authentication will be enabled.\",\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\t\t\tdescription: \"Successful response\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttotpURI: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"TOTP URI\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tbackupCodes: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Backup codes\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tconst user = ctx.context.session.user as UserWithTwoFactor;\n\t\t\t\t\tconst { password, issuer } = ctx.body;\n\t\t\t\t\tconst isPasswordValid = await validatePassword(ctx, {\n\t\t\t\t\t\tpassword,\n\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t});\n\t\t\t\t\tif (!isPasswordValid) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage: BASE_ERROR_CODES.INVALID_PASSWORD,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst secret = generateRandomString(32);\n\t\t\t\t\tconst encryptedSecret = await symmetricEncrypt({\n\t\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\t\tdata: secret,\n\t\t\t\t\t});\n\t\t\t\t\tconst backupCodes = await generateBackupCodes(\n\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t\tbackupCodeOptions,\n\t\t\t\t\t);\n\t\t\t\t\tif (options?.skipVerificationOnEnable) {\n\t\t\t\t\t\tconst updatedUser = await ctx.context.internalAdapter.updateUser(\n\t\t\t\t\t\t\tuser.id,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttwoFactorEnabled: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst newSession = await ctx.context.internalAdapter.createSession(\n\t\t\t\t\t\t\tupdatedUser.id,\n\t\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t\tctx.context.session.session,\n\t\t\t\t\t\t);\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * Update the session cookie with the new user data\n\t\t\t\t\t\t */\n\t\t\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\t\t\tsession: newSession,\n\t\t\t\t\t\t\tuser: updatedUser,\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t//remove current session\n\t\t\t\t\t\tawait ctx.context.internalAdapter.deleteSession(\n\t\t\t\t\t\t\tctx.context.session.session.token,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\t//delete existing two factor\n\t\t\t\t\tawait ctx.context.adapter.deleteMany({\n\t\t\t\t\t\tmodel: opts.twoFactorTable,\n\t\t\t\t\t\twhere: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\t\t\tvalue: user.id,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\n\t\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\t\tmodel: opts.twoFactorTable,\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tsecret: encryptedSecret,\n\t\t\t\t\t\t\tbackupCodes: backupCodes.encryptedBackupCodes,\n\t\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\tconst totpURI = createOTP(secret, {\n\t\t\t\t\t\tdigits: options?.totpOptions?.digits || 6,\n\t\t\t\t\t\tperiod: options?.totpOptions?.period,\n\t\t\t\t\t}).url(issuer || options?.issuer || ctx.context.appName, user.email);\n\t\t\t\t\treturn ctx.json({ totpURI, backupCodes: backupCodes.backupCodes });\n\t\t\t\t},\n\t\t\t),\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * POST `/two-factor/disable`\n\t\t\t *\n\t\t\t * ### API Methods\n\t\t\t *\n\t\t\t * **server:**\n\t\t\t * `auth.api.disableTwoFactor`\n\t\t\t *\n\t\t\t * **client:**\n\t\t\t * `authClient.twoFactor.disable`\n\t\t\t *\n\t\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/2fa#api-method-two-factor-disable)\n\t\t\t */\n\t\t\tdisableTwoFactor: createAuthEndpoint(\n\t\t\t\t\"/two-factor/disable\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tbody: disableTwoFactorBodySchema,\n\t\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\tsummary: \"Disable two factor authentication\",\n\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\"Use this endpoint to disable two factor authentication.\",\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\t\t\tdescription: \"Successful response\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tstatus: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tconst user = ctx.context.session.user as UserWithTwoFactor;\n\t\t\t\t\tconst { password } = ctx.body;\n\t\t\t\t\tconst isPasswordValid = await validatePassword(ctx, {\n\t\t\t\t\t\tpassword,\n\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t});\n\t\t\t\t\tif (!isPasswordValid) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage: BASE_ERROR_CODES.INVALID_PASSWORD,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst updatedUser = await ctx.context.internalAdapter.updateUser(\n\t\t\t\t\t\tuser.id,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttwoFactorEnabled: false,\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t\tawait ctx.context.adapter.delete({\n\t\t\t\t\t\tmodel: opts.twoFactorTable,\n\t\t\t\t\t\twhere: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\t\t\tvalue: updatedUser.id,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\t\t\t\t\tconst newSession = await ctx.context.internalAdapter.createSession(\n\t\t\t\t\t\tupdatedUser.id,\n\t\t\t\t\t\tfalse,\n\t\t\t\t\t\tctx.context.session.session,\n\t\t\t\t\t);\n\t\t\t\t\t/**\n\t\t\t\t\t * Update the session cookie with the new user data\n\t\t\t\t\t */\n\t\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\t\tsession: newSession,\n\t\t\t\t\t\tuser: updatedUser,\n\t\t\t\t\t});\n\t\t\t\t\t//remove current session\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteSession(\n\t\t\t\t\t\tctx.context.session.session.token,\n\t\t\t\t\t);\n\t\t\t\t\tconst disableTrustCookie = ctx.context.createAuthCookie(\n\t\t\t\t\t\tTRUST_DEVICE_COOKIE_NAME,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmaxAge: trustDeviceMaxAge,\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t\tconst disableTrustValue = await ctx.getSignedCookie(\n\t\t\t\t\t\tdisableTrustCookie.name,\n\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t);\n\t\t\t\t\tif (disableTrustValue) {\n\t\t\t\t\t\tconst [, trustId] = disableTrustValue.split(\"!\");\n\t\t\t\t\t\tif (trustId) {\n\t\t\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationByIdentifier(\n\t\t\t\t\t\t\t\ttrustId,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\texpireCookie(ctx, disableTrustCookie);\n\t\t\t\t\t}\n\t\t\t\t\treturn ctx.json({ status: true });\n\t\t\t\t},\n\t\t\t),\n\t\t},\n\t\toptions: options as NoInfer<O>,\n\t\thooks: {\n\t\t\tafter: [\n\t\t\t\t{\n\t\t\t\t\tmatcher(context) {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\tcontext.path === \"/sign-in/email\" ||\n\t\t\t\t\t\t\tcontext.path === \"/sign-in/username\" ||\n\t\t\t\t\t\t\tcontext.path === \"/sign-in/phone-number\"\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tconst data = ctx.context.newSession;\n\t\t\t\t\t\tif (!data) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!data?.user.twoFactorEnabled) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst trustDeviceCookieAttrs = ctx.context.createAuthCookie(\n\t\t\t\t\t\t\tTRUST_DEVICE_COOKIE_NAME,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tmaxAge: trustDeviceMaxAge,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t);\n\t\t\t\t\t\t// Check for trust device cookie\n\t\t\t\t\t\tconst trustDeviceCookie = await ctx.getSignedCookie(\n\t\t\t\t\t\t\ttrustDeviceCookieAttrs.name,\n\t\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tif (trustDeviceCookie) {\n\t\t\t\t\t\t\tconst [token, trustIdentifier] = trustDeviceCookie.split(\"!\");\n\t\t\t\t\t\t\tif (token && trustIdentifier) {\n\t\t\t\t\t\t\t\tconst expectedToken = await createHMAC(\n\t\t\t\t\t\t\t\t\t\"SHA-256\",\n\t\t\t\t\t\t\t\t\t\"base64urlnopad\",\n\t\t\t\t\t\t\t\t).sign(\n\t\t\t\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t\t\t\t\t`${data.user.id}!${trustIdentifier}`,\n\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\tif (token === expectedToken) {\n\t\t\t\t\t\t\t\t\t// HMAC is valid; verify the server-side record\n\t\t\t\t\t\t\t\t\tconst verificationRecord =\n\t\t\t\t\t\t\t\t\t\tawait ctx.context.internalAdapter.findVerificationValue(\n\t\t\t\t\t\t\t\t\t\t\ttrustIdentifier,\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\tverificationRecord &&\n\t\t\t\t\t\t\t\t\t\tverificationRecord.value === data.user.id &&\n\t\t\t\t\t\t\t\t\t\tverificationRecord.expiresAt > new Date()\n\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(\n\t\t\t\t\t\t\t\t\t\t\tverificationRecord.id,\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\tconst newTrustIdentifier = `trust-device-${generateRandomString(32)}`;\n\t\t\t\t\t\t\t\t\t\tconst newToken = await createHMAC(\n\t\t\t\t\t\t\t\t\t\t\t\"SHA-256\",\n\t\t\t\t\t\t\t\t\t\t\t\"base64urlnopad\",\n\t\t\t\t\t\t\t\t\t\t).sign(\n\t\t\t\t\t\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t\t\t\t\t\t\t`${data.user.id}!${newTrustIdentifier}`,\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\t\t\t\t\t\t\t\tvalue: data.user.id,\n\t\t\t\t\t\t\t\t\t\t\tidentifier: newTrustIdentifier,\n\t\t\t\t\t\t\t\t\t\t\texpiresAt: new Date(\n\t\t\t\t\t\t\t\t\t\t\t\tDate.now() + trustDeviceMaxAge * 1000,\n\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\tconst newTrustDeviceCookie = ctx.context.createAuthCookie(\n\t\t\t\t\t\t\t\t\t\t\tTRUST_DEVICE_COOKIE_NAME,\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tmaxAge: trustDeviceMaxAge,\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\tawait ctx.setSignedCookie(\n\t\t\t\t\t\t\t\t\t\t\tnewTrustDeviceCookie.name,\n\t\t\t\t\t\t\t\t\t\t\t`${newToken}!${newTrustIdentifier}`,\n\t\t\t\t\t\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t\t\t\t\t\t\ttrustDeviceCookieAttrs.attributes,\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\texpireCookie(ctx, trustDeviceCookieAttrs);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * remove the session cookie. It's set by the sign in credential\n\t\t\t\t\t\t */\n\t\t\t\t\t\tdeleteSessionCookie(ctx, true);\n\t\t\t\t\t\tawait ctx.context.internalAdapter.deleteSession(data.session.token);\n\t\t\t\t\t\tconst maxAge = options?.twoFactorCookieMaxAge ?? 10 * 60; // 10 minutes\n\t\t\t\t\t\tconst twoFactorCookie = ctx.context.createAuthCookie(\n\t\t\t\t\t\t\tTWO_FACTOR_COOKIE_NAME,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tmaxAge,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst identifier = `2fa-${generateRandomString(20)}`;\n\t\t\t\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\t\t\t\tvalue: data.user.id,\n\t\t\t\t\t\t\tidentifier,\n\t\t\t\t\t\t\texpiresAt: new Date(Date.now() + maxAge * 1000),\n\t\t\t\t\t\t});\n\t\t\t\t\t\tawait ctx.setSignedCookie(\n\t\t\t\t\t\t\ttwoFactorCookie.name,\n\t\t\t\t\t\t\tidentifier,\n\t\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t\t\ttwoFactorCookie.attributes,\n\t\t\t\t\t\t);\n\t\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\t\ttwoFactorRedirect: true,\n\t\t\t\t\t\t});\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\tschema: mergeSchema(schema, options?.schema),\n\t\trateLimit: [\n\t\t\t{\n\t\t\t\tpathMatcher(path) {\n\t\t\t\t\treturn path.startsWith(\"/two-factor/\");\n\t\t\t\t},\n\t\t\t\twindow: 10,\n\t\t\t\tmax: 3,\n\t\t\t},\n\t\t],\n\t\t$ERROR_CODES: TWO_FACTOR_ERROR_CODES,\n\t} satisfies BetterAuthPlugin;\n};\n\nexport * from \"./client\";\nexport * from \"./types\";\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1540, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/admin/access/statement.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/admin/access/statement.ts"],"sourcesContent":["import { createAccessControl } from \"../../access\";\n\nexport const defaultStatements = {\n\tuser: [\n\t\t\"create\",\n\t\t\"list\",\n\t\t\"set-role\",\n\t\t\"ban\",\n\t\t\"impersonate\",\n\t\t\"delete\",\n\t\t\"set-password\",\n\t\t\"get\",\n\t\t\"update\",\n\t],\n\tsession: [\"list\", \"revoke\", \"delete\"],\n} as const;\n\nexport const defaultAc = createAccessControl(defaultStatements);\n\nexport const adminAc = defaultAc.newRole({\n\tuser: [\n\t\t\"create\",\n\t\t\"list\",\n\t\t\"set-role\",\n\t\t\"ban\",\n\t\t\"impersonate\",\n\t\t\"delete\",\n\t\t\"set-password\",\n\t\t\"get\",\n\t\t\"update\",\n\t],\n\tsession: [\"list\", \"revoke\", \"delete\"],\n});\n\nexport const userAc = defaultAc.newRole({\n\tuser: [],\n\tsession: [],\n});\n\nexport const defaultRoles = {\n\tadmin: adminAc,\n\tuser: userAc,\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAEA,MAAa,oBAAoB;IAChC,MAAM;QACL;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACA;IACD,SAAS;QAAC;QAAQ;QAAU;KAAS;CACrC;AAED,MAAa,gBAAY,+LAAA,EAAoB,kBAAkB;AAE/D,MAAa,UAAU,UAAU,OAAA,CAAQ;IACxC,MAAM;QACL;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACA;IACD,SAAS;QAAC;QAAQ;QAAU;KAAS;CACrC,CAAC;AAEF,MAAa,SAAS,UAAU,OAAA,CAAQ;IACvC,MAAM,EAAE;IACR,SAAS,EAAE;CACX,CAAC;AAEF,MAAa,eAAe;IAC3B,OAAO;IACP,MAAM;CACN"}},
    {"offset": {"line": 1608, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/dist/plugins/admin/access/index.mjs"],"sourcesContent":["import { adminAc, defaultAc, defaultRoles, defaultStatements, userAc } from \"./statement.mjs\";\n\nexport { adminAc, defaultAc, defaultRoles, defaultStatements, userAc };"],"names":[],"mappings":";AAAA","ignoreList":[0]}},
    {"offset": {"line": 1616, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/admin/error-codes.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/admin/error-codes.ts"],"sourcesContent":["// NOTE: Error code const must be all capital of string (ref https://github.com/better-auth/better-auth/issues/4386)\nimport { defineErrorCodes } from \"@better-auth/core/utils\";\n\nexport const ADMIN_ERROR_CODES = defineErrorCodes({\n\tFAILED_TO_CREATE_USER: \"Failed to create user\",\n\tUSER_ALREADY_EXISTS: \"User already exists.\",\n\tUSER_ALREADY_EXISTS_USE_ANOTHER_EMAIL:\n\t\t\"User already exists. Use another email.\",\n\tYOU_CANNOT_BAN_YOURSELF: \"You cannot ban yourself\",\n\tYOU_ARE_NOT_ALLOWED_TO_CHANGE_USERS_ROLE:\n\t\t\"You are not allowed to change users role\",\n\tYOU_ARE_NOT_ALLOWED_TO_CREATE_USERS: \"You are not allowed to create users\",\n\tYOU_ARE_NOT_ALLOWED_TO_LIST_USERS: \"You are not allowed to list users\",\n\tYOU_ARE_NOT_ALLOWED_TO_LIST_USERS_SESSIONS:\n\t\t\"You are not allowed to list users sessions\",\n\tYOU_ARE_NOT_ALLOWED_TO_BAN_USERS: \"You are not allowed to ban users\",\n\tYOU_ARE_NOT_ALLOWED_TO_IMPERSONATE_USERS:\n\t\t\"You are not allowed to impersonate users\",\n\tYOU_ARE_NOT_ALLOWED_TO_REVOKE_USERS_SESSIONS:\n\t\t\"You are not allowed to revoke users sessions\",\n\tYOU_ARE_NOT_ALLOWED_TO_DELETE_USERS: \"You are not allowed to delete users\",\n\tYOU_ARE_NOT_ALLOWED_TO_SET_USERS_PASSWORD:\n\t\t\"You are not allowed to set users password\",\n\tBANNED_USER: \"You have been banned from this application\",\n\tYOU_ARE_NOT_ALLOWED_TO_GET_USER: \"You are not allowed to get user\",\n\tNO_DATA_TO_UPDATE: \"No data to update\",\n\tYOU_ARE_NOT_ALLOWED_TO_UPDATE_USERS: \"You are not allowed to update users\",\n\tYOU_CANNOT_REMOVE_YOURSELF: \"You cannot remove yourself\",\n\tYOU_ARE_NOT_ALLOWED_TO_SET_NON_EXISTENT_VALUE:\n\t\t\"You are not allowed to set a non-existent role value\",\n\tYOU_CANNOT_IMPERSONATE_ADMINS: \"You cannot impersonate admins\",\n\tINVALID_ROLE_TYPE: \"Invalid role type\",\n});\n"],"names":[],"mappings":";;;;;;;;AAGA,MAAa,wBAAoB,kMAAA,EAAiB;IACjD,uBAAuB;IACvB,qBAAqB;IACrB,uCACC;IACD,yBAAyB;IACzB,0CACC;IACD,qCAAqC;IACrC,mCAAmC;IACnC,4CACC;IACD,kCAAkC;IAClC,0CACC;IACD,8CACC;IACD,qCAAqC;IACrC,2CACC;IACD,aAAa;IACb,iCAAiC;IACjC,mBAAmB;IACnB,qCAAqC;IACrC,4BAA4B;IAC5B,+CACC;IACD,+BAA+B;IAC/B,mBAAmB;CACnB,CAAC"}},
    {"offset": {"line": 1653, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/admin/has-permission.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/admin/has-permission.ts"],"sourcesContent":["import { defaultRoles } from \"./access\";\nimport type { AdminOptions } from \"./types\";\n\ntype PermissionExclusive =\n\t| {\n\t\t\t/**\n\t\t\t * @deprecated Use `permissions` instead\n\t\t\t */\n\t\t\tpermission: { [key: string]: string[] };\n\t\t\tpermissions?: never | undefined;\n\t  }\n\t| {\n\t\t\tpermissions: { [key: string]: string[] };\n\t\t\tpermission?: never | undefined;\n\t  };\n\nexport const hasPermission = (\n\tinput: {\n\t\tuserId?: string | undefined;\n\t\trole?: string | undefined;\n\t\toptions?: AdminOptions | undefined;\n\t} & PermissionExclusive,\n) => {\n\tif (input.userId && input.options?.adminUserIds?.includes(input.userId)) {\n\t\treturn true;\n\t}\n\tif (!input.permissions && !input.permission) {\n\t\treturn false;\n\t}\n\tconst roles = (input.role || input.options?.defaultRole || \"user\").split(\",\");\n\tconst acRoles = input.options?.roles || defaultRoles;\n\tfor (const role of roles) {\n\t\tconst _role = acRoles[role as keyof typeof acRoles];\n\t\tconst result = _role?.authorize(input.permission ?? input.permissions);\n\t\tif (result?.success) {\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n};\n"],"names":[],"mappings":";;;;;;;;;AAgBA,MAAa,gBAAA,CACZ,UAKI;IACJ,IAAI,MAAM,MAAA,IAAU,MAAM,OAAA,EAAS,cAAc,SAAS,MAAM,MAAA,CAAO,CACtE,CAAA,OAAO;IAER,IAAI,CAAC,MAAM,WAAA,IAAe,CAAC,MAAM,UAAA,CAChC,CAAA,OAAO;IAER,MAAM,QAAA,CAAS,MAAM,IAAA,IAAQ,MAAM,OAAA,EAAS,eAAe,MAAA,EAAQ,KAAA,CAAM,IAAI;IAC7E,MAAM,UAAU,MAAM,OAAA,EAAS,SAAS,oMAAA;IACxC,KAAK,MAAM,QAAQ,MAGlB,IAFc,OAAA,CAAQ,KAAA,EACA,UAAU,MAAM,UAAA,IAAc,MAAM,WAAA,CAAY,EAC1D,QACX,CAAA,OAAO;IAGT,OAAO"}},
    {"offset": {"line": 1676, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/admin/routes.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/admin/routes.ts"],"sourcesContent":["import {\n\tcreateAuthEndpoint,\n\tcreateAuthMiddleware,\n} from \"@better-auth/core/api\";\nimport type { Session } from \"@better-auth/core/db\";\nimport type { Where } from \"@better-auth/core/db/adapter\";\nimport { BASE_ERROR_CODES } from \"@better-auth/core/error\";\nimport * as z from \"zod\";\nimport { APIError, getSessionFromCtx } from \"../../api\";\nimport {\n\tdeleteSessionCookie,\n\texpireCookie,\n\tsetSessionCookie,\n} from \"../../cookies\";\nimport { parseSessionOutput, parseUserOutput } from \"../../db/schema\";\nimport { getDate } from \"../../utils/date\";\nimport type { AccessControl } from \"../access\";\nimport type { defaultStatements } from \"./access\";\nimport { ADMIN_ERROR_CODES } from \"./error-codes\";\nimport { hasPermission } from \"./has-permission\";\nimport type {\n\tAdminOptions,\n\tInferAdminRolesFromOption,\n\tSessionWithImpersonatedBy,\n\tUserWithRole,\n} from \"./types\";\n\n/**\n * Ensures a valid session, if not will throw.\n * Will also provide additional types on the user to include role types.\n */\nconst adminMiddleware = createAuthMiddleware(async (ctx) => {\n\tconst session = await getSessionFromCtx(ctx);\n\tif (!session) {\n\t\tthrow new APIError(\"UNAUTHORIZED\");\n\t}\n\treturn {\n\t\tsession,\n\t} as {\n\t\tsession: {\n\t\t\tuser: UserWithRole;\n\t\t\tsession: Session;\n\t\t};\n\t};\n});\n\nfunction parseRoles(roles: string | string[]): string {\n\treturn Array.isArray(roles) ? roles.join(\",\") : roles;\n}\n\nconst setRoleBodySchema = z.object({\n\tuserId: z.coerce.string().meta({\n\t\tdescription: \"The user id\",\n\t}),\n\trole: z\n\t\t.union([\n\t\t\tz.string().meta({\n\t\t\t\tdescription: \"The role to set. `admin` or `user` by default\",\n\t\t\t}),\n\t\t\tz.array(\n\t\t\t\tz.string().meta({\n\t\t\t\t\tdescription: \"The roles to set. `admin` or `user` by default\",\n\t\t\t\t}),\n\t\t\t),\n\t\t])\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t\"The role to set, this can be a string or an array of strings. Eg: `admin` or `[admin, user]`\",\n\t\t}),\n});\n\n/**\n * ### Endpoint\n *\n * POST `/admin/set-role`\n *\n * ### API Methods\n *\n * **server:**\n * `auth.api.setRole`\n *\n * **client:**\n * `authClient.admin.setRole`\n *\n * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/admin#api-method-admin-set-role)\n */\nexport const setRole = <O extends AdminOptions>(opts: O) =>\n\tcreateAuthEndpoint(\n\t\t\"/admin/set-role\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: setRoleBodySchema,\n\t\t\trequireHeaders: true,\n\t\t\tuse: [adminMiddleware],\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\toperationId: \"setUserRole\",\n\t\t\t\t\tsummary: \"Set the role of a user\",\n\t\t\t\t\tdescription: \"Set the role of a user\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"User role updated\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/User\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t$Infer: {\n\t\t\t\t\tbody: {} as {\n\t\t\t\t\t\tuserId: string;\n\t\t\t\t\t\trole: InferAdminRolesFromOption<O> | InferAdminRolesFromOption<O>[];\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst canSetRole = hasPermission({\n\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\trole: ctx.context.session.user.role,\n\t\t\t\toptions: opts,\n\t\t\t\tpermissions: {\n\t\t\t\t\tuser: [\"set-role\"],\n\t\t\t\t},\n\t\t\t});\n\t\t\tif (!canSetRole) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_CHANGE_USERS_ROLE,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst roles = opts.roles;\n\t\t\tif (roles) {\n\t\t\t\tconst inputRoles = Array.isArray(ctx.body.role)\n\t\t\t\t\t? ctx.body.role\n\t\t\t\t\t: [ctx.body.role];\n\t\t\t\tfor (const role of inputRoles) {\n\t\t\t\t\tif (!roles[role as keyof typeof roles]) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage:\n\t\t\t\t\t\t\t\tADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_SET_NON_EXISTENT_VALUE,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst updatedUser = await ctx.context.internalAdapter.updateUser(\n\t\t\t\tctx.body.userId,\n\t\t\t\t{\n\t\t\t\t\trole: parseRoles(ctx.body.role),\n\t\t\t\t},\n\t\t\t);\n\t\t\treturn ctx.json({\n\t\t\t\tuser: parseUserOutput(ctx.context.options, updatedUser) as UserWithRole,\n\t\t\t});\n\t\t},\n\t);\n\nconst getUserQuerySchema = z.object({\n\tid: z.string().meta({\n\t\tdescription: \"The id of the User\",\n\t}),\n});\n\nexport const getUser = (opts: AdminOptions) =>\n\tcreateAuthEndpoint(\n\t\t\"/admin/get-user\",\n\t\t{\n\t\t\tmethod: \"GET\",\n\t\t\tquery: getUserQuerySchema,\n\t\t\tuse: [adminMiddleware],\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\toperationId: \"getUser\",\n\t\t\t\t\tsummary: \"Get an existing user\",\n\t\t\t\t\tdescription: \"Get an existing user\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"User\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/User\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst { id } = ctx.query;\n\n\t\t\tconst canGetUser = hasPermission({\n\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\trole: ctx.context.session.user.role,\n\t\t\t\toptions: opts,\n\t\t\t\tpermissions: {\n\t\t\t\t\tuser: [\"get\"],\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (!canGetUser) {\n\t\t\t\tthrow ctx.error(\"FORBIDDEN\", {\n\t\t\t\t\tmessage: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_GET_USER,\n\t\t\t\t\tcode: \"YOU_ARE_NOT_ALLOWED_TO_GET_USER\",\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst user = await ctx.context.internalAdapter.findUserById(id);\n\n\t\t\tif (!user) {\n\t\t\t\tthrow new APIError(\"NOT_FOUND\", {\n\t\t\t\t\tmessage: BASE_ERROR_CODES.USER_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn parseUserOutput(ctx.context.options, user) as UserWithRole;\n\t\t},\n\t);\n\nconst createUserBodySchema = z.object({\n\temail: z.string().meta({\n\t\tdescription: \"The email of the user\",\n\t}),\n\tpassword: z.string().optional().meta({\n\t\tdescription:\n\t\t\t\"The password of the user. If not provided, the user will be created without a credential account (useful for magic link or social login only users).\",\n\t}),\n\tname: z.string().meta({\n\t\tdescription: \"The name of the user\",\n\t}),\n\trole: z\n\t\t.union([\n\t\t\tz.string().meta({\n\t\t\t\tdescription: \"The role of the user\",\n\t\t\t}),\n\t\t\tz.array(\n\t\t\t\tz.string().meta({\n\t\t\t\t\tdescription: \"The roles of user\",\n\t\t\t\t}),\n\t\t\t),\n\t\t])\n\t\t.optional()\n\t\t.meta({\n\t\t\tdescription: `A string or array of strings representing the roles to apply to the new user. Eg: \\\"user\\\"`,\n\t\t}),\n\t/**\n\t * extra fields for user\n\t */\n\tdata: z.record(z.string(), z.any()).optional().meta({\n\t\tdescription:\n\t\t\t\"Extra fields for the user. Including custom additional fields.\",\n\t}),\n});\n\n/**\n * ### Endpoint\n *\n * POST `/admin/create-user`\n *\n * ### API Methods\n *\n * **server:**\n * `auth.api.createUser`\n *\n * **client:**\n * `authClient.admin.createUser`\n *\n * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/admin#api-method-admin-create-user)\n */\nexport const createUser = <O extends AdminOptions>(opts: O) =>\n\tcreateAuthEndpoint(\n\t\t\"/admin/create-user\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: createUserBodySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\toperationId: \"createUser\",\n\t\t\t\t\tsummary: \"Create a new user\",\n\t\t\t\t\tdescription: \"Create a new user\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"User created\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/User\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t$Infer: {\n\t\t\t\t\tbody: {} as {\n\t\t\t\t\t\temail: string;\n\t\t\t\t\t\tpassword?: string | undefined;\n\t\t\t\t\t\tname: string;\n\t\t\t\t\t\trole?:\n\t\t\t\t\t\t\t| (InferAdminRolesFromOption<O> | InferAdminRolesFromOption<O>[])\n\t\t\t\t\t\t\t| undefined;\n\t\t\t\t\t\tdata?: Record<string, any> | undefined;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = await getSessionFromCtx<{ role: string }>(ctx);\n\t\t\tif (!session && (ctx.request || ctx.headers)) {\n\t\t\t\tthrow ctx.error(\"UNAUTHORIZED\");\n\t\t\t}\n\t\t\tif (session) {\n\t\t\t\tconst canCreateUser = hasPermission({\n\t\t\t\t\tuserId: session.user.id,\n\t\t\t\t\trole: session.user.role,\n\t\t\t\t\toptions: opts,\n\t\t\t\t\tpermissions: {\n\t\t\t\t\t\tuser: [\"create\"],\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tif (!canCreateUser) {\n\t\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\t\tmessage: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_CREATE_USERS,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst email = ctx.body.email.toLowerCase();\n\t\t\tconst isValidEmail = z.email().safeParse(email);\n\t\t\tif (!isValidEmail.success) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: BASE_ERROR_CODES.INVALID_EMAIL,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst existUser =\n\t\t\t\tawait ctx.context.internalAdapter.findUserByEmail(email);\n\t\t\tif (existUser) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ADMIN_ERROR_CODES.USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst user = await ctx.context.internalAdapter.createUser<UserWithRole>({\n\t\t\t\temail: email,\n\t\t\t\tname: ctx.body.name,\n\t\t\t\trole:\n\t\t\t\t\t(ctx.body.role && parseRoles(ctx.body.role)) ??\n\t\t\t\t\topts?.defaultRole ??\n\t\t\t\t\t\"user\",\n\t\t\t\t...ctx.body.data,\n\t\t\t});\n\n\t\t\tif (!user) {\n\t\t\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\t\tmessage: ADMIN_ERROR_CODES.FAILED_TO_CREATE_USER,\n\t\t\t\t});\n\t\t\t}\n\t\t\t// Only create credential account if password is provided\n\t\t\tif (ctx.body.password) {\n\t\t\t\tconst hashedPassword = await ctx.context.password.hash(\n\t\t\t\t\tctx.body.password,\n\t\t\t\t);\n\t\t\t\tawait ctx.context.internalAdapter.linkAccount({\n\t\t\t\t\taccountId: user.id,\n\t\t\t\t\tproviderId: \"credential\",\n\t\t\t\t\tpassword: hashedPassword,\n\t\t\t\t\tuserId: user.id,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn ctx.json({\n\t\t\t\tuser: parseUserOutput(ctx.context.options, user) as UserWithRole,\n\t\t\t});\n\t\t},\n\t);\n\nconst adminUpdateUserBodySchema = z.object({\n\tuserId: z.coerce.string().meta({\n\t\tdescription: \"The user id\",\n\t}),\n\tdata: z.record(z.any(), z.any()).meta({\n\t\tdescription: \"The user data to update\",\n\t}),\n});\n\n/**\n * ### Endpoint\n *\n * POST `/admin/update-user`\n *\n * ### API Methods\n *\n * **server:**\n * `auth.api.adminUpdateUser`\n *\n * **client:**\n * `authClient.admin.updateUser`\n *\n * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/admin#api-method-admin-update-user)\n */\nexport const adminUpdateUser = (opts: AdminOptions) =>\n\tcreateAuthEndpoint(\n\t\t\"/admin/update-user\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: adminUpdateUserBodySchema,\n\t\t\tuse: [adminMiddleware],\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\toperationId: \"updateUser\",\n\t\t\t\t\tsummary: \"Update a user\",\n\t\t\t\t\tdescription: \"Update a user's details\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"User updated\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/User\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst canUpdateUser = hasPermission({\n\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\trole: ctx.context.session.user.role,\n\t\t\t\toptions: opts,\n\t\t\t\tpermissions: {\n\t\t\t\t\tuser: [\"update\"],\n\t\t\t\t},\n\t\t\t});\n\t\t\tif (!canUpdateUser) {\n\t\t\t\tthrow ctx.error(\"FORBIDDEN\", {\n\t\t\t\t\tmessage: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_UPDATE_USERS,\n\t\t\t\t\tcode: \"YOU_ARE_NOT_ALLOWED_TO_UPDATE_USERS\",\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (Object.keys(ctx.body.data).length === 0) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ADMIN_ERROR_CODES.NO_DATA_TO_UPDATE,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Role changes must be guarded by `user:set-role` and validated against the role allow-list.\n\t\t\tif (Object.prototype.hasOwnProperty.call(ctx.body.data, \"role\")) {\n\t\t\t\tconst canSetRole = hasPermission({\n\t\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\t\trole: ctx.context.session.user.role,\n\t\t\t\t\toptions: opts,\n\t\t\t\t\tpermissions: {\n\t\t\t\t\t\tuser: [\"set-role\"],\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tif (!canSetRole) {\n\t\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\t\tmessage: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_CHANGE_USERS_ROLE,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tconst roleValue = (ctx.body.data as Record<string, any>).role;\n\t\t\t\tconst inputRoles = Array.isArray(roleValue) ? roleValue : [roleValue];\n\t\t\t\tfor (const role of inputRoles) {\n\t\t\t\t\tif (typeof role !== \"string\") {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage: ADMIN_ERROR_CODES.INVALID_ROLE_TYPE,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (opts.roles && !opts.roles[role as keyof typeof opts.roles]) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage:\n\t\t\t\t\t\t\t\tADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_SET_NON_EXISTENT_VALUE,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t(ctx.body.data as Record<string, any>).role = parseRoles(\n\t\t\t\t\tinputRoles as string[],\n\t\t\t\t);\n\t\t\t}\n\t\t\tconst updatedUser = await ctx.context.internalAdapter.updateUser(\n\t\t\t\tctx.body.userId,\n\t\t\t\tctx.body.data,\n\t\t\t);\n\n\t\t\treturn ctx.json(\n\t\t\t\tparseUserOutput(ctx.context.options, updatedUser) as UserWithRole,\n\t\t\t);\n\t\t},\n\t);\n\nconst listUsersQuerySchema = z.object({\n\tsearchValue: z.string().optional().meta({\n\t\tdescription: 'The value to search for. Eg: \"some name\"',\n\t}),\n\tsearchField: z\n\t\t.enum([\"email\", \"name\"])\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The field to search in, defaults to email. Can be `email` or `name`. Eg: \"name\"',\n\t\t})\n\t\t.optional(),\n\tsearchOperator: z\n\t\t.enum([\"contains\", \"starts_with\", \"ends_with\"])\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The operator to use for the search. Can be `contains`, `starts_with` or `ends_with`. Eg: \"contains\"',\n\t\t})\n\t\t.optional(),\n\tlimit: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: \"The number of users to return\",\n\t\t})\n\t\t.or(z.number())\n\t\t.optional(),\n\toffset: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: \"The offset to start from\",\n\t\t})\n\t\t.or(z.number())\n\t\t.optional(),\n\tsortBy: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: \"The field to sort by\",\n\t\t})\n\t\t.optional(),\n\tsortDirection: z\n\t\t.enum([\"asc\", \"desc\"])\n\t\t.meta({\n\t\t\tdescription: \"The direction to sort by\",\n\t\t})\n\t\t.optional(),\n\tfilterField: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: \"The field to filter by\",\n\t\t})\n\t\t.optional(),\n\tfilterValue: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: \"The value to filter by\",\n\t\t})\n\t\t.or(z.number())\n\t\t.or(z.boolean())\n\t\t.optional(),\n\tfilterOperator: z\n\t\t.enum([\"eq\", \"ne\", \"lt\", \"lte\", \"gt\", \"gte\", \"contains\"])\n\t\t.meta({\n\t\t\tdescription: \"The operator to use for the filter\",\n\t\t})\n\t\t.optional(),\n});\n\nexport const listUsers = (opts: AdminOptions) =>\n\tcreateAuthEndpoint(\n\t\t\"/admin/list-users\",\n\t\t{\n\t\t\tmethod: \"GET\",\n\t\t\tuse: [adminMiddleware],\n\t\t\tquery: listUsersQuerySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\toperationId: \"listUsers\",\n\t\t\t\t\tsummary: \"List users\",\n\t\t\t\t\tdescription: \"List users\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"List of users\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tusers: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/User\",\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\ttotal: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tlimit: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\toffset: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\trequired: [\"users\", \"total\"],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = ctx.context.session;\n\t\t\tconst canListUsers = hasPermission({\n\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\trole: session.user.role,\n\t\t\t\toptions: opts,\n\t\t\t\tpermissions: {\n\t\t\t\t\tuser: [\"list\"],\n\t\t\t\t},\n\t\t\t});\n\t\t\tif (!canListUsers) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_LIST_USERS,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst where: Where[] = [];\n\n\t\t\tif (ctx.query?.searchValue) {\n\t\t\t\twhere.push({\n\t\t\t\t\tfield: ctx.query.searchField || \"email\",\n\t\t\t\t\toperator: ctx.query.searchOperator || \"contains\",\n\t\t\t\t\tvalue: ctx.query.searchValue,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (ctx.query?.filterValue) {\n\t\t\t\twhere.push({\n\t\t\t\t\tfield: ctx.query.filterField || \"email\",\n\t\t\t\t\toperator: ctx.query.filterOperator || \"eq\",\n\t\t\t\t\tvalue: ctx.query.filterValue,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tconst users = await ctx.context.internalAdapter.listUsers(\n\t\t\t\t\tNumber(ctx.query?.limit) || undefined,\n\t\t\t\t\tNumber(ctx.query?.offset) || undefined,\n\t\t\t\t\tctx.query?.sortBy\n\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\tfield: ctx.query.sortBy,\n\t\t\t\t\t\t\t\tdirection: ctx.query.sortDirection || \"asc\",\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t: undefined,\n\t\t\t\t\twhere.length ? where : undefined,\n\t\t\t\t);\n\t\t\t\tconst total = await ctx.context.internalAdapter.countTotalUsers(\n\t\t\t\t\twhere.length ? where : undefined,\n\t\t\t\t);\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tusers: users.map((user) =>\n\t\t\t\t\t\tparseUserOutput(ctx.context.options, user),\n\t\t\t\t\t) as UserWithRole[],\n\t\t\t\t\ttotal: total,\n\t\t\t\t\tlimit: Number(ctx.query?.limit) || undefined,\n\t\t\t\t\toffset: Number(ctx.query?.offset) || undefined,\n\t\t\t\t});\n\t\t\t} catch {\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tusers: [],\n\t\t\t\t\ttotal: 0,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t);\n\nconst listUserSessionsBodySchema = z.object({\n\tuserId: z.coerce.string().meta({\n\t\tdescription: \"The user id\",\n\t}),\n});\n\n/**\n * ### Endpoint\n *\n * POST `/admin/list-user-sessions`\n *\n * ### API Methods\n *\n * **server:**\n * `auth.api.listUserSessions`\n *\n * **client:**\n * `authClient.admin.listUserSessions`\n *\n * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/admin#api-method-admin-list-user-sessions)\n */\nexport const listUserSessions = (opts: AdminOptions) =>\n\tcreateAuthEndpoint(\n\t\t\"/admin/list-user-sessions\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tuse: [adminMiddleware],\n\t\t\tbody: listUserSessionsBodySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\toperationId: \"listUserSessions\",\n\t\t\t\t\tsummary: \"List user sessions\",\n\t\t\t\t\tdescription: \"List user sessions\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"List of user sessions\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tsessions: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/Session\",\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = ctx.context.session;\n\t\t\tconst canListSessions = hasPermission({\n\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\trole: session.user.role,\n\t\t\t\toptions: opts,\n\t\t\t\tpermissions: {\n\t\t\t\t\tsession: [\"list\"],\n\t\t\t\t},\n\t\t\t});\n\t\t\tif (!canListSessions) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_LIST_USERS_SESSIONS,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst sessions: SessionWithImpersonatedBy[] =\n\t\t\t\tawait ctx.context.internalAdapter.listSessions(ctx.body.userId);\n\t\t\treturn ctx.json({\n\t\t\t\tsessions: sessions.map((s) =>\n\t\t\t\t\tparseSessionOutput(ctx.context.options, s),\n\t\t\t\t),\n\t\t\t});\n\t\t},\n\t);\n\nconst unbanUserBodySchema = z.object({\n\tuserId: z.coerce.string().meta({\n\t\tdescription: \"The user id\",\n\t}),\n});\n\n/**\n * ### Endpoint\n *\n * POST `/admin/unban-user`\n *\n * ### API Methods\n *\n * **server:**\n * `auth.api.unbanUser`\n *\n * **client:**\n * `authClient.admin.unbanUser`\n *\n * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/admin#api-method-admin-unban-user)\n */\nexport const unbanUser = (opts: AdminOptions) =>\n\tcreateAuthEndpoint(\n\t\t\"/admin/unban-user\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: unbanUserBodySchema,\n\t\t\tuse: [adminMiddleware],\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\toperationId: \"unbanUser\",\n\t\t\t\t\tsummary: \"Unban a user\",\n\t\t\t\t\tdescription: \"Unban a user\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"User unbanned\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/User\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = ctx.context.session;\n\t\t\tconst canBanUser = hasPermission({\n\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\trole: session.user.role,\n\t\t\t\toptions: opts,\n\t\t\t\tpermissions: {\n\t\t\t\t\tuser: [\"ban\"],\n\t\t\t\t},\n\t\t\t});\n\t\t\tif (!canBanUser) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_BAN_USERS,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst user = await ctx.context.internalAdapter.updateUser(\n\t\t\t\tctx.body.userId,\n\t\t\t\t{\n\t\t\t\t\tbanned: false,\n\t\t\t\t\tbanExpires: null,\n\t\t\t\t\tbanReason: null,\n\t\t\t\t\tupdatedAt: new Date(),\n\t\t\t\t},\n\t\t\t);\n\t\t\treturn ctx.json({\n\t\t\t\tuser: parseUserOutput(ctx.context.options, user) as UserWithRole,\n\t\t\t});\n\t\t},\n\t);\n\nconst banUserBodySchema = z.object({\n\tuserId: z.coerce.string().meta({\n\t\tdescription: \"The user id\",\n\t}),\n\t/**\n\t * Reason for the ban\n\t */\n\tbanReason: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: \"The reason for the ban\",\n\t\t})\n\t\t.optional(),\n\t/**\n\t * Number of seconds until the ban expires\n\t */\n\tbanExpiresIn: z\n\t\t.number()\n\t\t.meta({\n\t\t\tdescription: \"The number of seconds until the ban expires\",\n\t\t})\n\t\t.optional(),\n});\n\n/**\n * ### Endpoint\n *\n * POST `/admin/ban-user`\n *\n * ### API Methods\n *\n * **server:**\n * `auth.api.banUser`\n *\n * **client:**\n * `authClient.admin.banUser`\n *\n * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/admin#api-method-admin-ban-user)\n */\nexport const banUser = (opts: AdminOptions) =>\n\tcreateAuthEndpoint(\n\t\t\"/admin/ban-user\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: banUserBodySchema,\n\t\t\tuse: [adminMiddleware],\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\toperationId: \"banUser\",\n\t\t\t\t\tsummary: \"Ban a user\",\n\t\t\t\t\tdescription: \"Ban a user\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"User banned\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/User\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = ctx.context.session;\n\t\t\tconst canBanUser = hasPermission({\n\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\trole: session.user.role,\n\t\t\t\toptions: opts,\n\t\t\t\tpermissions: {\n\t\t\t\t\tuser: [\"ban\"],\n\t\t\t\t},\n\t\t\t});\n\t\t\tif (!canBanUser) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_BAN_USERS,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst foundUser = await ctx.context.internalAdapter.findUserById(\n\t\t\t\tctx.body.userId,\n\t\t\t);\n\n\t\t\tif (!foundUser) {\n\t\t\t\tthrow new APIError(\"NOT_FOUND\", {\n\t\t\t\t\tmessage: BASE_ERROR_CODES.USER_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (ctx.body.userId === ctx.context.session.user.id) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ADMIN_ERROR_CODES.YOU_CANNOT_BAN_YOURSELF,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst user = await ctx.context.internalAdapter.updateUser(\n\t\t\t\tctx.body.userId,\n\t\t\t\t{\n\t\t\t\t\tbanned: true,\n\t\t\t\t\tbanReason:\n\t\t\t\t\t\tctx.body.banReason || opts?.defaultBanReason || \"No reason\",\n\t\t\t\t\tbanExpires: ctx.body.banExpiresIn\n\t\t\t\t\t\t? getDate(ctx.body.banExpiresIn, \"sec\")\n\t\t\t\t\t\t: opts?.defaultBanExpiresIn\n\t\t\t\t\t\t\t? getDate(opts.defaultBanExpiresIn, \"sec\")\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\tupdatedAt: new Date(),\n\t\t\t\t},\n\t\t\t);\n\t\t\t//revoke all sessions\n\t\t\tawait ctx.context.internalAdapter.deleteSessions(ctx.body.userId);\n\t\t\treturn ctx.json({\n\t\t\t\tuser: parseUserOutput(ctx.context.options, user) as UserWithRole,\n\t\t\t});\n\t\t},\n\t);\n\nconst impersonateUserBodySchema = z.object({\n\tuserId: z.coerce.string().meta({\n\t\tdescription: \"The user id\",\n\t}),\n});\n/**\n * ### Endpoint\n *\n * POST `/admin/impersonate-user`\n *\n * ### API Methods\n *\n * **server:**\n * `auth.api.impersonateUser`\n *\n * **client:**\n * `authClient.admin.impersonateUser`\n *\n * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/admin#api-method-admin-impersonate-user)\n */\nexport const impersonateUser = (opts: AdminOptions) =>\n\tcreateAuthEndpoint(\n\t\t\"/admin/impersonate-user\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: impersonateUserBodySchema,\n\t\t\tuse: [adminMiddleware],\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\toperationId: \"impersonateUser\",\n\t\t\t\t\tsummary: \"Impersonate a user\",\n\t\t\t\t\tdescription: \"Impersonate a user\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Impersonation session created\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tsession: {\n\t\t\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/Session\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/User\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst canImpersonateUser = hasPermission({\n\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\trole: ctx.context.session.user.role,\n\t\t\t\toptions: opts,\n\t\t\t\tpermissions: {\n\t\t\t\t\tuser: [\"impersonate\"],\n\t\t\t\t},\n\t\t\t});\n\t\t\tif (!canImpersonateUser) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_IMPERSONATE_USERS,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst targetUser = (await ctx.context.internalAdapter.findUserById(\n\t\t\t\tctx.body.userId,\n\t\t\t)) as UserWithRole | null;\n\n\t\t\tif (!targetUser) {\n\t\t\t\tthrow new APIError(\"NOT_FOUND\", {\n\t\t\t\t\tmessage: \"User not found\",\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst adminRoles = (\n\t\t\t\tArray.isArray(opts.adminRoles)\n\t\t\t\t\t? opts.adminRoles\n\t\t\t\t\t: opts.adminRoles?.split(\",\") || []\n\t\t\t).map((role) => role.trim());\n\t\t\tconst targetUserRole = (\n\t\t\t\ttargetUser.role ||\n\t\t\t\topts.defaultRole ||\n\t\t\t\t\"user\"\n\t\t\t).split(\",\");\n\t\t\tif (\n\t\t\t\topts.allowImpersonatingAdmins !== true &&\n\t\t\t\t(targetUserRole.some((role) => adminRoles.includes(role)) ||\n\t\t\t\t\topts.adminUserIds?.includes(targetUser.id))\n\t\t\t) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage: ADMIN_ERROR_CODES.YOU_CANNOT_IMPERSONATE_ADMINS,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst session = await ctx.context.internalAdapter.createSession(\n\t\t\t\ttargetUser.id,\n\t\t\t\ttrue,\n\t\t\t\t{\n\t\t\t\t\timpersonatedBy: ctx.context.session.user.id,\n\t\t\t\t\texpiresAt: opts?.impersonationSessionDuration\n\t\t\t\t\t\t? getDate(opts.impersonationSessionDuration, \"sec\")\n\t\t\t\t\t\t: getDate(60 * 60, \"sec\"), // 1 hour\n\t\t\t\t},\n\t\t\t\ttrue,\n\t\t\t);\n\t\t\tif (!session) {\n\t\t\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\t\tmessage: ADMIN_ERROR_CODES.FAILED_TO_CREATE_USER,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst authCookies = ctx.context.authCookies;\n\t\t\tdeleteSessionCookie(ctx);\n\t\t\tconst dontRememberMeCookie = await ctx.getSignedCookie(\n\t\t\t\tctx.context.authCookies.dontRememberToken.name,\n\t\t\t\tctx.context.secret,\n\t\t\t);\n\t\t\tconst adminCookieProp = ctx.context.createAuthCookie(\"admin_session\");\n\t\t\tawait ctx.setSignedCookie(\n\t\t\t\tadminCookieProp.name,\n\t\t\t\t`${ctx.context.session.session.token}:${dontRememberMeCookie || \"\"}`,\n\t\t\t\tctx.context.secret,\n\t\t\t\tauthCookies.sessionToken.attributes,\n\t\t\t);\n\t\t\tawait setSessionCookie(\n\t\t\t\tctx,\n\t\t\t\t{\n\t\t\t\t\tsession: session,\n\t\t\t\t\tuser: targetUser,\n\t\t\t\t},\n\t\t\t\ttrue,\n\t\t\t);\n\t\t\treturn ctx.json({\n\t\t\t\tsession: session,\n\t\t\t\tuser: parseUserOutput(ctx.context.options, targetUser) as UserWithRole,\n\t\t\t});\n\t\t},\n\t);\n\n/**\n * ### Endpoint\n *\n * POST `/admin/stop-impersonating`\n *\n * ### API Methods\n *\n * **server:**\n * `auth.api.stopImpersonating`\n *\n * **client:**\n * `authClient.admin.stopImpersonating`\n *\n * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/admin#api-method-admin-stop-impersonating)\n */\nexport const stopImpersonating = () =>\n\tcreateAuthEndpoint(\n\t\t\"/admin/stop-impersonating\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\trequireHeaders: true,\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = await getSessionFromCtx<\n\t\t\t\t{},\n\t\t\t\t{\n\t\t\t\t\timpersonatedBy: string;\n\t\t\t\t}\n\t\t\t>(ctx);\n\t\t\tif (!session) {\n\t\t\t\tthrow new APIError(\"UNAUTHORIZED\");\n\t\t\t}\n\t\t\tif (!session.session.impersonatedBy) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: \"You are not impersonating anyone\",\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst user = await ctx.context.internalAdapter.findUserById(\n\t\t\t\tsession.session.impersonatedBy,\n\t\t\t);\n\t\t\tif (!user) {\n\t\t\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\t\tmessage: \"Failed to find user\",\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst adminSessionCookie = ctx.context.createAuthCookie(\"admin_session\");\n\t\t\tconst adminCookie = await ctx.getSignedCookie(\n\t\t\t\tadminSessionCookie.name,\n\t\t\t\tctx.context.secret,\n\t\t\t);\n\n\t\t\tif (!adminCookie) {\n\t\t\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\t\tmessage: \"Failed to find admin session\",\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst [adminSessionToken, dontRememberMeCookie] = adminCookie?.split(\":\");\n\t\t\tconst adminSession = await ctx.context.internalAdapter.findSession(\n\t\t\t\tadminSessionToken!,\n\t\t\t);\n\t\t\tif (!adminSession || adminSession.session.userId !== user.id) {\n\t\t\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\t\tmessage: \"Failed to find admin session\",\n\t\t\t\t});\n\t\t\t}\n\t\t\tawait ctx.context.internalAdapter.deleteSession(session.session.token);\n\t\t\tawait setSessionCookie(ctx, adminSession, !!dontRememberMeCookie);\n\t\t\texpireCookie(ctx, adminSessionCookie);\n\t\t\treturn ctx.json({\n\t\t\t\tsession: parseSessionOutput(ctx.context.options, adminSession.session),\n\t\t\t\tuser: parseUserOutput(ctx.context.options, adminSession.user),\n\t\t\t});\n\t\t},\n\t);\n\nconst revokeUserSessionBodySchema = z.object({\n\tsessionToken: z.string().meta({\n\t\tdescription: \"The session token\",\n\t}),\n});\n/**\n * ### Endpoint\n *\n * POST `/admin/revoke-user-session`\n *\n * ### API Methods\n *\n * **server:**\n * `auth.api.revokeUserSession`\n *\n * **client:**\n * `authClient.admin.revokeUserSession`\n *\n * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/admin#api-method-admin-revoke-user-session)\n */\nexport const revokeUserSession = (opts: AdminOptions) =>\n\tcreateAuthEndpoint(\n\t\t\"/admin/revoke-user-session\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: revokeUserSessionBodySchema,\n\t\t\tuse: [adminMiddleware],\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\toperationId: \"revokeUserSession\",\n\t\t\t\t\tsummary: \"Revoke a user session\",\n\t\t\t\t\tdescription: \"Revoke a user session\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Session revoked\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tsuccess: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = ctx.context.session;\n\t\t\tconst canRevokeSession = hasPermission({\n\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\trole: session.user.role,\n\t\t\t\toptions: opts,\n\t\t\t\tpermissions: {\n\t\t\t\t\tsession: [\"revoke\"],\n\t\t\t\t},\n\t\t\t});\n\t\t\tif (!canRevokeSession) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_REVOKE_USERS_SESSIONS,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tawait ctx.context.internalAdapter.deleteSession(ctx.body.sessionToken);\n\t\t\treturn ctx.json({\n\t\t\t\tsuccess: true,\n\t\t\t});\n\t\t},\n\t);\n\nconst revokeUserSessionsBodySchema = z.object({\n\tuserId: z.coerce.string().meta({\n\t\tdescription: \"The user id\",\n\t}),\n});\n/**\n * ### Endpoint\n *\n * POST `/admin/revoke-user-sessions`\n *\n * ### API Methods\n *\n * **server:**\n * `auth.api.revokeUserSessions`\n *\n * **client:**\n * `authClient.admin.revokeUserSessions`\n *\n * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/admin#api-method-admin-revoke-user-sessions)\n */\nexport const revokeUserSessions = (opts: AdminOptions) =>\n\tcreateAuthEndpoint(\n\t\t\"/admin/revoke-user-sessions\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: revokeUserSessionsBodySchema,\n\t\t\tuse: [adminMiddleware],\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\toperationId: \"revokeUserSessions\",\n\t\t\t\t\tsummary: \"Revoke all user sessions\",\n\t\t\t\t\tdescription: \"Revoke all user sessions\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Sessions revoked\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tsuccess: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = ctx.context.session;\n\t\t\tconst canRevokeSession = hasPermission({\n\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\trole: session.user.role,\n\t\t\t\toptions: opts,\n\t\t\t\tpermissions: {\n\t\t\t\t\tsession: [\"revoke\"],\n\t\t\t\t},\n\t\t\t});\n\t\t\tif (!canRevokeSession) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_REVOKE_USERS_SESSIONS,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tawait ctx.context.internalAdapter.deleteSessions(ctx.body.userId);\n\t\t\treturn ctx.json({\n\t\t\t\tsuccess: true,\n\t\t\t});\n\t\t},\n\t);\n\nconst removeUserBodySchema = z.object({\n\tuserId: z.coerce.string().meta({\n\t\tdescription: \"The user id\",\n\t}),\n});\n\n/**\n * ### Endpoint\n *\n * POST `/admin/remove-user`\n *\n * ### API Methods\n *\n * **server:**\n * `auth.api.removeUser`\n *\n * **client:**\n * `authClient.admin.removeUser`\n *\n * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/admin#api-method-admin-remove-user)\n */\nexport const removeUser = (opts: AdminOptions) =>\n\tcreateAuthEndpoint(\n\t\t\"/admin/remove-user\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: removeUserBodySchema,\n\t\t\tuse: [adminMiddleware],\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\toperationId: \"removeUser\",\n\t\t\t\t\tsummary: \"Remove a user\",\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t\"Delete a user and all their sessions and accounts. Cannot be undone.\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"User removed\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tsuccess: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = ctx.context.session;\n\t\t\tconst canDeleteUser = hasPermission({\n\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\trole: session.user.role,\n\t\t\t\toptions: opts,\n\t\t\t\tpermissions: {\n\t\t\t\t\tuser: [\"delete\"],\n\t\t\t\t},\n\t\t\t});\n\t\t\tif (!canDeleteUser) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_DELETE_USERS,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (ctx.body.userId === ctx.context.session.user.id) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ADMIN_ERROR_CODES.YOU_CANNOT_REMOVE_YOURSELF,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst user = await ctx.context.internalAdapter.findUserById(\n\t\t\t\tctx.body.userId,\n\t\t\t);\n\n\t\t\tif (!user) {\n\t\t\t\tthrow new APIError(\"NOT_FOUND\", {\n\t\t\t\t\tmessage: \"User not found\",\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tawait ctx.context.internalAdapter.deleteUser(ctx.body.userId);\n\t\t\treturn ctx.json({\n\t\t\t\tsuccess: true,\n\t\t\t});\n\t\t},\n\t);\n\nconst setUserPasswordBodySchema = z.object({\n\tnewPassword: z.string().nonempty(\"newPassword cannot be empty\").meta({\n\t\tdescription: \"The new password\",\n\t}),\n\tuserId: z.coerce.string().nonempty(\"userId cannot be empty\").meta({\n\t\tdescription: \"The user id\",\n\t}),\n});\n\n/**\n * ### Endpoint\n *\n * POST `/admin/set-user-password`\n *\n * ### API Methods\n *\n * **server:**\n * `auth.api.setUserPassword`\n *\n * **client:**\n * `authClient.admin.setUserPassword`\n *\n * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/admin#api-method-admin-set-user-password)\n */\nexport const setUserPassword = (opts: AdminOptions) =>\n\tcreateAuthEndpoint(\n\t\t\"/admin/set-user-password\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: setUserPasswordBodySchema,\n\t\t\tuse: [adminMiddleware],\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\toperationId: \"setUserPassword\",\n\t\t\t\t\tsummary: \"Set a user's password\",\n\t\t\t\t\tdescription: \"Set a user's password\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Password set\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tstatus: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst canSetUserPassword = hasPermission({\n\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\trole: ctx.context.session.user.role,\n\t\t\t\toptions: opts,\n\t\t\t\tpermissions: {\n\t\t\t\t\tuser: [\"set-password\"],\n\t\t\t\t},\n\t\t\t});\n\t\t\tif (!canSetUserPassword) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage: ADMIN_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_SET_USERS_PASSWORD,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst { newPassword, userId } = ctx.body;\n\t\t\tconst minPasswordLength = ctx.context.password.config.minPasswordLength;\n\t\t\tif (newPassword.length < minPasswordLength) {\n\t\t\t\tctx.context.logger.error(\"Password is too short\");\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: BASE_ERROR_CODES.PASSWORD_TOO_SHORT,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst maxPasswordLength = ctx.context.password.config.maxPasswordLength;\n\t\t\tif (newPassword.length > maxPasswordLength) {\n\t\t\t\tctx.context.logger.error(\"Password is too long\");\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: BASE_ERROR_CODES.PASSWORD_TOO_LONG,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst hashedPassword = await ctx.context.password.hash(newPassword);\n\t\t\tawait ctx.context.internalAdapter.updatePassword(userId, hashedPassword);\n\t\t\treturn ctx.json({\n\t\t\t\tstatus: true,\n\t\t\t});\n\t\t},\n\t);\n\nconst userHasPermissionBodySchema = z\n\t.object({\n\t\tuserId: z.coerce.string().optional().meta({\n\t\t\tdescription: `The user id. Eg: \"user-id\"`,\n\t\t}),\n\t\trole: z.string().optional().meta({\n\t\t\tdescription: `The role to check permission for. Eg: \"admin\"`,\n\t\t}),\n\t})\n\t.and(\n\t\tz.union([\n\t\t\tz.object({\n\t\t\t\tpermission: z.record(z.string(), z.array(z.string())),\n\t\t\t\tpermissions: z.undefined(),\n\t\t\t}),\n\t\t\tz.object({\n\t\t\t\tpermission: z.undefined(),\n\t\t\t\tpermissions: z.record(z.string(), z.array(z.string())),\n\t\t\t}),\n\t\t]),\n\t);\n\n/**\n * ### Endpoint\n *\n * POST `/admin/has-permission`\n *\n * ### API Methods\n *\n * **server:**\n * `auth.api.userHasPermission`\n *\n * **client:**\n * `authClient.admin.hasPermission`\n *\n * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/admin#api-method-admin-has-permission)\n */\nexport const userHasPermission = <O extends AdminOptions>(opts: O) => {\n\ttype DefaultStatements = typeof defaultStatements;\n\ttype Statements =\n\t\tO[\"ac\"] extends AccessControl<infer S> ? S : DefaultStatements;\n\n\ttype PermissionType = {\n\t\t[key in keyof Statements]?: Array<\n\t\t\tStatements[key] extends readonly unknown[]\n\t\t\t\t? Statements[key][number]\n\t\t\t\t: never\n\t\t>;\n\t};\n\ttype PermissionExclusive =\n\t\t| {\n\t\t\t\t/**\n\t\t\t\t * @deprecated Use `permissions` instead\n\t\t\t\t */\n\t\t\t\tpermission: PermissionType;\n\t\t\t\tpermissions?: never | undefined;\n\t\t  }\n\t\t| {\n\t\t\t\tpermissions: PermissionType;\n\t\t\t\tpermission?: never | undefined;\n\t\t  };\n\n\treturn createAuthEndpoint(\n\t\t\"/admin/has-permission\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: userHasPermissionBodySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"Check if the user has permission\",\n\t\t\t\t\trequestBody: {\n\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\tpermission: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"The permission to check\",\n\t\t\t\t\t\t\t\t\t\t\tdeprecated: true,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tpermissions: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"The permission to check\",\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\trequired: [\"permissions\"],\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\terror: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tsuccess: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\trequired: [\"success\"],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t$Infer: {\n\t\t\t\t\tbody: {} as PermissionExclusive & {\n\t\t\t\t\t\tuserId?: string | undefined;\n\t\t\t\t\t\trole?: InferAdminRolesFromOption<O> | undefined;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tif (!ctx.body?.permission && !ctx.body?.permissions) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: \"invalid permission check. no permission(s) were passed.\",\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst session = await getSessionFromCtx(ctx);\n\n\t\t\tif (!session && (ctx.request || ctx.headers)) {\n\t\t\t\tthrow new APIError(\"UNAUTHORIZED\");\n\t\t\t}\n\t\t\tif (!session && !ctx.body.userId && !ctx.body.role) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: \"user id or role is required\",\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst user =\n\t\t\t\tsession?.user ||\n\t\t\t\t(ctx.body.role\n\t\t\t\t\t? { id: ctx.body.userId || \"\", role: ctx.body.role }\n\t\t\t\t\t: null) ||\n\t\t\t\t(ctx.body.userId\n\t\t\t\t\t? ((await ctx.context.internalAdapter.findUserById(\n\t\t\t\t\t\t\tctx.body.userId as string,\n\t\t\t\t\t\t)) as { role?: string | undefined; id: string })\n\t\t\t\t\t: null);\n\t\t\tif (!user) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: \"user not found\",\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst result = hasPermission({\n\t\t\t\tuserId: user.id,\n\t\t\t\trole: user.role,\n\t\t\t\toptions: opts as AdminOptions,\n\t\t\t\tpermissions: (ctx.body.permissions ?? ctx.body.permission) as any,\n\t\t\t});\n\t\t\treturn ctx.json({\n\t\t\t\terror: null,\n\t\t\t\tsuccess: result,\n\t\t\t});\n\t\t},\n\t);\n};\n"],"names":["where: Where[]","sessions: SessionWithImpersonatedBy[]"],"mappings":"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"}},
    {"offset": {"line": 3035, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/admin/schema.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/admin/schema.ts"],"sourcesContent":["import type { BetterAuthPluginDBSchema } from \"@better-auth/core/db\";\n\nexport const schema = {\n\tuser: {\n\t\tfields: {\n\t\t\trole: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: false,\n\t\t\t\tinput: false,\n\t\t\t},\n\t\t\tbanned: {\n\t\t\t\ttype: \"boolean\",\n\t\t\t\tdefaultValue: false,\n\t\t\t\trequired: false,\n\t\t\t\tinput: false,\n\t\t\t},\n\t\t\tbanReason: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: false,\n\t\t\t\tinput: false,\n\t\t\t},\n\t\t\tbanExpires: {\n\t\t\t\ttype: \"date\",\n\t\t\t\trequired: false,\n\t\t\t\tinput: false,\n\t\t\t},\n\t\t},\n\t},\n\tsession: {\n\t\tfields: {\n\t\t\timpersonatedBy: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: false,\n\t\t\t},\n\t\t},\n\t},\n} satisfies BetterAuthPluginDBSchema;\n\nexport type AdminSchema = typeof schema;\n"],"names":[],"mappings":";;;;;AAEA,MAAa,SAAS;IACrB,MAAM;QACL,QAAQ;YACP,MAAM;gBACL,MAAM;gBACN,UAAU;gBACV,OAAO;aACP;YACD,QAAQ;gBACP,MAAM;gBACN,cAAc;gBACd,UAAU;gBACV,OAAO;aACP;YACD,WAAW;gBACV,MAAM;gBACN,UAAU;gBACV,OAAO;aACP;YACD,YAAY;gBACX,MAAM;gBACN,UAAU;gBACV,OAAO;aACP;SACD;IAAA,CACD;IACD,SAAS;QACR,QAAQ;YACP,gBAAgB;gBACf,MAAM;gBACN,UAAU;aACV;QAAA,CACD;IAAA,CACD;CACD"}},
    {"offset": {"line": 3081, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/admin/admin.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/admin/admin.ts"],"sourcesContent":["import type { BetterAuthPlugin } from \"@better-auth/core\";\nimport { createAuthMiddleware } from \"@better-auth/core/api\";\nimport { BetterAuthError } from \"@better-auth/core/error\";\nimport { APIError } from \"../../api\";\nimport { mergeSchema } from \"../../db/schema\";\nimport { getEndpointResponse } from \"../../utils/plugin-helper\";\nimport { defaultRoles } from \"./access\";\nimport { ADMIN_ERROR_CODES } from \"./error-codes\";\nimport {\n\tadminUpdateUser,\n\tbanUser,\n\tcreateUser,\n\tgetUser,\n\timpersonateUser,\n\tlistUserSessions,\n\tlistUsers,\n\tremoveUser,\n\trevokeUserSession,\n\trevokeUserSessions,\n\tsetRole,\n\tsetUserPassword,\n\tstopImpersonating,\n\tunbanUser,\n\tuserHasPermission,\n} from \"./routes\";\nimport { schema } from \"./schema\";\nimport type {\n\tAdminOptions,\n\tSessionWithImpersonatedBy,\n\tUserWithRole,\n} from \"./types\";\n\nexport const admin = <O extends AdminOptions>(options?: O | undefined) => {\n\tconst opts = {\n\t\t...(options || {}),\n\t\tdefaultRole: options?.defaultRole ?? \"user\",\n\t\tadminRoles: options?.adminRoles ?? [\"admin\"],\n\t\tbannedUserMessage:\n\t\t\toptions?.bannedUserMessage ??\n\t\t\t\"You have been banned from this application. Please contact support if you believe this is an error.\",\n\t} as O &\n\t\tRequired<\n\t\t\tPick<AdminOptions, \"defaultRole\" | \"adminRoles\" | \"bannedUserMessage\">\n\t\t>;\n\n\tif (options?.adminRoles) {\n\t\tconst adminRoles = Array.isArray(options.adminRoles)\n\t\t\t? options.adminRoles\n\t\t\t: [...options.adminRoles.split(\",\")];\n\t\tconst invalidRoles = adminRoles.filter(\n\t\t\t(role) =>\n\t\t\t\t!Object.keys(options?.roles || defaultRoles)\n\t\t\t\t\t.map((r) => r.toLowerCase())\n\t\t\t\t\t.includes(role.toLowerCase()),\n\t\t);\n\t\tif (invalidRoles.length > 0) {\n\t\t\tthrow new BetterAuthError(\n\t\t\t\t`Invalid admin roles: ${invalidRoles.join(\", \")}. Admin roles must be defined in the 'roles' configuration.`,\n\t\t\t);\n\t\t}\n\t}\n\n\treturn {\n\t\tid: \"admin\",\n\t\tinit() {\n\t\t\treturn {\n\t\t\t\toptions: {\n\t\t\t\t\tdatabaseHooks: {\n\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\tcreate: {\n\t\t\t\t\t\t\t\tasync before(user) {\n\t\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\t\t\trole: options?.defaultRole ?? \"user\",\n\t\t\t\t\t\t\t\t\t\t\t...user,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsession: {\n\t\t\t\t\t\t\tcreate: {\n\t\t\t\t\t\t\t\tasync before(session, ctx) {\n\t\t\t\t\t\t\t\t\tif (!ctx) {\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tconst user = (await ctx.context.internalAdapter.findUserById(\n\t\t\t\t\t\t\t\t\t\tsession.userId,\n\t\t\t\t\t\t\t\t\t)) as UserWithRole;\n\n\t\t\t\t\t\t\t\t\tif (user.banned) {\n\t\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\t\tuser.banExpires &&\n\t\t\t\t\t\t\t\t\t\t\tnew Date(user.banExpires).getTime() < Date.now()\n\t\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\t\tawait ctx.context.internalAdapter.updateUser(\n\t\t\t\t\t\t\t\t\t\t\t\tsession.userId,\n\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\tbanned: false,\n\t\t\t\t\t\t\t\t\t\t\t\t\tbanReason: null,\n\t\t\t\t\t\t\t\t\t\t\t\t\tbanExpires: null,\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\t\tctx &&\n\t\t\t\t\t\t\t\t\t\t\t(ctx.path.startsWith(\"/callback\") ||\n\t\t\t\t\t\t\t\t\t\t\t\tctx.path.startsWith(\"/oauth2/callback\"))\n\t\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\t\tconst redirectURI =\n\t\t\t\t\t\t\t\t\t\t\t\tctx.context.options.onAPIError?.errorURL ||\n\t\t\t\t\t\t\t\t\t\t\t\t`${ctx.context.baseURL}/error`;\n\t\t\t\t\t\t\t\t\t\t\tthrow ctx.redirect(\n\t\t\t\t\t\t\t\t\t\t\t\t`${redirectURI}?error=banned&error_description=${opts.bannedUserMessage}`,\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\t\t\t\t\t\t\tmessage: opts.bannedUserMessage,\n\t\t\t\t\t\t\t\t\t\t\tcode: \"BANNED_USER\",\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\thooks: {\n\t\t\tafter: [\n\t\t\t\t{\n\t\t\t\t\tmatcher(context) {\n\t\t\t\t\t\treturn context.path === \"/list-sessions\";\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tconst response =\n\t\t\t\t\t\t\tawait getEndpointResponse<SessionWithImpersonatedBy[]>(ctx);\n\n\t\t\t\t\t\tif (!response) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst newJson = response.filter((session) => {\n\t\t\t\t\t\t\treturn !session.impersonatedBy;\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn ctx.json(newJson);\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\tendpoints: {\n\t\t\tsetRole: setRole(opts),\n\t\t\tgetUser: getUser(opts),\n\t\t\tcreateUser: createUser(opts),\n\t\t\tadminUpdateUser: adminUpdateUser(opts),\n\t\t\tlistUsers: listUsers(opts),\n\t\t\tlistUserSessions: listUserSessions(opts),\n\t\t\tunbanUser: unbanUser(opts),\n\t\t\tbanUser: banUser(opts),\n\t\t\timpersonateUser: impersonateUser(opts),\n\t\t\tstopImpersonating: stopImpersonating(),\n\t\t\trevokeUserSession: revokeUserSession(opts),\n\t\t\trevokeUserSessions: revokeUserSessions(opts),\n\t\t\tremoveUser: removeUser(opts),\n\t\t\tsetUserPassword: setUserPassword(opts),\n\t\t\tuserHasPermission: userHasPermission(opts as O),\n\t\t},\n\t\t$ERROR_CODES: ADMIN_ERROR_CODES,\n\t\tschema: mergeSchema(schema, opts.schema),\n\t\toptions: options as NoInfer<O>,\n\t} satisfies BetterAuthPlugin;\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3215, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/dist/plugins/admin/index.mjs"],"sourcesContent":["import { admin } from \"./admin.mjs\";\n\nexport { admin };"],"names":[],"mappings":";AAAA","ignoreList":[0]}},
    {"offset": {"line": 3223, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/anonymous/error-codes.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/anonymous/error-codes.ts"],"sourcesContent":["import { defineErrorCodes } from \"@better-auth/core/utils\";\n\nexport const ANONYMOUS_ERROR_CODES = defineErrorCodes({\n\tINVALID_EMAIL_FORMAT: \"Email was not generated in a valid format\",\n\tFAILED_TO_CREATE_USER: \"Failed to create user\",\n\tCOULD_NOT_CREATE_SESSION: \"Could not create session\",\n\tANONYMOUS_USERS_CANNOT_SIGN_IN_AGAIN_ANONYMOUSLY:\n\t\t\"Anonymous users cannot sign in again anonymously\",\n\tFAILED_TO_DELETE_ANONYMOUS_USER: \"Failed to delete anonymous user\",\n\tUSER_IS_NOT_ANONYMOUS: \"User is not anonymous\",\n\tDELETE_ANONYMOUS_USER_DISABLED: \"Deleting anonymous users is disabled\",\n});\n"],"names":[],"mappings":";;;;;;;;AAEA,MAAa,4BAAwB,kMAAA,EAAiB;IACrD,sBAAsB;IACtB,uBAAuB;IACvB,0BAA0B;IAC1B,kDACC;IACD,iCAAiC;IACjC,uBAAuB;IACvB,gCAAgC;CAChC,CAAC"}},
    {"offset": {"line": 3246, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/anonymous/schema.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/anonymous/schema.ts"],"sourcesContent":["import type { BetterAuthPluginDBSchema } from \"@better-auth/core/db\";\n\nexport const schema = {\n\tuser: {\n\t\tfields: {\n\t\t\tisAnonymous: {\n\t\t\t\ttype: \"boolean\",\n\t\t\t\trequired: false,\n\t\t\t\tinput: false,\n\t\t\t\tdefaultValue: false,\n\t\t\t},\n\t\t},\n\t},\n} satisfies BetterAuthPluginDBSchema;\n"],"names":[],"mappings":";;;;;AAEA,MAAa,SAAS;IACrB,MAAM;QACL,QAAQ;YACP,aAAa;gBACZ,MAAM;gBACN,UAAU;gBACV,OAAO;gBACP,cAAc;aACd;QAAA,CACD;IAAA,CACD;AAAA,CACD"}},
    {"offset": {"line": 3269, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/anonymous/index.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/anonymous/index.ts"],"sourcesContent":["import type { BetterAuthPlugin } from \"@better-auth/core\";\nimport {\n\tcreateAuthEndpoint,\n\tcreateAuthMiddleware,\n} from \"@better-auth/core/api\";\nimport { generateId } from \"@better-auth/core/utils\";\nimport * as z from \"zod\";\nimport {\n\tAPIError,\n\tgetSessionFromCtx,\n\tsensitiveSessionMiddleware,\n} from \"../../api\";\nimport {\n\tdeleteSessionCookie,\n\tparseSetCookieHeader,\n\tsetSessionCookie,\n} from \"../../cookies\";\nimport { mergeSchema, parseUserOutput } from \"../../db/schema\";\nimport { ANONYMOUS_ERROR_CODES } from \"./error-codes\";\nimport { schema } from \"./schema\";\nimport type {\n\tAnonymousOptions,\n\tAnonymousSession,\n\tUserWithAnonymous,\n} from \"./types\";\n\nasync function getAnonUserEmail(\n\toptions: AnonymousOptions | undefined,\n): Promise<string> {\n\tconst customEmail = await options?.generateRandomEmail?.();\n\tif (customEmail) {\n\t\tconst validation = z.email().safeParse(customEmail);\n\t\tif (!validation.success) {\n\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\tmessage: ANONYMOUS_ERROR_CODES.INVALID_EMAIL_FORMAT,\n\t\t\t});\n\t\t}\n\t\treturn customEmail;\n\t}\n\n\tconst id = generateId();\n\tif (options?.emailDomainName) {\n\t\treturn `temp-${id}@${options.emailDomainName}`;\n\t}\n\n\treturn `temp@${id}.com`;\n}\n\nexport const anonymous = (options?: AnonymousOptions | undefined) => {\n\treturn {\n\t\tid: \"anonymous\",\n\t\tendpoints: {\n\t\t\tsignInAnonymous: createAuthEndpoint(\n\t\t\t\t\"/sign-in/anonymous\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\tdescription: \"Sign in anonymously\",\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\t\t\tdescription: \"Sign in anonymously\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/User\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tsession: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/Session\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\t// If the current request already has a valid anonymous session, we should\n\t\t\t\t\t// reject any further attempts to create another anonymous user. This\n\t\t\t\t\t// prevents an anonymous user from signing in anonymously again while they\n\t\t\t\t\t// are already authenticated.\n\t\t\t\t\tconst existingSession = await getSessionFromCtx<{\n\t\t\t\t\t\tisAnonymous: boolean | null;\n\t\t\t\t\t}>(ctx, { disableRefresh: true });\n\t\t\t\t\tif (existingSession?.user.isAnonymous) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage:\n\t\t\t\t\t\t\t\tANONYMOUS_ERROR_CODES.ANONYMOUS_USERS_CANNOT_SIGN_IN_AGAIN_ANONYMOUSLY,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tconst email = await getAnonUserEmail(options);\n\t\t\t\t\tconst name = (await options?.generateName?.(ctx)) || \"Anonymous\";\n\t\t\t\t\tconst newUser = await ctx.context.internalAdapter.createUser({\n\t\t\t\t\t\temail,\n\t\t\t\t\t\temailVerified: false,\n\t\t\t\t\t\tisAnonymous: true,\n\t\t\t\t\t\tname,\n\t\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t\t\tupdatedAt: new Date(),\n\t\t\t\t\t});\n\t\t\t\t\tif (!newUser) {\n\t\t\t\t\t\tthrow ctx.error(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\t\t\t\tmessage: ANONYMOUS_ERROR_CODES.FAILED_TO_CREATE_USER,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst session = await ctx.context.internalAdapter.createSession(\n\t\t\t\t\t\tnewUser.id,\n\t\t\t\t\t);\n\t\t\t\t\tif (!session) {\n\t\t\t\t\t\treturn ctx.json(null, {\n\t\t\t\t\t\t\tstatus: 400,\n\t\t\t\t\t\t\tbody: {\n\t\t\t\t\t\t\t\tmessage: ANONYMOUS_ERROR_CODES.COULD_NOT_CREATE_SESSION,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\t\tsession,\n\t\t\t\t\t\tuser: newUser,\n\t\t\t\t\t});\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\ttoken: session.token,\n\t\t\t\t\t\tuser: parseUserOutput(ctx.context.options, newUser),\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t),\n\t\t\tdeleteAnonymousUser: createAuthEndpoint(\n\t\t\t\t\"/delete-anonymous-user\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tuse: [sensitiveSessionMiddleware],\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\tdescription: \"Delete an anonymous user\",\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\t\t\tdescription: \"Anonymous user deleted\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tsuccess: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\"400\": {\n\t\t\t\t\t\t\t\t\tdescription: \"Anonymous user deletion is disabled\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tmessage: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\trequired: [\"message\"],\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\"500\": {\n\t\t\t\t\t\t\t\t\tdescription: \"Internal server error\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tmessage: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\trequired: [\"message\"],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tconst session = ctx.context.session as AnonymousSession;\n\n\t\t\t\t\tif (options?.disableDeleteAnonymousUser) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage: ANONYMOUS_ERROR_CODES.DELETE_ANONYMOUS_USER_DISABLED,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!session.user.isAnonymous) {\n\t\t\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\t\t\tmessage: ANONYMOUS_ERROR_CODES.USER_IS_NOT_ANONYMOUS,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait ctx.context.internalAdapter.deleteUser(session.user.id);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tctx.context.logger.error(\"Failed to delete anonymous user\", error);\n\t\t\t\t\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\t\t\t\tmessage: ANONYMOUS_ERROR_CODES.FAILED_TO_DELETE_ANONYMOUS_USER,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tdeleteSessionCookie(ctx);\n\t\t\t\t\treturn ctx.json({ success: true });\n\t\t\t\t},\n\t\t\t),\n\t\t},\n\t\thooks: {\n\t\t\tafter: [\n\t\t\t\t{\n\t\t\t\t\tmatcher(ctx) {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\tctx.path?.startsWith(\"/sign-in\") ||\n\t\t\t\t\t\t\tctx.path?.startsWith(\"/sign-up\") ||\n\t\t\t\t\t\t\tctx.path?.startsWith(\"/callback\") ||\n\t\t\t\t\t\t\tctx.path?.startsWith(\"/oauth2/callback\") ||\n\t\t\t\t\t\t\tctx.path?.startsWith(\"/magic-link/verify\") ||\n\t\t\t\t\t\t\tctx.path?.startsWith(\"/email-otp/verify-email\") ||\n\t\t\t\t\t\t\tctx.path?.startsWith(\"/one-tap/callback\") ||\n\t\t\t\t\t\t\tctx.path?.startsWith(\"/passkey/verify-authentication\") ||\n\t\t\t\t\t\t\tctx.path?.startsWith(\"/phone-number/verify\") ||\n\t\t\t\t\t\t\tfalse\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tconst setCookie = ctx.context.responseHeaders?.get(\"set-cookie\");\n\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * We can consider the user is about to sign in or sign up\n\t\t\t\t\t\t * if the response contains a session token.\n\t\t\t\t\t\t */\n\t\t\t\t\t\tconst sessionTokenName = ctx.context.authCookies.sessionToken.name;\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * The user is about to link their account.\n\t\t\t\t\t\t */\n\t\t\t\t\t\tconst sessionCookie = parseSetCookieHeader(setCookie || \"\")\n\t\t\t\t\t\t\t.get(sessionTokenName)\n\t\t\t\t\t\t\t?.value.split(\".\")[0]!;\n\n\t\t\t\t\t\tif (!sessionCookie) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * Make sure the user had an anonymous session.\n\t\t\t\t\t\t */\n\t\t\t\t\t\tconst session = await getSessionFromCtx<{\n\t\t\t\t\t\t\tisAnonymous: boolean | null;\n\t\t\t\t\t\t}>(ctx, {\n\t\t\t\t\t\t\tdisableRefresh: true,\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (!session || !session.user.isAnonymous) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (ctx.path === \"/sign-in/anonymous\" && !ctx.context.newSession) {\n\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\tmessage:\n\t\t\t\t\t\t\t\t\tANONYMOUS_ERROR_CODES.ANONYMOUS_USERS_CANNOT_SIGN_IN_AGAIN_ANONYMOUSLY,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst newSession = ctx.context.newSession;\n\t\t\t\t\t\tif (!newSession) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst user = {\n\t\t\t\t\t\t\t...session.user,\n\t\t\t\t\t\t\t// Type hack to ensure `isAnonymous` is correctly inferred as true.\n\t\t\t\t\t\t\t// Without this, `isAnonymous` is inferred as `boolean | null` despite\n\t\t\t\t\t\t\t// the conditional checks above suggesting otherwise.\n\t\t\t\t\t\t\tisAnonymous: session.user.isAnonymous,\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t// At this point the user is linking their previous anonymous account with a\n\t\t\t\t\t\t// new credential (email / social). Invoke the provided callback so that the\n\t\t\t\t\t\t// integrator can perform any additional logic such as transferring data\n\t\t\t\t\t\t// from the anonymous user to the new user.\n\t\t\t\t\t\tif (options?.onLinkAccount) {\n\t\t\t\t\t\t\tawait options?.onLinkAccount?.({\n\t\t\t\t\t\t\t\tanonymousUser: { session: session.session, user },\n\t\t\t\t\t\t\t\tnewUser: newSession,\n\t\t\t\t\t\t\t\tctx,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst newSessionUser = newSession.user as\n\t\t\t\t\t\t\t| (UserWithAnonymous & Record<string, any>)\n\t\t\t\t\t\t\t| undefined;\n\t\t\t\t\t\tconst isSameUser = newSessionUser?.id === session.user.id;\n\t\t\t\t\t\tconst newSessionIsAnonymous = Boolean(newSessionUser?.isAnonymous);\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\toptions?.disableDeleteAnonymousUser ||\n\t\t\t\t\t\t\tisSameUser ||\n\t\t\t\t\t\t\tnewSessionIsAnonymous\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tawait ctx.context.internalAdapter.deleteUser(session.user.id);\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\toptions,\n\t\tschema: mergeSchema(schema, options?.schema),\n\t\t$ERROR_CODES: ANONYMOUS_ERROR_CODES,\n\t} satisfies BetterAuthPlugin;\n};\n\nexport type * from \"./types\";\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3515, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/bearer/index.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/bearer/index.ts"],"sourcesContent":["import type { BetterAuthPlugin } from \"@better-auth/core\";\nimport { createAuthMiddleware } from \"@better-auth/core/api\";\nimport { createHMAC } from \"@better-auth/utils/hmac\";\nimport { serializeSignedCookie } from \"better-call\";\nimport { parseSetCookieHeader } from \"../../cookies\";\n\nexport interface BearerOptions {\n\t/**\n\t * If true, only signed tokens\n\t * will be converted to session\n\t * cookies\n\t *\n\t * @default false\n\t */\n\trequireSignature?: boolean | undefined;\n}\n\n/**\n * Converts bearer token to session cookie\n */\nexport const bearer = (options?: BearerOptions | undefined) => {\n\treturn {\n\t\tid: \"bearer\",\n\t\thooks: {\n\t\t\tbefore: [\n\t\t\t\t{\n\t\t\t\t\tmatcher(context) {\n\t\t\t\t\t\treturn Boolean(\n\t\t\t\t\t\t\tcontext.request?.headers.get(\"authorization\") ||\n\t\t\t\t\t\t\t\tcontext.headers?.get(\"authorization\"),\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (c) => {\n\t\t\t\t\t\tconst token =\n\t\t\t\t\t\t\tc.request?.headers.get(\"authorization\")?.replace(\"Bearer \", \"\") ||\n\t\t\t\t\t\t\tc.headers?.get(\"Authorization\")?.replace(\"Bearer \", \"\");\n\t\t\t\t\t\tif (!token) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet signedToken = \"\";\n\t\t\t\t\t\tif (token.includes(\".\")) {\n\t\t\t\t\t\t\tsignedToken = token.replace(\"=\", \"\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (options?.requireSignature) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tsignedToken = (\n\t\t\t\t\t\t\t\tawait serializeSignedCookie(\"\", token, c.context.secret)\n\t\t\t\t\t\t\t).replace(\"=\", \"\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst decodedToken = decodeURIComponent(signedToken);\n\t\t\t\t\t\t\tconst isValid = await createHMAC(\n\t\t\t\t\t\t\t\t\"SHA-256\",\n\t\t\t\t\t\t\t\t\"base64urlnopad\",\n\t\t\t\t\t\t\t).verify(\n\t\t\t\t\t\t\t\tc.context.secret,\n\t\t\t\t\t\t\t\tdecodedToken.split(\".\")[0]!,\n\t\t\t\t\t\t\t\tdecodedToken.split(\".\")[1]!,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (!isValid) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst existingHeaders = (c.request?.headers ||\n\t\t\t\t\t\t\tc.headers) as Headers;\n\t\t\t\t\t\tconst headers = new Headers({\n\t\t\t\t\t\t\t...Object.fromEntries(existingHeaders?.entries()),\n\t\t\t\t\t\t});\n\t\t\t\t\t\theaders.append(\n\t\t\t\t\t\t\t\"cookie\",\n\t\t\t\t\t\t\t`${c.context.authCookies.sessionToken.name}=${signedToken}`,\n\t\t\t\t\t\t);\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tcontext: {\n\t\t\t\t\t\t\t\theaders,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t};\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t],\n\t\t\tafter: [\n\t\t\t\t{\n\t\t\t\t\tmatcher(context) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tconst setCookie = ctx.context.responseHeaders?.get(\"set-cookie\");\n\t\t\t\t\t\tif (!setCookie) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst parsedCookies = parseSetCookieHeader(setCookie);\n\t\t\t\t\t\tconst cookieName = ctx.context.authCookies.sessionToken.name;\n\t\t\t\t\t\tconst sessionCookie = parsedCookies.get(cookieName);\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t!sessionCookie ||\n\t\t\t\t\t\t\t!sessionCookie.value ||\n\t\t\t\t\t\t\tsessionCookie[\"max-age\"] === 0\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst token = sessionCookie.value;\n\t\t\t\t\t\tconst exposedHeaders =\n\t\t\t\t\t\t\tctx.context.responseHeaders?.get(\n\t\t\t\t\t\t\t\t\"access-control-expose-headers\",\n\t\t\t\t\t\t\t) || \"\";\n\t\t\t\t\t\tconst headersSet = new Set(\n\t\t\t\t\t\t\texposedHeaders\n\t\t\t\t\t\t\t\t.split(\",\")\n\t\t\t\t\t\t\t\t.map((header) => header.trim())\n\t\t\t\t\t\t\t\t.filter(Boolean),\n\t\t\t\t\t\t);\n\t\t\t\t\t\theadersSet.add(\"set-auth-token\");\n\t\t\t\t\t\tctx.setHeader(\"set-auth-token\", token);\n\t\t\t\t\t\tctx.setHeader(\n\t\t\t\t\t\t\t\"Access-Control-Expose-Headers\",\n\t\t\t\t\t\t\tArray.from(headersSet).join(\", \"),\n\t\t\t\t\t\t);\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\toptions,\n\t} satisfies BetterAuthPlugin;\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;GAoBA,MAAa,SAAA,CAAU,YAAwC;IAC9D,OAAO;QACN,IAAI;QACJ,OAAO;YACN,QAAQ;gBACP;oBACC,SAAQ,OAAA,EAAS;wBAChB,OAAO,QACN,QAAQ,OAAA,EAAS,QAAQ,IAAI,gBAAgB,IAC5C,QAAQ,OAAA,EAAS,IAAI,gBAAgB,CACtC;;oBAEF,aAAS,2LAAA,EAAqB,OAAO,MAAM;wBAC1C,MAAM,QACL,EAAE,OAAA,EAAS,QAAQ,IAAI,gBAAgB,EAAE,QAAQ,WAAW,GAAG,IAC/D,EAAE,OAAA,EAAS,IAAI,gBAAgB,EAAE,QAAQ,WAAW,GAAG;wBACxD,IAAI,CAAC,MACJ,CAAA;wBAGD,IAAI,cAAc;wBAClB,IAAI,MAAM,QAAA,CAAS,IAAI,CACtB,CAAA,cAAc,MAAM,OAAA,CAAQ,KAAK,GAAG;6BAC9B;4BACN,IAAI,SAAS,iBACZ,CAAA;4BAED,cAAA,CACC,UAAM,6KAAA,EAAsB,IAAI,OAAO,EAAE,OAAA,CAAQ,MAAA,CAAO,EACvD,OAAA,CAAQ,KAAK,GAAG;;wBAEnB,IAAI;4BACH,MAAM,eAAe,mBAAmB,YAAY;4BASpD,IAAI,CARY,UAAM,0KAAA,EACrB,WACA,iBACA,CAAC,MAAA,CACD,EAAE,OAAA,CAAQ,MAAA,EACV,aAAa,KAAA,CAAM,IAAI,CAAC,EAAA,EACxB,aAAa,KAAA,CAAM,IAAI,CAAC,EAAA,CACxB,CAEA,CAAA;iCAEM;4BACP;;wBAED,MAAM,kBAAmB,EAAE,OAAA,EAAS,WACnC,EAAE,OAAA;wBACH,MAAM,UAAU,IAAI,QAAQ;4BAC3B,GAAG,OAAO,WAAA,CAAY,iBAAiB,SAAS,CAAC;wBAAA,CACjD,CAAC;wBACF,QAAQ,MAAA,CACP,UACA,GAAG,EAAE,OAAA,CAAQ,WAAA,CAAY,YAAA,CAAa,IAAA,CAAK,CAAA,EAAG,aAAA,CAC9C;wBACD,OAAO;4BACN,SAAS;gCACR;4BAAA,CACA;wBAAA,CACD;sBACA;iBACF;aACD;YACD,OAAO;gBACN;oBACC,SAAQ,OAAA,EAAS;wBAChB,OAAO;;oBAER,aAAS,2LAAA,EAAqB,OAAO,QAAQ;wBAC5C,MAAM,YAAY,IAAI,OAAA,CAAQ,eAAA,EAAiB,IAAI,aAAa;wBAChE,IAAI,CAAC,UACJ,CAAA;wBAED,MAAM,oBAAgB,+LAAA,EAAqB,UAAU;wBACrD,MAAM,aAAa,IAAI,OAAA,CAAQ,WAAA,CAAY,YAAA,CAAa,IAAA;wBACxD,MAAM,gBAAgB,cAAc,GAAA,CAAI,WAAW;wBACnD,IACC,CAAC,iBACD,CAAC,cAAc,KAAA,IACf,aAAA,CAAc,UAAA,KAAe,EAE7B,CAAA;wBAED,MAAM,QAAQ,cAAc,KAAA;wBAC5B,MAAM,iBACL,IAAI,OAAA,CAAQ,eAAA,EAAiB,IAC5B,gCACA,IAAI;wBACN,MAAM,aAAa,IAAI,IACtB,eACE,KAAA,CAAM,IAAI,CACV,GAAA,CAAA,CAAK,SAAW,OAAO,IAAA,EAAM,CAAC,CAC9B,MAAA,CAAO,QAAQ,CACjB;wBACD,WAAW,GAAA,CAAI,iBAAiB;wBAChC,IAAI,SAAA,CAAU,kBAAkB,MAAM;wBACtC,IAAI,SAAA,CACH,iCACA,MAAM,IAAA,CAAK,WAAW,CAAC,IAAA,CAAK,KAAK,CACjC;sBACA;iBACF;aACD;SACD;QACD;KACA"}},
    {"offset": {"line": 3601, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/captcha/constants.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/captcha/constants.ts"],"sourcesContent":["import type { Provider } from \"./types\";\n\nexport const defaultEndpoints = [\n\t\"/sign-up/email\",\n\t\"/sign-in/email\",\n\t\"/request-password-reset\",\n];\n\nexport const Providers = {\n\tCLOUDFLARE_TURNSTILE: \"cloudflare-turnstile\",\n\tGOOGLE_RECAPTCHA: \"google-recaptcha\",\n\tHCAPTCHA: \"hcaptcha\",\n\tCAPTCHAFOX: \"captchafox\",\n} as const;\n\nexport const siteVerifyMap: Record<Provider, string> = {\n\t[Providers.CLOUDFLARE_TURNSTILE]:\n\t\t\"https://challenges.cloudflare.com/turnstile/v0/siteverify\",\n\t[Providers.GOOGLE_RECAPTCHA]:\n\t\t\"https://www.google.com/recaptcha/api/siteverify\",\n\t[Providers.HCAPTCHA]: \"https://api.hcaptcha.com/siteverify\",\n\t[Providers.CAPTCHAFOX]: \"https://api.captchafox.com/siteverify\",\n};\n"],"names":["siteVerifyMap: Record<Provider, string>"],"mappings":";;;;;;;;;AAEA,MAAa,mBAAmB;IAC/B;IACA;IACA;CACA;AAED,MAAa,YAAY;IACxB,sBAAsB;IACtB,kBAAkB;IAClB,UAAU;IACV,YAAY;CACZ;AAED,MAAaA,gBAA0C;KACrD,UAAU,oBAAA,CAAA,EACV;KACA,UAAU,gBAAA,CAAA,EACV;KACA,UAAU,QAAA,CAAA,EAAW;KACrB,UAAU,UAAA,CAAA,EAAa;CACxB"}},
    {"offset": {"line": 3633, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/captcha/error-codes.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/captcha/error-codes.ts"],"sourcesContent":["// These error codes are returned by the API\nimport { defineErrorCodes } from \"@better-auth/core/utils\";\n\nexport const EXTERNAL_ERROR_CODES = defineErrorCodes({\n\tVERIFICATION_FAILED: \"Captcha verification failed\",\n\tMISSING_RESPONSE: \"Missing CAPTCHA response\",\n\tUNKNOWN_ERROR: \"Something went wrong\",\n});\n\n// These error codes are only visible in the server logs\nexport const INTERNAL_ERROR_CODES = defineErrorCodes({\n\tMISSING_SECRET_KEY: \"Missing secret key\",\n\tSERVICE_UNAVAILABLE: \"CAPTCHA service unavailable\",\n});\n"],"names":[],"mappings":";;;;;;;;;;AAGA,MAAa,2BAAuB,kMAAA,EAAiB;IACpD,qBAAqB;IACrB,kBAAkB;IAClB,eAAe;CACf,CAAC;AAGF,MAAa,2BAAuB,kMAAA,EAAiB;IACpD,oBAAoB;IACpB,qBAAqB;CACrB,CAAC"}},
    {"offset": {"line": 3658, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/captcha/utils.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/captcha/utils.ts"],"sourcesContent":["export const encodeToURLParams = (obj: Record<string, any>): string => {\n\tif (typeof obj !== \"object\" || obj === null || Array.isArray(obj)) {\n\t\tthrow new Error(\"Input must be a non-null object.\");\n\t}\n\n\tconst params = new URLSearchParams();\n\n\tfor (const [key, value] of Object.entries(obj)) {\n\t\tif (value !== undefined && value !== null) {\n\t\t\tparams.append(key, String(value));\n\t\t}\n\t}\n\n\treturn params.toString();\n};\n"],"names":[],"mappings":";;;;;AAAA,MAAa,oBAAA,CAAqB,QAAqC;IACtE,IAAI,OAAO,QAAQ,YAAY,QAAQ,QAAQ,MAAM,OAAA,CAAQ,IAAI,CAChE,CAAA,MAAM,IAAI,MAAM,mCAAmC;IAGpD,MAAM,SAAS,IAAI,iBAAiB;IAEpC,KAAK,MAAM,CAAC,KAAK,MAAA,IAAU,OAAO,OAAA,CAAQ,IAAI,CAC7C,IAAI,UAAU,KAAA,KAAa,UAAU,KACpC,CAAA,OAAO,MAAA,CAAO,KAAK,OAAO,MAAM,CAAC;IAInC,OAAO,OAAO,QAAA,EAAU"}},
    {"offset": {"line": 3675, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/captcha/verify-handlers/captchafox.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/captcha/verify-handlers/captchafox.ts"],"sourcesContent":["import { betterFetch } from \"@better-fetch/fetch\";\nimport { middlewareResponse } from \"../../../utils/middleware-response\";\nimport { EXTERNAL_ERROR_CODES, INTERNAL_ERROR_CODES } from \"../error-codes\";\nimport { encodeToURLParams } from \"../utils\";\n\ntype Params = {\n\tsiteVerifyURL: string;\n\tsecretKey: string;\n\tcaptchaResponse: string;\n\tsiteKey?: string | undefined;\n\tremoteIP?: string | undefined;\n};\n\ntype SiteVerifyResponse = {\n\tsuccess: boolean;\n\tchallenge_ts: number;\n\thostname: string;\n\t\"error-codes\":\n\t\t| Array<\n\t\t\t\t| \"missing-input-secret\"\n\t\t\t\t| \"invalid-input-secret\"\n\t\t\t\t| \"invalid-input-sitekey\"\n\t\t\t\t| \"missing-input-response\"\n\t\t\t\t| \"invalid-input-response\"\n\t\t\t\t| \"expired-input-response\"\n\t\t\t\t| \"timeout-or-duplicate\"\n\t\t\t\t| \"bad-request\"\n\t\t  >\n\t\t| undefined;\n\tinsights: Record<string, unknown> | undefined; // ENTERPRISE feature: insights into verification.\n};\n\nexport const captchaFox = async ({\n\tsiteVerifyURL,\n\tcaptchaResponse,\n\tsecretKey,\n\tsiteKey,\n\tremoteIP,\n}: Params) => {\n\tconst response = await betterFetch<SiteVerifyResponse>(siteVerifyURL, {\n\t\tmethod: \"POST\",\n\t\theaders: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\n\t\tbody: encodeToURLParams({\n\t\t\tsecret: secretKey,\n\t\t\tresponse: captchaResponse,\n\t\t\t...(siteKey && { sitekey: siteKey }),\n\t\t\t...(remoteIP && { remoteIp: remoteIP }),\n\t\t}),\n\t});\n\n\tif (!response.data || response.error) {\n\t\tthrow new Error(INTERNAL_ERROR_CODES.SERVICE_UNAVAILABLE);\n\t}\n\n\tif (!response.data.success) {\n\t\treturn middlewareResponse({\n\t\t\tmessage: EXTERNAL_ERROR_CODES.VERIFICATION_FAILED,\n\t\t\tstatus: 403,\n\t\t});\n\t}\n\n\treturn undefined;\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;AAgCA,MAAa,aAAa,OAAO,EAChC,aAAA,EACA,eAAA,EACA,SAAA,EACA,OAAA,EACA,QAAA,EAAA,KACa;IACb,MAAM,WAAW,UAAM,4KAAA,EAAgC,eAAe;QACrE,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAA,CAAqC;QAChE,UAAM,6LAAA,EAAkB;YACvB,QAAQ;YACR,UAAU;YACV,GAAI,WAAW;gBAAE,SAAS;YAAA,CAAS;YACnC,GAAI,YAAY;gBAAE,UAAU;YAAA,CAAU;SACtC,CAAC;KACF,CAAC;IAEF,IAAI,CAAC,SAAS,IAAA,IAAQ,SAAS,KAAA,CAC9B,CAAA,MAAM,IAAI,MAAM,yMAAA,CAAqB,mBAAA,CAAoB;IAG1D,IAAI,CAAC,SAAS,IAAA,CAAK,OAAA,CAClB,CAAA,WAAO,kMAAA,EAAmB;QACzB,SAAS,yMAAA,CAAqB,mBAAA;QAC9B,QAAQ;KACR,CAAC"}},
    {"offset": {"line": 3717, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/captcha/verify-handlers/cloudflare-turnstile.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/captcha/verify-handlers/cloudflare-turnstile.ts"],"sourcesContent":["import { betterFetch } from \"@better-fetch/fetch\";\nimport { middlewareResponse } from \"../../../utils/middleware-response\";\nimport { EXTERNAL_ERROR_CODES, INTERNAL_ERROR_CODES } from \"../error-codes\";\n\ntype Params = {\n\tsiteVerifyURL: string;\n\tsecretKey: string;\n\tcaptchaResponse: string;\n\tremoteIP?: string | undefined;\n};\n\ntype SiteVerifyResponse = {\n\tsuccess: boolean;\n\t\"error-codes\"?: string[] | undefined;\n\tchallenge_ts?: string | undefined;\n\thostname?: string | undefined;\n\taction?: string | undefined;\n\tcdata?: string | undefined;\n\tmetadata?:\n\t\t| {\n\t\t\t\tinteractive: boolean;\n\t\t  }\n\t\t| undefined;\n\tmessages?: string[] | undefined;\n};\n\nexport const cloudflareTurnstile = async ({\n\tsiteVerifyURL,\n\tcaptchaResponse,\n\tsecretKey,\n\tremoteIP,\n}: Params) => {\n\tconst response = await betterFetch<SiteVerifyResponse>(siteVerifyURL, {\n\t\tmethod: \"POST\",\n\t\theaders: { \"Content-Type\": \"application/json\" },\n\t\tbody: JSON.stringify({\n\t\t\tsecret: secretKey,\n\t\t\tresponse: captchaResponse,\n\t\t\t...(remoteIP && { remoteip: remoteIP }),\n\t\t}),\n\t});\n\n\tif (!response.data || response.error) {\n\t\tthrow new Error(INTERNAL_ERROR_CODES.SERVICE_UNAVAILABLE);\n\t}\n\n\tif (!response.data.success) {\n\t\treturn middlewareResponse({\n\t\t\tmessage: EXTERNAL_ERROR_CODES.VERIFICATION_FAILED,\n\t\t\tstatus: 403,\n\t\t});\n\t}\n\n\treturn undefined;\n};\n"],"names":[],"mappings":";;;;;;;;;;;AA0BA,MAAa,sBAAsB,OAAO,EACzC,aAAA,EACA,eAAA,EACA,SAAA,EACA,QAAA,EAAA,KACa;IACb,MAAM,WAAW,UAAM,4KAAA,EAAgC,eAAe;QACrE,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAA,CAAoB;QAC/C,MAAM,KAAK,SAAA,CAAU;YACpB,QAAQ;YACR,UAAU;YACV,GAAI,YAAY;gBAAE,UAAU;YAAA,CAAU;SACtC,CAAC;KACF,CAAC;IAEF,IAAI,CAAC,SAAS,IAAA,IAAQ,SAAS,KAAA,CAC9B,CAAA,MAAM,IAAI,MAAM,yMAAA,CAAqB,mBAAA,CAAoB;IAG1D,IAAI,CAAC,SAAS,IAAA,CAAK,OAAA,CAClB,CAAA,WAAO,kMAAA,EAAmB;QACzB,SAAS,yMAAA,CAAqB,mBAAA;QAC9B,QAAQ;KACR,CAAC"}},
    {"offset": {"line": 3754, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/captcha/verify-handlers/google-recaptcha.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/captcha/verify-handlers/google-recaptcha.ts"],"sourcesContent":["import { betterFetch } from \"@better-fetch/fetch\";\nimport { middlewareResponse } from \"../../../utils/middleware-response\";\nimport { EXTERNAL_ERROR_CODES, INTERNAL_ERROR_CODES } from \"../error-codes\";\nimport { encodeToURLParams } from \"../utils\";\n\ntype Params = {\n\tsiteVerifyURL: string;\n\tsecretKey: string;\n\tcaptchaResponse: string;\n\tminScore?: number | undefined;\n\tremoteIP?: string | undefined;\n};\n\ntype SiteVerifyResponse = {\n\tsuccess: boolean;\n\tchallenge_ts: string;\n\thostname: string;\n\t\"error-codes\":\n\t\t| Array<\n\t\t\t\t| \"missing-input-secret\"\n\t\t\t\t| \"invalid-input-secret\"\n\t\t\t\t| \"missing-input-response\"\n\t\t\t\t| \"invalid-input-response\"\n\t\t\t\t| \"bad-request\"\n\t\t\t\t| \"timeout-or-duplicate\"\n\t\t  >\n\t\t| undefined;\n};\n\ntype SiteVerifyV3Response = SiteVerifyResponse & {\n\tscore: number;\n};\n\nconst isV3 = (\n\tresponse: SiteVerifyResponse | SiteVerifyV3Response,\n): response is SiteVerifyV3Response => {\n\treturn \"score\" in response && typeof response.score === \"number\";\n};\n\nexport const googleRecaptcha = async ({\n\tsiteVerifyURL,\n\tcaptchaResponse,\n\tsecretKey,\n\tminScore = 0.5,\n\tremoteIP,\n}: Params) => {\n\tconst response = await betterFetch<SiteVerifyResponse | SiteVerifyV3Response>(\n\t\tsiteVerifyURL,\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\theaders: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\n\t\t\tbody: encodeToURLParams({\n\t\t\t\tsecret: secretKey,\n\t\t\t\tresponse: captchaResponse,\n\t\t\t\t...(remoteIP && { remoteip: remoteIP }),\n\t\t\t}),\n\t\t},\n\t);\n\n\tif (!response.data || response.error) {\n\t\tthrow new Error(INTERNAL_ERROR_CODES.SERVICE_UNAVAILABLE);\n\t}\n\n\tif (\n\t\t!response.data.success ||\n\t\t(isV3(response.data) && response.data.score < minScore)\n\t) {\n\t\treturn middlewareResponse({\n\t\t\tmessage: EXTERNAL_ERROR_CODES.VERIFICATION_FAILED,\n\t\t\tstatus: 403,\n\t\t});\n\t}\n\n\treturn undefined;\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;AAiCA,MAAM,OAAA,CACL,aACsC;IACtC,OAAO,WAAW,YAAY,OAAO,SAAS,KAAA,KAAU;;AAGzD,MAAa,kBAAkB,OAAO,EACrC,aAAA,EACA,eAAA,EACA,SAAA,EACA,WAAW,EAAA,EACX,QAAA,EAAA,KACa;IACb,MAAM,WAAW,UAAM,4KAAA,EACtB,eACA;QACC,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAA,CAAqC;QAChE,UAAM,6LAAA,EAAkB;YACvB,QAAQ;YACR,UAAU;YACV,GAAI,YAAY;gBAAE,UAAU;YAAA,CAAU;SACtC,CAAC;KACF,CACD;IAED,IAAI,CAAC,SAAS,IAAA,IAAQ,SAAS,KAAA,CAC9B,CAAA,MAAM,IAAI,MAAM,yMAAA,CAAqB,mBAAA,CAAoB;IAG1D,IACC,CAAC,SAAS,IAAA,CAAK,OAAA,IACd,KAAK,SAAS,IAAA,CAAK,IAAI,SAAS,IAAA,CAAK,KAAA,GAAQ,SAE9C,CAAA,WAAO,kMAAA,EAAmB;QACzB,SAAS,yMAAA,CAAqB,mBAAA;QAC9B,QAAQ;KACR,CAAC"}},
    {"offset": {"line": 3796, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/captcha/verify-handlers/h-captcha.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/captcha/verify-handlers/h-captcha.ts"],"sourcesContent":["import { betterFetch } from \"@better-fetch/fetch\";\nimport { middlewareResponse } from \"../../../utils/middleware-response\";\nimport { EXTERNAL_ERROR_CODES, INTERNAL_ERROR_CODES } from \"../error-codes\";\nimport { encodeToURLParams } from \"../utils\";\n\ntype Params = {\n\tsiteVerifyURL: string;\n\tsecretKey: string;\n\tcaptchaResponse: string;\n\tsiteKey?: string | undefined;\n\tremoteIP?: string | undefined;\n};\n\ntype SiteVerifyResponse = {\n\tsuccess: boolean;\n\tchallenge_ts: number;\n\thostname: string;\n\tcredit: true | false | undefined;\n\t\"error-codes\":\n\t\t| Array<\n\t\t\t\t| \"missing-input-secret\"\n\t\t\t\t| \"invalid-input-secret\"\n\t\t\t\t| \"missing-input-response\"\n\t\t\t\t| \"invalid-input-response\"\n\t\t\t\t| \"expired-input-response\"\n\t\t\t\t| \"already-seen-response\"\n\t\t\t\t| \"bad-request\"\n\t\t\t\t| \"missing-remoteip\"\n\t\t\t\t| \"invalid-remoteip\"\n\t\t\t\t| \"not-using-dummy-passcode\"\n\t\t\t\t| \"sitekey-secret-mismatch\"\n\t\t  >\n\t\t| undefined;\n\tscore: number | undefined; // ENTERPRISE feature: a score denoting malicious activity.\n\tscore_reason: Array<unknown> | undefined; // ENTERPRISE feature: reason(s) for score.\n};\n\nexport const hCaptcha = async ({\n\tsiteVerifyURL,\n\tcaptchaResponse,\n\tsecretKey,\n\tsiteKey,\n\tremoteIP,\n}: Params) => {\n\tconst response = await betterFetch<SiteVerifyResponse>(siteVerifyURL, {\n\t\tmethod: \"POST\",\n\t\theaders: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\n\t\tbody: encodeToURLParams({\n\t\t\tsecret: secretKey,\n\t\t\tresponse: captchaResponse,\n\t\t\t...(siteKey && { sitekey: siteKey }),\n\t\t\t...(remoteIP && { remoteip: remoteIP }),\n\t\t}),\n\t});\n\n\tif (!response.data || response.error) {\n\t\tthrow new Error(INTERNAL_ERROR_CODES.SERVICE_UNAVAILABLE);\n\t}\n\n\tif (!response.data.success) {\n\t\treturn middlewareResponse({\n\t\t\tmessage: EXTERNAL_ERROR_CODES.VERIFICATION_FAILED,\n\t\t\tstatus: 403,\n\t\t});\n\t}\n\n\treturn undefined;\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;AAqCA,MAAa,WAAW,OAAO,EAC9B,aAAA,EACA,eAAA,EACA,SAAA,EACA,OAAA,EACA,QAAA,EAAA,KACa;IACb,MAAM,WAAW,UAAM,4KAAA,EAAgC,eAAe;QACrE,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAA,CAAqC;QAChE,UAAM,6LAAA,EAAkB;YACvB,QAAQ;YACR,UAAU;YACV,GAAI,WAAW;gBAAE,SAAS;YAAA,CAAS;YACnC,GAAI,YAAY;gBAAE,UAAU;YAAA,CAAU;SACtC,CAAC;KACF,CAAC;IAEF,IAAI,CAAC,SAAS,IAAA,IAAQ,SAAS,KAAA,CAC9B,CAAA,MAAM,IAAI,MAAM,yMAAA,CAAqB,mBAAA,CAAoB;IAG1D,IAAI,CAAC,SAAS,IAAA,CAAK,OAAA,CAClB,CAAA,WAAO,kMAAA,EAAmB;QACzB,SAAS,yMAAA,CAAqB,mBAAA;QAC9B,QAAQ;KACR,CAAC"}},
    {"offset": {"line": 3838, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/dist/plugins/captcha/verify-handlers/index.mjs"],"sourcesContent":["import { captchaFox } from \"./captchafox.mjs\";\nimport { cloudflareTurnstile } from \"./cloudflare-turnstile.mjs\";\nimport { googleRecaptcha } from \"./google-recaptcha.mjs\";\nimport { hCaptcha } from \"./h-captcha.mjs\";\n\nexport {  };"],"names":[],"mappings":";AAAA;AACA;AACA;AACA","ignoreList":[0]}},
    {"offset": {"line": 3852, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/captcha/index.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/captcha/index.ts"],"sourcesContent":["import type { BetterAuthPlugin } from \"@better-auth/core\";\nimport { getIp } from \"../../utils/get-request-ip\";\nimport { middlewareResponse } from \"../../utils/middleware-response\";\nimport { defaultEndpoints, Providers, siteVerifyMap } from \"./constants\";\nimport { EXTERNAL_ERROR_CODES, INTERNAL_ERROR_CODES } from \"./error-codes\";\nimport type { CaptchaOptions } from \"./types\";\nimport * as verifyHandlers from \"./verify-handlers\";\n\nexport type * from \"./types\";\n\nexport const captcha = (options: CaptchaOptions) =>\n\t({\n\t\tid: \"captcha\",\n\t\tonRequest: async (request, ctx) => {\n\t\t\ttry {\n\t\t\t\tconst endpoints = options.endpoints?.length\n\t\t\t\t\t? options.endpoints\n\t\t\t\t\t: defaultEndpoints;\n\n\t\t\t\tif (!endpoints.some((endpoint) => request.url.includes(endpoint)))\n\t\t\t\t\treturn undefined;\n\n\t\t\t\tif (!options.secretKey) {\n\t\t\t\t\tthrow new Error(INTERNAL_ERROR_CODES.MISSING_SECRET_KEY);\n\t\t\t\t}\n\n\t\t\t\tconst captchaResponse = request.headers.get(\"x-captcha-response\");\n\t\t\t\tconst remoteUserIP = getIp(request, ctx.options) ?? undefined;\n\n\t\t\t\tif (!captchaResponse) {\n\t\t\t\t\treturn middlewareResponse({\n\t\t\t\t\t\tmessage: EXTERNAL_ERROR_CODES.MISSING_RESPONSE,\n\t\t\t\t\t\tstatus: 400,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tconst siteVerifyURL =\n\t\t\t\t\toptions.siteVerifyURLOverride || siteVerifyMap[options.provider];\n\n\t\t\t\tconst handlerParams = {\n\t\t\t\t\tsiteVerifyURL,\n\t\t\t\t\tcaptchaResponse,\n\t\t\t\t\tsecretKey: options.secretKey,\n\t\t\t\t\tremoteIP: remoteUserIP,\n\t\t\t\t};\n\n\t\t\t\tif (options.provider === Providers.CLOUDFLARE_TURNSTILE) {\n\t\t\t\t\treturn await verifyHandlers.cloudflareTurnstile(handlerParams);\n\t\t\t\t}\n\n\t\t\t\tif (options.provider === Providers.GOOGLE_RECAPTCHA) {\n\t\t\t\t\treturn await verifyHandlers.googleRecaptcha({\n\t\t\t\t\t\t...handlerParams,\n\t\t\t\t\t\tminScore: options.minScore,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (options.provider === Providers.HCAPTCHA) {\n\t\t\t\t\treturn await verifyHandlers.hCaptcha({\n\t\t\t\t\t\t...handlerParams,\n\t\t\t\t\t\tsiteKey: options.siteKey,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (options.provider === Providers.CAPTCHAFOX) {\n\t\t\t\t\treturn await verifyHandlers.captchaFox({\n\t\t\t\t\t\t...handlerParams,\n\t\t\t\t\t\tsiteKey: options.siteKey,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} catch (_error) {\n\t\t\t\tconst errorMessage =\n\t\t\t\t\t_error instanceof Error ? _error.message : undefined;\n\n\t\t\t\tctx.logger.error(errorMessage ?? \"Unknown error\", {\n\t\t\t\t\tendpoint: request.url,\n\t\t\t\t\tmessage: _error,\n\t\t\t\t});\n\n\t\t\t\treturn middlewareResponse({\n\t\t\t\t\tmessage: EXTERNAL_ERROR_CODES.UNKNOWN_ERROR,\n\t\t\t\t\tstatus: 500,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\toptions,\n\t}) satisfies BetterAuthPlugin;\n"],"names":["verifyHandlers.cloudflareTurnstile","verifyHandlers.googleRecaptcha","verifyHandlers.hCaptcha","verifyHandlers.captchaFox"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAUA,MAAa,UAAA,CAAW,UAAA,CACtB;QACA,IAAI;QACJ,WAAW,OAAO,SAAS,QAAQ;YAClC,IAAI;gBAKH,IAAI,CAAA,CAJc,QAAQ,SAAA,EAAW,SAClC,QAAQ,SAAA,GACR,gMAAA,EAEY,IAAA,CAAA,CAAM,WAAa,QAAQ,GAAA,CAAI,QAAA,CAAS,SAAS,CAAC,CAChE,CAAA,OAAO,KAAA;gBAER,IAAI,CAAC,QAAQ,SAAA,CACZ,CAAA,MAAM,IAAI,MAAM,yMAAA,CAAqB,kBAAA,CAAmB;gBAGzD,MAAM,kBAAkB,QAAQ,OAAA,CAAQ,GAAA,CAAI,qBAAqB;gBACjE,MAAM,mBAAe,mLAAA,EAAM,SAAS,IAAI,OAAA,CAAQ,IAAI,KAAA;gBAEpD,IAAI,CAAC,gBACJ,CAAA,WAAO,kMAAA,EAAmB;oBACzB,SAAS,yMAAA,CAAqB,gBAAA;oBAC9B,QAAQ;iBACR,CAAC;gBAMH,MAAM,gBAAgB;oBACrB,eAHA,QAAQ,qBAAA,IAAyB,6LAAA,CAAc,QAAQ,QAAA,CAAA;oBAIvD;oBACA,WAAW,QAAQ,SAAA;oBACnB,UAAU;iBACV;gBAED,IAAI,QAAQ,QAAA,KAAa,yLAAA,CAAU,oBAAA,CAClC,CAAA,OAAO,UAAMA,uOAAAA,EAAmC,cAAc;gBAG/D,IAAI,QAAQ,QAAA,KAAa,yLAAA,CAAU,gBAAA,CAClC,CAAA,OAAO,UAAMC,+NAAAA,EAA+B;oBAC3C,GAAG,aAAA;oBACH,UAAU,QAAQ,QAAA;iBAClB,CAAC;gBAGH,IAAI,QAAQ,QAAA,KAAa,yLAAA,CAAU,QAAA,CAClC,CAAA,OAAO,UAAMC,iNAAAA,EAAwB;oBACpC,GAAG,aAAA;oBACH,SAAS,QAAQ,OAAA;iBACjB,CAAC;gBAGH,IAAI,QAAQ,QAAA,KAAa,yLAAA,CAAU,UAAA,CAClC,CAAA,OAAO,UAAMC,iNAAAA,EAA0B;oBACtC,GAAG,aAAA;oBACH,SAAS,QAAQ,OAAA;iBACjB,CAAC;qBAEK,QAAQ;gBAChB,MAAM,eACL,kBAAkB,QAAQ,OAAO,OAAA,GAAU,KAAA;gBAE5C,IAAI,MAAA,CAAO,KAAA,CAAM,gBAAgB,iBAAiB;oBACjD,UAAU,QAAQ,GAAA;oBAClB,SAAS;iBACT,CAAC;gBAEF,WAAO,kMAAA,EAAmB;oBACzB,SAAS,yMAAA,CAAqB,aAAA;oBAC9B,QAAQ;iBACR,CAAC;;;QAGJ;KACA"}},
    {"offset": {"line": 3926, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/custom-session/index.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/custom-session/index.ts"],"sourcesContent":["import type {\n\tBetterAuthOptions,\n\tBetterAuthPlugin,\n\tGenericEndpointContext,\n} from \"@better-auth/core\";\nimport {\n\tcreateAuthEndpoint,\n\tcreateAuthMiddleware,\n} from \"@better-auth/core/api\";\nimport * as z from \"zod\";\nimport { getSession } from \"../../api\";\nimport type { InferSession, InferUser } from \"../../types\";\nimport { getEndpointResponse } from \"../../utils/plugin-helper\";\n\nconst getSessionQuerySchema = z.optional(\n\tz.object({\n\t\t/**\n\t\t * If cookie cache is enabled, it will disable the cache\n\t\t * and fetch the session from the database\n\t\t */\n\t\tdisableCookieCache: z\n\t\t\t.boolean()\n\t\t\t.meta({\n\t\t\t\tdescription: \"Disable cookie cache and fetch session from database\",\n\t\t\t})\n\t\t\t.or(z.string().transform((v) => v === \"true\"))\n\t\t\t.optional(),\n\t\tdisableRefresh: z\n\t\t\t.boolean()\n\t\t\t.meta({\n\t\t\t\tdescription:\n\t\t\t\t\t\"Disable session refresh. Useful for checking session status, without updating the session\",\n\t\t\t})\n\t\t\t.optional(),\n\t}),\n);\n\nexport type CustomSessionPluginOptions = {\n\t/**\n\t * This option is used to determine if the list-device-sessions endpoint should be mutated to the custom session data.\n\t * @default false\n\t */\n\tshouldMutateListDeviceSessionsEndpoint?: boolean | undefined;\n};\n\nexport const customSession = <\n\tReturns extends Record<string, any>,\n\tO extends BetterAuthOptions = BetterAuthOptions,\n>(\n\tfn: (\n\t\tsession: {\n\t\t\tuser: InferUser<O>;\n\t\t\tsession: InferSession<O>;\n\t\t},\n\t\tctx: GenericEndpointContext,\n\t) => Promise<Returns>,\n\toptions?: O | undefined,\n\tpluginOptions?: CustomSessionPluginOptions | undefined,\n) => {\n\treturn {\n\t\tid: \"custom-session\",\n\t\thooks: {\n\t\t\tafter: [\n\t\t\t\t{\n\t\t\t\t\tmatcher: (ctx) =>\n\t\t\t\t\t\tctx.path === \"/multi-session/list-device-sessions\" &&\n\t\t\t\t\t\t(pluginOptions?.shouldMutateListDeviceSessionsEndpoint ?? false),\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tconst response = await getEndpointResponse<[]>(ctx);\n\t\t\t\t\t\tif (!response) return;\n\t\t\t\t\t\tconst newResponse = await Promise.all(\n\t\t\t\t\t\t\tresponse.map(async (v) => await fn(v, ctx)),\n\t\t\t\t\t\t);\n\t\t\t\t\t\treturn ctx.json(newResponse);\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\tendpoints: {\n\t\t\tgetSession: createAuthEndpoint(\n\t\t\t\t\"/get-session\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\tquery: getSessionQuerySchema,\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\tCUSTOM_SESSION: true,\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\tdescription: \"Get custom session data\",\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/Session\",\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\trequireHeaders: true,\n\t\t\t\t},\n\t\t\t\tasync (ctx): Promise<Returns | null> => {\n\t\t\t\t\tconst session = await getSession()({\n\t\t\t\t\t\t...ctx,\n\t\t\t\t\t\tasResponse: false,\n\t\t\t\t\t\theaders: ctx.headers,\n\t\t\t\t\t\treturnHeaders: true,\n\t\t\t\t\t}).catch((e) => {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t});\n\t\t\t\t\tif (!session?.response) {\n\t\t\t\t\t\treturn ctx.json(null);\n\t\t\t\t\t}\n\t\t\t\t\tconst fnResult = await fn(session.response as any, ctx);\n\n\t\t\t\t\tconst setCookie = session.headers.get(\"set-cookie\");\n\t\t\t\t\tif (setCookie) {\n\t\t\t\t\t\tctx.setHeader(\"set-cookie\", setCookie);\n\t\t\t\t\t\tsession.headers.delete(\"set-cookie\");\n\t\t\t\t\t}\n\n\t\t\t\t\tsession.headers.forEach((value, key) => {\n\t\t\t\t\t\tctx.setHeader(key, value);\n\t\t\t\t\t});\n\t\t\t\t\treturn ctx.json(fnResult);\n\t\t\t\t},\n\t\t\t),\n\t\t},\n\t\t$Infer: {\n\t\t\tSession: {} as Awaited<ReturnType<typeof fn>>,\n\t\t},\n\t\toptions: pluginOptions,\n\t} satisfies BetterAuthPlugin;\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;AAcA,MAAM,wBAAwB,EAAE,2JAAA,CAC/B,EAAE,yJAAA,CAAO;IAKR,oBAAoB,EAClB,0JAAA,EAAS,CACT,IAAA,CAAK;QACL,aAAa;IAAA,CACb,CAAC,CACD,EAAA,CAAG,EAAE,yJAAA,EAAQ,CAAC,SAAA,CAAA,CAAW,IAAM,MAAM,OAAO,CAAC,CAC7C,QAAA,EAAU;IACZ,gBAAgB,EACd,0JAAA,EAAS,CACT,IAAA,CAAK;QACL,aACC;IAAA,CACD,CAAC,CACD,QAAA,EAAU;CACZ,CAAC,CACF;AAUD,MAAa,gBAAA,CAIZ,IAOA,SACA,kBACI;IACJ,OAAO;QACN,IAAI;QACJ,OAAO;YACN,OAAO;gBACN;oBACC,SAAA,CAAU,MACT,IAAI,IAAA,KAAS,yCAAA,CACZ,eAAe,0CAA0C,KAAA;oBAC3D,aAAS,2LAAA,EAAqB,OAAO,QAAQ;wBAC5C,MAAM,WAAW,UAAM,6LAAA,EAAwB,IAAI;wBACnD,IAAI,CAAC,SAAU,CAAA;wBACf,MAAM,cAAc,MAAM,QAAQ,GAAA,CACjC,SAAS,GAAA,CAAI,OAAO,IAAM,MAAM,GAAG,GAAG,IAAI,CAAC,CAC3C;wBACD,OAAO,IAAI,IAAA,CAAK,YAAY;sBAC3B;iBACF;aACD;QAAA,CACD;QACD,WAAW;YACV,gBAAY,yLAAA,EACX,gBACA;gBACC,QAAQ;gBACR,OAAO;gBACP,UAAU;oBACT,gBAAgB;oBAChB,SAAS;wBACR,aAAa;wBACb,WAAW;4BACV,OAAO;gCACN,aAAa;gCACb,SAAS;oCACR,oBAAoB;wCACnB,QAAQ;4CACP,MAAM;4CACN,UAAU;4CACV,OAAO;gDACN,MAAM;4CAAA,CACN;yCACD;oCAAA,CACD;gCAAA,CACD;6BACD;wBAAA,CACD;qBACD;iBACD;gBACD,gBAAgB;aAChB,EACD,OAAO,QAAiC;gBACvC,MAAM,UAAU,UAAM,mLAAA,EAAY,EAAC;oBAClC,GAAG,GAAA;oBACH,YAAY;oBACZ,SAAS,IAAI,OAAA;oBACb,eAAe;iBACf,CAAC,CAAC,KAAA,CAAA,CAAO,MAAM;oBACf,OAAO;kBACN;gBACF,IAAI,CAAC,SAAS,SACb,CAAA,OAAO,IAAI,IAAA,CAAK,KAAK;gBAEtB,MAAM,WAAW,MAAM,GAAG,QAAQ,QAAA,EAAiB,IAAI;gBAEvD,MAAM,YAAY,QAAQ,OAAA,CAAQ,GAAA,CAAI,aAAa;gBACnD,IAAI,WAAW;oBACd,IAAI,SAAA,CAAU,cAAc,UAAU;oBACtC,QAAQ,OAAA,CAAQ,MAAA,CAAO,aAAa;;gBAGrC,QAAQ,OAAA,CAAQ,OAAA,CAAA,CAAS,OAAO,QAAQ;oBACvC,IAAI,SAAA,CAAU,KAAK,MAAM;kBACxB;gBACF,OAAO,IAAI,IAAA,CAAK,SAAS;cAE1B;QAAA,CACD;QACD,QAAQ;YACP,SAAS,CAAA,CAAE;QAAA,CACX;QACD,SAAS;KACT"}},
    {"offset": {"line": 4026, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/device-authorization/error-codes.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/device-authorization/error-codes.ts"],"sourcesContent":["import { defineErrorCodes } from \"@better-auth/core/utils\";\n\nexport const DEVICE_AUTHORIZATION_ERROR_CODES = defineErrorCodes({\n\tINVALID_DEVICE_CODE: \"Invalid device code\",\n\tEXPIRED_DEVICE_CODE: \"Device code has expired\",\n\tEXPIRED_USER_CODE: \"User code has expired\",\n\tAUTHORIZATION_PENDING: \"Authorization pending\",\n\tACCESS_DENIED: \"Access denied\",\n\tINVALID_USER_CODE: \"Invalid user code\",\n\tDEVICE_CODE_ALREADY_PROCESSED: \"Device code already processed\",\n\tPOLLING_TOO_FREQUENTLY: \"Polling too frequently\",\n\tUSER_NOT_FOUND: \"User not found\",\n\tFAILED_TO_CREATE_SESSION: \"Failed to create session\",\n\tINVALID_DEVICE_CODE_STATUS: \"Invalid device code status\",\n\tAUTHENTICATION_REQUIRED: \"Authentication required\",\n});\n"],"names":[],"mappings":";;;;;;;;AAEA,MAAa,uCAAmC,kMAAA,EAAiB;IAChE,qBAAqB;IACrB,qBAAqB;IACrB,mBAAmB;IACnB,uBAAuB;IACvB,eAAe;IACf,mBAAmB;IACnB,+BAA+B;IAC/B,wBAAwB;IACxB,gBAAgB;IAChB,0BAA0B;IAC1B,4BAA4B;IAC5B,yBAAyB;CACzB,CAAC"}},
    {"offset": {"line": 4054, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/device-authorization/routes.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/device-authorization/routes.ts"],"sourcesContent":["import { createAuthEndpoint } from \"@better-auth/core/api\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { getSessionFromCtx } from \"../../api/routes/session\";\nimport { generateRandomString } from \"../../crypto\";\nimport { ms } from \"../../utils/time\";\nimport type { DeviceAuthorizationOptions } from \".\";\nimport { DEVICE_AUTHORIZATION_ERROR_CODES } from \"./error-codes\";\nimport type { DeviceCode } from \"./schema\";\n\n/* cspell:disable-next-line */\nconst defaultCharset = \"ABCDEFGHJKLMNPQRSTUVWXYZ23456789\";\n\nconst deviceCodeBodySchema = z.object({\n\tclient_id: z.string().meta({\n\t\tdescription: \"The client ID of the application\",\n\t}),\n\tscope: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: \"Space-separated list of scopes\",\n\t\t})\n\t\t.optional(),\n});\n\nconst deviceCodeErrorSchema = z.object({\n\terror: z.enum([\"invalid_request\", \"invalid_client\"]).meta({\n\t\tdescription: \"Error code\",\n\t}),\n\terror_description: z.string().meta({\n\t\tdescription: \"Detailed error description\",\n\t}),\n});\n\nexport const deviceCode = (opts: DeviceAuthorizationOptions) => {\n\tconst generateDeviceCode = async () => {\n\t\tif (opts.generateDeviceCode) {\n\t\t\treturn opts.generateDeviceCode();\n\t\t}\n\t\treturn defaultGenerateDeviceCode(opts.deviceCodeLength);\n\t};\n\n\tconst generateUserCode = async () => {\n\t\tif (opts.generateUserCode) {\n\t\t\treturn opts.generateUserCode();\n\t\t}\n\t\treturn defaultGenerateUserCode(opts.userCodeLength);\n\t};\n\treturn createAuthEndpoint(\n\t\t\"/device/code\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: deviceCodeBodySchema,\n\t\t\terror: deviceCodeErrorSchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: `Request a device and user code\n\nFollow [rfc8628#section-3.2](https://datatracker.ietf.org/doc/html/rfc8628#section-3.2)`,\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tdevice_code: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"The device verification code\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tuser_code: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"The user code to display\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tverification_uri: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tformat: \"uri\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"The URL for user verification. Defaults to /device if not configured.\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tverification_uri_complete: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tformat: \"uri\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"The complete URL with user code as query parameter.\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\texpires_in: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Lifetime in seconds of the device code\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tinterval: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"number\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Minimum polling interval in seconds\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\t400: {\n\t\t\t\t\t\t\tdescription: \"Error response\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\terror: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tenum: [\"invalid_request\", \"invalid_client\"],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\terror_description: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tif (opts.validateClient) {\n\t\t\t\tconst isValid = await opts.validateClient(ctx.body.client_id);\n\t\t\t\tif (!isValid) {\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\terror_description: \"Invalid client ID\",\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (opts.onDeviceAuthRequest) {\n\t\t\t\tawait opts.onDeviceAuthRequest(ctx.body.client_id, ctx.body.scope);\n\t\t\t}\n\n\t\t\tconst deviceCode = await generateDeviceCode();\n\t\t\tconst userCode = await generateUserCode();\n\t\t\tconst expiresIn = ms(opts.expiresIn);\n\t\t\tconst expiresAt = new Date(Date.now() + expiresIn);\n\n\t\t\tawait ctx.context.adapter.create({\n\t\t\t\tmodel: \"deviceCode\",\n\t\t\t\tdata: {\n\t\t\t\t\tdeviceCode,\n\t\t\t\t\tuserCode,\n\t\t\t\t\texpiresAt,\n\t\t\t\t\tstatus: \"pending\",\n\t\t\t\t\tpollingInterval: ms(opts.interval),\n\t\t\t\t\tclientId: ctx.body.client_id,\n\t\t\t\t\tscope: ctx.body.scope,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tconst { verificationUri, verificationUriComplete } =\n\t\t\t\tbuildVerificationUris(\n\t\t\t\t\topts.verificationUri,\n\t\t\t\t\tctx.context.baseURL,\n\t\t\t\t\tuserCode,\n\t\t\t\t);\n\n\t\t\treturn ctx.json(\n\t\t\t\t{\n\t\t\t\t\tdevice_code: deviceCode,\n\t\t\t\t\tuser_code: userCode,\n\t\t\t\t\tverification_uri: verificationUri,\n\t\t\t\t\tverification_uri_complete: verificationUriComplete,\n\t\t\t\t\texpires_in: Math.floor(expiresIn / 1000),\n\t\t\t\t\tinterval: Math.floor(ms(opts.interval) / 1000),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t\"Cache-Control\": \"no-store\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t);\n};\n\nconst deviceTokenBodySchema = z.object({\n\tgrant_type: z.literal(\"urn:ietf:params:oauth:grant-type:device_code\").meta({\n\t\tdescription: \"The grant type for device flow\",\n\t}),\n\tdevice_code: z.string().meta({\n\t\tdescription: \"The device verification code\",\n\t}),\n\tclient_id: z.string().meta({\n\t\tdescription: \"The client ID of the application\",\n\t}),\n});\n\nconst deviceTokenErrorSchema = z.object({\n\terror: z\n\t\t.enum([\n\t\t\t\"authorization_pending\",\n\t\t\t\"slow_down\",\n\t\t\t\"expired_token\",\n\t\t\t\"access_denied\",\n\t\t\t\"invalid_request\",\n\t\t\t\"invalid_grant\",\n\t\t])\n\t\t.meta({\n\t\t\tdescription: \"Error code\",\n\t\t}),\n\terror_description: z.string().meta({\n\t\tdescription: \"Detailed error description\",\n\t}),\n});\n\nexport const deviceToken = (opts: DeviceAuthorizationOptions) =>\n\tcreateAuthEndpoint(\n\t\t\"/device/token\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: deviceTokenBodySchema,\n\t\t\terror: deviceTokenErrorSchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: `Exchange device code for access token\n\nFollow [rfc8628#section-3.4](https://datatracker.ietf.org/doc/html/rfc8628#section-3.4)`,\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tsession: {\n\t\t\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/Session\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/User\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\t400: {\n\t\t\t\t\t\t\tdescription: \"Error response\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\terror: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tenum: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"authorization_pending\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"slow_down\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"expired_token\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"access_denied\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"invalid_request\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"invalid_grant\",\n\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\terror_description: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst { device_code, client_id } = ctx.body;\n\n\t\t\tif (opts.validateClient) {\n\t\t\t\tconst isValid = await opts.validateClient(client_id);\n\t\t\t\tif (!isValid) {\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"invalid_grant\",\n\t\t\t\t\t\terror_description: \"Invalid client ID\",\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst deviceCodeRecord = await ctx.context.adapter.findOne<{\n\t\t\t\tid: string;\n\t\t\t\tdeviceCode: string;\n\t\t\t\tuserCode: string;\n\t\t\t\tuserId?: string | undefined;\n\t\t\t\texpiresAt: Date;\n\t\t\t\tstatus: string;\n\t\t\t\tlastPolledAt?: Date | undefined;\n\t\t\t\tpollingInterval?: number | undefined;\n\t\t\t\tclientId?: string | undefined;\n\t\t\t\tscope?: string | undefined;\n\t\t\t}>({\n\t\t\t\tmodel: \"deviceCode\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"deviceCode\",\n\t\t\t\t\t\tvalue: device_code,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\n\t\t\tif (!deviceCodeRecord) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"invalid_grant\",\n\t\t\t\t\terror_description:\n\t\t\t\t\t\tDEVICE_AUTHORIZATION_ERROR_CODES.INVALID_DEVICE_CODE,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tdeviceCodeRecord.clientId &&\n\t\t\t\tdeviceCodeRecord.clientId !== client_id\n\t\t\t) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"invalid_grant\",\n\t\t\t\t\terror_description: \"Client ID mismatch\",\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Check for rate limiting\n\t\t\tif (deviceCodeRecord.lastPolledAt && deviceCodeRecord.pollingInterval) {\n\t\t\t\tconst timeSinceLastPoll =\n\t\t\t\t\tDate.now() - new Date(deviceCodeRecord.lastPolledAt).getTime();\n\t\t\t\tconst minInterval = deviceCodeRecord.pollingInterval;\n\n\t\t\t\tif (timeSinceLastPoll < minInterval) {\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\terror: \"slow_down\",\n\t\t\t\t\t\terror_description:\n\t\t\t\t\t\t\tDEVICE_AUTHORIZATION_ERROR_CODES.POLLING_TOO_FREQUENTLY,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Update last polled time\n\t\t\tawait ctx.context.adapter.update({\n\t\t\t\tmodel: \"deviceCode\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\tvalue: deviceCodeRecord.id,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tupdate: {\n\t\t\t\t\tlastPolledAt: new Date(),\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (deviceCodeRecord.expiresAt < new Date()) {\n\t\t\t\tawait ctx.context.adapter.delete({\n\t\t\t\t\tmodel: \"deviceCode\",\n\t\t\t\t\twhere: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\t\tvalue: deviceCodeRecord.id,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"expired_token\",\n\t\t\t\t\terror_description:\n\t\t\t\t\t\tDEVICE_AUTHORIZATION_ERROR_CODES.EXPIRED_DEVICE_CODE,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (deviceCodeRecord.status === \"pending\") {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"authorization_pending\",\n\t\t\t\t\terror_description:\n\t\t\t\t\t\tDEVICE_AUTHORIZATION_ERROR_CODES.AUTHORIZATION_PENDING,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (deviceCodeRecord.status === \"denied\") {\n\t\t\t\tawait ctx.context.adapter.delete({\n\t\t\t\t\tmodel: \"deviceCode\",\n\t\t\t\t\twhere: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\t\tvalue: deviceCodeRecord.id,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\terror: \"access_denied\",\n\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.ACCESS_DENIED,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (deviceCodeRecord.status === \"approved\" && deviceCodeRecord.userId) {\n\t\t\t\tconst user = await ctx.context.internalAdapter.findUserById(\n\t\t\t\t\tdeviceCodeRecord.userId,\n\t\t\t\t);\n\n\t\t\t\tif (!user) {\n\t\t\t\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\t\t\terror: \"server_error\",\n\t\t\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.USER_NOT_FOUND,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tconst session = await ctx.context.internalAdapter.createSession(\n\t\t\t\t\tuser.id,\n\t\t\t\t);\n\n\t\t\t\tif (!session) {\n\t\t\t\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\t\t\terror: \"server_error\",\n\t\t\t\t\t\terror_description:\n\t\t\t\t\t\t\tDEVICE_AUTHORIZATION_ERROR_CODES.FAILED_TO_CREATE_SESSION,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// Set new session context for hooks and plugins\n\t\t\t\t// (matches setSessionCookie logic)\n\t\t\t\tctx.context.setNewSession({\n\t\t\t\t\tsession,\n\t\t\t\t\tuser,\n\t\t\t\t});\n\n\t\t\t\t// If secondary storage is enabled, store the session data in the secondary storage\n\t\t\t\t// (matches setSessionCookie logic)\n\t\t\t\tif (ctx.context.options.secondaryStorage) {\n\t\t\t\t\tawait ctx.context.secondaryStorage?.set(\n\t\t\t\t\t\tsession.token,\n\t\t\t\t\t\tJSON.stringify({\n\t\t\t\t\t\t\tuser,\n\t\t\t\t\t\t\tsession,\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tMath.floor(\n\t\t\t\t\t\t\t(new Date(session.expiresAt).getTime() - Date.now()) / 1000,\n\t\t\t\t\t\t),\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\t// Delete the device code after successful authorization\n\t\t\t\tawait ctx.context.adapter.delete({\n\t\t\t\t\tmodel: \"deviceCode\",\n\t\t\t\t\twhere: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\t\tvalue: deviceCodeRecord.id,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t});\n\n\t\t\t\t// Return OAuth 2.0 compliant token response\n\t\t\t\treturn ctx.json(\n\t\t\t\t\t{\n\t\t\t\t\t\taccess_token: session.token,\n\t\t\t\t\t\ttoken_type: \"Bearer\",\n\t\t\t\t\t\texpires_in: Math.floor(\n\t\t\t\t\t\t\t(new Date(session.expiresAt).getTime() - Date.now()) / 1000,\n\t\t\t\t\t\t),\n\t\t\t\t\t\tscope: deviceCodeRecord.scope || \"\",\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\"Cache-Control\": \"no-store\",\n\t\t\t\t\t\t\tPragma: \"no-cache\",\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\terror: \"server_error\",\n\t\t\t\terror_description:\n\t\t\t\t\tDEVICE_AUTHORIZATION_ERROR_CODES.INVALID_DEVICE_CODE_STATUS,\n\t\t\t});\n\t\t},\n\t);\n\nexport const deviceVerify = createAuthEndpoint(\n\t\"/device\",\n\t{\n\t\tmethod: \"GET\",\n\t\tquery: z.object({\n\t\t\tuser_code: z.string().meta({\n\t\t\t\tdescription: \"The user code to verify\",\n\t\t\t}),\n\t\t}),\n\t\terror: z.object({\n\t\t\terror: z.enum([\"invalid_request\"]).meta({\n\t\t\t\tdescription: \"Error code\",\n\t\t\t}),\n\t\t\terror_description: z.string().meta({\n\t\t\t\tdescription: \"Detailed error description\",\n\t\t\t}),\n\t\t}),\n\t\tmetadata: {\n\t\t\topenapi: {\n\t\t\t\tdescription: \"Verify user code and get device authorization status\",\n\t\t\t\tresponses: {\n\t\t\t\t\t200: {\n\t\t\t\t\t\tdescription: \"Device authorization status\",\n\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\tuser_code: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"The user code to verify\",\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tstatus: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\tenum: [\"pending\", \"approved\", \"denied\"],\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"Current status of the device authorization\",\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t},\n\tasync (ctx) => {\n\t\tconst { user_code } = ctx.query;\n\t\tconst cleanUserCode = user_code.replace(/-/g, \"\");\n\n\t\tconst deviceCodeRecord = await ctx.context.adapter.findOne<DeviceCode>({\n\t\t\tmodel: \"deviceCode\",\n\t\t\twhere: [\n\t\t\t\t{\n\t\t\t\t\tfield: \"userCode\",\n\t\t\t\t\tvalue: cleanUserCode,\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\n\t\tif (!deviceCodeRecord) {\n\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\terror: \"invalid_request\",\n\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.INVALID_USER_CODE,\n\t\t\t});\n\t\t}\n\n\t\tif (deviceCodeRecord.expiresAt < new Date()) {\n\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\terror: \"expired_token\",\n\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.EXPIRED_USER_CODE,\n\t\t\t});\n\t\t}\n\n\t\treturn ctx.json({\n\t\t\tuser_code: user_code,\n\t\t\tstatus: deviceCodeRecord.status,\n\t\t});\n\t},\n);\n\nexport const deviceApprove = createAuthEndpoint(\n\t\"/device/approve\",\n\t{\n\t\tmethod: \"POST\",\n\t\tbody: z.object({\n\t\t\tuserCode: z.string().meta({\n\t\t\t\tdescription: \"The user code to approve\",\n\t\t\t}),\n\t\t}),\n\t\terror: z.object({\n\t\t\terror: z\n\t\t\t\t.enum([\n\t\t\t\t\t\"invalid_request\",\n\t\t\t\t\t\"expired_token\",\n\t\t\t\t\t\"device_code_already_processed\",\n\t\t\t\t\t\"unauthorized\",\n\t\t\t\t\t\"access_denied\",\n\t\t\t\t])\n\t\t\t\t.meta({\n\t\t\t\t\tdescription: \"Error code\",\n\t\t\t\t}),\n\t\t\terror_description: z.string().meta({\n\t\t\t\tdescription: \"Detailed error description\",\n\t\t\t}),\n\t\t}),\n\t\trequireHeaders: true,\n\t\tmetadata: {\n\t\t\topenapi: {\n\t\t\t\tdescription: \"Approve device authorization\",\n\t\t\t\tresponses: {\n\t\t\t\t\t200: {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\tsuccess: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t},\n\tasync (ctx) => {\n\t\tconst session = await getSessionFromCtx(ctx);\n\t\tif (!session) {\n\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\terror: \"unauthorized\",\n\t\t\t\terror_description:\n\t\t\t\t\tDEVICE_AUTHORIZATION_ERROR_CODES.AUTHENTICATION_REQUIRED,\n\t\t\t});\n\t\t}\n\n\t\tconst { userCode } = ctx.body;\n\t\tconst cleanUserCode = userCode.replace(/-/g, \"\");\n\n\t\tconst deviceCodeRecord = await ctx.context.adapter.findOne<DeviceCode>({\n\t\t\tmodel: \"deviceCode\",\n\t\t\twhere: [\n\t\t\t\t{\n\t\t\t\t\tfield: \"userCode\",\n\t\t\t\t\tvalue: cleanUserCode,\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\n\t\tif (!deviceCodeRecord) {\n\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\terror: \"invalid_request\",\n\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.INVALID_USER_CODE,\n\t\t\t});\n\t\t}\n\n\t\tif (deviceCodeRecord.expiresAt < new Date()) {\n\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\terror: \"expired_token\",\n\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.EXPIRED_USER_CODE,\n\t\t\t});\n\t\t}\n\n\t\tif (deviceCodeRecord.status !== \"pending\") {\n\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\terror: \"invalid_request\",\n\t\t\t\terror_description:\n\t\t\t\t\tDEVICE_AUTHORIZATION_ERROR_CODES.DEVICE_CODE_ALREADY_PROCESSED,\n\t\t\t});\n\t\t}\n\n\t\t// Check if userId is set and matches the current user\n\t\tif (\n\t\t\tdeviceCodeRecord.userId &&\n\t\t\tdeviceCodeRecord.userId !== session.user.id\n\t\t) {\n\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\terror: \"access_denied\",\n\t\t\t\terror_description:\n\t\t\t\t\t\"You are not authorized to approve this device authorization\",\n\t\t\t});\n\t\t}\n\n\t\t// Update device code with approved status and user ID\n\t\tawait ctx.context.adapter.update({\n\t\t\tmodel: \"deviceCode\",\n\t\t\twhere: [\n\t\t\t\t{\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tvalue: deviceCodeRecord.id,\n\t\t\t\t},\n\t\t\t],\n\t\t\tupdate: {\n\t\t\t\tstatus: \"approved\",\n\t\t\t\tuserId: session.user.id,\n\t\t\t},\n\t\t});\n\n\t\treturn ctx.json({\n\t\t\tsuccess: true,\n\t\t});\n\t},\n);\n\nexport const deviceDeny = createAuthEndpoint(\n\t\"/device/deny\",\n\t{\n\t\tmethod: \"POST\",\n\t\tbody: z.object({\n\t\t\tuserCode: z.string().meta({\n\t\t\t\tdescription: \"The user code to deny\",\n\t\t\t}),\n\t\t}),\n\t\terror: z.object({\n\t\t\terror: z\n\t\t\t\t.enum([\n\t\t\t\t\t\"invalid_request\",\n\t\t\t\t\t\"expired_token\",\n\t\t\t\t\t\"unauthorized\",\n\t\t\t\t\t\"access_denied\",\n\t\t\t\t])\n\t\t\t\t.meta({\n\t\t\t\t\tdescription: \"Error code\",\n\t\t\t\t}),\n\t\t\terror_description: z.string().meta({\n\t\t\t\tdescription: \"Detailed error description\",\n\t\t\t}),\n\t\t}),\n\t\trequireHeaders: true,\n\t\tmetadata: {\n\t\t\topenapi: {\n\t\t\t\tdescription: \"Deny device authorization\",\n\t\t\t\tresponses: {\n\t\t\t\t\t200: {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\tsuccess: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t},\n\tasync (ctx) => {\n\t\tconst session = await getSessionFromCtx(ctx);\n\t\tif (!session) {\n\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\terror: \"unauthorized\",\n\t\t\t\terror_description:\n\t\t\t\t\tDEVICE_AUTHORIZATION_ERROR_CODES.AUTHENTICATION_REQUIRED,\n\t\t\t});\n\t\t}\n\n\t\tconst { userCode } = ctx.body;\n\t\tconst cleanUserCode = userCode.replace(/-/g, \"\");\n\n\t\tconst deviceCodeRecord = await ctx.context.adapter.findOne<DeviceCode>({\n\t\t\tmodel: \"deviceCode\",\n\t\t\twhere: [\n\t\t\t\t{\n\t\t\t\t\tfield: \"userCode\",\n\t\t\t\t\tvalue: cleanUserCode,\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\n\t\tif (!deviceCodeRecord) {\n\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\terror: \"invalid_request\",\n\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.INVALID_USER_CODE,\n\t\t\t});\n\t\t}\n\n\t\tif (deviceCodeRecord.expiresAt < new Date()) {\n\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\terror: \"expired_token\",\n\t\t\t\terror_description: DEVICE_AUTHORIZATION_ERROR_CODES.EXPIRED_USER_CODE,\n\t\t\t});\n\t\t}\n\n\t\tif (deviceCodeRecord.status !== \"pending\") {\n\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\terror: \"invalid_request\",\n\t\t\t\terror_description:\n\t\t\t\t\tDEVICE_AUTHORIZATION_ERROR_CODES.DEVICE_CODE_ALREADY_PROCESSED,\n\t\t\t});\n\t\t}\n\n\t\t// Check if userId is set and matches the current user\n\t\tif (\n\t\t\tdeviceCodeRecord.userId &&\n\t\t\tdeviceCodeRecord.userId !== session.user.id\n\t\t) {\n\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\terror: \"access_denied\",\n\t\t\t\terror_description:\n\t\t\t\t\t\"You are not authorized to deny this device authorization\",\n\t\t\t});\n\t\t}\n\n\t\t// Update device code with denied status and userId if not already set\n\t\tawait ctx.context.adapter.update({\n\t\t\tmodel: \"deviceCode\",\n\t\t\twhere: [\n\t\t\t\t{\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tvalue: deviceCodeRecord.id,\n\t\t\t\t},\n\t\t\t],\n\t\t\tupdate: {\n\t\t\t\tstatus: \"denied\",\n\t\t\t\tuserId: deviceCodeRecord.userId || session.user.id,\n\t\t\t},\n\t\t});\n\n\t\treturn ctx.json({\n\t\t\tsuccess: true,\n\t\t});\n\t},\n);\n\n/**\n * @internal\n */\nconst buildVerificationUris = (\n\tverificationUri: string | undefined,\n\tbaseURL: string,\n\tuserCode: string,\n): {\n\tverificationUri: string;\n\tverificationUriComplete: string;\n} => {\n\tconst uri = verificationUri || \"/device\";\n\n\tlet verificationUrl: URL;\n\ttry {\n\t\tverificationUrl = new URL(uri);\n\t} catch {\n\t\tverificationUrl = new URL(uri, baseURL);\n\t}\n\n\tconst verificationUriCompleteUrl = new URL(verificationUrl);\n\tverificationUriCompleteUrl.searchParams.set(\"user_code\", userCode);\n\n\tconst verificationUriString = verificationUrl.toString();\n\tconst verificationUriCompleteString = verificationUriCompleteUrl.toString();\n\n\treturn {\n\t\tverificationUri: verificationUriString,\n\t\tverificationUriComplete: verificationUriCompleteString,\n\t};\n};\n\n/**\n * @internal\n */\nconst defaultGenerateDeviceCode = (length: number) => {\n\treturn generateRandomString(length, \"a-z\", \"A-Z\", \"0-9\");\n};\n\n/**\n * @internal\n */\nconst defaultGenerateUserCode = (length: number) => {\n\tconst chars = new Uint8Array(length);\n\treturn Array.from(crypto.getRandomValues(chars))\n\t\t.map((byte) => defaultCharset[byte % defaultCharset.length])\n\t\t.join(\"\");\n};\n"],"names":["deviceCode","verificationUrl: URL"],"mappings":"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"}},
    {"offset": {"line": 4725, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/device-authorization/schema.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/device-authorization/schema.ts"],"sourcesContent":["import type { BetterAuthPluginDBSchema } from \"@better-auth/core/db\";\nimport * as z from \"zod\";\n\nexport const schema = {\n\tdeviceCode: {\n\t\tfields: {\n\t\t\tdeviceCode: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: true,\n\t\t\t},\n\t\t\tuserCode: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: true,\n\t\t\t},\n\t\t\tuserId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: false,\n\t\t\t},\n\t\t\texpiresAt: {\n\t\t\t\ttype: \"date\",\n\t\t\t\trequired: true,\n\t\t\t},\n\t\t\tstatus: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: true,\n\t\t\t},\n\t\t\tlastPolledAt: {\n\t\t\t\ttype: \"date\",\n\t\t\t\trequired: false,\n\t\t\t},\n\t\t\tpollingInterval: {\n\t\t\t\ttype: \"number\",\n\t\t\t\trequired: false,\n\t\t\t},\n\t\t\tclientId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: false,\n\t\t\t},\n\t\t\tscope: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: false,\n\t\t\t},\n\t\t},\n\t},\n} satisfies BetterAuthPluginDBSchema;\n\nconst deviceCode = z.object({\n\tid: z.string(),\n\tdeviceCode: z.string(),\n\tuserCode: z.string(),\n\tuserId: z.string().optional(),\n\texpiresAt: z.date(),\n\tstatus: z.string(),\n\tlastPolledAt: z.date().optional(),\n\tpollingInterval: z.number().optional(),\n\tclientId: z.string().optional(),\n\tscope: z.string().optional(),\n});\n\nexport type DeviceCode = z.infer<typeof deviceCode>;\n"],"names":[],"mappings":";;;;;;;AAGA,MAAa,SAAS;IACrB,YAAY;QACX,QAAQ;YACP,YAAY;gBACX,MAAM;gBACN,UAAU;aACV;YACD,UAAU;gBACT,MAAM;gBACN,UAAU;aACV;YACD,QAAQ;gBACP,MAAM;gBACN,UAAU;aACV;YACD,WAAW;gBACV,MAAM;gBACN,UAAU;aACV;YACD,QAAQ;gBACP,MAAM;gBACN,UAAU;aACV;YACD,cAAc;gBACb,MAAM;gBACN,UAAU;aACV;YACD,iBAAiB;gBAChB,MAAM;gBACN,UAAU;aACV;YACD,UAAU;gBACT,MAAM;gBACN,UAAU;aACV;YACD,OAAO;gBACN,MAAM;gBACN,UAAU;aACV;SACD;IAAA,CACD;AAAA,CACD;AAEkB,EAAE,yJAAA,CAAO;IAC3B,IAAI,EAAE,yJAAA,EAAQ;IACd,YAAY,EAAE,yJAAA,EAAQ;IACtB,UAAU,EAAE,yJAAA,EAAQ;IACpB,QAAQ,EAAE,yJAAA,EAAQ,CAAC,QAAA,EAAU;IAC7B,WAAW,EAAE,uJAAA,EAAM;IACnB,QAAQ,EAAE,yJAAA,EAAQ;IAClB,cAAc,EAAE,uJAAA,EAAM,CAAC,QAAA,EAAU;IACjC,iBAAiB,EAAE,yJAAA,EAAQ,CAAC,QAAA,EAAU;IACtC,UAAU,EAAE,yJAAA,EAAQ,CAAC,QAAA,EAAU;IAC/B,OAAO,EAAE,yJAAA,EAAQ,CAAC,QAAA,EAAU;CAC5B,CAAC"}},
    {"offset": {"line": 4792, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/device-authorization/index.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/device-authorization/index.ts"],"sourcesContent":["import type { BetterAuthPlugin } from \"@better-auth/core\";\nimport * as z from \"zod\";\nimport { mergeSchema } from \"../../db\";\nimport type { InferOptionSchema } from \"../../types/plugins\";\nimport type { TimeString } from \"../../utils/time\";\nimport { ms } from \"../../utils/time\";\nimport { DEVICE_AUTHORIZATION_ERROR_CODES } from \"./error-codes\";\nimport {\n\tdeviceApprove,\n\tdeviceCode,\n\tdeviceDeny,\n\tdeviceToken,\n\tdeviceVerify,\n} from \"./routes\";\nimport { schema } from \"./schema\";\n\nconst timeStringSchema = z.custom<TimeString>(\n\t(val) => {\n\t\tif (typeof val !== \"string\") return false;\n\t\ttry {\n\t\t\tms(val as TimeString);\n\t\t\treturn true;\n\t\t} catch {\n\t\t\treturn false;\n\t\t}\n\t},\n\t{\n\t\tmessage:\n\t\t\t\"Invalid time string format. Use formats like '30m', '5s', '1h', etc.\",\n\t},\n);\n\nexport const deviceAuthorizationOptionsSchema = z.object({\n\texpiresIn: timeStringSchema\n\t\t.default(\"30m\")\n\t\t.describe(\n\t\t\t\"Time in seconds until the device code expires. Use formats like '30m', '5s', '1h', etc.\",\n\t\t),\n\tinterval: timeStringSchema\n\t\t.default(\"5s\")\n\t\t.describe(\n\t\t\t\"Time in seconds between polling attempts. Use formats like '30m', '5s', '1h', etc.\",\n\t\t),\n\tdeviceCodeLength: z\n\t\t.number()\n\t\t.int()\n\t\t.positive()\n\t\t.default(40)\n\t\t.describe(\n\t\t\t\"Length of the device code to be generated. Default is 40 characters.\",\n\t\t),\n\tuserCodeLength: z\n\t\t.number()\n\t\t.int()\n\t\t.positive()\n\t\t.default(8)\n\t\t.describe(\n\t\t\t\"Length of the user code to be generated. Default is 8 characters.\",\n\t\t),\n\tgenerateDeviceCode: z\n\t\t.custom<() => string | Promise<string>>(\n\t\t\t(val) => typeof val === \"function\",\n\t\t\t{\n\t\t\t\tmessage:\n\t\t\t\t\t\"generateDeviceCode must be a function that returns a string or a promise that resolves to a string.\",\n\t\t\t},\n\t\t)\n\t\t.optional()\n\t\t.describe(\n\t\t\t\"Function to generate a device code. If not provided, a default random string generator will be used.\",\n\t\t),\n\tgenerateUserCode: z\n\t\t.custom<() => string | Promise<string>>(\n\t\t\t(val) => typeof val === \"function\",\n\t\t\t{\n\t\t\t\tmessage:\n\t\t\t\t\t\"generateUserCode must be a function that returns a string or a promise that resolves to a string.\",\n\t\t\t},\n\t\t)\n\t\t.optional()\n\t\t.describe(\n\t\t\t\"Function to generate a user code. If not provided, a default random string generator will be used.\",\n\t\t),\n\tvalidateClient: z\n\t\t.custom<(clientId: string) => boolean | Promise<boolean>>(\n\t\t\t(val) => typeof val === \"function\",\n\t\t\t{\n\t\t\t\tmessage:\n\t\t\t\t\t\"validateClient must be a function that returns a boolean or a promise that resolves to a boolean.\",\n\t\t\t},\n\t\t)\n\t\t.optional()\n\t\t.describe(\n\t\t\t\"Function to validate the client ID. If not provided, no validation will be performed.\",\n\t\t),\n\tonDeviceAuthRequest: z\n\t\t.custom<\n\t\t\t(clientId: string, scope: string | undefined) => void | Promise<void>\n\t\t>((val) => typeof val === \"function\", {\n\t\t\tmessage:\n\t\t\t\t\"onDeviceAuthRequest must be a function that returns void or a promise that resolves to void.\",\n\t\t})\n\t\t.optional()\n\t\t.describe(\n\t\t\t\"Function to handle device authorization requests. If not provided, no additional actions will be taken.\",\n\t\t),\n\tverificationUri: z\n\t\t.string()\n\t\t.optional()\n\t\t.describe(\n\t\t\t\"The URI where users verify their device code. Can be an absolute URL (https://example.com/device) or relative path (/custom-path). This will be returned as verification_uri in the device code response. If not provided, defaults to /device.\",\n\t\t),\n\tschema: z.custom<InferOptionSchema<typeof schema>>(() => true),\n});\n\nexport type DeviceAuthorizationOptions = z.infer<\n\ttypeof deviceAuthorizationOptionsSchema\n>;\n\nexport const deviceAuthorization = (\n\toptions: Partial<DeviceAuthorizationOptions> = {},\n) => {\n\tconst opts = deviceAuthorizationOptionsSchema.parse(options);\n\n\treturn {\n\t\tid: \"device-authorization\",\n\t\tschema: mergeSchema(schema, options?.schema),\n\t\tendpoints: {\n\t\t\tdeviceCode: deviceCode(opts),\n\t\t\tdeviceToken: deviceToken(opts),\n\t\t\tdeviceVerify,\n\t\t\tdeviceApprove,\n\t\t\tdeviceDeny,\n\t\t},\n\t\t$ERROR_CODES: DEVICE_AUTHORIZATION_ERROR_CODES,\n\t\toptions,\n\t} satisfies BetterAuthPlugin;\n};\n\nexport type * from \"../../utils/time\";\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;AAgBA,MAAM,mBAAmB,EAAE,yJAAA,CAAA,CACzB,QAAQ;IACR,IAAI,OAAO,QAAQ,SAAU,CAAA,OAAO;IACpC,IAAI;QACH,IAAA,gKAAA,EAAG,IAAkB;QACrB,OAAO;aACA;QACP,OAAO;;GAGT;IACC,SACC;AAAA,CACD,CACD;AAED,MAAa,mCAAmC,EAAE,yJAAA,CAAO;IACxD,WAAW,iBACT,OAAA,CAAQ,MAAM,CACd,QAAA,CACA,0FACA;IACF,UAAU,iBACR,OAAA,CAAQ,KAAK,CACb,QAAA,CACA,qFACA;IACF,kBAAkB,EAChB,yJAAA,EAAQ,CACR,GAAA,EAAK,CACL,QAAA,EAAU,CACV,OAAA,CAAQ,GAAG,CACX,QAAA,CACA,uEACA;IACF,gBAAgB,EACd,yJAAA,EAAQ,CACR,GAAA,EAAK,CACL,QAAA,EAAU,CACV,OAAA,CAAQ,EAAE,CACV,QAAA,CACA,oEACA;IACF,oBAAoB,EAClB,yJAAA,CAAA,CACC,MAAQ,OAAO,QAAQ,YACxB;QACC,SACC;IAAA,CACD,CACD,CACA,QAAA,EAAU,CACV,QAAA,CACA,uGACA;IACF,kBAAkB,EAChB,yJAAA,CAAA,CACC,MAAQ,OAAO,QAAQ,YACxB;QACC,SACC;IAAA,CACD,CACD,CACA,QAAA,EAAU,CACV,QAAA,CACA,qGACA;IACF,gBAAgB,EACd,yJAAA,CAAA,CACC,MAAQ,OAAO,QAAQ,YACxB;QACC,SACC;IAAA,CACD,CACD,CACA,QAAA,EAAU,CACV,QAAA,CACA,wFACA;IACF,qBAAqB,EACnB,yJAAA,CAAA,CAEE,MAAQ,OAAO,QAAQ,YAAY;QACrC,SACC;IAAA,CACD,CAAC,CACD,QAAA,EAAU,CACV,QAAA,CACA,0GACA;IACF,iBAAiB,EACf,yJAAA,EAAQ,CACR,QAAA,EAAU,CACV,QAAA,CACA,kPACA;IACF,QAAQ,EAAE,yJAAA,CAAA,IAA+C,KAAK;CAC9D,CAAC;AAMF,MAAa,sBAAA,CACZ,UAA+C,CAAA,CAAE,KAC7C;IACJ,MAAM,OAAO,iCAAiC,KAAA,CAAM,QAAQ;IAE5D,OAAO;QACN,IAAI;QACJ,YAAQ,wKAAA,EAAY,mMAAA,EAAQ,SAAS,OAAO;QAC5C,WAAW;YACV,gBAAY,uMAAA,EAAW,KAAK;YAC5B,iBAAa,wMAAA,EAAY,KAAK;0BAC9B,yMAAA;2BACA,0MAAA;wBACA,uMAAA;SACA;QACD,cAAc,qOAAA;QACd;KACA"}},
    {"offset": {"line": 4866, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/email-otp/utils.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/email-otp/utils.ts"],"sourcesContent":["import { base64Url } from \"@better-auth/utils/base64\";\nimport { createHash } from \"@better-auth/utils/hash\";\nexport const defaultKeyHasher = async (otp: string) => {\n\tconst hash = await createHash(\"SHA-256\").digest(\n\t\tnew TextEncoder().encode(otp),\n\t);\n\tconst hashed = base64Url.encode(new Uint8Array(hash), {\n\t\tpadding: false,\n\t});\n\treturn hashed;\n};\n\nexport function splitAtLastColon(input: string): [string, string] {\n\tconst idx = input.lastIndexOf(\":\");\n\tif (idx === -1) {\n\t\treturn [input, \"\"];\n\t}\n\treturn [input.slice(0, idx), input.slice(idx + 1)];\n}\n"],"names":[],"mappings":";;;;;;;;;;;AAEA,MAAa,mBAAmB,OAAO,QAAgB;IACtD,MAAM,OAAO,UAAM,0KAAA,EAAW,UAAU,CAAC,MAAA,CACxC,IAAI,aAAa,CAAC,MAAA,CAAO,IAAI,CAC7B;IAID,OAHe,2KAAA,CAAU,MAAA,CAAO,IAAI,WAAW,KAAK,EAAE;QACrD,SAAS;IAAA,CACT,CAAC;;AAIH,SAAgB,iBAAiB,KAAA,EAAiC;IACjE,MAAM,MAAM,MAAM,WAAA,CAAY,IAAI;IAClC,IAAI,QAAQ,CAAA,EACX,CAAA,OAAO;QAAC;QAAO;KAAG;IAEnB,OAAO;QAAC,MAAM,KAAA,CAAM,GAAG,IAAI;QAAE,MAAM,KAAA,CAAM,MAAM,EAAE;KAAC"}},
    {"offset": {"line": 4900, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/email-otp/otp-token.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/email-otp/otp-token.ts"],"sourcesContent":["import type { GenericEndpointContext } from \"@better-auth/core\";\nimport {\n\tconstantTimeEqual,\n\tsymmetricDecrypt,\n\tsymmetricEncrypt,\n} from \"../../crypto\";\nimport type { EmailOTPOptions } from \"./types\";\nimport { defaultKeyHasher } from \"./utils\";\n\nexport async function storeOTP(\n\tctx: GenericEndpointContext,\n\topts: EmailOTPOptions,\n\totp: string,\n) {\n\tif (opts.storeOTP === \"encrypted\") {\n\t\treturn await symmetricEncrypt({\n\t\t\tkey: ctx.context.secret,\n\t\t\tdata: otp,\n\t\t});\n\t}\n\tif (opts.storeOTP === \"hashed\") {\n\t\treturn await defaultKeyHasher(otp);\n\t}\n\tif (typeof opts.storeOTP === \"object\" && \"hash\" in opts.storeOTP) {\n\t\treturn await opts.storeOTP.hash(otp);\n\t}\n\tif (typeof opts.storeOTP === \"object\" && \"encrypt\" in opts.storeOTP) {\n\t\treturn await opts.storeOTP.encrypt(otp);\n\t}\n\n\treturn otp;\n}\n\nexport async function verifyStoredOTP(\n\tctx: GenericEndpointContext,\n\topts: EmailOTPOptions,\n\tstoredOtp: string,\n\totp: string,\n): Promise<boolean> {\n\tif (opts.storeOTP === \"encrypted\") {\n\t\tconst decryptedOtp = await symmetricDecrypt({\n\t\t\tkey: ctx.context.secret,\n\t\t\tdata: storedOtp,\n\t\t});\n\t\treturn constantTimeEqual(decryptedOtp, otp);\n\t}\n\tif (opts.storeOTP === \"hashed\") {\n\t\tconst hashedOtp = await defaultKeyHasher(otp);\n\t\treturn constantTimeEqual(hashedOtp, storedOtp);\n\t}\n\tif (typeof opts.storeOTP === \"object\" && \"hash\" in opts.storeOTP) {\n\t\tconst hashedOtp = await opts.storeOTP.hash(otp);\n\t\treturn constantTimeEqual(hashedOtp, storedOtp);\n\t}\n\tif (typeof opts.storeOTP === \"object\" && \"decrypt\" in opts.storeOTP) {\n\t\tconst decryptedOtp = await opts.storeOTP.decrypt(storedOtp);\n\t\treturn constantTimeEqual(decryptedOtp, otp);\n\t}\n\n\treturn constantTimeEqual(otp, storedOtp);\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;AASA,eAAsB,SACrB,GAAA,EACA,IAAA,EACA,GAAA,EACC;IACD,IAAI,KAAK,QAAA,KAAa,YACrB,CAAA,OAAO,UAAM,gMAAA,EAAiB;QAC7B,KAAK,IAAI,OAAA,CAAQ,MAAA;QACjB,MAAM;KACN,CAAC;IAEH,IAAI,KAAK,QAAA,KAAa,SACrB,CAAA,OAAO,UAAM,iMAAA,EAAiB,IAAI;IAEnC,IAAI,OAAO,KAAK,QAAA,KAAa,YAAY,UAAU,KAAK,QAAA,CACvD,CAAA,OAAO,MAAM,KAAK,QAAA,CAAS,IAAA,CAAK,IAAI;IAErC,IAAI,OAAO,KAAK,QAAA,KAAa,YAAY,aAAa,KAAK,QAAA,CAC1D,CAAA,OAAO,MAAM,KAAK,QAAA,CAAS,OAAA,CAAQ,IAAI;IAGxC,OAAO;;AAGR,eAAsB,gBACrB,GAAA,EACA,IAAA,EACA,SAAA,EACA,GAAA,EACmB;IACnB,IAAI,KAAK,QAAA,KAAa,YAKrB,CAAA,WAAO,kLAAA,EAJc,UAAM,gMAAA,EAAiB;QAC3C,KAAK,IAAI,OAAA,CAAQ,MAAA;QACjB,MAAM;KACN,CAAC,EACqC,IAAI;IAE5C,IAAI,KAAK,QAAA,KAAa,SAErB,CAAA,WAAO,kLAAA,EADW,UAAM,iMAAA,EAAiB,IAAI,EACT,UAAU;IAE/C,IAAI,OAAO,KAAK,QAAA,KAAa,YAAY,UAAU,KAAK,QAAA,CAEvD,CAAA,WAAO,kLAAA,EADW,MAAM,KAAK,QAAA,CAAS,IAAA,CAAK,IAAI,EACX,UAAU;IAE/C,IAAI,OAAO,KAAK,QAAA,KAAa,YAAY,aAAa,KAAK,QAAA,CAE1D,CAAA,WAAO,kLAAA,EADc,MAAM,KAAK,QAAA,CAAS,OAAA,CAAQ,UAAU,EACpB,IAAI;IAG5C,WAAO,kLAAA,EAAkB,KAAK,UAAU"}},
    {"offset": {"line": 4939, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/email-otp/routes.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/email-otp/routes.ts"],"sourcesContent":["import { createAuthEndpoint } from \"@better-auth/core/api\";\nimport { BASE_ERROR_CODES } from \"@better-auth/core/error\";\nimport { defineErrorCodes, deprecate } from \"@better-auth/core/utils\";\nimport * as z from \"zod\";\nimport { APIError, getSessionFromCtx } from \"../../api\";\nimport { setCookieCache, setSessionCookie } from \"../../cookies\";\nimport { generateRandomString, symmetricDecrypt } from \"../../crypto\";\nimport { parseUserOutput } from \"../../db/schema\";\nimport { getDate } from \"../../utils/date\";\nimport { storeOTP, verifyStoredOTP } from \"./otp-token\";\nimport type { EmailOTPOptions } from \"./types\";\nimport { splitAtLastColon } from \"./utils\";\n\nconst types = [\"email-verification\", \"sign-in\", \"forget-password\"] as const;\n\ntype WithRequired<T, K extends keyof T> = T & { [P in K]-?: T[P] };\n\ntype RequiredEmailOTPOptions = WithRequired<\n\tEmailOTPOptions,\n\t\"expiresIn\" | \"generateOTP\" | \"storeOTP\"\n>;\n\nexport const ERROR_CODES = defineErrorCodes({\n\tOTP_EXPIRED: \"OTP expired\",\n\tINVALID_OTP: \"Invalid OTP\",\n\tTOO_MANY_ATTEMPTS: \"Too many attempts\",\n});\n\nconst sendVerificationOTPBodySchema = z.object({\n\temail: z.string({}).meta({\n\t\tdescription: \"Email address to send the OTP\",\n\t}),\n\ttype: z.enum(types).meta({\n\t\tdescription: \"Type of the OTP\",\n\t}),\n});\n\n/**\n * ### Endpoint\n *\n * POST `/email-otp/send-verification-otp`\n *\n * ### API Methods\n *\n * **server:**\n * `auth.api.sendVerificationOTP`\n *\n * **client:**\n * `authClient.emailOtp.sendVerificationOtp`\n *\n * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/email-otp#api-method-email-otp-send-verification-otp)\n */\nexport const sendVerificationOTP = (opts: RequiredEmailOTPOptions) =>\n\tcreateAuthEndpoint(\n\t\t\"/email-otp/send-verification-otp\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: sendVerificationOTPBodySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\toperationId: \"sendEmailVerificationOTP\",\n\t\t\t\t\tdescription: \"Send a verification OTP to an email\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tsuccess: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tif (!opts?.sendVerificationOTP) {\n\t\t\t\tctx.context.logger.error(\"send email verification is not implemented\");\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: \"send email verification is not implemented\",\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst email = ctx.body.email.toLowerCase();\n\t\t\tconst isValidEmail = z.email().safeParse(email);\n\t\t\tif (!isValidEmail.success) {\n\t\t\t\tthrow ctx.error(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: BASE_ERROR_CODES.INVALID_EMAIL,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst otp =\n\t\t\t\topts.generateOTP({ email, type: ctx.body.type }, ctx) ||\n\t\t\t\tdefaultOTPGenerator(opts);\n\n\t\t\tconst storedOTP = await storeOTP(ctx, opts, otp);\n\n\t\t\tawait ctx.context.internalAdapter\n\t\t\t\t.createVerificationValue({\n\t\t\t\t\tvalue: `${storedOTP}:0`,\n\t\t\t\t\tidentifier: `${ctx.body.type}-otp-${email}`,\n\t\t\t\t\texpiresAt: getDate(opts.expiresIn, \"sec\"),\n\t\t\t\t})\n\t\t\t\t.catch(async (error) => {\n\t\t\t\t\t// might be duplicate key error\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationByIdentifier(\n\t\t\t\t\t\t`${ctx.body.type}-otp-${email}`,\n\t\t\t\t\t);\n\t\t\t\t\t//try again\n\t\t\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\t\t\tvalue: `${storedOTP}:0`,\n\t\t\t\t\t\tidentifier: `${ctx.body.type}-otp-${email}`,\n\t\t\t\t\t\texpiresAt: getDate(opts.expiresIn, \"sec\"),\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\tconst user = await ctx.context.internalAdapter.findUserByEmail(email);\n\t\t\tif (!user) {\n\t\t\t\tif (ctx.body.type === \"sign-in\" && !opts.disableSignUp) {\n\t\t\t\t\t// allow\n\t\t\t\t} else {\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationByIdentifier(\n\t\t\t\t\t\t`${ctx.body.type}-otp-${email}`,\n\t\t\t\t\t);\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\tsuccess: true,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tawait ctx.context.runInBackgroundOrAwait(\n\t\t\t\topts.sendVerificationOTP(\n\t\t\t\t\t{\n\t\t\t\t\t\temail,\n\t\t\t\t\t\totp,\n\t\t\t\t\t\ttype: ctx.body.type,\n\t\t\t\t\t},\n\t\t\t\t\tctx,\n\t\t\t\t),\n\t\t\t);\n\t\t\treturn ctx.json({\n\t\t\t\tsuccess: true,\n\t\t\t});\n\t\t},\n\t);\n\nconst createVerificationOTPBodySchema = z.object({\n\temail: z.string({}).meta({\n\t\tdescription: \"Email address to send the OTP\",\n\t}),\n\ttype: z.enum(types).meta({\n\t\trequired: true,\n\t\tdescription: \"Type of the OTP\",\n\t}),\n});\n\nexport const createVerificationOTP = (opts: RequiredEmailOTPOptions) =>\n\tcreateAuthEndpoint(\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: createVerificationOTPBodySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\toperationId: \"createEmailVerificationOTP\",\n\t\t\t\t\tdescription: \"Create a verification OTP for an email\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst email = ctx.body.email.toLowerCase();\n\t\t\tconst otp =\n\t\t\t\topts.generateOTP({ email, type: ctx.body.type }, ctx) ||\n\t\t\t\tdefaultOTPGenerator(opts);\n\t\t\tconst storedOTP = await storeOTP(ctx, opts, otp);\n\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\tvalue: `${storedOTP}:0`,\n\t\t\t\tidentifier: `${ctx.body.type}-otp-${email}`,\n\t\t\t\texpiresAt: getDate(opts.expiresIn, \"sec\"),\n\t\t\t});\n\t\t\treturn otp;\n\t\t},\n\t);\n\nconst getVerificationOTPBodySchema = z.object({\n\temail: z.string({}).meta({\n\t\tdescription: \"Email address the OTP was sent to\",\n\t}),\n\ttype: z.enum(types).meta({\n\t\trequired: true,\n\t\tdescription: \"Type of the OTP\",\n\t}),\n});\n\n/**\n * ### Endpoint\n *\n * GET `/email-otp/get-verification-otp`\n *\n * ### API Methods\n *\n * **server:**\n * `auth.api.getVerificationOTP`\n *\n * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/email-otp#api-method-email-otp-get-verification-otp)\n */\nexport const getVerificationOTP = (opts: RequiredEmailOTPOptions) =>\n\tcreateAuthEndpoint(\n\t\t{\n\t\t\tmethod: \"GET\",\n\t\t\tquery: getVerificationOTPBodySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\toperationId: \"getEmailVerificationOTP\",\n\t\t\t\t\tdescription: \"Get a verification OTP for an email\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"OTP retrieved successfully or not found/expired\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\totp: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"The stored OTP, or null if not found or expired\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\trequired: [\"otp\"],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst email = ctx.query.email.toLowerCase();\n\t\t\tconst verificationValue =\n\t\t\t\tawait ctx.context.internalAdapter.findVerificationValue(\n\t\t\t\t\t`${ctx.query.type}-otp-${email}`,\n\t\t\t\t);\n\t\t\tif (!verificationValue || verificationValue.expiresAt < new Date()) {\n\t\t\t\treturn ctx.json({\n\t\t\t\t\totp: null,\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (\n\t\t\t\topts.storeOTP === \"hashed\" ||\n\t\t\t\t(typeof opts.storeOTP === \"object\" && \"hash\" in opts.storeOTP)\n\t\t\t) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: \"OTP is hashed, cannot return the plain text OTP\",\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst [storedOtp, _attempts] = splitAtLastColon(verificationValue.value);\n\t\t\tlet otp = storedOtp;\n\t\t\tif (opts.storeOTP === \"encrypted\") {\n\t\t\t\totp = await symmetricDecrypt({\n\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\tdata: storedOtp,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (typeof opts.storeOTP === \"object\" && \"decrypt\" in opts.storeOTP) {\n\t\t\t\totp = await opts.storeOTP.decrypt(storedOtp);\n\t\t\t}\n\n\t\t\treturn ctx.json({\n\t\t\t\totp,\n\t\t\t});\n\t\t},\n\t);\n\nconst checkVerificationOTPBodySchema = z.object({\n\temail: z.string().meta({\n\t\tdescription: \"Email address the OTP was sent to\",\n\t}),\n\ttype: z.enum(types).meta({\n\t\trequired: true,\n\t\tdescription: \"Type of the OTP\",\n\t}),\n\totp: z.string().meta({\n\t\trequired: true,\n\t\tdescription: \"OTP to verify\",\n\t}),\n});\n\n/**\n * ### Endpoint\n *\n * GET `/email-otp/check-verification-otp`\n *\n * ### API Methods\n *\n * **server:**\n * `auth.api.checkVerificationOTP`\n *\n * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/email-otp#api-method-email-otp-check-verification-otp)\n */\nexport const checkVerificationOTP = (opts: RequiredEmailOTPOptions) =>\n\tcreateAuthEndpoint(\n\t\t\"/email-otp/check-verification-otp\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: checkVerificationOTPBodySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\toperationId: \"verifyEmailWithOTP\",\n\t\t\t\t\tdescription: \"Verify an email with an OTP\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tsuccess: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst email = ctx.body.email.toLowerCase();\n\t\t\tconst isValidEmail = z.email().safeParse(email);\n\t\t\tif (!isValidEmail.success) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: BASE_ERROR_CODES.INVALID_EMAIL,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst user = await ctx.context.internalAdapter.findUserByEmail(email);\n\t\t\tif (!user) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: BASE_ERROR_CODES.USER_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst verificationValue =\n\t\t\t\tawait ctx.context.internalAdapter.findVerificationValue(\n\t\t\t\t\t`${ctx.body.type}-otp-${email}`,\n\t\t\t\t);\n\t\t\tif (!verificationValue) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ERROR_CODES.INVALID_OTP,\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (verificationValue.expiresAt < new Date()) {\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(\n\t\t\t\t\tverificationValue.id,\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ERROR_CODES.OTP_EXPIRED,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst [otpValue, attempts] = splitAtLastColon(verificationValue.value);\n\t\t\tconst allowedAttempts = opts?.allowedAttempts || 3;\n\t\t\tif (attempts && parseInt(attempts) >= allowedAttempts) {\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(\n\t\t\t\t\tverificationValue.id,\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage: ERROR_CODES.TOO_MANY_ATTEMPTS,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst verified = await verifyStoredOTP(ctx, opts, otpValue, ctx.body.otp);\n\t\t\tif (!verified) {\n\t\t\t\tawait ctx.context.internalAdapter.updateVerificationValue(\n\t\t\t\t\tverificationValue.id,\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: `${otpValue}:${parseInt(attempts || \"0\") + 1}`,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ERROR_CODES.INVALID_OTP,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn ctx.json({\n\t\t\t\tsuccess: true,\n\t\t\t});\n\t\t},\n\t);\n\nconst verifyEmailOTPBodySchema = z.object({\n\temail: z.string({}).meta({\n\t\tdescription: \"Email address to verify\",\n\t}),\n\totp: z.string().meta({\n\t\trequired: true,\n\t\tdescription: \"OTP to verify\",\n\t}),\n});\n\n/**\n * ### Endpoint\n *\n * POST `/email-otp/verify-email`\n *\n * ### API Methods\n *\n * **server:**\n * `auth.api.verifyEmailOTP`\n *\n * **client:**\n * `authClient.emailOtp.verifyEmail`\n *\n * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/email-otp#api-method-email-otp-verify-email)\n */\nexport const verifyEmailOTP = (opts: RequiredEmailOTPOptions) =>\n\tcreateAuthEndpoint(\n\t\t\"/email-otp/verify-email\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: verifyEmailOTPBodySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"Verify email with OTP\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tstatus: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Indicates if the verification was successful\",\n\t\t\t\t\t\t\t\t\t\t\t\tenum: [true],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\ttoken: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Session token if autoSignInAfterVerification is enabled, otherwise null\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/User\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\trequired: [\"status\", \"token\", \"user\"],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst email = ctx.body.email.toLowerCase();\n\t\t\tconst isValidEmail = z.email().safeParse(email);\n\t\t\tif (!isValidEmail.success) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: BASE_ERROR_CODES.INVALID_EMAIL,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst verificationValue =\n\t\t\t\tawait ctx.context.internalAdapter.findVerificationValue(\n\t\t\t\t\t`email-verification-otp-${email}`,\n\t\t\t\t);\n\n\t\t\tif (!verificationValue) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ERROR_CODES.INVALID_OTP,\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (verificationValue.expiresAt < new Date()) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ERROR_CODES.OTP_EXPIRED,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst [otpValue, attempts] = splitAtLastColon(verificationValue.value);\n\t\t\tconst allowedAttempts = opts?.allowedAttempts || 3;\n\t\t\tif (attempts && parseInt(attempts) >= allowedAttempts) {\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(\n\t\t\t\t\tverificationValue.id,\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage: ERROR_CODES.TOO_MANY_ATTEMPTS,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst verified = await verifyStoredOTP(ctx, opts, otpValue, ctx.body.otp);\n\t\t\tif (!verified) {\n\t\t\t\tawait ctx.context.internalAdapter.updateVerificationValue(\n\t\t\t\t\tverificationValue.id,\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: `${otpValue}:${parseInt(attempts || \"0\") + 1}`,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ERROR_CODES.INVALID_OTP,\n\t\t\t\t});\n\t\t\t}\n\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(\n\t\t\t\tverificationValue.id,\n\t\t\t);\n\t\t\tconst user = await ctx.context.internalAdapter.findUserByEmail(email);\n\t\t\tif (!user) {\n\t\t\t\t/**\n\t\t\t\t * safe to leak the existence of a user, given the user has already the OTP from the\n\t\t\t\t * email\n\t\t\t\t */\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: BASE_ERROR_CODES.USER_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (ctx.context.options.emailVerification?.beforeEmailVerification) {\n\t\t\t\tawait ctx.context.options.emailVerification.beforeEmailVerification(\n\t\t\t\t\tuser.user,\n\t\t\t\t\tctx.request,\n\t\t\t\t);\n\t\t\t}\n\t\t\tconst updatedUser = await ctx.context.internalAdapter.updateUser(\n\t\t\t\tuser.user.id,\n\t\t\t\t{\n\t\t\t\t\temail,\n\t\t\t\t\temailVerified: true,\n\t\t\t\t},\n\t\t\t);\n\t\t\tif (ctx.context.options.emailVerification?.onEmailVerification) {\n\t\t\t\tawait ctx.context.options.emailVerification.onEmailVerification(\n\t\t\t\t\tupdatedUser,\n\t\t\t\t\tctx.request,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tawait ctx.context.options.emailVerification?.afterEmailVerification?.(\n\t\t\t\tupdatedUser,\n\t\t\t\tctx.request,\n\t\t\t);\n\n\t\t\tif (ctx.context.options.emailVerification?.autoSignInAfterVerification) {\n\t\t\t\tconst session = await ctx.context.internalAdapter.createSession(\n\t\t\t\t\tupdatedUser.id,\n\t\t\t\t);\n\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\tsession,\n\t\t\t\t\tuser: updatedUser,\n\t\t\t\t});\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tstatus: true,\n\t\t\t\t\ttoken: session.token,\n\t\t\t\t\tuser: parseUserOutput(ctx.context.options, updatedUser),\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst currentSession = await getSessionFromCtx(ctx);\n\t\t\tif (currentSession && updatedUser.emailVerified) {\n\t\t\t\tconst dontRememberMeCookie = await ctx.getSignedCookie(\n\t\t\t\t\tctx.context.authCookies.dontRememberToken.name,\n\t\t\t\t\tctx.context.secret,\n\t\t\t\t);\n\t\t\t\tawait setCookieCache(\n\t\t\t\t\tctx,\n\t\t\t\t\t{\n\t\t\t\t\t\tsession: currentSession.session,\n\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t...currentSession.user,\n\t\t\t\t\t\t\temailVerified: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t!!dontRememberMeCookie,\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn ctx.json({\n\t\t\t\tstatus: true,\n\t\t\t\ttoken: null,\n\t\t\t\tuser: parseUserOutput(ctx.context.options, updatedUser),\n\t\t\t});\n\t\t},\n\t);\n\nconst signInEmailOTPBodySchema = z.object({\n\temail: z.string({}).meta({\n\t\tdescription: \"Email address to sign in\",\n\t}),\n\totp: z.string().meta({\n\t\trequired: true,\n\t\tdescription: \"OTP sent to the email\",\n\t}),\n});\n\n/**\n * ### Endpoint\n *\n * POST `/sign-in/email-otp`\n *\n * ### API Methods\n *\n * **server:**\n * `auth.api.signInEmailOTP`\n *\n * **client:**\n * `authClient.signIn.emailOtp`\n *\n * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/email-otp#api-method-sign-in-email-otp)\n */\nexport const signInEmailOTP = (opts: RequiredEmailOTPOptions) =>\n\tcreateAuthEndpoint(\n\t\t\"/sign-in/email-otp\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: signInEmailOTPBodySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\toperationId: \"signInWithEmailOTP\",\n\t\t\t\t\tdescription: \"Sign in with email and OTP\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\ttoken: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Session token for the authenticated session\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/User\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\trequired: [\"token\", \"user\"],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst email = ctx.body.email.toLowerCase();\n\t\t\tconst verificationValue =\n\t\t\t\tawait ctx.context.internalAdapter.findVerificationValue(\n\t\t\t\t\t`sign-in-otp-${email}`,\n\t\t\t\t);\n\t\t\tif (!verificationValue) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ERROR_CODES.INVALID_OTP,\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (verificationValue.expiresAt < new Date()) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ERROR_CODES.OTP_EXPIRED,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst [otpValue, attempts] = splitAtLastColon(verificationValue.value);\n\t\t\tconst allowedAttempts = opts?.allowedAttempts || 3;\n\t\t\tif (attempts && parseInt(attempts) >= allowedAttempts) {\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(\n\t\t\t\t\tverificationValue.id,\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage: ERROR_CODES.TOO_MANY_ATTEMPTS,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst verified = await verifyStoredOTP(ctx, opts, otpValue, ctx.body.otp);\n\t\t\tif (!verified) {\n\t\t\t\tawait ctx.context.internalAdapter.updateVerificationValue(\n\t\t\t\t\tverificationValue.id,\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: `${otpValue}:${parseInt(attempts || \"0\") + 1}`,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ERROR_CODES.INVALID_OTP,\n\t\t\t\t});\n\t\t\t}\n\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(\n\t\t\t\tverificationValue.id,\n\t\t\t);\n\t\t\tconst user = await ctx.context.internalAdapter.findUserByEmail(email);\n\t\t\tif (!user) {\n\t\t\t\tif (opts.disableSignUp) {\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\tmessage: BASE_ERROR_CODES.USER_NOT_FOUND,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst newUser = await ctx.context.internalAdapter.createUser({\n\t\t\t\t\temail,\n\t\t\t\t\temailVerified: true,\n\t\t\t\t\tname: \"\",\n\t\t\t\t});\n\t\t\t\tconst session = await ctx.context.internalAdapter.createSession(\n\t\t\t\t\tnewUser.id,\n\t\t\t\t);\n\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\tsession,\n\t\t\t\t\tuser: newUser,\n\t\t\t\t});\n\t\t\t\treturn ctx.json({\n\t\t\t\t\ttoken: session.token,\n\t\t\t\t\tuser: parseUserOutput(ctx.context.options, newUser),\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!user.user.emailVerified) {\n\t\t\t\tawait ctx.context.internalAdapter.updateUser(user.user.id, {\n\t\t\t\t\temailVerified: true,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst session = await ctx.context.internalAdapter.createSession(\n\t\t\t\tuser.user.id,\n\t\t\t);\n\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\tsession,\n\t\t\t\tuser: user.user,\n\t\t\t});\n\t\t\treturn ctx.json({\n\t\t\t\ttoken: session.token,\n\t\t\t\tuser: parseUserOutput(ctx.context.options, user.user),\n\t\t\t});\n\t\t},\n\t);\n\nconst requestPasswordResetEmailOTPBodySchema = z.object({\n\temail: z.string().meta({\n\t\tdescription: \"Email address to send the OTP\",\n\t}),\n});\n\n/**\n * ### Endpoint\n *\n * POST `/email-otp/request-password-reset`\n *\n * ### API Methods\n *\n * **server:**\n * `auth.api.requestPasswordResetEmailOTP`\n *\n * **client:**\n * `authClient.emailOtp.requestPasswordReset`\n *\n * @see [Read our docs to learn more.](https://www.better-auth.com/docs/plugins/email-otp#reset-password-with-otp)\n */\nexport const requestPasswordResetEmailOTP = (opts: RequiredEmailOTPOptions) =>\n\tcreateAuthEndpoint(\n\t\t\"/email-otp/request-password-reset\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: requestPasswordResetEmailOTPBodySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\toperationId: \"requestPasswordResetWithEmailOTP\",\n\t\t\t\t\tdescription: \"Request password reset with email and OTP\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tsuccess: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Indicates if the OTP was sent successfully\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst email = ctx.body.email;\n\t\t\tconst otp =\n\t\t\t\topts.generateOTP({ email, type: \"forget-password\" }, ctx) ||\n\t\t\t\tdefaultOTPGenerator(opts);\n\t\t\tconst storedOTP = await storeOTP(ctx, opts, otp);\n\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\tvalue: `${storedOTP}:0`,\n\t\t\t\tidentifier: `forget-password-otp-${email}`,\n\t\t\t\texpiresAt: getDate(opts.expiresIn, \"sec\"),\n\t\t\t});\n\t\t\tconst user = await ctx.context.internalAdapter.findUserByEmail(email);\n\t\t\tif (!user) {\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationByIdentifier(\n\t\t\t\t\t`forget-password-otp-${email}`,\n\t\t\t\t);\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tsuccess: true,\n\t\t\t\t});\n\t\t\t}\n\t\t\tawait ctx.context.runInBackgroundOrAwait(\n\t\t\t\topts.sendVerificationOTP(\n\t\t\t\t\t{\n\t\t\t\t\t\temail,\n\t\t\t\t\t\totp,\n\t\t\t\t\t\ttype: \"forget-password\",\n\t\t\t\t\t},\n\t\t\t\t\tctx,\n\t\t\t\t),\n\t\t\t);\n\t\t\treturn ctx.json({\n\t\t\t\tsuccess: true,\n\t\t\t});\n\t\t},\n\t);\n\nconst forgetPasswordEmailOTPBodySchema = z.object({\n\temail: z.string().meta({\n\t\tdescription: \"Email address to send the OTP\",\n\t}),\n});\n\n/**\n * ### Endpoint\n *\n * POST `/forget-password/email-otp`\n *\n * ### API Methods\n *\n * **server:**\n * `auth.api.forgetPasswordEmailOTP`\n *\n * **client:**\n * `authClient.forgetPassword.emailOtp`\n *\n * @deprecated Use `/email-otp/request-password-reset` instead.\n * @see [Read our docs to learn more.](https://www.better-auth.com/docs/plugins/email-otp#reset-password-with-otp)\n */\nexport const forgetPasswordEmailOTP = (opts: RequiredEmailOTPOptions) => {\n\tconst warnDeprecation = deprecate(\n\t\t() => {},\n\t\t'The \"/forget-password/email-otp\" endpoint is deprecated. ' +\n\t\t\t'Please use \"/email-otp/request-password-reset\" instead. ' +\n\t\t\t\"This endpoint will be removed in the next major version.\",\n\t);\n\n\treturn createAuthEndpoint(\n\t\t\"/forget-password/email-otp\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: forgetPasswordEmailOTPBodySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\toperationId: \"forgetPasswordWithEmailOTP\",\n\t\t\t\t\tdescription:\n\t\t\t\t\t\t\"Deprecated: Use /email-otp/request-password-reset instead.\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tsuccess: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Indicates if the OTP was sent successfully\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\twarnDeprecation();\n\t\t\tconst email = ctx.body.email;\n\t\t\tconst otp =\n\t\t\t\topts.generateOTP({ email, type: \"forget-password\" }, ctx) ||\n\t\t\t\tdefaultOTPGenerator(opts);\n\t\t\tconst storedOTP = await storeOTP(ctx, opts, otp);\n\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\tvalue: `${storedOTP}:0`,\n\t\t\t\tidentifier: `forget-password-otp-${email}`,\n\t\t\t\texpiresAt: getDate(opts.expiresIn, \"sec\"),\n\t\t\t});\n\t\t\tconst user = await ctx.context.internalAdapter.findUserByEmail(email);\n\t\t\tif (!user) {\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationByIdentifier(\n\t\t\t\t\t`forget-password-otp-${email}`,\n\t\t\t\t);\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tsuccess: true,\n\t\t\t\t});\n\t\t\t}\n\t\t\tawait ctx.context.runInBackgroundOrAwait(\n\t\t\t\topts.sendVerificationOTP(\n\t\t\t\t\t{\n\t\t\t\t\t\temail,\n\t\t\t\t\t\totp,\n\t\t\t\t\t\ttype: \"forget-password\",\n\t\t\t\t\t},\n\t\t\t\t\tctx,\n\t\t\t\t),\n\t\t\t);\n\t\t\treturn ctx.json({\n\t\t\t\tsuccess: true,\n\t\t\t});\n\t\t},\n\t);\n};\n\nconst resetPasswordEmailOTPBodySchema = z.object({\n\temail: z.string().meta({\n\t\tdescription: \"Email address to reset the password\",\n\t}),\n\totp: z.string().meta({\n\t\tdescription: \"OTP sent to the email\",\n\t}),\n\tpassword: z.string().meta({\n\t\tdescription: \"New password\",\n\t}),\n});\n\n/**\n * ### Endpoint\n *\n * POST `/email-otp/reset-password`\n *\n * ### API Methods\n *\n * **server:**\n * `auth.api.resetPasswordEmailOTP`\n *\n * **client:**\n * `authClient.emailOtp.resetPassword`\n *\n * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/email-otp#api-method-email-otp-reset-password)\n */\nexport const resetPasswordEmailOTP = (opts: RequiredEmailOTPOptions) =>\n\tcreateAuthEndpoint(\n\t\t\"/email-otp/reset-password\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: resetPasswordEmailOTPBodySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\toperationId: \"resetPasswordWithEmailOTP\",\n\t\t\t\t\tdescription: \"Reset password with email and OTP\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontnt: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tsuccess: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst email = ctx.body.email;\n\t\t\tconst verificationValue =\n\t\t\t\tawait ctx.context.internalAdapter.findVerificationValue(\n\t\t\t\t\t`forget-password-otp-${email}`,\n\t\t\t\t);\n\t\t\tif (!verificationValue) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ERROR_CODES.INVALID_OTP,\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (verificationValue.expiresAt < new Date()) {\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(\n\t\t\t\t\tverificationValue.id,\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ERROR_CODES.OTP_EXPIRED,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst [otpValue, attempts] = splitAtLastColon(verificationValue.value);\n\t\t\tconst allowedAttempts = opts?.allowedAttempts || 3;\n\t\t\tif (attempts && parseInt(attempts) >= allowedAttempts) {\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(\n\t\t\t\t\tverificationValue.id,\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage: ERROR_CODES.TOO_MANY_ATTEMPTS,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst verified = await verifyStoredOTP(ctx, opts, otpValue, ctx.body.otp);\n\t\t\tif (!verified) {\n\t\t\t\tawait ctx.context.internalAdapter.updateVerificationValue(\n\t\t\t\t\tverificationValue.id,\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: `${otpValue}:${parseInt(attempts || \"0\") + 1}`,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ERROR_CODES.INVALID_OTP,\n\t\t\t\t});\n\t\t\t}\n\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(\n\t\t\t\tverificationValue.id,\n\t\t\t);\n\t\t\tconst user = await ctx.context.internalAdapter.findUserByEmail(email, {\n\t\t\t\tincludeAccounts: true,\n\t\t\t});\n\t\t\tif (!user) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: BASE_ERROR_CODES.USER_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst minPasswordLength = ctx.context.password.config.minPasswordLength;\n\t\t\tif (ctx.body.password.length < minPasswordLength) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: BASE_ERROR_CODES.PASSWORD_TOO_SHORT,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst maxPasswordLength = ctx.context.password.config.maxPasswordLength;\n\t\t\tif (ctx.body.password.length > maxPasswordLength) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: BASE_ERROR_CODES.PASSWORD_TOO_LONG,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst passwordHash = await ctx.context.password.hash(ctx.body.password);\n\t\t\tconst account = user.accounts?.find(\n\t\t\t\t(account) => account.providerId === \"credential\",\n\t\t\t);\n\t\t\tif (!account) {\n\t\t\t\tawait ctx.context.internalAdapter.createAccount({\n\t\t\t\t\tuserId: user.user.id,\n\t\t\t\t\tproviderId: \"credential\",\n\t\t\t\t\taccountId: user.user.id,\n\t\t\t\t\tpassword: passwordHash,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tawait ctx.context.internalAdapter.updatePassword(\n\t\t\t\t\tuser.user.id,\n\t\t\t\t\tpasswordHash,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (ctx.context.options.emailAndPassword?.onPasswordReset) {\n\t\t\t\tawait ctx.context.options.emailAndPassword.onPasswordReset(\n\t\t\t\t\t{\n\t\t\t\t\t\tuser: user.user,\n\t\t\t\t\t},\n\t\t\t\t\tctx.request,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (!user.user.emailVerified) {\n\t\t\t\tawait ctx.context.internalAdapter.updateUser(user.user.id, {\n\t\t\t\t\temailVerified: true,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (ctx.context.options.emailAndPassword?.revokeSessionsOnPasswordReset) {\n\t\t\t\tawait ctx.context.internalAdapter.deleteSessions(user.user.id);\n\t\t\t}\n\t\t\treturn ctx.json({\n\t\t\t\tsuccess: true,\n\t\t\t});\n\t\t},\n\t);\n\nconst defaultOTPGenerator = (options: EmailOTPOptions) =>\n\tgenerateRandomString(options.otpLength ?? 6, \"0-9\");\n"],"names":["session"],"mappings":"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"}},
    {"offset": {"line": 5820, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/email-otp/index.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/email-otp/index.ts"],"sourcesContent":["import type { BetterAuthPlugin } from \"@better-auth/core\";\nimport { createAuthMiddleware } from \"@better-auth/core/api\";\nimport { generateRandomString } from \"../../crypto\";\nimport { getDate } from \"../../utils/date\";\nimport { getEndpointResponse } from \"../../utils/plugin-helper\";\nimport { storeOTP } from \"./otp-token\";\nimport {\n\tcheckVerificationOTP,\n\tcreateVerificationOTP,\n\tERROR_CODES,\n\tforgetPasswordEmailOTP,\n\tgetVerificationOTP,\n\trequestPasswordResetEmailOTP,\n\tresetPasswordEmailOTP,\n\tsendVerificationOTP,\n\tsignInEmailOTP,\n\tverifyEmailOTP,\n} from \"./routes\";\nimport type { EmailOTPOptions } from \"./types\";\n\nexport type { EmailOTPOptions } from \"./types\";\n\nconst defaultOTPGenerator = (options: EmailOTPOptions) =>\n\tgenerateRandomString(options.otpLength ?? 6, \"0-9\");\n\nexport const emailOTP = (options: EmailOTPOptions) => {\n\tconst opts = {\n\t\texpiresIn: 5 * 60,\n\t\tgenerateOTP: () => defaultOTPGenerator(options),\n\t\tstoreOTP: \"plain\",\n\t\t...options,\n\t} satisfies EmailOTPOptions;\n\n\tconst sendVerificationOTPAction = sendVerificationOTP(opts);\n\n\treturn {\n\t\tid: \"email-otp\",\n\t\tinit(ctx) {\n\t\t\tif (!opts.overrideDefaultEmailVerification) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\toptions: {\n\t\t\t\t\temailVerification: {\n\t\t\t\t\t\tasync sendVerificationEmail(data, request) {\n\t\t\t\t\t\t\tawait ctx.runInBackgroundOrAwait(\n\t\t\t\t\t\t\t\tsendVerificationOTPAction({\n\t\t\t\t\t\t\t\t\t//@ts-expect-error - we need to pass the context\n\t\t\t\t\t\t\t\t\tcontext: ctx,\n\t\t\t\t\t\t\t\t\trequest: request,\n\t\t\t\t\t\t\t\t\tbody: {\n\t\t\t\t\t\t\t\t\t\temail: data.user.email,\n\t\t\t\t\t\t\t\t\t\ttype: \"email-verification\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tctx,\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tendpoints: {\n\t\t\tsendVerificationOTP: sendVerificationOTPAction,\n\t\t\tcreateVerificationOTP: createVerificationOTP(opts),\n\t\t\tgetVerificationOTP: getVerificationOTP(opts),\n\t\t\tcheckVerificationOTP: checkVerificationOTP(opts),\n\t\t\tverifyEmailOTP: verifyEmailOTP(opts),\n\t\t\tsignInEmailOTP: signInEmailOTP(opts),\n\t\t\trequestPasswordResetEmailOTP: requestPasswordResetEmailOTP(opts),\n\t\t\tforgetPasswordEmailOTP: forgetPasswordEmailOTP(opts),\n\t\t\tresetPasswordEmailOTP: resetPasswordEmailOTP(opts),\n\t\t},\n\t\thooks: {\n\t\t\tafter: [\n\t\t\t\t{\n\t\t\t\t\tmatcher(context) {\n\t\t\t\t\t\treturn !!(\n\t\t\t\t\t\t\tcontext.path?.startsWith(\"/sign-up\") &&\n\t\t\t\t\t\t\topts.sendVerificationOnSignUp &&\n\t\t\t\t\t\t\t!opts.overrideDefaultEmailVerification\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tconst response = await getEndpointResponse<{\n\t\t\t\t\t\t\tuser: { email: string };\n\t\t\t\t\t\t}>(ctx);\n\t\t\t\t\t\tconst email = response?.user.email;\n\t\t\t\t\t\tif (email) {\n\t\t\t\t\t\t\tconst otp =\n\t\t\t\t\t\t\t\topts.generateOTP({ email, type: ctx.body.type }, ctx) ||\n\t\t\t\t\t\t\t\tdefaultOTPGenerator(opts);\n\t\t\t\t\t\t\tconst storedOTP = await storeOTP(ctx, opts, otp);\n\t\t\t\t\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\t\t\t\t\tvalue: `${storedOTP}:0`,\n\t\t\t\t\t\t\t\tidentifier: `email-verification-otp-${email}`,\n\t\t\t\t\t\t\t\texpiresAt: getDate(opts.expiresIn, \"sec\"),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tawait ctx.context.runInBackgroundOrAwait(\n\t\t\t\t\t\t\t\toptions.sendVerificationOTP(\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\temail,\n\t\t\t\t\t\t\t\t\t\totp,\n\t\t\t\t\t\t\t\t\t\ttype: \"email-verification\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tctx,\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t$ERROR_CODES: ERROR_CODES,\n\t\trateLimit: [\n\t\t\t{\n\t\t\t\tpathMatcher(path) {\n\t\t\t\t\treturn path === \"/email-otp/send-verification-otp\";\n\t\t\t\t},\n\t\t\t\twindow: 60,\n\t\t\t\tmax: 3,\n\t\t\t},\n\t\t\t{\n\t\t\t\tpathMatcher(path) {\n\t\t\t\t\treturn path === \"/email-otp/check-verification-otp\";\n\t\t\t\t},\n\t\t\t\twindow: 60,\n\t\t\t\tmax: 3,\n\t\t\t},\n\t\t\t{\n\t\t\t\tpathMatcher(path) {\n\t\t\t\t\treturn path === \"/email-otp/verify-email\";\n\t\t\t\t},\n\t\t\t\twindow: 60,\n\t\t\t\tmax: 3,\n\t\t\t},\n\t\t\t{\n\t\t\t\tpathMatcher(path) {\n\t\t\t\t\treturn path === \"/sign-in/email-otp\";\n\t\t\t\t},\n\t\t\t\twindow: 60,\n\t\t\t\tmax: 3,\n\t\t\t},\n\t\t\t{\n\t\t\t\tpathMatcher(path) {\n\t\t\t\t\treturn path === \"/email-otp/request-password-reset\";\n\t\t\t\t},\n\t\t\t\twindow: 60,\n\t\t\t\tmax: 3,\n\t\t\t},\n\t\t\t{\n\t\t\t\tpathMatcher(path) {\n\t\t\t\t\treturn path === \"/email-otp/reset-password\";\n\t\t\t\t},\n\t\t\t\twindow: 60,\n\t\t\t\tmax: 3,\n\t\t\t},\n\t\t\t{\n\t\t\t\tpathMatcher(path) {\n\t\t\t\t\treturn path === \"/forget-password/email-otp\";\n\t\t\t\t},\n\t\t\t\twindow: 60,\n\t\t\t\tmax: 3,\n\t\t\t},\n\t\t],\n\t\toptions,\n\t} satisfies BetterAuthPlugin;\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5971, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/generic-oauth/providers/auth0.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/generic-oauth/providers/auth0.ts"],"sourcesContent":["import type { OAuth2Tokens, OAuth2UserInfo } from \"@better-auth/core/oauth2\";\nimport { betterFetch } from \"@better-fetch/fetch\";\nimport type { BaseOAuthProviderOptions, GenericOAuthConfig } from \"../index\";\n\nexport interface Auth0Options extends BaseOAuthProviderOptions {\n\t/**\n\t * Auth0 domain (e.g., dev-xxx.eu.auth0.com)\n\t * This will be used to construct the discovery URL.\n\t */\n\tdomain: string;\n}\n\ninterface Auth0Profile {\n\tsub: string;\n\tname?: string;\n\temail?: string;\n\temail_verified?: boolean;\n\tpicture?: string;\n\tnickname?: string;\n\tgiven_name?: string;\n\tfamily_name?: string;\n}\n\n/**\n * Auth0 OAuth provider helper\n *\n * @example\n * ```ts\n * import { genericOAuth, auth0 } from \"better-auth/plugins/generic-oauth\";\n *\n * export const auth = betterAuth({\n *   plugins: [\n *     genericOAuth({\n *       config: [\n *         auth0({\n *           clientId: process.env.AUTH0_CLIENT_ID,\n *           clientSecret: process.env.AUTH0_CLIENT_SECRET,\n *           domain: process.env.AUTH0_DOMAIN,\n *         }),\n *       ],\n *     }),\n *   ],\n * });\n * ```\n */\nexport function auth0(options: Auth0Options): GenericOAuthConfig {\n\tconst defaultScopes = [\"openid\", \"profile\", \"email\"];\n\n\t// Ensure domain doesn't have protocol prefix\n\tconst domain = options.domain.replace(/^https?:\\/\\//, \"\");\n\tconst discoveryUrl = `https://${domain}/.well-known/openid-configuration`;\n\n\tconst getUserInfo = async (\n\t\ttokens: OAuth2Tokens,\n\t): Promise<OAuth2UserInfo | null> => {\n\t\tconst userInfoUrl = `https://${domain}/userinfo`;\n\n\t\tconst { data: profile, error } = await betterFetch<Auth0Profile>(\n\t\t\tuserInfoUrl,\n\t\t\t{\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${tokens.accessToken}`,\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\n\t\tif (error || !profile) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tid: profile.sub,\n\t\t\tname: profile.name ?? profile.nickname ?? undefined,\n\t\t\temail: profile.email ?? undefined,\n\t\t\timage: profile.picture,\n\t\t\temailVerified: profile.email_verified ?? false,\n\t\t};\n\t};\n\n\treturn {\n\t\tproviderId: \"auth0\",\n\t\tdiscoveryUrl,\n\t\tclientId: options.clientId,\n\t\tclientSecret: options.clientSecret,\n\t\tscopes: options.scopes ?? defaultScopes,\n\t\tredirectURI: options.redirectURI,\n\t\tpkce: options.pkce,\n\t\tdisableImplicitSignUp: options.disableImplicitSignUp,\n\t\tdisableSignUp: options.disableSignUp,\n\t\toverrideUserInfo: options.overrideUserInfo,\n\t\tgetUserInfo,\n\t};\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;GA6CA,SAAgB,MAAM,OAAA,EAA2C;IAChE,MAAM,gBAAgB;QAAC;QAAU;QAAW;KAAQ;IAGpD,MAAM,SAAS,QAAQ,MAAA,CAAO,OAAA,CAAQ,gBAAgB,GAAG;IACzD,MAAM,eAAe,CAAA,QAAA,EAAW,OAAO,iCAAA,CAAA;IAEvC,MAAM,cAAc,OACnB,WACoC;QAGpC,MAAM,EAAE,MAAM,OAAA,EAAS,KAAA,EAAA,GAAU,UAAM,4KAAA,EAFnB,CAAA,QAAA,EAAW,OAAO,SAAA,CAAA,EAIrC;YACC,SAAS;gBACR,eAAe,CAAA,OAAA,EAAU,OAAO,WAAA,EAAA;YAAA,CAChC;QAAA,CACD,CACD;QAED,IAAI,SAAS,CAAC,QACb,CAAA,OAAO;QAGR,OAAO;YACN,IAAI,QAAQ,GAAA;YACZ,MAAM,QAAQ,IAAA,IAAQ,QAAQ,QAAA,IAAY,KAAA;YAC1C,OAAO,QAAQ,KAAA,IAAS,KAAA;YACxB,OAAO,QAAQ,OAAA;YACf,eAAe,QAAQ,cAAA,IAAkB;SACzC;;IAGF,OAAO;QACN,YAAY;QACZ;QACA,UAAU,QAAQ,QAAA;QAClB,cAAc,QAAQ,YAAA;QACtB,QAAQ,QAAQ,MAAA,IAAU;QAC1B,aAAa,QAAQ,WAAA;QACrB,MAAM,QAAQ,IAAA;QACd,uBAAuB,QAAQ,qBAAA;QAC/B,eAAe,QAAQ,aAAA;QACvB,kBAAkB,QAAQ,gBAAA;QAC1B;KACA"}},
    {"offset": {"line": 6042, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/generic-oauth/providers/gumroad.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/generic-oauth/providers/gumroad.ts"],"sourcesContent":["import type { OAuth2Tokens, OAuth2UserInfo } from \"@better-auth/core/oauth2\";\nimport { betterFetch } from \"@better-fetch/fetch\";\nimport type { BaseOAuthProviderOptions, GenericOAuthConfig } from \"../index\";\n\nexport interface GumroadOptions extends BaseOAuthProviderOptions {}\n\ninterface GumroadUser {\n\tuser_id: string;\n\tname: string;\n\temail: string;\n\tprofile_url: string;\n}\n\ninterface GumroadProfile {\n\tsuccess: boolean;\n\tuser: GumroadUser;\n}\n\n/**\n * Gumroad OAuth provider helper\n *\n * @example\n * ```ts\n * import { genericOAuth, gumroad } from \"better-auth/plugins/generic-oauth\";\n *\n * export const auth = betterAuth({\n *   plugins: [\n *     genericOAuth({\n *       config: [\n *         gumroad({\n *           clientId: process.env.GUMROAD_CLIENT_ID,\n *           clientSecret: process.env.GUMROAD_CLIENT_SECRET,\n *         }),\n *       ],\n *     }),\n *   ],\n * });\n * ```\n *\n * @see https://app.gumroad.com/oauth\n */\nexport function gumroad(options: GumroadOptions): GenericOAuthConfig {\n\tconst getUserInfo = async (\n\t\ttokens: OAuth2Tokens,\n\t): Promise<OAuth2UserInfo | null> => {\n\t\tconst { data: profile, error } = await betterFetch<GumroadProfile>(\n\t\t\t\"https://api.gumroad.com/v2/user\",\n\t\t\t{\n\t\t\t\tmethod: \"GET\",\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${tokens.accessToken}`,\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\n\t\tif (error || !profile?.success || !profile.user) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tid: profile.user.user_id,\n\t\t\tname: profile.user.name,\n\t\t\temail: profile.user.email,\n\t\t\timage: profile.user.profile_url,\n\t\t\temailVerified: false,\n\t\t};\n\t};\n\n\tconst defaultScopes = [\"view_profile\"];\n\n\treturn {\n\t\tproviderId: \"gumroad\",\n\t\tauthorizationUrl: \"https://gumroad.com/oauth/authorize\",\n\t\ttokenUrl: \"https://api.gumroad.com/oauth/token\",\n\t\tclientId: options.clientId,\n\t\tclientSecret: options.clientSecret,\n\t\tscopes: options.scopes ?? defaultScopes,\n\t\tredirectURI: options.redirectURI,\n\t\tpkce: options.pkce,\n\t\tdisableImplicitSignUp: options.disableImplicitSignUp,\n\t\tdisableSignUp: options.disableSignUp,\n\t\toverrideUserInfo: options.overrideUserInfo,\n\t\tgetUserInfo,\n\t};\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;GAyCA,SAAgB,QAAQ,OAAA,EAA6C;IACpE,MAAM,cAAc,OACnB,WACoC;QACpC,MAAM,EAAE,MAAM,OAAA,EAAS,KAAA,EAAA,GAAU,UAAM,4KAAA,EACtC,mCACA;YACC,QAAQ;YACR,SAAS;gBACR,eAAe,CAAA,OAAA,EAAU,OAAO,WAAA,EAAA;YAAA,CAChC;SACD,CACD;QAED,IAAI,SAAS,CAAC,SAAS,WAAW,CAAC,QAAQ,IAAA,CAC1C,CAAA,OAAO;QAGR,OAAO;YACN,IAAI,QAAQ,IAAA,CAAK,OAAA;YACjB,MAAM,QAAQ,IAAA,CAAK,IAAA;YACnB,OAAO,QAAQ,IAAA,CAAK,KAAA;YACpB,OAAO,QAAQ,IAAA,CAAK,WAAA;YACpB,eAAe;SACf;;IAKF,OAAO;QACN,YAAY;QACZ,kBAAkB;QAClB,UAAU;QACV,UAAU,QAAQ,QAAA;QAClB,cAAc,QAAQ,YAAA;QACtB,QAAQ,QAAQ,MAAA,IARK;YAAC;SAAe;QASrC,aAAa,QAAQ,WAAA;QACrB,MAAM,QAAQ,IAAA;QACd,uBAAuB,QAAQ,qBAAA;QAC/B,eAAe,QAAQ,aAAA;QACvB,kBAAkB,QAAQ,gBAAA;QAC1B;KACA"}},
    {"offset": {"line": 6111, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/generic-oauth/providers/hubspot.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/generic-oauth/providers/hubspot.ts"],"sourcesContent":["import type { OAuth2Tokens, OAuth2UserInfo } from \"@better-auth/core/oauth2\";\nimport { betterFetch } from \"@better-fetch/fetch\";\nimport type { BaseOAuthProviderOptions, GenericOAuthConfig } from \"../index\";\n\nexport interface HubSpotOptions extends BaseOAuthProviderOptions {\n\t/**\n\t * OAuth scopes to request.\n\t * @default [\"oauth\"]\n\t */\n\tscopes?: string[];\n}\n\n/**\n * HubSpot access token information response.\n * Based on: https://legacydocs.hubspot.com/docs/methods/oauth2/get-access-token-information\n *\n * The API may return additional fields, but we only use the fields needed for user identification.\n */\ninterface HubSpotProfile extends Record<string, any> {\n\tuser: string;\n\tuser_id: string;\n\thub_domain: string;\n\thub_id: string;\n\tsigned_access_token?: {\n\t\tuserId?: string;\n\t\t[key: string]: any;\n\t};\n}\n\n/**\n * HubSpot OAuth provider helper\n *\n * @example\n * ```ts\n * import { genericOAuth, hubspot } from \"better-auth/plugins/generic-oauth\";\n *\n * export const auth = betterAuth({\n *   plugins: [\n *     genericOAuth({\n *       config: [\n *         hubspot({\n *           clientId: process.env.HUBSPOT_CLIENT_ID,\n *           clientSecret: process.env.HUBSPOT_CLIENT_SECRET,\n *           scopes: [\"oauth\", \"contacts\"],\n *         }),\n *       ],\n *     }),\n *   ],\n * });\n * ```\n */\nexport function hubspot(options: HubSpotOptions): GenericOAuthConfig {\n\tconst defaultScopes = [\"oauth\"];\n\n\tconst getUserInfo = async (\n\t\ttokens: OAuth2Tokens,\n\t): Promise<OAuth2UserInfo | null> => {\n\t\tconst tokenInfoUrl = `https://api.hubapi.com/oauth/v1/access-tokens/${tokens.accessToken}`;\n\n\t\tconst { data: profile, error } = await betterFetch<HubSpotProfile>(\n\t\t\ttokenInfoUrl,\n\t\t\t{\n\t\t\t\theaders: {\n\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\n\t\tif (error || !profile) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Note: HubSpot's OAuth API only returns the email address in the 'user' field.\n\t\t// It does NOT provide a display name or profile picture. This is a known limitation.\n\t\t// See: https://community.hubspot.com/t5/APIs-Integrations/Profile-photo-is-not-retrieved-with-User-API/m-p/325521\n\t\tconst id = profile.user_id ?? profile.signed_access_token?.userId;\n\n\t\tif (!id) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tid,\n\t\t\tname: profile.user,\n\t\t\temail: profile.user,\n\t\t\timage: undefined,\n\t\t\temailVerified: false,\n\t\t};\n\t};\n\n\treturn {\n\t\tproviderId: \"hubspot\",\n\t\tauthorizationUrl: \"https://app.hubspot.com/oauth/authorize\",\n\t\ttokenUrl: \"https://api.hubapi.com/oauth/v1/token\",\n\t\tclientId: options.clientId,\n\t\tclientSecret: options.clientSecret,\n\t\tscopes: options.scopes ?? defaultScopes,\n\t\tredirectURI: options.redirectURI,\n\t\tauthentication: \"post\",\n\t\tpkce: options.pkce,\n\t\tdisableImplicitSignUp: options.disableImplicitSignUp,\n\t\tdisableSignUp: options.disableSignUp,\n\t\toverrideUserInfo: options.overrideUserInfo,\n\t\tgetUserInfo,\n\t};\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;GAmDA,SAAgB,QAAQ,OAAA,EAA6C;IACpE,MAAM,gBAAgB;QAAC;KAAQ;IAE/B,MAAM,cAAc,OACnB,WACoC;QAGpC,MAAM,EAAE,MAAM,OAAA,EAAS,KAAA,EAAA,GAAU,UAAM,4KAAA,EAFlB,CAAA,8CAAA,EAAiD,OAAO,WAAA,EAAA,EAI5E;YACC,SAAS;gBACR,gBAAgB;YAAA,CAChB;QAAA,CACD,CACD;QAED,IAAI,SAAS,CAAC,QACb,CAAA,OAAO;QAMR,MAAM,KAAK,QAAQ,OAAA,IAAW,QAAQ,mBAAA,EAAqB;QAE3D,IAAI,CAAC,GACJ,CAAA,OAAO;QAGR,OAAO;YACN;YACA,MAAM,QAAQ,IAAA;YACd,OAAO,QAAQ,IAAA;YACf,OAAO,KAAA;YACP,eAAe;SACf;;IAGF,OAAO;QACN,YAAY;QACZ,kBAAkB;QAClB,UAAU;QACV,UAAU,QAAQ,QAAA;QAClB,cAAc,QAAQ,YAAA;QACtB,QAAQ,QAAQ,MAAA,IAAU;QAC1B,aAAa,QAAQ,WAAA;QACrB,gBAAgB;QAChB,MAAM,QAAQ,IAAA;QACd,uBAAuB,QAAQ,qBAAA;QAC/B,eAAe,QAAQ,aAAA;QACvB,kBAAkB,QAAQ,gBAAA;QAC1B;KACA"}},
    {"offset": {"line": 6182, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/generic-oauth/providers/keycloak.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/generic-oauth/providers/keycloak.ts"],"sourcesContent":["import type { OAuth2Tokens, OAuth2UserInfo } from \"@better-auth/core/oauth2\";\nimport { betterFetch } from \"@better-fetch/fetch\";\nimport type { BaseOAuthProviderOptions, GenericOAuthConfig } from \"../index\";\n\nexport interface KeycloakOptions extends BaseOAuthProviderOptions {\n\t/**\n\t * Keycloak issuer URL (includes realm, e.g., https://my-domain/realms/MyRealm)\n\t * This will be used to construct the discovery URL.\n\t */\n\tissuer: string;\n}\n\ninterface KeycloakProfile {\n\tsub: string;\n\tname?: string;\n\temail?: string;\n\temail_verified?: boolean;\n\tpicture?: string;\n\tpreferred_username?: string;\n\tgiven_name?: string;\n\tfamily_name?: string;\n}\n\n/**\n * Keycloak OAuth provider helper\n *\n * @example\n * ```ts\n * import { genericOAuth, keycloak } from \"better-auth/plugins/generic-oauth\";\n *\n * export const auth = betterAuth({\n *   plugins: [\n *     genericOAuth({\n *       config: [\n *         keycloak({\n *           clientId: process.env.KEYCLOAK_CLIENT_ID,\n *           clientSecret: process.env.KEYCLOAK_CLIENT_SECRET,\n *           issuer: process.env.KEYCLOAK_ISSUER,\n *         }),\n *       ],\n *     }),\n *   ],\n * });\n * ```\n */\nexport function keycloak(options: KeycloakOptions): GenericOAuthConfig {\n\tconst defaultScopes = [\"openid\", \"profile\", \"email\"];\n\n\t// Ensure issuer ends without trailing slash for proper discovery URL construction\n\tconst issuer = options.issuer.replace(/\\/$/, \"\");\n\tconst discoveryUrl = `${issuer}/.well-known/openid-configuration`;\n\n\tconst getUserInfo = async (\n\t\ttokens: OAuth2Tokens,\n\t): Promise<OAuth2UserInfo | null> => {\n\t\t// Construct userinfo URL from issuer\n\t\tconst userInfoUrl = `${issuer}/protocol/openid-connect/userinfo`;\n\n\t\tconst { data: profile, error } = await betterFetch<KeycloakProfile>(\n\t\t\tuserInfoUrl,\n\t\t\t{\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${tokens.accessToken}`,\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\n\t\tif (error || !profile) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tid: profile.sub,\n\t\t\tname: profile.name ?? profile.preferred_username ?? undefined,\n\t\t\temail: profile.email ?? undefined,\n\t\t\timage: profile.picture,\n\t\t\t// Keycloak provides email_verified per OIDC standard, but availability depends on configuration.\n\t\t\t// We default to false when not provided or not configured.\n\t\t\temailVerified: profile.email_verified ?? false,\n\t\t};\n\t};\n\n\treturn {\n\t\tproviderId: \"keycloak\",\n\t\tdiscoveryUrl,\n\t\tclientId: options.clientId,\n\t\tclientSecret: options.clientSecret,\n\t\tscopes: options.scopes ?? defaultScopes,\n\t\tredirectURI: options.redirectURI,\n\t\tpkce: options.pkce,\n\t\tdisableImplicitSignUp: options.disableImplicitSignUp,\n\t\tdisableSignUp: options.disableSignUp,\n\t\toverrideUserInfo: options.overrideUserInfo,\n\t\tgetUserInfo,\n\t};\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;GA6CA,SAAgB,SAAS,OAAA,EAA8C;IACtE,MAAM,gBAAgB;QAAC;QAAU;QAAW;KAAQ;IAGpD,MAAM,SAAS,QAAQ,MAAA,CAAO,OAAA,CAAQ,OAAO,GAAG;IAChD,MAAM,eAAe,GAAG,OAAO,iCAAA,CAAA;IAE/B,MAAM,cAAc,OACnB,WACoC;QAIpC,MAAM,EAAE,MAAM,OAAA,EAAS,KAAA,EAAA,GAAU,UAAM,4KAAA,EAFnB,GAAG,OAAO,iCAAA,CAAA,EAI7B;YACC,SAAS;gBACR,eAAe,CAAA,OAAA,EAAU,OAAO,WAAA,EAAA;YAAA,CAChC;QAAA,CACD,CACD;QAED,IAAI,SAAS,CAAC,QACb,CAAA,OAAO;QAGR,OAAO;YACN,IAAI,QAAQ,GAAA;YACZ,MAAM,QAAQ,IAAA,IAAQ,QAAQ,kBAAA,IAAsB,KAAA;YACpD,OAAO,QAAQ,KAAA,IAAS,KAAA;YACxB,OAAO,QAAQ,OAAA;YAGf,eAAe,QAAQ,cAAA,IAAkB;SACzC;;IAGF,OAAO;QACN,YAAY;QACZ;QACA,UAAU,QAAQ,QAAA;QAClB,cAAc,QAAQ,YAAA;QACtB,QAAQ,QAAQ,MAAA,IAAU;QAC1B,aAAa,QAAQ,WAAA;QACrB,MAAM,QAAQ,IAAA;QACd,uBAAuB,QAAQ,qBAAA;QAC/B,eAAe,QAAQ,aAAA;QACvB,kBAAkB,QAAQ,gBAAA;QAC1B;KACA"}},
    {"offset": {"line": 6253, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/generic-oauth/providers/line.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/generic-oauth/providers/line.ts"],"sourcesContent":["import type { OAuth2Tokens, OAuth2UserInfo } from \"@better-auth/core/oauth2\";\nimport { betterFetch } from \"@better-fetch/fetch\";\nimport { decodeJwt } from \"jose\";\nimport type { BaseOAuthProviderOptions, GenericOAuthConfig } from \"../index\";\n\nexport interface LineOptions extends BaseOAuthProviderOptions {\n\t/**\n\t * Unique provider identifier for this LINE channel.\n\t * Use different providerIds for different countries/channels (e.g., \"line-jp\", \"line-th\", \"line-tw\").\n\t * @default \"line\"\n\t */\n\tproviderId?: string;\n}\n\ninterface LineIdTokenPayload {\n\tiss: string;\n\tsub: string;\n\taud: string;\n\texp: number;\n\tiat: number;\n\tname?: string;\n\tpicture?: string;\n\temail?: string;\n\tamr?: string[];\n\tnonce?: string;\n}\n\ninterface LineUserInfo {\n\tsub: string;\n\tname?: string;\n\tpicture?: string;\n\temail?: string;\n}\n\n/**\n * LINE OAuth provider helper\n *\n * LINE requires separate channels for different countries (Japan, Thailand, Taiwan, etc.).\n * Each channel has its own clientId and clientSecret. To support multiple countries,\n * call this function multiple times with different providerIds and credentials.\n *\n * @example\n * ```ts\n * import { genericOAuth, line } from \"better-auth/plugins/generic-oauth\";\n *\n * export const auth = betterAuth({\n *   plugins: [\n *     genericOAuth({\n *       config: [\n *         // Japan channel\n *         line({\n *           providerId: \"line-jp\",\n *           clientId: process.env.LINE_JP_CLIENT_ID,\n *           clientSecret: process.env.LINE_JP_CLIENT_SECRET,\n *         }),\n *         // Thailand channel\n *         line({\n *           providerId: \"line-th\",\n *           clientId: process.env.LINE_TH_CLIENT_ID,\n *           clientSecret: process.env.LINE_TH_CLIENT_SECRET,\n *         }),\n *         // Taiwan channel\n *         line({\n *           providerId: \"line-tw\",\n *           clientId: process.env.LINE_TW_CLIENT_ID,\n *           clientSecret: process.env.LINE_TW_CLIENT_SECRET,\n *         }),\n *       ],\n *     }),\n *   ],\n * });\n * ```\n */\nexport function line(options: LineOptions): GenericOAuthConfig {\n\tconst defaultScopes = [\"openid\", \"profile\", \"email\"];\n\tconst authorizationUrl = \"https://access.line.me/oauth2/v2.1/authorize\";\n\tconst tokenUrl = \"https://api.line.me/oauth2/v2.1/token\";\n\tconst userInfoUrl = \"https://api.line.me/oauth2/v2.1/userinfo\";\n\n\tconst getUserInfo = async (\n\t\ttokens: OAuth2Tokens,\n\t): Promise<OAuth2UserInfo | null> => {\n\t\tlet profile: LineUserInfo | LineIdTokenPayload | null = null;\n\n\t\tif (tokens.idToken) {\n\t\t\ttry {\n\t\t\t\tprofile = decodeJwt(tokens.idToken) as LineIdTokenPayload;\n\t\t\t} catch {\n\t\t\t\t// If ID token decoding fails, fall back to UserInfo endpoint\n\t\t\t}\n\t\t}\n\n\t\tif (!profile) {\n\t\t\tconst { data, error } = await betterFetch<LineUserInfo>(userInfoUrl, {\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${tokens.accessToken}`,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (error || !data) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tprofile = data;\n\t\t}\n\n\t\tif (!profile) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tid: profile.sub,\n\t\t\tname: profile.name,\n\t\t\temail: profile.email,\n\t\t\timage: profile.picture,\n\t\t\temailVerified: false,\n\t\t};\n\t};\n\n\treturn {\n\t\tproviderId: options.providerId ?? \"line\",\n\t\tauthorizationUrl,\n\t\ttokenUrl,\n\t\tuserInfoUrl,\n\t\tclientId: options.clientId,\n\t\tclientSecret: options.clientSecret,\n\t\tscopes: options.scopes ?? defaultScopes,\n\t\tredirectURI: options.redirectURI,\n\t\tpkce: options.pkce,\n\t\tdisableImplicitSignUp: options.disableImplicitSignUp,\n\t\tdisableSignUp: options.disableSignUp,\n\t\toverrideUserInfo: options.overrideUserInfo,\n\t\tgetUserInfo,\n\t};\n}\n"],"names":["profile: LineUserInfo | LineIdTokenPayload | null"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GAyEA,SAAgB,KAAK,OAAA,EAA0C;IAC9D,MAAM,gBAAgB;QAAC;QAAU;QAAW;KAAQ;IACpD,MAAM,mBAAmB;IACzB,MAAM,WAAW;IACjB,MAAM,cAAc;IAEpB,MAAM,cAAc,OACnB,WACoC;QACpC,IAAIA,UAAoD;QAExD,IAAI,OAAO,OAAA,CACV,CAAA,IAAI;YACH,cAAU,2KAAA,EAAU,OAAO,OAAA,CAAQ;iBAC5B,CAAA;QAKT,IAAI,CAAC,SAAS;YACb,MAAM,EAAE,IAAA,EAAM,KAAA,EAAA,GAAU,UAAM,4KAAA,EAA0B,aAAa;gBACpE,SAAS;oBACR,eAAe,CAAA,OAAA,EAAU,OAAO,WAAA,EAAA;gBAAA,CAChC;YAAA,CACD,CAAC;YAEF,IAAI,SAAS,CAAC,KACb,CAAA,OAAO;YAGR,UAAU;;QAGX,IAAI,CAAC,QACJ,CAAA,OAAO;QAGR,OAAO;YACN,IAAI,QAAQ,GAAA;YACZ,MAAM,QAAQ,IAAA;YACd,OAAO,QAAQ,KAAA;YACf,OAAO,QAAQ,OAAA;YACf,eAAe;SACf;;IAGF,OAAO;QACN,YAAY,QAAQ,UAAA,IAAc;QAClC;QACA;QACA;QACA,UAAU,QAAQ,QAAA;QAClB,cAAc,QAAQ,YAAA;QACtB,QAAQ,QAAQ,MAAA,IAAU;QAC1B,aAAa,QAAQ,WAAA;QACrB,MAAM,QAAQ,IAAA;QACd,uBAAuB,QAAQ,qBAAA;QAC/B,eAAe,QAAQ,aAAA;QACvB,kBAAkB,QAAQ,gBAAA;QAC1B;KACA"}},
    {"offset": {"line": 6354, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/generic-oauth/providers/microsoft-entra-id.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/generic-oauth/providers/microsoft-entra-id.ts"],"sourcesContent":["import type { OAuth2Tokens, OAuth2UserInfo } from \"@better-auth/core/oauth2\";\nimport { betterFetch } from \"@better-fetch/fetch\";\nimport type { BaseOAuthProviderOptions, GenericOAuthConfig } from \"../index\";\n\nexport interface MicrosoftEntraIdOptions extends BaseOAuthProviderOptions {\n\t/**\n\t * Microsoft Entra ID tenant ID.\n\t * Can be a GUID, \"common\", \"organizations\", or \"consumers\"\n\t */\n\ttenantId: string;\n}\n\ninterface MicrosoftEntraIdProfile {\n\tsub: string;\n\tname?: string;\n\temail?: string;\n\tpreferred_username?: string;\n\tpicture?: string;\n\tgiven_name?: string;\n\tfamily_name?: string;\n\temail_verified?: boolean;\n}\n\n/**\n * Microsoft Entra ID (Azure AD) OAuth provider helper\n *\n * @example\n * ```ts\n * import { genericOAuth, microsoftEntraId } from \"better-auth/plugins/generic-oauth\";\n *\n * export const auth = betterAuth({\n *   plugins: [\n *     genericOAuth({\n *       config: [\n *         microsoftEntraId({\n *           clientId: process.env.MS_APP_ID,\n *           clientSecret: process.env.MS_CLIENT_SECRET,\n *           tenantId: process.env.MS_TENANT_ID,\n *         }),\n *       ],\n *     }),\n *   ],\n * });\n * ```\n */\nexport function microsoftEntraId(\n\toptions: MicrosoftEntraIdOptions,\n): GenericOAuthConfig {\n\tconst defaultScopes = [\"openid\", \"profile\", \"email\"];\n\n\tconst tenantId = options.tenantId;\n\tconst authorizationUrl = `https://login.microsoftonline.com/${tenantId}/oauth2/v2.0/authorize`;\n\tconst tokenUrl = `https://login.microsoftonline.com/${tenantId}/oauth2/v2.0/token`;\n\tconst userInfoUrl = \"https://graph.microsoft.com/oidc/userinfo\";\n\n\tconst getUserInfo = async (\n\t\ttokens: OAuth2Tokens,\n\t): Promise<OAuth2UserInfo | null> => {\n\t\tconst { data: profile, error } = await betterFetch<MicrosoftEntraIdProfile>(\n\t\t\tuserInfoUrl,\n\t\t\t{\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${tokens.accessToken}`,\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\n\t\tif (error || !profile) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tid: profile.sub,\n\t\t\tname:\n\t\t\t\tprofile.name ??\n\t\t\t\t(`${profile.given_name ?? \"\"} ${profile.family_name ?? \"\"}`.trim() ||\n\t\t\t\t\tundefined),\n\t\t\temail: profile.email ?? profile.preferred_username ?? undefined,\n\t\t\timage: profile.picture,\n\t\t\t// Note: Microsoft Entra ID does NOT include email_verified claim by default.\n\t\t\t// It must be configured as an optional claim in the app registration.\n\t\t\t// We default to false when not provided\n\t\t\t// The built-in provider hardcodes this to true, assuming Microsoft accounts are verified.\n\t\t\temailVerified: profile.email_verified ?? false,\n\t\t};\n\t};\n\n\treturn {\n\t\tproviderId: \"microsoft-entra-id\",\n\t\tauthorizationUrl,\n\t\ttokenUrl,\n\t\tuserInfoUrl,\n\t\tclientId: options.clientId,\n\t\tclientSecret: options.clientSecret,\n\t\tscopes: options.scopes ?? defaultScopes,\n\t\tredirectURI: options.redirectURI,\n\t\tpkce: options.pkce,\n\t\tdisableImplicitSignUp: options.disableImplicitSignUp,\n\t\tdisableSignUp: options.disableSignUp,\n\t\toverrideUserInfo: options.overrideUserInfo,\n\t\tgetUserInfo,\n\t};\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;GA6CA,SAAgB,iBACf,OAAA,EACqB;IACrB,MAAM,gBAAgB;QAAC;QAAU;QAAW;KAAQ;IAEpD,MAAM,WAAW,QAAQ,QAAA;IACzB,MAAM,mBAAmB,CAAA,kCAAA,EAAqC,SAAS,sBAAA,CAAA;IACvE,MAAM,WAAW,CAAA,kCAAA,EAAqC,SAAS,kBAAA,CAAA;IAC/D,MAAM,cAAc;IAEpB,MAAM,cAAc,OACnB,WACoC;QACpC,MAAM,EAAE,MAAM,OAAA,EAAS,KAAA,EAAA,GAAU,UAAM,4KAAA,EACtC,aACA;YACC,SAAS;gBACR,eAAe,CAAA,OAAA,EAAU,OAAO,WAAA,EAAA;YAAA,CAChC;QAAA,CACD,CACD;QAED,IAAI,SAAS,CAAC,QACb,CAAA,OAAO;QAGR,OAAO;YACN,IAAI,QAAQ,GAAA;YACZ,MACC,QAAQ,IAAA,IAAA,CACP,GAAG,QAAQ,UAAA,IAAc,GAAG,CAAA,EAAG,QAAQ,WAAA,IAAe,IAAA,CAAK,IAAA,EAAM,IACjE,KAAA,CAAA;YACF,OAAO,QAAQ,KAAA,IAAS,QAAQ,kBAAA,IAAsB,KAAA;YACtD,OAAO,QAAQ,OAAA;YAKf,eAAe,QAAQ,cAAA,IAAkB;SACzC;;IAGF,OAAO;QACN,YAAY;QACZ;QACA;QACA;QACA,UAAU,QAAQ,QAAA;QAClB,cAAc,QAAQ,YAAA;QACtB,QAAQ,QAAQ,MAAA,IAAU;QAC1B,aAAa,QAAQ,WAAA;QACrB,MAAM,QAAQ,IAAA;QACd,uBAAuB,QAAQ,qBAAA;QAC/B,eAAe,QAAQ,aAAA;QACvB,kBAAkB,QAAQ,gBAAA;QAC1B;KACA"}},
    {"offset": {"line": 6429, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/generic-oauth/providers/okta.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/generic-oauth/providers/okta.ts"],"sourcesContent":["import type { OAuth2Tokens, OAuth2UserInfo } from \"@better-auth/core/oauth2\";\nimport { betterFetch } from \"@better-fetch/fetch\";\nimport type { BaseOAuthProviderOptions, GenericOAuthConfig } from \"../index\";\n\nexport interface OktaOptions extends BaseOAuthProviderOptions {\n\t/**\n\t * Okta issuer URL (e.g., https://dev-xxxxx.okta.com/oauth2/default)\n\t * This will be used to construct the discovery URL.\n\t */\n\tissuer: string;\n}\n\ninterface OktaProfile {\n\tsub: string;\n\tname?: string;\n\temail?: string;\n\temail_verified?: boolean;\n\tpicture?: string;\n\tpreferred_username?: string;\n\tgiven_name?: string;\n\tfamily_name?: string;\n}\n\n/**\n * Okta OAuth provider helper\n *\n * @example\n * ```ts\n * import { genericOAuth, okta } from \"better-auth/plugins/generic-oauth\";\n *\n * export const auth = betterAuth({\n *   plugins: [\n *     genericOAuth({\n *       config: [\n *         okta({\n *           clientId: process.env.OKTA_CLIENT_ID,\n *           clientSecret: process.env.OKTA_CLIENT_SECRET,\n *           issuer: process.env.OKTA_ISSUER,\n *         }),\n *       ],\n *     }),\n *   ],\n * });\n * ```\n */\nexport function okta(options: OktaOptions): GenericOAuthConfig {\n\tconst defaultScopes = [\"openid\", \"profile\", \"email\"];\n\n\t// Ensure issuer ends without trailing slash for proper discovery URL construction\n\tconst issuer = options.issuer.replace(/\\/$/, \"\");\n\tconst discoveryUrl = `${issuer}/.well-known/openid-configuration`;\n\n\tconst getUserInfo = async (\n\t\ttokens: OAuth2Tokens,\n\t): Promise<OAuth2UserInfo | null> => {\n\t\tconst userInfoUrl = `${issuer}/oauth2/v1/userinfo`;\n\n\t\tconst { data: profile, error } = await betterFetch<OktaProfile>(\n\t\t\tuserInfoUrl,\n\t\t\t{\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${tokens.accessToken}`,\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\n\t\tif (error || !profile) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tid: profile.sub,\n\t\t\tname: profile.name ?? profile.preferred_username ?? undefined,\n\t\t\temail: profile.email ?? undefined,\n\t\t\timage: profile.picture,\n\t\t\temailVerified: profile.email_verified ?? false,\n\t\t};\n\t};\n\n\treturn {\n\t\tproviderId: \"okta\",\n\t\tdiscoveryUrl,\n\t\tclientId: options.clientId,\n\t\tclientSecret: options.clientSecret,\n\t\tscopes: options.scopes ?? defaultScopes,\n\t\tredirectURI: options.redirectURI,\n\t\tpkce: options.pkce,\n\t\tdisableImplicitSignUp: options.disableImplicitSignUp,\n\t\tdisableSignUp: options.disableSignUp,\n\t\toverrideUserInfo: options.overrideUserInfo,\n\t\tgetUserInfo,\n\t};\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;GA6CA,SAAgB,KAAK,OAAA,EAA0C;IAC9D,MAAM,gBAAgB;QAAC;QAAU;QAAW;KAAQ;IAGpD,MAAM,SAAS,QAAQ,MAAA,CAAO,OAAA,CAAQ,OAAO,GAAG;IAChD,MAAM,eAAe,GAAG,OAAO,iCAAA,CAAA;IAE/B,MAAM,cAAc,OACnB,WACoC;QAGpC,MAAM,EAAE,MAAM,OAAA,EAAS,KAAA,EAAA,GAAU,UAAM,4KAAA,EAFnB,GAAG,OAAO,mBAAA,CAAA,EAI7B;YACC,SAAS;gBACR,eAAe,CAAA,OAAA,EAAU,OAAO,WAAA,EAAA;YAAA,CAChC;QAAA,CACD,CACD;QAED,IAAI,SAAS,CAAC,QACb,CAAA,OAAO;QAGR,OAAO;YACN,IAAI,QAAQ,GAAA;YACZ,MAAM,QAAQ,IAAA,IAAQ,QAAQ,kBAAA,IAAsB,KAAA;YACpD,OAAO,QAAQ,KAAA,IAAS,KAAA;YACxB,OAAO,QAAQ,OAAA;YACf,eAAe,QAAQ,cAAA,IAAkB;SACzC;;IAGF,OAAO;QACN,YAAY;QACZ;QACA,UAAU,QAAQ,QAAA;QAClB,cAAc,QAAQ,YAAA;QACtB,QAAQ,QAAQ,MAAA,IAAU;QAC1B,aAAa,QAAQ,WAAA;QACrB,MAAM,QAAQ,IAAA;QACd,uBAAuB,QAAQ,qBAAA;QAC/B,eAAe,QAAQ,aAAA;QACvB,kBAAkB,QAAQ,gBAAA;QAC1B;KACA"}},
    {"offset": {"line": 6500, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/generic-oauth/providers/patreon.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/generic-oauth/providers/patreon.ts"],"sourcesContent":["import type { OAuth2Tokens, OAuth2UserInfo } from \"@better-auth/core/oauth2\";\nimport { betterFetch } from \"@better-fetch/fetch\";\nimport type { BaseOAuthProviderOptions, GenericOAuthConfig } from \"../index\";\n\nexport interface PatreonOptions extends BaseOAuthProviderOptions {}\n\ninterface PatreonProfile {\n\tdata: {\n\t\tid: string;\n\t\tattributes: {\n\t\t\tfull_name: string;\n\t\t\temail: string;\n\t\t\timage_url: string;\n\t\t\tis_email_verified: boolean;\n\t\t};\n\t};\n}\n\n/**\n * Patreon OAuth provider helper\n *\n * @example\n * ```ts\n * import { genericOAuth, patreon } from \"better-auth/plugins/generic-oauth\";\n *\n * export const auth = betterAuth({\n *   plugins: [\n *     genericOAuth({\n *       config: [\n *         patreon({\n *           clientId: process.env.PATREON_CLIENT_ID,\n *           clientSecret: process.env.PATREON_CLIENT_SECRET,\n *         }),\n *       ],\n *     }),\n *   ],\n * });\n * ```\n */\nexport function patreon(options: PatreonOptions): GenericOAuthConfig {\n\tconst defaultScopes = [\"identity[email]\"];\n\n\tconst getUserInfo = async (\n\t\ttokens: OAuth2Tokens,\n\t): Promise<OAuth2UserInfo | null> => {\n\t\tconst { data: profile, error } = await betterFetch<PatreonProfile>(\n\t\t\t\"https://www.patreon.com/api/oauth2/v2/identity?fields[user]=email,full_name,image_url,is_email_verified\",\n\t\t\t{\n\t\t\t\tmethod: \"GET\",\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${tokens.accessToken}`,\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\n\t\tif (error || !profile) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tid: profile.data.id,\n\t\t\tname: profile.data.attributes.full_name,\n\t\t\temail: profile.data.attributes.email,\n\t\t\timage: profile.data.attributes.image_url,\n\t\t\temailVerified: profile.data.attributes.is_email_verified,\n\t\t};\n\t};\n\n\treturn {\n\t\tproviderId: \"patreon\",\n\t\tauthorizationUrl: \"https://www.patreon.com/oauth2/authorize\",\n\t\ttokenUrl: \"https://www.patreon.com/api/oauth2/token\",\n\t\tclientId: options.clientId,\n\t\tclientSecret: options.clientSecret,\n\t\tscopes: options.scopes ?? defaultScopes,\n\t\tredirectURI: options.redirectURI,\n\t\tpkce: options.pkce,\n\t\tdisableImplicitSignUp: options.disableImplicitSignUp,\n\t\tdisableSignUp: options.disableSignUp,\n\t\toverrideUserInfo: options.overrideUserInfo,\n\t\tgetUserInfo,\n\t};\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;GAuCA,SAAgB,QAAQ,OAAA,EAA6C;IACpE,MAAM,gBAAgB;QAAC;KAAkB;IAEzC,MAAM,cAAc,OACnB,WACoC;QACpC,MAAM,EAAE,MAAM,OAAA,EAAS,KAAA,EAAA,GAAU,UAAM,4KAAA,EACtC,2GACA;YACC,QAAQ;YACR,SAAS;gBACR,eAAe,CAAA,OAAA,EAAU,OAAO,WAAA,EAAA;YAAA,CAChC;SACD,CACD;QAED,IAAI,SAAS,CAAC,QACb,CAAA,OAAO;QAGR,OAAO;YACN,IAAI,QAAQ,IAAA,CAAK,EAAA;YACjB,MAAM,QAAQ,IAAA,CAAK,UAAA,CAAW,SAAA;YAC9B,OAAO,QAAQ,IAAA,CAAK,UAAA,CAAW,KAAA;YAC/B,OAAO,QAAQ,IAAA,CAAK,UAAA,CAAW,SAAA;YAC/B,eAAe,QAAQ,IAAA,CAAK,UAAA,CAAW,iBAAA;SACvC;;IAGF,OAAO;QACN,YAAY;QACZ,kBAAkB;QAClB,UAAU;QACV,UAAU,QAAQ,QAAA;QAClB,cAAc,QAAQ,YAAA;QACtB,QAAQ,QAAQ,MAAA,IAAU;QAC1B,aAAa,QAAQ,WAAA;QACrB,MAAM,QAAQ,IAAA;QACd,uBAAuB,QAAQ,qBAAA;QAC/B,eAAe,QAAQ,aAAA;QACvB,kBAAkB,QAAQ,gBAAA;QAC1B;KACA"}},
    {"offset": {"line": 6568, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/generic-oauth/providers/slack.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/generic-oauth/providers/slack.ts"],"sourcesContent":["import type { OAuth2Tokens, OAuth2UserInfo } from \"@better-auth/core/oauth2\";\nimport { betterFetch } from \"@better-fetch/fetch\";\nimport type { BaseOAuthProviderOptions, GenericOAuthConfig } from \"../index\";\n\nexport interface SlackOptions extends BaseOAuthProviderOptions {}\n\ninterface SlackProfile {\n\tsub: string;\n\t\"https://slack.com/user_id\": string;\n\t\"https://slack.com/team_id\": string;\n\temail: string;\n\temail_verified: boolean;\n\tname: string;\n\tpicture?: string;\n\tgiven_name?: string;\n\tfamily_name?: string;\n\tlocale?: string;\n\t\"https://slack.com/team_name\"?: string;\n\t\"https://slack.com/team_domain\"?: string;\n\t\"https://slack.com/user_image_512\"?: string;\n\t[key: string]: any;\n}\n\n/**\n * Slack OAuth provider helper\n *\n * @example\n * ```ts\n * import { genericOAuth, slack } from \"better-auth/plugins/generic-oauth\";\n *\n * export const auth = betterAuth({\n *   plugins: [\n *     genericOAuth({\n *       config: [\n *         slack({\n *           clientId: process.env.SLACK_CLIENT_ID,\n *           clientSecret: process.env.SLACK_CLIENT_SECRET,\n *         }),\n *       ],\n *     }),\n *   ],\n * });\n * ```\n */\nexport function slack(options: SlackOptions): GenericOAuthConfig {\n\tconst defaultScopes = [\"openid\", \"profile\", \"email\"];\n\n\tconst getUserInfo = async (\n\t\ttokens: OAuth2Tokens,\n\t): Promise<OAuth2UserInfo | null> => {\n\t\tconst { data: profile, error } = await betterFetch<SlackProfile>(\n\t\t\t\"https://slack.com/api/openid.connect.userInfo\",\n\t\t\t{\n\t\t\t\theaders: {\n\t\t\t\t\tAuthorization: `Bearer ${tokens.accessToken}`,\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\n\t\tif (error || !profile) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tid: profile[\"https://slack.com/user_id\"] ?? profile.sub,\n\t\t\tname: profile.name,\n\t\t\temail: profile.email,\n\t\t\timage: profile.picture ?? profile[\"https://slack.com/user_image_512\"],\n\t\t\temailVerified: profile.email_verified ?? false,\n\t\t};\n\t};\n\n\treturn {\n\t\tproviderId: \"slack\",\n\t\tauthorizationUrl: \"https://slack.com/openid/connect/authorize\",\n\t\ttokenUrl: \"https://slack.com/api/openid.connect.token\",\n\t\tuserInfoUrl: \"https://slack.com/api/openid.connect.userInfo\",\n\t\tclientId: options.clientId,\n\t\tclientSecret: options.clientSecret,\n\t\tscopes: options.scopes ?? defaultScopes,\n\t\tredirectURI: options.redirectURI,\n\t\tpkce: options.pkce,\n\t\tdisableImplicitSignUp: options.disableImplicitSignUp,\n\t\tdisableSignUp: options.disableSignUp,\n\t\toverrideUserInfo: options.overrideUserInfo,\n\t\tgetUserInfo,\n\t};\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;GA4CA,SAAgB,MAAM,OAAA,EAA2C;IAChE,MAAM,gBAAgB;QAAC;QAAU;QAAW;KAAQ;IAEpD,MAAM,cAAc,OACnB,WACoC;QACpC,MAAM,EAAE,MAAM,OAAA,EAAS,KAAA,EAAA,GAAU,UAAM,4KAAA,EACtC,iDACA;YACC,SAAS;gBACR,eAAe,CAAA,OAAA,EAAU,OAAO,WAAA,EAAA;YAAA,CAChC;QAAA,CACD,CACD;QAED,IAAI,SAAS,CAAC,QACb,CAAA,OAAO;QAGR,OAAO;YACN,IAAI,OAAA,CAAQ,4BAAA,IAAgC,QAAQ,GAAA;YACpD,MAAM,QAAQ,IAAA;YACd,OAAO,QAAQ,KAAA;YACf,OAAO,QAAQ,OAAA,IAAW,OAAA,CAAQ,mCAAA;YAClC,eAAe,QAAQ,cAAA,IAAkB;SACzC;;IAGF,OAAO;QACN,YAAY;QACZ,kBAAkB;QAClB,UAAU;QACV,aAAa;QACb,UAAU,QAAQ,QAAA;QAClB,cAAc,QAAQ,YAAA;QACtB,QAAQ,QAAQ,MAAA,IAAU;QAC1B,aAAa,QAAQ,WAAA;QACrB,MAAM,QAAQ,IAAA;QACd,uBAAuB,QAAQ,qBAAA;QAC/B,eAAe,QAAQ,aAAA;QACvB,kBAAkB,QAAQ,gBAAA;QAC1B;KACA"}},
    {"offset": {"line": 6638, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/generic-oauth/error-codes.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/generic-oauth/error-codes.ts"],"sourcesContent":["import { defineErrorCodes } from \"@better-auth/core/utils\";\n\nexport const GENERIC_OAUTH_ERROR_CODES = defineErrorCodes({\n\tINVALID_OAUTH_CONFIGURATION: \"Invalid OAuth configuration\",\n\tTOKEN_URL_NOT_FOUND: \"Invalid OAuth configuration. Token URL not found.\",\n\tPROVIDER_CONFIG_NOT_FOUND: \"No config found for provider\",\n\tPROVIDER_ID_REQUIRED: \"Provider ID is required\",\n\tINVALID_OAUTH_CONFIG: \"Invalid OAuth configuration.\",\n\tSESSION_REQUIRED: \"Session is required\",\n});\n"],"names":[],"mappings":";;;;;;;;AAEA,MAAa,gCAA4B,kMAAA,EAAiB;IACzD,6BAA6B;IAC7B,qBAAqB;IACrB,2BAA2B;IAC3B,sBAAsB;IACtB,sBAAsB;IACtB,kBAAkB;CAClB,CAAC"}},
    {"offset": {"line": 6660, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/generic-oauth/routes.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/generic-oauth/routes.ts"],"sourcesContent":["import type { GenericEndpointContext } from \"@better-auth/core\";\nimport { createAuthEndpoint } from \"@better-auth/core/api\";\nimport { BASE_ERROR_CODES } from \"@better-auth/core/error\";\nimport type { OAuth2Tokens, OAuth2UserInfo } from \"@better-auth/core/oauth2\";\nimport {\n\tcreateAuthorizationURL,\n\tvalidateAuthorizationCode,\n} from \"@better-auth/core/oauth2\";\nimport { betterFetch } from \"@better-fetch/fetch\";\nimport { APIError } from \"better-call\";\nimport { decodeJwt } from \"jose\";\nimport * as z from \"zod\";\nimport { sessionMiddleware } from \"../../api\";\nimport { setSessionCookie } from \"../../cookies\";\nimport { handleOAuthUserInfo } from \"../../oauth2/link-account\";\nimport { generateState, parseState } from \"../../oauth2/state\";\nimport { setTokenUtil } from \"../../oauth2/utils\";\nimport type { User } from \"../../types\";\nimport { HIDE_METADATA } from \"../../utils\";\nimport { GENERIC_OAUTH_ERROR_CODES } from \"./error-codes\";\nimport type { GenericOAuthOptions } from \"./types\";\n\nconst signInWithOAuth2BodySchema = z.object({\n\tproviderId: z.string().meta({\n\t\tdescription: \"The provider ID for the OAuth provider\",\n\t}),\n\tcallbackURL: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: \"The URL to redirect to after sign in\",\n\t\t})\n\t\t.optional(),\n\terrorCallbackURL: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: \"The URL to redirect to if an error occurs\",\n\t\t})\n\t\t.optional(),\n\tnewUserCallbackURL: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The URL to redirect to after login if the user is new. Eg: \"/welcome\"',\n\t\t})\n\t\t.optional(),\n\tdisableRedirect: z\n\t\t.boolean()\n\t\t.meta({\n\t\t\tdescription: \"Disable redirect\",\n\t\t})\n\t\t.optional(),\n\tscopes: z\n\t\t.array(z.string())\n\t\t.meta({\n\t\t\tdescription: \"Scopes to be passed to the provider authorization request.\",\n\t\t})\n\t\t.optional(),\n\trequestSignUp: z\n\t\t.boolean()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t\"Explicitly request sign-up. Useful when disableImplicitSignUp is true for this provider. Eg: false\",\n\t\t})\n\t\t.optional(),\n\t/**\n\t * Any additional data to pass through the oauth flow.\n\t */\n\tadditionalData: z.record(z.string(), z.any()).optional(),\n});\n\n/**\n * ### Endpoint\n *\n * POST `/sign-in/oauth2`\n *\n * ### API Methods\n *\n * **server:**\n * `auth.api.signInWithOAuth2`\n *\n * **client:**\n * `authClient.signIn.oauth2`\n *\n * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/sign-in#api-method-sign-in-oauth2)\n */\nexport const signInWithOAuth2 = (options: GenericOAuthOptions) =>\n\tcreateAuthEndpoint(\n\t\t\"/sign-in/oauth2\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: signInWithOAuth2BodySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"Sign in with OAuth2\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Sign in with OAuth2\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\turl: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tredirect: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx: GenericEndpointContext) => {\n\t\t\tconst { providerId } = ctx.body;\n\t\t\tconst config = options.config.find((c) => c.providerId === providerId);\n\t\t\tif (!config) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: `${GENERIC_OAUTH_ERROR_CODES.PROVIDER_CONFIG_NOT_FOUND} ${providerId}`,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst {\n\t\t\t\tdiscoveryUrl,\n\t\t\t\tauthorizationUrl,\n\t\t\t\ttokenUrl,\n\t\t\t\tclientId,\n\t\t\t\tclientSecret,\n\t\t\t\tscopes,\n\t\t\t\tredirectURI,\n\t\t\t\tresponseType,\n\t\t\t\tpkce,\n\t\t\t\tprompt,\n\t\t\t\taccessType,\n\t\t\t\tauthorizationUrlParams,\n\t\t\t\tresponseMode,\n\t\t\t} = config;\n\t\t\tlet finalAuthUrl = authorizationUrl;\n\t\t\tlet finalTokenUrl = tokenUrl;\n\t\t\tif (discoveryUrl) {\n\t\t\t\tconst discovery = await betterFetch<{\n\t\t\t\t\tauthorization_endpoint: string;\n\t\t\t\t\ttoken_endpoint: string;\n\t\t\t\t}>(discoveryUrl, {\n\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\theaders: config.discoveryHeaders,\n\t\t\t\t\tonError(context) {\n\t\t\t\t\t\tctx.context.logger.error(context.error.message, context.error, {\n\t\t\t\t\t\t\tdiscoveryUrl,\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tif (discovery.data) {\n\t\t\t\t\tfinalAuthUrl = discovery.data.authorization_endpoint;\n\t\t\t\t\tfinalTokenUrl = discovery.data.token_endpoint;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!finalAuthUrl || !finalTokenUrl) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: GENERIC_OAUTH_ERROR_CODES.INVALID_OAUTH_CONFIGURATION,\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (authorizationUrlParams) {\n\t\t\t\tconst withAdditionalParams = new URL(finalAuthUrl);\n\t\t\t\tfor (const [paramName, paramValue] of Object.entries(\n\t\t\t\t\tauthorizationUrlParams,\n\t\t\t\t)) {\n\t\t\t\t\twithAdditionalParams.searchParams.set(paramName, paramValue);\n\t\t\t\t}\n\t\t\t\tfinalAuthUrl = withAdditionalParams.toString();\n\t\t\t}\n\t\t\tconst additionalParams =\n\t\t\t\ttypeof authorizationUrlParams === \"function\"\n\t\t\t\t\t? authorizationUrlParams(ctx)\n\t\t\t\t\t: authorizationUrlParams;\n\n\t\t\tconst { state, codeVerifier } = await generateState(\n\t\t\t\tctx,\n\t\t\t\tundefined,\n\t\t\t\tctx.body.additionalData,\n\t\t\t);\n\t\t\tconst authUrl = await createAuthorizationURL({\n\t\t\t\tid: providerId,\n\t\t\t\toptions: {\n\t\t\t\t\tclientId,\n\t\t\t\t\tclientSecret,\n\t\t\t\t\tredirectURI,\n\t\t\t\t},\n\t\t\t\tauthorizationEndpoint: finalAuthUrl,\n\t\t\t\tstate,\n\t\t\t\tcodeVerifier: pkce ? codeVerifier : undefined,\n\t\t\t\tscopes: ctx.body.scopes\n\t\t\t\t\t? [...ctx.body.scopes, ...(scopes || [])]\n\t\t\t\t\t: scopes || [],\n\t\t\t\tredirectURI: `${ctx.context.baseURL}/oauth2/callback/${providerId}`,\n\t\t\t\tprompt,\n\t\t\t\taccessType,\n\t\t\t\tresponseType,\n\t\t\t\tresponseMode,\n\t\t\t\tadditionalParams,\n\t\t\t});\n\t\t\treturn ctx.json({\n\t\t\t\turl: authUrl.toString(),\n\t\t\t\tredirect: !ctx.body.disableRedirect,\n\t\t\t});\n\t\t},\n\t);\n\nconst OAuth2CallbackQuerySchema = z.object({\n\tcode: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: \"The OAuth2 code\",\n\t\t})\n\t\t.optional(),\n\terror: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: \"The error message, if any\",\n\t\t})\n\t\t.optional(),\n\terror_description: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: \"The error description, if any\",\n\t\t})\n\t\t.optional(),\n\tstate: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: \"The state parameter from the OAuth2 request\",\n\t\t})\n\t\t.optional(),\n});\n\nexport const oAuth2Callback = (options: GenericOAuthOptions) =>\n\tcreateAuthEndpoint(\n\t\t\"/oauth2/callback/:providerId\",\n\t\t{\n\t\t\tmethod: \"GET\",\n\t\t\tquery: OAuth2CallbackQuerySchema,\n\t\t\tmetadata: {\n\t\t\t\t...HIDE_METADATA,\n\t\t\t\tallowedMediaTypes: [\n\t\t\t\t\t\"application/x-www-form-urlencoded\",\n\t\t\t\t\t\"application/json\",\n\t\t\t\t],\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"OAuth2 callback\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"OAuth2 callback\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\turl: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx: GenericEndpointContext) => {\n\t\t\tconst defaultErrorURL =\n\t\t\t\tctx.context.options.onAPIError?.errorURL ||\n\t\t\t\t`${ctx.context.baseURL}/error`;\n\t\t\tif (ctx.query.error || !ctx.query.code) {\n\t\t\t\tthrow ctx.redirect(\n\t\t\t\t\t`${defaultErrorURL}?error=${\n\t\t\t\t\t\tctx.query.error || \"oAuth_code_missing\"\n\t\t\t\t\t}&error_description=${ctx.query.error_description}`,\n\t\t\t\t);\n\t\t\t}\n\t\t\tconst providerId = ctx.params?.providerId;\n\t\t\tif (!providerId) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: GENERIC_OAUTH_ERROR_CODES.PROVIDER_ID_REQUIRED,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst providerConfig = options.config.find(\n\t\t\t\t(p) => p.providerId === providerId,\n\t\t\t);\n\n\t\t\tif (!providerConfig) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: `${GENERIC_OAUTH_ERROR_CODES.PROVIDER_CONFIG_NOT_FOUND} ${providerId}`,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tlet tokens: OAuth2Tokens | undefined = undefined;\n\t\t\tconst parsedState = await parseState(ctx);\n\t\t\tconst {\n\t\t\t\tcallbackURL,\n\t\t\t\tcodeVerifier,\n\t\t\t\terrorURL,\n\t\t\t\trequestSignUp,\n\t\t\t\tnewUserURL,\n\t\t\t\tlink,\n\t\t\t} = parsedState;\n\t\t\tconst code = ctx.query.code;\n\n\t\t\tfunction redirectOnError(error: string) {\n\t\t\t\tconst defaultErrorURL =\n\t\t\t\t\tctx.context.options.onAPIError?.errorURL ||\n\t\t\t\t\t`${ctx.context.baseURL}/error`;\n\t\t\t\tlet url = errorURL || defaultErrorURL;\n\t\t\t\tif (url.includes(\"?\")) {\n\t\t\t\t\turl = `${url}&error=${error}`;\n\t\t\t\t} else {\n\t\t\t\t\turl = `${url}?error=${error}`;\n\t\t\t\t}\n\t\t\t\tthrow ctx.redirect(url);\n\t\t\t}\n\n\t\t\tlet finalTokenUrl = providerConfig.tokenUrl;\n\t\t\tlet finalUserInfoUrl = providerConfig.userInfoUrl;\n\t\t\tif (providerConfig.discoveryUrl) {\n\t\t\t\tconst discovery = await betterFetch<{\n\t\t\t\t\ttoken_endpoint: string;\n\t\t\t\t\tuserinfo_endpoint: string;\n\t\t\t\t}>(providerConfig.discoveryUrl, {\n\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\theaders: providerConfig.discoveryHeaders,\n\t\t\t\t});\n\t\t\t\tif (discovery.data) {\n\t\t\t\t\tfinalTokenUrl = discovery.data.token_endpoint;\n\t\t\t\t\tfinalUserInfoUrl = discovery.data.userinfo_endpoint;\n\t\t\t\t}\n\t\t\t}\n\t\t\ttry {\n\t\t\t\t// Use custom getToken if provided\n\t\t\t\tif (providerConfig.getToken) {\n\t\t\t\t\ttokens = await providerConfig.getToken({\n\t\t\t\t\t\tcode,\n\t\t\t\t\t\tredirectURI: `${ctx.context.baseURL}/oauth2/callback/${providerConfig.providerId}`,\n\t\t\t\t\t\tcodeVerifier: providerConfig.pkce ? codeVerifier : undefined,\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t// Standard token exchange with tokenUrlParams support\n\t\t\t\t\tif (!finalTokenUrl) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage: GENERIC_OAUTH_ERROR_CODES.INVALID_OAUTH_CONFIG,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst additionalParams =\n\t\t\t\t\t\ttypeof providerConfig.tokenUrlParams === \"function\"\n\t\t\t\t\t\t\t? providerConfig.tokenUrlParams(ctx)\n\t\t\t\t\t\t\t: providerConfig.tokenUrlParams;\n\t\t\t\t\ttokens = await validateAuthorizationCode({\n\t\t\t\t\t\theaders: providerConfig.authorizationHeaders,\n\t\t\t\t\t\tcode,\n\t\t\t\t\t\tcodeVerifier: providerConfig.pkce ? codeVerifier : undefined,\n\t\t\t\t\t\tredirectURI: `${ctx.context.baseURL}/oauth2/callback/${providerConfig.providerId}`,\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tclientId: providerConfig.clientId,\n\t\t\t\t\t\t\tclientSecret: providerConfig.clientSecret,\n\t\t\t\t\t\t\tredirectURI: providerConfig.redirectURI,\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttokenEndpoint: finalTokenUrl,\n\t\t\t\t\t\tauthentication: providerConfig.authentication,\n\t\t\t\t\t\tadditionalParams,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\te && typeof e === \"object\" && \"name\" in e ? (e.name as string) : \"\",\n\t\t\t\t\te,\n\t\t\t\t);\n\t\t\t\tthrow redirectOnError(\"oauth_code_verification_failed\");\n\t\t\t}\n\t\t\tif (!tokens) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: GENERIC_OAUTH_ERROR_CODES.INVALID_OAUTH_CONFIG,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst userInfo: Omit<User, \"createdAt\" | \"updatedAt\"> =\n\t\t\t\tawait (async function handleUserInfo() {\n\t\t\t\t\tconst userInfo = (\n\t\t\t\t\t\tproviderConfig.getUserInfo\n\t\t\t\t\t\t\t? await providerConfig.getUserInfo(tokens)\n\t\t\t\t\t\t\t: await getUserInfo(tokens, finalUserInfoUrl)\n\t\t\t\t\t) as OAuth2UserInfo | null;\n\t\t\t\t\tif (!userInfo) {\n\t\t\t\t\t\tthrow redirectOnError(\"user_info_is_missing\");\n\t\t\t\t\t}\n\t\t\t\t\tconst mapUser = providerConfig.mapProfileToUser\n\t\t\t\t\t\t? await providerConfig.mapProfileToUser(userInfo)\n\t\t\t\t\t\t: userInfo;\n\t\t\t\t\tconst email = mapUser.email\n\t\t\t\t\t\t? mapUser.email.toLowerCase()\n\t\t\t\t\t\t: userInfo.email?.toLowerCase();\n\t\t\t\t\tif (!email) {\n\t\t\t\t\t\tctx.context.logger.error(\"Unable to get user info\", userInfo);\n\t\t\t\t\t\tthrow redirectOnError(\"email_is_missing\");\n\t\t\t\t\t}\n\t\t\t\t\tconst id = mapUser.id ? String(mapUser.id) : String(userInfo.id);\n\t\t\t\t\tconst name = mapUser.name ? mapUser.name : userInfo.name;\n\t\t\t\t\tif (!name) {\n\t\t\t\t\t\tctx.context.logger.error(\"Unable to get user info\", userInfo);\n\t\t\t\t\t\tthrow redirectOnError(\"name_is_missing\");\n\t\t\t\t\t}\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...userInfo,\n\t\t\t\t\t\t...mapUser,\n\t\t\t\t\t\temail,\n\t\t\t\t\t\tid,\n\t\t\t\t\t\tname,\n\t\t\t\t\t};\n\t\t\t\t})();\n\t\t\tif (link) {\n\t\t\t\tif (\n\t\t\t\t\tctx.context.options.account?.accountLinking?.allowDifferentEmails !==\n\t\t\t\t\t\ttrue &&\n\t\t\t\t\tlink.email !== userInfo.email\n\t\t\t\t) {\n\t\t\t\t\treturn redirectOnError(\"email_doesn't_match\");\n\t\t\t\t}\n\t\t\t\tconst existingAccount =\n\t\t\t\t\tawait ctx.context.internalAdapter.findAccountByProviderId(\n\t\t\t\t\t\tString(userInfo.id),\n\t\t\t\t\t\tproviderConfig.providerId,\n\t\t\t\t\t);\n\t\t\t\tif (existingAccount) {\n\t\t\t\t\tif (existingAccount.userId !== link.userId) {\n\t\t\t\t\t\treturn redirectOnError(\"account_already_linked_to_different_user\");\n\t\t\t\t\t}\n\t\t\t\t\tconst updateData = Object.fromEntries(\n\t\t\t\t\t\tObject.entries({\n\t\t\t\t\t\t\taccessToken: await setTokenUtil(tokens.accessToken, ctx.context),\n\t\t\t\t\t\t\tidToken: tokens.idToken,\n\t\t\t\t\t\t\trefreshToken: await setTokenUtil(\n\t\t\t\t\t\t\t\ttokens.refreshToken,\n\t\t\t\t\t\t\t\tctx.context,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\taccessTokenExpiresAt: tokens.accessTokenExpiresAt,\n\t\t\t\t\t\t\trefreshTokenExpiresAt: tokens.refreshTokenExpiresAt,\n\t\t\t\t\t\t\tscope: tokens.scopes?.join(\",\"),\n\t\t\t\t\t\t}).filter(([_, value]) => value !== undefined),\n\t\t\t\t\t);\n\t\t\t\t\tawait ctx.context.internalAdapter.updateAccount(\n\t\t\t\t\t\texistingAccount.id,\n\t\t\t\t\t\tupdateData,\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tconst newAccount = await ctx.context.internalAdapter.createAccount({\n\t\t\t\t\t\tuserId: link.userId,\n\t\t\t\t\t\tproviderId: providerConfig.providerId,\n\t\t\t\t\t\taccountId: userInfo.id,\n\t\t\t\t\t\taccessToken: await setTokenUtil(tokens.accessToken, ctx.context),\n\t\t\t\t\t\taccessTokenExpiresAt: tokens.accessTokenExpiresAt,\n\t\t\t\t\t\trefreshTokenExpiresAt: tokens.refreshTokenExpiresAt,\n\t\t\t\t\t\tscope: tokens.scopes?.join(\",\"),\n\t\t\t\t\t\trefreshToken: await setTokenUtil(tokens.refreshToken, ctx.context),\n\t\t\t\t\t\tidToken: tokens.idToken,\n\t\t\t\t\t});\n\t\t\t\t\tif (!newAccount) {\n\t\t\t\t\t\treturn redirectOnError(\"unable_to_link_account\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet toRedirectTo: string;\n\t\t\t\ttry {\n\t\t\t\t\tconst url = callbackURL;\n\t\t\t\t\ttoRedirectTo = url.toString();\n\t\t\t\t} catch {\n\t\t\t\t\ttoRedirectTo = callbackURL;\n\t\t\t\t}\n\t\t\t\tthrow ctx.redirect(toRedirectTo);\n\t\t\t}\n\n\t\t\tconst result = await handleOAuthUserInfo(ctx, {\n\t\t\t\tuserInfo,\n\t\t\t\taccount: {\n\t\t\t\t\tproviderId: providerConfig.providerId,\n\t\t\t\t\taccountId: userInfo.id,\n\t\t\t\t\t...tokens,\n\t\t\t\t\tscope: tokens.scopes?.join(\",\"),\n\t\t\t\t},\n\t\t\t\tcallbackURL: callbackURL,\n\t\t\t\tdisableSignUp:\n\t\t\t\t\t(providerConfig.disableImplicitSignUp && !requestSignUp) ||\n\t\t\t\t\tproviderConfig.disableSignUp,\n\t\t\t\toverrideUserInfo: providerConfig.overrideUserInfo,\n\t\t\t});\n\n\t\t\tif (result.error) {\n\t\t\t\treturn redirectOnError(result.error.split(\" \").join(\"_\"));\n\t\t\t}\n\t\t\tconst { session, user } = result.data!;\n\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\tsession,\n\t\t\t\tuser,\n\t\t\t});\n\t\t\tlet toRedirectTo: string;\n\t\t\ttry {\n\t\t\t\tconst url = result.isRegister ? newUserURL || callbackURL : callbackURL;\n\t\t\t\ttoRedirectTo = url.toString();\n\t\t\t} catch {\n\t\t\t\ttoRedirectTo = result.isRegister\n\t\t\t\t\t? newUserURL || callbackURL\n\t\t\t\t\t: callbackURL;\n\t\t\t}\n\t\t\tthrow ctx.redirect(toRedirectTo);\n\t\t},\n\t);\n\nconst OAuth2LinkAccountBodySchema = z.object({\n\tproviderId: z.string(),\n\t/**\n\t * Callback URL to redirect to after the user has signed in.\n\t */\n\tcallbackURL: z.string(),\n\t/**\n\t * Additional scopes to request when linking the account.\n\t * This is useful for requesting additional permissions when\n\t * linking a social account compared to the initial authentication.\n\t */\n\tscopes: z\n\t\t.array(z.string())\n\t\t.meta({\n\t\t\tdescription: \"Additional scopes to request when linking the account\",\n\t\t})\n\t\t.optional(),\n\t/**\n\t * The URL to redirect to if there is an error during the link process.\n\t */\n\terrorCallbackURL: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t\"The URL to redirect to if there is an error during the link process\",\n\t\t})\n\t\t.optional(),\n});\n/**\n * ### Endpoint\n *\n * POST `/oauth2/link`\n *\n * ### API Methods\n *\n * **server:**\n * `auth.api.oAuth2LinkAccount`\n *\n * **client:**\n * `authClient.oauth2.link`\n *\n * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/generic-oauth#api-method-oauth2-link)\n */\nexport const oAuth2LinkAccount = (options: GenericOAuthOptions) =>\n\tcreateAuthEndpoint(\n\t\t\"/oauth2/link\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: OAuth2LinkAccountBodySchema,\n\t\t\tuse: [sessionMiddleware],\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"Link an OAuth2 account to the current user session\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\"Authorization URL generated successfully for linking an OAuth2 account\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\turl: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tformat: \"uri\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"The authorization URL to redirect the user to for linking the OAuth2 account\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tredirect: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Indicates that the client should redirect to the provided URL\",\n\t\t\t\t\t\t\t\t\t\t\t\tenum: [true],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\trequired: [\"url\", \"redirect\"],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (c: GenericEndpointContext) => {\n\t\t\tconst session = c.context.session;\n\t\t\tif (!session) {\n\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\tmessage: GENERIC_OAUTH_ERROR_CODES.SESSION_REQUIRED,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst provider = options.config.find(\n\t\t\t\t(p) => p.providerId === c.body.providerId,\n\t\t\t);\n\t\t\tif (!provider) {\n\t\t\t\tthrow new APIError(\"NOT_FOUND\", {\n\t\t\t\t\tmessage: BASE_ERROR_CODES.PROVIDER_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst {\n\t\t\t\tproviderId,\n\t\t\t\tclientId,\n\t\t\t\tclientSecret,\n\t\t\t\tredirectURI,\n\t\t\t\tauthorizationUrl,\n\t\t\t\tdiscoveryUrl,\n\t\t\t\tpkce,\n\t\t\t\tscopes,\n\t\t\t\tprompt,\n\t\t\t\taccessType,\n\t\t\t\tauthorizationUrlParams,\n\t\t\t} = provider;\n\n\t\t\tlet finalAuthUrl = authorizationUrl;\n\t\t\tif (!finalAuthUrl) {\n\t\t\t\tif (!discoveryUrl) {\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\tmessage: GENERIC_OAUTH_ERROR_CODES.INVALID_OAUTH_CONFIGURATION,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst discovery = await betterFetch<{\n\t\t\t\t\tauthorization_endpoint: string;\n\t\t\t\t\ttoken_endpoint: string;\n\t\t\t\t}>(discoveryUrl, {\n\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\theaders: provider.discoveryHeaders,\n\t\t\t\t\tonError(context) {\n\t\t\t\t\t\tc.context.logger.error(context.error.message, context.error, {\n\t\t\t\t\t\t\tdiscoveryUrl,\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tif (discovery.data) {\n\t\t\t\t\tfinalAuthUrl = discovery.data.authorization_endpoint;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!finalAuthUrl) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: GENERIC_OAUTH_ERROR_CODES.INVALID_OAUTH_CONFIGURATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst state = await generateState(\n\t\t\t\tc,\n\t\t\t\t{\n\t\t\t\t\tuserId: session.user.id,\n\t\t\t\t\temail: session.user.email,\n\t\t\t\t},\n\t\t\t\tundefined,\n\t\t\t);\n\n\t\t\tconst additionalParams =\n\t\t\t\ttypeof authorizationUrlParams === \"function\"\n\t\t\t\t\t? authorizationUrlParams(c)\n\t\t\t\t\t: authorizationUrlParams;\n\n\t\t\tconst url = await createAuthorizationURL({\n\t\t\t\tid: providerId,\n\t\t\t\toptions: {\n\t\t\t\t\tclientId,\n\t\t\t\t\tclientSecret,\n\t\t\t\t\tredirectURI:\n\t\t\t\t\t\tredirectURI || `${c.context.baseURL}/oauth2/callback/${providerId}`,\n\t\t\t\t},\n\t\t\t\tauthorizationEndpoint: finalAuthUrl,\n\t\t\t\tstate: state.state,\n\t\t\t\tcodeVerifier: pkce ? state.codeVerifier : undefined,\n\t\t\t\tscopes: c.body.scopes || scopes || [],\n\t\t\t\tredirectURI:\n\t\t\t\t\tredirectURI || `${c.context.baseURL}/oauth2/callback/${providerId}`,\n\t\t\t\tprompt,\n\t\t\t\taccessType,\n\t\t\t\tadditionalParams,\n\t\t\t});\n\n\t\t\treturn c.json({\n\t\t\t\turl: url.toString(),\n\t\t\t\tredirect: true,\n\t\t\t});\n\t\t},\n\t);\n\nexport async function getUserInfo(\n\ttokens: OAuth2Tokens,\n\tfinalUserInfoUrl: string | undefined,\n): Promise<OAuth2UserInfo | null> {\n\tif (tokens.idToken) {\n\t\tconst decoded = decodeJwt(tokens.idToken) as {\n\t\t\tsub: string;\n\t\t\temail_verified: boolean;\n\t\t\temail: string;\n\t\t\tname: string;\n\t\t\tpicture: string;\n\t\t};\n\t\tif (decoded) {\n\t\t\tif (decoded.sub && decoded.email) {\n\t\t\t\treturn {\n\t\t\t\t\tid: decoded.sub,\n\t\t\t\t\temailVerified: decoded.email_verified,\n\t\t\t\t\timage: decoded.picture,\n\t\t\t\t\t...decoded,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\n\tif (!finalUserInfoUrl) {\n\t\treturn null;\n\t}\n\n\tconst userInfo = await betterFetch<{\n\t\temail: string;\n\t\tsub?: string | undefined;\n\t\tname: string;\n\t\temail_verified: boolean;\n\t\tpicture: string;\n\t}>(finalUserInfoUrl, {\n\t\tmethod: \"GET\",\n\t\theaders: {\n\t\t\tAuthorization: `Bearer ${tokens.accessToken}`,\n\t\t},\n\t});\n\treturn {\n\t\tid: userInfo.data?.sub ?? \"\",\n\t\temailVerified: userInfo.data?.email_verified ?? false,\n\t\temail: userInfo.data?.email,\n\t\timage: userInfo.data?.picture,\n\t\tname: userInfo.data?.name,\n\t\t...userInfo.data,\n\t};\n}\n"],"names":["tokens: OAuth2Tokens | undefined","defaultErrorURL","userInfo: Omit<User, \"createdAt\" | \"updatedAt\">","userInfo","toRedirectTo: string","toRedirectTo"],"mappings":"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"}},
    {"offset": {"line": 7179, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/dist/plugins/generic-oauth/providers/index.mjs"],"sourcesContent":["import { auth0 } from \"./auth0.mjs\";\nimport { gumroad } from \"./gumroad.mjs\";\nimport { hubspot } from \"./hubspot.mjs\";\nimport { keycloak } from \"./keycloak.mjs\";\nimport { line } from \"./line.mjs\";\nimport { microsoftEntraId } from \"./microsoft-entra-id.mjs\";\nimport { okta } from \"./okta.mjs\";\nimport { patreon } from \"./patreon.mjs\";\nimport { slack } from \"./slack.mjs\";\n\nexport {  };"],"names":[],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","ignoreList":[0]}},
    {"offset": {"line": 7203, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/generic-oauth/index.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/generic-oauth/index.ts"],"sourcesContent":["import type { AuthContext, BetterAuthPlugin } from \"@better-auth/core\";\nimport type { OAuth2Tokens, OAuthProvider } from \"@better-auth/core/oauth2\";\nimport {\n\tcreateAuthorizationURL,\n\trefreshAccessToken,\n\tvalidateAuthorizationCode,\n} from \"@better-auth/core/oauth2\";\nimport { betterFetch } from \"@better-fetch/fetch\";\nimport { APIError } from \"better-call\";\nimport { GENERIC_OAUTH_ERROR_CODES } from \"./error-codes\";\nimport {\n\tgetUserInfo,\n\toAuth2Callback,\n\toAuth2LinkAccount,\n\tsignInWithOAuth2,\n} from \"./routes\";\nimport type { GenericOAuthConfig, GenericOAuthOptions } from \"./types\";\n\nexport * from \"./providers\";\nexport type { GenericOAuthConfig, GenericOAuthOptions } from \"./types\";\n\n/**\n * Base type for OAuth provider options.\n * Extracts common fields from GenericOAuthConfig and makes clientSecret required.\n */\nexport type BaseOAuthProviderOptions = Omit<\n\tPick<\n\t\tGenericOAuthConfig,\n\t\t| \"clientId\"\n\t\t| \"clientSecret\"\n\t\t| \"scopes\"\n\t\t| \"redirectURI\"\n\t\t| \"pkce\"\n\t\t| \"disableImplicitSignUp\"\n\t\t| \"disableSignUp\"\n\t\t| \"overrideUserInfo\"\n\t>,\n\t\"clientSecret\"\n> & {\n\t/** OAuth client secret (required for provider options) */\n\tclientSecret: string;\n};\n\n/**\n * A generic OAuth plugin that can be used to add OAuth support to any provider\n */\nexport const genericOAuth = (options: GenericOAuthOptions) => {\n\treturn {\n\t\tid: \"generic-oauth\",\n\t\tinit: (ctx: AuthContext) => {\n\t\t\tconst genericProviders = options.config.map((c) => {\n\t\t\t\tlet finalUserInfoUrl = c.userInfoUrl;\n\t\t\t\treturn {\n\t\t\t\t\tid: c.providerId,\n\t\t\t\t\tname: c.providerId,\n\t\t\t\t\tasync createAuthorizationURL(data: {\n\t\t\t\t\t\tstate: string;\n\t\t\t\t\t\tcodeVerifier: string;\n\t\t\t\t\t\tscopes?: string[] | undefined;\n\t\t\t\t\t\tredirectURI: string;\n\t\t\t\t\t\tdisplay?: string | undefined;\n\t\t\t\t\t\tloginHint?: string | undefined;\n\t\t\t\t\t}) {\n\t\t\t\t\t\tlet finalAuthUrl = c.authorizationUrl;\n\t\t\t\t\t\tif (!finalAuthUrl && c.discoveryUrl) {\n\t\t\t\t\t\t\tconst discovery = await betterFetch<{\n\t\t\t\t\t\t\t\tauthorization_endpoint: string;\n\t\t\t\t\t\t\t\tuserinfo_endpoint: string;\n\t\t\t\t\t\t\t}>(c.discoveryUrl, {\n\t\t\t\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\t\t\t\theaders: c.discoveryHeaders,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (discovery.data) {\n\t\t\t\t\t\t\t\tfinalAuthUrl = discovery.data.authorization_endpoint;\n\t\t\t\t\t\t\t\tfinalUserInfoUrl =\n\t\t\t\t\t\t\t\t\tfinalUserInfoUrl ?? discovery.data.userinfo_endpoint;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!finalAuthUrl) {\n\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\tmessage: GENERIC_OAUTH_ERROR_CODES.INVALID_OAUTH_CONFIGURATION,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn createAuthorizationURL({\n\t\t\t\t\t\t\tid: c.providerId,\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tclientId: c.clientId,\n\t\t\t\t\t\t\t\tclientSecret: c.clientSecret,\n\t\t\t\t\t\t\t\tredirectURI: c.redirectURI,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tauthorizationEndpoint: finalAuthUrl,\n\t\t\t\t\t\t\tstate: data.state,\n\t\t\t\t\t\t\tcodeVerifier: c.pkce ? data.codeVerifier : undefined,\n\t\t\t\t\t\t\tscopes: c.scopes || [],\n\t\t\t\t\t\t\tredirectURI: `${ctx.baseURL}/oauth2/callback/${c.providerId}`,\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tasync validateAuthorizationCode(data: {\n\t\t\t\t\t\tcode: string;\n\t\t\t\t\t\tredirectURI: string;\n\t\t\t\t\t\tcodeVerifier?: string | undefined;\n\t\t\t\t\t\tdeviceId?: string | undefined;\n\t\t\t\t\t}) {\n\t\t\t\t\t\t// Use custom getToken if provided\n\t\t\t\t\t\tif (c.getToken) {\n\t\t\t\t\t\t\treturn c.getToken(data);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Standard token exchange flow\n\t\t\t\t\t\tlet finalTokenUrl = c.tokenUrl;\n\t\t\t\t\t\tif (c.discoveryUrl) {\n\t\t\t\t\t\t\tconst discovery = await betterFetch<{\n\t\t\t\t\t\t\t\ttoken_endpoint: string;\n\t\t\t\t\t\t\t\tuserinfo_endpoint: string;\n\t\t\t\t\t\t\t}>(c.discoveryUrl, {\n\t\t\t\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\t\t\t\theaders: c.discoveryHeaders,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (discovery.data) {\n\t\t\t\t\t\t\t\tfinalTokenUrl = discovery.data.token_endpoint;\n\t\t\t\t\t\t\t\tfinalUserInfoUrl = discovery.data.userinfo_endpoint;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!finalTokenUrl) {\n\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\tmessage: GENERIC_OAUTH_ERROR_CODES.TOKEN_URL_NOT_FOUND,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn validateAuthorizationCode({\n\t\t\t\t\t\t\theaders: c.authorizationHeaders,\n\t\t\t\t\t\t\tcode: data.code,\n\t\t\t\t\t\t\tcodeVerifier: data.codeVerifier,\n\t\t\t\t\t\t\tredirectURI: data.redirectURI,\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tclientId: c.clientId,\n\t\t\t\t\t\t\t\tclientSecret: c.clientSecret,\n\t\t\t\t\t\t\t\tredirectURI: c.redirectURI,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttokenEndpoint: finalTokenUrl,\n\t\t\t\t\t\t\tauthentication: c.authentication,\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tasync refreshAccessToken(\n\t\t\t\t\t\trefreshToken: string,\n\t\t\t\t\t): Promise<OAuth2Tokens> {\n\t\t\t\t\t\tlet finalTokenUrl = c.tokenUrl;\n\t\t\t\t\t\tif (c.discoveryUrl) {\n\t\t\t\t\t\t\tconst discovery = await betterFetch<{\n\t\t\t\t\t\t\t\ttoken_endpoint: string;\n\t\t\t\t\t\t\t}>(c.discoveryUrl, {\n\t\t\t\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\t\t\t\theaders: c.discoveryHeaders,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (discovery.data) {\n\t\t\t\t\t\t\t\tfinalTokenUrl = discovery.data.token_endpoint;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!finalTokenUrl) {\n\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\tmessage: GENERIC_OAUTH_ERROR_CODES.TOKEN_URL_NOT_FOUND,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn refreshAccessToken({\n\t\t\t\t\t\t\trefreshToken,\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tclientId: c.clientId,\n\t\t\t\t\t\t\t\tclientSecret: c.clientSecret,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tauthentication: c.authentication,\n\t\t\t\t\t\t\ttokenEndpoint: finalTokenUrl,\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tasync getUserInfo(tokens: OAuth2Tokens) {\n\t\t\t\t\t\tconst userInfo = c.getUserInfo\n\t\t\t\t\t\t\t? await c.getUserInfo(tokens)\n\t\t\t\t\t\t\t: await getUserInfo(tokens, finalUserInfoUrl);\n\t\t\t\t\t\tif (!userInfo) {\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst userMap = await c.mapProfileToUser?.(userInfo);\n\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\tid: userInfo?.id,\n\t\t\t\t\t\t\t\temail: userInfo?.email,\n\t\t\t\t\t\t\t\temailVerified: userInfo?.emailVerified,\n\t\t\t\t\t\t\t\timage: userInfo?.image,\n\t\t\t\t\t\t\t\tname: userInfo?.name,\n\t\t\t\t\t\t\t\t...userMap,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tdata: userInfo,\n\t\t\t\t\t\t};\n\t\t\t\t\t},\n\t\t\t\t\toptions: {\n\t\t\t\t\t\toverrideUserInfoOnSignIn: c.overrideUserInfo,\n\t\t\t\t\t},\n\t\t\t\t} as OAuthProvider;\n\t\t\t});\n\t\t\treturn {\n\t\t\t\tcontext: {\n\t\t\t\t\tsocialProviders: genericProviders.concat(ctx.socialProviders),\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tendpoints: {\n\t\t\tsignInWithOAuth2: signInWithOAuth2(options),\n\t\t\toAuth2Callback: oAuth2Callback(options),\n\t\t\toAuth2LinkAccount: oAuth2LinkAccount(options),\n\t\t},\n\t\toptions,\n\t\t$ERROR_CODES: GENERIC_OAUTH_ERROR_CODES,\n\t} satisfies BetterAuthPlugin;\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7375, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/haveibeenpwned/index.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/haveibeenpwned/index.ts"],"sourcesContent":["import type { BetterAuthPlugin } from \"@better-auth/core\";\nimport { getCurrentAuthContext } from \"@better-auth/core/context\";\nimport { defineErrorCodes } from \"@better-auth/core/utils\";\nimport { createHash } from \"@better-auth/utils/hash\";\nimport { betterFetch } from \"@better-fetch/fetch\";\nimport { APIError } from \"../../api\";\n\nconst ERROR_CODES = defineErrorCodes({\n\tPASSWORD_COMPROMISED:\n\t\t\"The password you entered has been compromised. Please choose a different password.\",\n});\n\nasync function checkPasswordCompromise(\n\tpassword: string,\n\tcustomMessage?: string | undefined,\n) {\n\tif (!password) return;\n\n\tconst sha1Hash = (\n\t\tawait createHash(\"SHA-1\", \"hex\").digest(password)\n\t).toUpperCase();\n\tconst prefix = sha1Hash.substring(0, 5);\n\tconst suffix = sha1Hash.substring(5);\n\ttry {\n\t\tconst { data, error } = await betterFetch<string>(\n\t\t\t`https://api.pwnedpasswords.com/range/${prefix}`,\n\t\t\t{\n\t\t\t\theaders: {\n\t\t\t\t\t\"Add-Padding\": \"true\",\n\t\t\t\t\t\"User-Agent\": \"BetterAuth Password Checker\",\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\n\t\tif (error) {\n\t\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\tmessage: `Failed to check password. Status: ${error.status}`,\n\t\t\t});\n\t\t}\n\t\tconst lines = data.split(\"\\n\");\n\t\tconst found = lines.some(\n\t\t\t(line) => line.split(\":\")[0]!.toUpperCase() === suffix.toUpperCase(),\n\t\t);\n\n\t\tif (found) {\n\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\tmessage: customMessage || ERROR_CODES.PASSWORD_COMPROMISED,\n\t\t\t\tcode: \"PASSWORD_COMPROMISED\",\n\t\t\t});\n\t\t}\n\t} catch (error) {\n\t\tif (error instanceof APIError) throw error;\n\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\tmessage: \"Failed to check password. Please try again later.\",\n\t\t});\n\t}\n}\n\nexport interface HaveIBeenPwnedOptions {\n\tcustomPasswordCompromisedMessage?: string | undefined;\n\t/**\n\t * Paths to check for password\n\t *\n\t * @default [\"/sign-up/email\", \"/change-password\", \"/reset-password\"]\n\t */\n\tpaths?: string[];\n}\n\nexport const haveIBeenPwned = (options?: HaveIBeenPwnedOptions | undefined) => {\n\tconst paths = options?.paths || [\n\t\t\"/sign-up/email\",\n\t\t\"/change-password\",\n\t\t\"/reset-password\",\n\t];\n\n\treturn {\n\t\tid: \"haveIBeenPwned\",\n\t\tinit(ctx) {\n\t\t\treturn {\n\t\t\t\tcontext: {\n\t\t\t\t\tpassword: {\n\t\t\t\t\t\t...ctx.password,\n\t\t\t\t\t\tasync hash(password) {\n\t\t\t\t\t\t\tconst c = await getCurrentAuthContext();\n\t\t\t\t\t\t\tif (!c.path || !paths.includes(c.path)) {\n\t\t\t\t\t\t\t\treturn ctx.password.hash(password);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tawait checkPasswordCompromise(\n\t\t\t\t\t\t\t\tpassword,\n\t\t\t\t\t\t\t\toptions?.customPasswordCompromisedMessage,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\treturn ctx.password.hash(password);\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\toptions,\n\t\t$ERROR_CODES: ERROR_CODES,\n\t} satisfies BetterAuthPlugin;\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAOA,MAAM,kBAAc,kMAAA,EAAiB;IACpC,sBACC;AAAA,CACD,CAAC;AAEF,eAAe,wBACd,QAAA,EACA,aAAA,EACC;IACD,IAAI,CAAC,SAAU,CAAA;IAEf,MAAM,WAAA,CACL,UAAM,0KAAA,EAAW,SAAS,MAAM,CAAC,MAAA,CAAO,SAAS,EAChD,WAAA,EAAa;IACf,MAAM,SAAS,SAAS,SAAA,CAAU,GAAG,EAAE;IACvC,MAAM,SAAS,SAAS,SAAA,CAAU,EAAE;IACpC,IAAI;QACH,MAAM,EAAE,IAAA,EAAM,KAAA,EAAA,GAAU,UAAM,4KAAA,EAC7B,CAAA,qCAAA,EAAwC,QAAA,EACxC;YACC,SAAS;gBACR,eAAe;gBACf,cAAc;aACd;QAAA,CACD,CACD;QAED,IAAI,MACH,CAAA,MAAM,IAAI,8JAAA,CAAS,yBAAyB;YAC3C,SAAS,CAAA,kCAAA,EAAqC,MAAM,MAAA,EAAA;QAAA,CACpD,CAAC;QAOH,IALc,KAAK,KAAA,CAAM,KAAK,CACV,IAAA,CAAA,CAClB,OAAS,KAAK,KAAA,CAAM,IAAI,CAAC,EAAA,CAAI,WAAA,EAAa,KAAK,OAAO,WAAA,EAAa,CACpE,CAGA,CAAA,MAAM,IAAI,8JAAA,CAAS,eAAe;YACjC,SAAS,iBAAiB,YAAY,oBAAA;YACtC,MAAM;SACN,CAAC;aAEK,OAAO;QACf,IAAI,iBAAiB,8JAAA,CAAU,CAAA,MAAM;QACrC,MAAM,IAAI,8JAAA,CAAS,yBAAyB;YAC3C,SAAS;QAAA,CACT,CAAC;;;AAcJ,MAAa,iBAAA,CAAkB,YAAgD;IAC9E,MAAM,QAAQ,SAAS,SAAS;QAC/B;QACA;QACA;KACA;IAED,OAAO;QACN,IAAI;QACJ,MAAK,GAAA,EAAK;YACT,OAAO;gBACN,SAAS;oBACR,UAAU;wBACT,GAAG,IAAI,QAAA;wBACP,MAAM,MAAK,QAAA,EAAU;4BACpB,MAAM,IAAI,UAAM,8MAAA,EAAuB;4BACvC,IAAI,CAAC,EAAE,IAAA,IAAQ,CAAC,MAAM,QAAA,CAAS,EAAE,IAAA,CAAK,CACrC,CAAA,OAAO,IAAI,QAAA,CAAS,IAAA,CAAK,SAAS;4BAEnC,MAAM,wBACL,UACA,SAAS,iCACT;4BACD,OAAO,IAAI,QAAA,CAAS,IAAA,CAAK,SAAS;;qBAEnC;gBAAA,CACD;YAAA,CACD;;QAEF;QACA,cAAc;KACd"}},
    {"offset": {"line": 7455, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/jwt/adapter.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/jwt/adapter.ts"],"sourcesContent":["import type {\n\tBetterAuthOptions,\n\tGenericEndpointContext,\n} from \"@better-auth/core\";\nimport type { DBAdapter } from \"@better-auth/core/db/adapter\";\nimport type { Jwk, JwtOptions } from \"./types\";\n\nexport const getJwksAdapter = (\n\tadapter: DBAdapter<BetterAuthOptions>,\n\toptions?: JwtOptions,\n) => {\n\treturn {\n\t\tgetAllKeys: async (ctx: GenericEndpointContext) => {\n\t\t\tif (options?.adapter?.getJwks) {\n\t\t\t\treturn await options.adapter.getJwks(ctx);\n\t\t\t}\n\t\t\treturn await adapter.findMany<Jwk>({\n\t\t\t\tmodel: \"jwks\",\n\t\t\t});\n\t\t},\n\t\tgetLatestKey: async (ctx: GenericEndpointContext) => {\n\t\t\tif (options?.adapter?.getJwks) {\n\t\t\t\tconst keys = await options.adapter.getJwks(ctx);\n\t\t\t\treturn keys?.sort(\n\t\t\t\t\t(a, b) => b.createdAt.getTime() - a.createdAt.getTime(),\n\t\t\t\t)[0];\n\t\t\t}\n\t\t\tconst keys = await adapter.findMany<Jwk>({\n\t\t\t\tmodel: \"jwks\",\n\t\t\t});\n\t\t\treturn keys?.sort(\n\t\t\t\t(a, b) => b.createdAt.getTime() - a.createdAt.getTime(),\n\t\t\t)[0];\n\t\t},\n\t\tcreateJwk: async (ctx: GenericEndpointContext, webKey: Omit<Jwk, \"id\">) => {\n\t\t\tif (options?.adapter?.createJwk) {\n\t\t\t\treturn await options.adapter.createJwk(webKey, ctx);\n\t\t\t}\n\t\t\tconst jwk = await adapter.create<Omit<Jwk, \"id\">, Jwk>({\n\t\t\t\tmodel: \"jwks\",\n\t\t\t\tdata: {\n\t\t\t\t\t...webKey,\n\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn jwk;\n\t\t},\n\t};\n};\n"],"names":[],"mappings":";;;;;AAOA,MAAa,iBAAA,CACZ,SACA,YACI;IACJ,OAAO;QACN,YAAY,OAAO,QAAgC;YAClD,IAAI,SAAS,SAAS,QACrB,CAAA,OAAO,MAAM,QAAQ,OAAA,CAAQ,OAAA,CAAQ,IAAI;YAE1C,OAAO,MAAM,QAAQ,QAAA,CAAc;gBAClC,OAAO;YAAA,CACP,CAAC;;QAEH,cAAc,OAAO,QAAgC;YACpD,IAAI,SAAS,SAAS,QAErB,CAAA,OAAA,CADa,MAAM,QAAQ,OAAA,CAAQ,OAAA,CAAQ,IAAI,GAClC,KAAA,CACX,GAAG,IAAM,EAAE,SAAA,CAAU,OAAA,EAAS,GAAG,EAAE,SAAA,CAAU,OAAA,EAAS,CACvD,CAAC,EAAA;YAKH,OAAA,CAHa,MAAM,QAAQ,QAAA,CAAc;gBACxC,OAAO;YAAA,CACP,CAAC,GACW,KAAA,CACX,GAAG,IAAM,EAAE,SAAA,CAAU,OAAA,EAAS,GAAG,EAAE,SAAA,CAAU,OAAA,EAAS,CACvD,CAAC,EAAA;;QAEH,WAAW,OAAO,KAA6B,WAA4B;YAC1E,IAAI,SAAS,SAAS,UACrB,CAAA,OAAO,MAAM,QAAQ,OAAA,CAAQ,SAAA,CAAU,QAAQ,IAAI;YAUpD,OARY,MAAM,QAAQ,MAAA,CAA6B;gBACtD,OAAO;gBACP,MAAM;oBACL,GAAG,MAAA;oBACH,WAAA,aAAA,GAAW,IAAI,MAAM;iBACrB;aACD,CAAC;;KAIH"}},
    {"offset": {"line": 7492, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/jwt/utils.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/jwt/utils.ts"],"sourcesContent":["import type { GenericEndpointContext } from \"@better-auth/core\";\nimport { exportJWK, generateKeyPair } from \"jose\";\nimport { symmetricEncrypt } from \"../../crypto\";\nimport type { TimeString } from \"../../utils/time\";\nimport { sec } from \"../../utils/time\";\nimport { getJwksAdapter } from \"./adapter\";\nimport type { Jwk, JwtOptions } from \"./types\";\n\n/**\n * Converts an expirationTime to ISO seconds expiration time (the format of JWT exp)\n *\n * See https://github.com/panva/jose/blob/main/src/lib/jwt_claims_set.ts#L245\n *\n * @param expirationTime - see options.jwt.expirationTime\n * @param iat - the iat time to consolidate on\n * @returns\n */\nexport function toExpJWT(\n\texpirationTime: number | Date | string,\n\tiat: number,\n): number {\n\tif (typeof expirationTime === \"number\") {\n\t\treturn expirationTime;\n\t} else if (expirationTime instanceof Date) {\n\t\treturn Math.floor(expirationTime.getTime() / 1000);\n\t} else {\n\t\treturn iat + sec(expirationTime as TimeString);\n\t}\n}\n\nexport async function generateExportedKeyPair(\n\toptions?: JwtOptions | undefined,\n) {\n\tconst { alg, ...cfg } = options?.jwks?.keyPairConfig ?? {\n\t\talg: \"EdDSA\",\n\t\tcrv: \"Ed25519\",\n\t};\n\tconst { publicKey, privateKey } = await generateKeyPair(alg, {\n\t\t...cfg,\n\t\textractable: true,\n\t});\n\n\tconst publicWebKey = await exportJWK(publicKey);\n\tconst privateWebKey = await exportJWK(privateKey);\n\n\treturn { publicWebKey, privateWebKey, alg, cfg };\n}\n\n/**\n * Creates a Jwk on the database\n *\n * @param ctx\n * @param options\n * @returns\n */\nexport async function createJwk(\n\tctx: GenericEndpointContext,\n\toptions?: JwtOptions | undefined,\n) {\n\tconst { publicWebKey, privateWebKey, alg, cfg } =\n\t\tawait generateExportedKeyPair(options);\n\n\tconst stringifiedPrivateWebKey = JSON.stringify(privateWebKey);\n\tconst privateKeyEncryptionEnabled =\n\t\t!options?.jwks?.disablePrivateKeyEncryption;\n\tconst jwk: Omit<Jwk, \"id\"> = {\n\t\talg,\n\t\t...(cfg && \"crv\" in cfg\n\t\t\t? {\n\t\t\t\t\tcrv: (cfg as { crv: (typeof jwk)[\"crv\"] }).crv,\n\t\t\t\t}\n\t\t\t: {}),\n\t\tpublicKey: JSON.stringify(publicWebKey),\n\t\tprivateKey: privateKeyEncryptionEnabled\n\t\t\t? JSON.stringify(\n\t\t\t\t\tawait symmetricEncrypt({\n\t\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\t\tdata: stringifiedPrivateWebKey,\n\t\t\t\t\t}),\n\t\t\t\t)\n\t\t\t: stringifiedPrivateWebKey,\n\t\tcreatedAt: new Date(),\n\t\t...(options?.jwks?.rotationInterval\n\t\t\t? {\n\t\t\t\t\texpiresAt: new Date(\n\t\t\t\t\t\tDate.now() + options.jwks.rotationInterval * 1000,\n\t\t\t\t\t),\n\t\t\t\t}\n\t\t\t: {}),\n\t};\n\n\tconst adapter = getJwksAdapter(ctx.context.adapter, options);\n\tconst key = await adapter.createJwk(ctx, jwk as Jwk);\n\n\treturn key;\n}\n"],"names":["jwk: Omit<Jwk, \"id\">"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;GAiBA,SAAgB,SACf,cAAA,EACA,GAAA,EACS;IACT,IAAI,OAAO,mBAAmB,SAC7B,CAAA,OAAO;aACG,0BAA0B,KACpC,CAAA,OAAO,KAAK,KAAA,CAAM,eAAe,OAAA,EAAS,GAAG,IAAK;SAElD,OAAO,UAAM,iKAAA,EAAI,eAA6B;;AAIhD,eAAsB,wBACrB,OAAA,EACC;IACD,MAAM,EAAE,GAAA,EAAK,GAAG,KAAA,GAAQ,SAAS,MAAM,iBAAiB;QACvD,KAAK;QACL,KAAK;KACL;IACD,MAAM,EAAE,SAAA,EAAW,UAAA,EAAA,GAAe,UAAM,uLAAA,EAAgB,KAAK;QAC5D,GAAG,GAAA;QACH,aAAa;KACb,CAAC;IAKF,OAAO;QAAE,cAHY,UAAM,sKAAA,EAAU,UAAU;QAGxB,eAFD,UAAM,sKAAA,EAAU,WAAW;QAEX;QAAK;KAAK;;;;;;;;GAUjD,eAAsB,UACrB,GAAA,EACA,OAAA,EACC;IACD,MAAM,EAAE,YAAA,EAAc,aAAA,EAAe,GAAA,EAAK,GAAA,EAAA,GACzC,MAAM,wBAAwB,QAAQ;IAEvC,MAAM,2BAA2B,KAAK,SAAA,CAAU,cAAc;IAC9D,MAAM,8BACL,CAAC,SAAS,MAAM;IACjB,MAAMA,MAAuB;QAC5B;QACA,GAAI,OAAO,SAAS,MACjB;YACA,KAAM,IAAqC,GAAA;QAAA,CAC3C,GACA,CAAA,CAAE;QACL,WAAW,KAAK,SAAA,CAAU,aAAa;QACvC,YAAY,8BACT,KAAK,SAAA,CACL,UAAM,gMAAA,EAAiB;YACtB,KAAK,IAAI,OAAA,CAAQ,MAAA;YACjB,MAAM;SACN,CAAC,CACF,GACA;QACH,WAAA,aAAA,GAAW,IAAI,MAAM;QACrB,GAAI,SAAS,MAAM,mBAChB;YACA,WAAW,IAAI,KACd,KAAK,GAAA,EAAK,GAAG,QAAQ,IAAA,CAAK,gBAAA,GAAmB,IAC7C;QAAA,CACD,GACA,CAAA,CAAE;KACL;IAKD,OAFY,UADI,wLAAA,EAAe,IAAI,OAAA,CAAQ,OAAA,EAAS,QAAQ,CAClC,SAAA,CAAU,KAAK,IAAW"}},
    {"offset": {"line": 7572, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/jwt/sign.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/jwt/sign.ts"],"sourcesContent":["import type { GenericEndpointContext } from \"@better-auth/core\";\nimport { BetterAuthError } from \"@better-auth/core/error\";\nimport type { JWTPayload } from \"jose\";\nimport { importJWK, SignJWT } from \"jose\";\nimport { symmetricDecrypt } from \"../../crypto\";\nimport { getJwksAdapter } from \"./adapter\";\nimport type { JwtOptions } from \"./types\";\nimport { createJwk, toExpJWT } from \"./utils\";\n\ntype JWTPayloadWithOptional = {\n\t/**\n\t * JWT Issuer\n\t *\n\t * @see {@link https://www.rfc-editor.org/rfc/rfc7519#section-4.1.1 RFC7519#section-4.1.1}\n\t */\n\tiss?: string | undefined;\n\n\t/**\n\t * JWT Subject\n\t *\n\t * @see {@link https://www.rfc-editor.org/rfc/rfc7519#section-4.1.2 RFC7519#section-4.1.2}\n\t */\n\tsub?: string | undefined;\n\n\t/**\n\t * JWT Audience\n\t *\n\t * @see {@link https://www.rfc-editor.org/rfc/rfc7519#section-4.1.3 RFC7519#section-4.1.3}\n\t */\n\taud?: string | string[] | undefined;\n\n\t/**\n\t * JWT ID\n\t *\n\t * @see {@link https://www.rfc-editor.org/rfc/rfc7519#section-4.1.7 RFC7519#section-4.1.7}\n\t */\n\tjti?: string | undefined;\n\n\t/**\n\t * JWT Not Before\n\t *\n\t * @see {@link https://www.rfc-editor.org/rfc/rfc7519#section-4.1.5 RFC7519#section-4.1.5}\n\t */\n\tnbf?: number | undefined;\n\n\t/**\n\t * JWT Expiration Time\n\t *\n\t * @see {@link https://www.rfc-editor.org/rfc/rfc7519#section-4.1.4 RFC7519#section-4.1.4}\n\t */\n\texp?: number | undefined;\n\n\t/**\n\t * JWT Issued At\n\t *\n\t * @see {@link https://www.rfc-editor.org/rfc/rfc7519#section-4.1.6 RFC7519#section-4.1.6}\n\t */\n\tiat?: number | undefined;\n\n\t/** Any other JWT Claim Set member. */\n\t[propName: string]: unknown | undefined;\n};\n\nexport async function signJWT(\n\tctx: GenericEndpointContext,\n\tconfig: {\n\t\toptions?: JwtOptions | undefined;\n\t\tpayload: JWTPayloadWithOptional;\n\t},\n) {\n\tconst { options } = config;\n\tconst payload = config.payload as JWTPayload;\n\n\t// Iat\n\tconst nowSeconds = Math.floor(Date.now() / 1000);\n\tconst iat = payload.iat!;\n\n\t// Exp\n\tlet exp = payload.exp;\n\tconst defaultExp = toExpJWT(\n\t\toptions?.jwt?.expirationTime ?? \"15m\",\n\t\tiat ?? nowSeconds,\n\t);\n\texp = exp ?? defaultExp;\n\n\t// Nbf\n\tconst nbf = payload.nbf!;\n\n\t// Iss\n\tconst iss = payload.iss;\n\tconst defaultIss = options?.jwt?.issuer ?? ctx.context.options.baseURL!;\n\n\t// Aud\n\tconst aud = payload.aud;\n\tconst defaultAud = options?.jwt?.audience ?? ctx.context.options.baseURL!;\n\n\t// Custom/remote signing function\n\tif (options?.jwt?.sign) {\n\t\tconst jwtPayload = {\n\t\t\t...payload,\n\t\t\tiat,\n\t\t\texp,\n\t\t\tnbf,\n\t\t\tiss: iss ?? defaultIss,\n\t\t\taud: aud ?? defaultAud,\n\t\t};\n\t\treturn options.jwt.sign(jwtPayload);\n\t}\n\n\tconst adapter = getJwksAdapter(ctx.context.adapter, options);\n\tlet key = await adapter.getLatestKey(ctx);\n\tif (!key || (key.expiresAt && key.expiresAt < new Date())) {\n\t\tkey = await createJwk(ctx, options);\n\t}\n\tconst privateKeyEncryptionEnabled =\n\t\t!options?.jwks?.disablePrivateKeyEncryption;\n\n\tconst privateWebKey = privateKeyEncryptionEnabled\n\t\t? await symmetricDecrypt({\n\t\t\t\tkey: ctx.context.secret,\n\t\t\t\tdata: JSON.parse(key.privateKey),\n\t\t\t}).catch(() => {\n\t\t\t\tthrow new BetterAuthError(\n\t\t\t\t\t\"Failed to decrypt private key. Make sure the secret currently in use is the same as the one used to encrypt the private key. If you are using a different secret, either clean up your JWKS or disable private key encryption.\",\n\t\t\t\t);\n\t\t\t})\n\t\t: key.privateKey;\n\tconst alg = key.alg ?? options?.jwks?.keyPairConfig?.alg ?? \"EdDSA\";\n\tconst privateKey = await importJWK(JSON.parse(privateWebKey), alg);\n\n\tconst jwt = new SignJWT(payload)\n\t\t.setProtectedHeader({\n\t\t\talg,\n\t\t\tkid: key.id,\n\t\t})\n\t\t.setExpirationTime(exp)\n\t\t.setIssuer(iss ?? defaultIss)\n\t\t.setAudience(aud ?? defaultAud);\n\tif (iat) jwt.setIssuedAt(iat);\n\tif (payload.sub) jwt.setSubject(payload.sub);\n\tif (payload.nbf) jwt.setNotBefore(payload.nbf);\n\tif (payload.jti) jwt.setJti(payload.jti);\n\treturn await jwt.sign(privateKey);\n}\n\nexport async function getJwtToken(\n\tctx: GenericEndpointContext,\n\toptions?: JwtOptions | undefined,\n) {\n\tconst payload = !options?.jwt?.definePayload\n\t\t? ctx.context.session!.user\n\t\t: await options.jwt.definePayload(ctx.context.session!);\n\n\treturn await signJWT(ctx, {\n\t\toptions,\n\t\tpayload: {\n\t\t\tiat: Math.floor(Date.now() / 1000),\n\t\t\t...payload,\n\t\t\tsub:\n\t\t\t\t(await options?.jwt?.getSubject?.(ctx.context.session!)) ??\n\t\t\t\tctx.context.session!.user.id,\n\t\t},\n\t});\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AA+DA,eAAsB,QACrB,GAAA,EACA,MAAA,EAIC;IACD,MAAM,EAAE,OAAA,EAAA,GAAY;IACpB,MAAM,UAAU,OAAO,OAAA;IAGvB,MAAM,aAAa,KAAK,KAAA,CAAM,KAAK,GAAA,EAAK,GAAG,IAAK;IAChD,MAAM,MAAM,QAAQ,GAAA;IAGpB,IAAI,MAAM,QAAQ,GAAA;IAClB,MAAM,iBAAa,gLAAA,EAClB,SAAS,KAAK,kBAAkB,OAChC,OAAO,WACP;IACD,MAAM,OAAO;IAGb,MAAM,MAAM,QAAQ,GAAA;IAGpB,MAAM,MAAM,QAAQ,GAAA;IACpB,MAAM,aAAa,SAAS,KAAK,UAAU,IAAI,OAAA,CAAQ,OAAA,CAAQ,OAAA;IAG/D,MAAM,MAAM,QAAQ,GAAA;IACpB,MAAM,aAAa,SAAS,KAAK,YAAY,IAAI,OAAA,CAAQ,OAAA,CAAQ,OAAA;IAGjE,IAAI,SAAS,KAAK,MAAM;QACvB,MAAM,aAAa;YAClB,GAAG,OAAA;YACH;YACA;YACA;YACA,KAAK,OAAO;YACZ,KAAK,OAAO;SACZ;QACD,OAAO,QAAQ,GAAA,CAAI,IAAA,CAAK,WAAW;;IAIpC,IAAI,MAAM,UADM,wLAAA,EAAe,IAAI,OAAA,CAAQ,OAAA,EAAS,QAAQ,CACpC,YAAA,CAAa,IAAI;IACzC,IAAI,CAAC,OAAQ,IAAI,SAAA,IAAa,IAAI,SAAA,GAAA,aAAA,GAAY,IAAI,MAAM,CACvD,CAAA,MAAM,UAAM,iLAAA,EAAU,KAAK,QAAQ;IAKpC,MAAM,gBAFL,CAAC,SAAS,MAAM,8BAGd,UAAM,gMAAA,EAAiB;QACvB,KAAK,IAAI,OAAA,CAAQ,MAAA;QACjB,MAAM,KAAK,KAAA,CAAM,IAAI,UAAA,CAAW;KAChC,CAAC,CAAC,KAAA,CAAA,MAAY;QACd,MAAM,IAAI,wMAAA,CACT,iOACA;MACA,GACD,IAAI,UAAA;IACP,MAAM,MAAM,IAAI,GAAA,IAAO,SAAS,MAAM,eAAe,OAAO;IAC5D,MAAM,aAAa,UAAM,sKAAA,EAAU,KAAK,KAAA,CAAM,cAAc,EAAE,IAAI;IAElE,MAAM,MAAM,IAAI,kKAAA,CAAQ,QAAQ,CAC9B,kBAAA,CAAmB;QACnB;QACA,KAAK,IAAI,EAAA;KACT,CAAC,CACD,iBAAA,CAAkB,IAAI,CACtB,SAAA,CAAU,OAAO,WAAW,CAC5B,WAAA,CAAY,OAAO,WAAW;IAChC,IAAI,IAAK,CAAA,IAAI,WAAA,CAAY,IAAI;IAC7B,IAAI,QAAQ,GAAA,CAAK,CAAA,IAAI,UAAA,CAAW,QAAQ,GAAA,CAAI;IAC5C,IAAI,QAAQ,GAAA,CAAK,CAAA,IAAI,YAAA,CAAa,QAAQ,GAAA,CAAI;IAC9C,IAAI,QAAQ,GAAA,CAAK,CAAA,IAAI,MAAA,CAAO,QAAQ,GAAA,CAAI;IACxC,OAAO,MAAM,IAAI,IAAA,CAAK,WAAW;;AAGlC,eAAsB,YACrB,GAAA,EACA,OAAA,EACC;IACD,MAAM,UAAU,CAAC,SAAS,KAAK,gBAC5B,IAAI,OAAA,CAAQ,OAAA,CAAS,IAAA,GACrB,MAAM,QAAQ,GAAA,CAAI,aAAA,CAAc,IAAI,OAAA,CAAQ,OAAA,CAAS;IAExD,OAAO,MAAM,QAAQ,KAAK;QACzB;QACA,SAAS;YACR,KAAK,KAAK,KAAA,CAAM,KAAK,GAAA,EAAK,GAAG,IAAK;YAClC,GAAG,OAAA;YACH,KACE,MAAM,SAAS,KAAK,aAAa,IAAI,OAAA,CAAQ,OAAA,CAAS,IACvD,IAAI,OAAA,CAAQ,OAAA,CAAS,IAAA,CAAK,EAAA;SAC3B;KACD,CAAC"}},
    {"offset": {"line": 7651, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/jwt/verify.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/jwt/verify.ts"],"sourcesContent":["import type { GenericEndpointContext } from \"@better-auth/core\";\nimport { getCurrentAuthContext } from \"@better-auth/core/context\";\nimport { base64 } from \"@better-auth/utils/base64\";\nimport type { JWTPayload } from \"jose\";\nimport { importJWK, jwtVerify } from \"jose\";\nimport { getJwksAdapter } from \"./adapter\";\nimport type { JwtOptions } from \"./types\";\n\n/**\n * Verify a JWT token using the JWKS public keys\n * Returns the payload if valid, null otherwise\n */\nexport async function verifyJWT<T extends JWTPayload = JWTPayload>(\n\ttoken: string,\n\toptions?: JwtOptions,\n): Promise<(T & Required<Pick<JWTPayload, \"sub\" | \"aud\">>) | null> {\n\tconst ctx = await getCurrentAuthContext();\n\ttry {\n\t\tconst parts = token.split(\".\");\n\t\tif (parts.length !== 3) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst headerStr = new TextDecoder().decode(base64.decode(parts[0]!));\n\t\tconst header = JSON.parse(headerStr);\n\t\tconst kid = header.kid;\n\n\t\tif (!kid) {\n\t\t\tctx.context.logger.debug(\"JWT missing kid in header\");\n\t\t\treturn null;\n\t\t}\n\n\t\t// Get all JWKS keys\n\t\tconst adapter = getJwksAdapter(ctx.context.adapter, options);\n\t\tconst keys = await adapter.getAllKeys(ctx as GenericEndpointContext);\n\n\t\tif (!keys || keys.length === 0) {\n\t\t\tctx.context.logger.debug(\"No JWKS keys available\");\n\t\t\treturn null;\n\t\t}\n\n\t\tconst key = keys.find((k) => k.id === kid);\n\t\tif (!key) {\n\t\t\tctx.context.logger.debug(`No JWKS key found for kid: ${kid}`);\n\t\t\treturn null;\n\t\t}\n\n\t\tconst publicKey = JSON.parse(key.publicKey);\n\t\tconst alg = key.alg ?? options?.jwks?.keyPairConfig?.alg ?? \"EdDSA\";\n\t\tconst cryptoKey = await importJWK(publicKey, alg);\n\n\t\tconst { payload } = await jwtVerify(token, cryptoKey, {\n\t\t\tissuer: options?.jwt?.issuer ?? ctx.context.options.baseURL,\n\t\t\taudience: options?.jwt?.audience ?? ctx.context.options.baseURL,\n\t\t});\n\n\t\tif (!payload.sub || !payload.aud) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn payload as T & Required<Pick<JWTPayload, \"sub\" | \"aud\">>;\n\t} catch (error) {\n\t\tctx.context.logger.debug(\"JWT verification failed\", error);\n\t\treturn null;\n\t}\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;GAYA,eAAsB,UACrB,KAAA,EACA,OAAA,EACkE;IAClE,MAAM,MAAM,UAAM,8MAAA,EAAuB;IACzC,IAAI;QACH,MAAM,QAAQ,MAAM,KAAA,CAAM,IAAI;QAC9B,IAAI,MAAM,MAAA,KAAW,EACpB,CAAA,OAAO;QAGR,MAAM,YAAY,IAAI,aAAa,CAAC,MAAA,CAAO,wKAAA,CAAO,MAAA,CAAO,KAAA,CAAM,EAAA,CAAI,CAAC;QAEpE,MAAM,MADS,KAAK,KAAA,CAAM,UAAU,CACjB,GAAA;QAEnB,IAAI,CAAC,KAAK;YACT,IAAI,OAAA,CAAQ,MAAA,CAAO,KAAA,CAAM,4BAA4B;YACrD,OAAO;;QAKR,MAAM,OAAO,UADG,wLAAA,EAAe,IAAI,OAAA,CAAQ,OAAA,EAAS,QAAQ,CACjC,UAAA,CAAW,IAA8B;QAEpE,IAAI,CAAC,QAAQ,KAAK,MAAA,KAAW,GAAG;YAC/B,IAAI,OAAA,CAAQ,MAAA,CAAO,KAAA,CAAM,yBAAyB;YAClD,OAAO;;QAGR,MAAM,MAAM,KAAK,IAAA,CAAA,CAAM,IAAM,EAAE,EAAA,KAAO,IAAI;QAC1C,IAAI,CAAC,KAAK;YACT,IAAI,OAAA,CAAQ,MAAA,CAAO,KAAA,CAAM,CAAA,2BAAA,EAA8B,KAAA,CAAM;YAC7D,OAAO;;QAOR,MAAM,EAAE,OAAA,EAAA,GAAY,UAAM,sKAAA,EAAU,OAFlB,UAAM,sKAAA,EAFN,KAAK,KAAA,CAAM,IAAI,SAAA,CAAU,EAC/B,IAAI,GAAA,IAAO,SAAS,MAAM,eAAe,OAAO,QACX,EAEK;YACrD,QAAQ,SAAS,KAAK,UAAU,IAAI,OAAA,CAAQ,OAAA,CAAQ,OAAA;YACpD,UAAU,SAAS,KAAK,YAAY,IAAI,OAAA,CAAQ,OAAA,CAAQ,OAAA;SACxD,CAAC;QAEF,IAAI,CAAC,QAAQ,GAAA,IAAO,CAAC,QAAQ,GAAA,CAC5B,CAAA,OAAO;QAGR,OAAO;aACC,OAAO;QACf,IAAI,OAAA,CAAQ,MAAA,CAAO,KAAA,CAAM,2BAA2B,MAAM;QAC1D,OAAO"}},
    {"offset": {"line": 7707, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/jwt/schema.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/jwt/schema.ts"],"sourcesContent":["import type { BetterAuthPluginDBSchema } from \"@better-auth/core/db\";\n\nexport const schema = {\n\tjwks: {\n\t\tfields: {\n\t\t\tpublicKey: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: true,\n\t\t\t},\n\t\t\tprivateKey: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: true,\n\t\t\t},\n\t\t\tcreatedAt: {\n\t\t\t\ttype: \"date\",\n\t\t\t\trequired: true,\n\t\t\t},\n\t\t\texpiresAt: {\n\t\t\t\ttype: \"date\",\n\t\t\t\trequired: false,\n\t\t\t},\n\t\t},\n\t},\n} satisfies BetterAuthPluginDBSchema;\n"],"names":[],"mappings":";;;;;AAEA,MAAa,SAAS;IACrB,MAAM;QACL,QAAQ;YACP,WAAW;gBACV,MAAM;gBACN,UAAU;aACV;YACD,YAAY;gBACX,MAAM;gBACN,UAAU;aACV;YACD,WAAW;gBACV,MAAM;gBACN,UAAU;aACV;YACD,WAAW;gBACV,MAAM;gBACN,UAAU;aACV;SACD;IAAA,CACD;AAAA,CACD"}},
    {"offset": {"line": 7740, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/jwt/index.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/jwt/index.ts"],"sourcesContent":["import type { BetterAuthPlugin } from \"@better-auth/core\";\nimport {\n\tcreateAuthEndpoint,\n\tcreateAuthMiddleware,\n} from \"@better-auth/core/api\";\nimport { BetterAuthError } from \"@better-auth/core/error\";\nimport type { JSONWebKeySet, JWTPayload } from \"jose\";\nimport * as z from \"zod\";\nimport { APIError, sessionMiddleware } from \"../../api\";\nimport { mergeSchema } from \"../../db/schema\";\nimport { getJwksAdapter } from \"./adapter\";\nimport { schema } from \"./schema\";\nimport { getJwtToken, signJWT } from \"./sign\";\nimport type { JwtOptions } from \"./types\";\nimport { createJwk } from \"./utils\";\nimport { verifyJWT as verifyJWTHelper } from \"./verify\";\n\nexport { signJWT } from \"./sign\";\nexport type * from \"./types\";\nexport { createJwk, generateExportedKeyPair, toExpJWT } from \"./utils\";\nexport { verifyJWT } from \"./verify\";\n\nconst signJWTBodySchema = z.object({\n\tpayload: z.record(z.string(), z.any()),\n\toverrideOptions: z.record(z.string(), z.any()).optional(),\n});\n\nconst verifyJWTBodySchema = z.object({\n\ttoken: z.string(),\n\tissuer: z.string().optional(),\n});\n\nexport const jwt = <O extends JwtOptions>(options?: O) => {\n\t// Remote url must be set when using signing function\n\tif (options?.jwt?.sign && !options.jwks?.remoteUrl) {\n\t\tthrow new BetterAuthError(\n\t\t\t\"options.jwks.remoteUrl must be set when using options.jwt.sign\",\n\t\t);\n\t}\n\n\t// Alg is required to be specified when using remote url (needed in openid metadata)\n\tif (options?.jwks?.remoteUrl && !options.jwks?.keyPairConfig?.alg) {\n\t\tthrow new BetterAuthError(\n\t\t\t\"options.jwks.keyPairConfig.alg must be specified when using the oidc plugin with options.jwks.remoteUrl\",\n\t\t);\n\t}\n\n\tconst jwksPath = options?.jwks?.jwksPath ?? \"/jwks\";\n\tif (\n\t\ttypeof jwksPath !== \"string\" ||\n\t\tjwksPath.length === 0 ||\n\t\t!jwksPath.startsWith(\"/\") ||\n\t\tjwksPath.includes(\"..\")\n\t) {\n\t\tthrow new BetterAuthError(\n\t\t\t\"options.jwks.jwksPath must be a non-empty string starting with '/' and not contain '..'\",\n\t\t);\n\t}\n\n\treturn {\n\t\tid: \"jwt\",\n\t\toptions: options as NoInfer<O>,\n\t\tendpoints: {\n\t\t\tgetJwks: createAuthEndpoint(\n\t\t\t\tjwksPath,\n\t\t\t\t{\n\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\toperationId: \"getJSONWebKeySet\",\n\t\t\t\t\t\t\tdescription: \"Get the JSON Web Key Set\",\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\t\t\tdescription: \"JSON Web Key Set retrieved successfully\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tkeys: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Array of public JSON Web Keys\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tkid: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Key ID uniquely identifying the key, corresponds to the 'id' from the stored Jwk\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tkty: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Key type (e.g., 'RSA', 'EC', 'OKP')\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\talg: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Algorithm intended for use with the key (e.g., 'EdDSA', 'RS256')\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tuse: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Intended use of the public key (e.g., 'sig' for signature)\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tenum: [\"sig\"],\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tn: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Modulus for RSA keys (base64url-encoded)\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Exponent for RSA keys (base64url-encoded)\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcrv: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Curve name for elliptic curve keys (e.g., 'Ed25519', 'P-256')\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tx: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"X coordinate for elliptic curve keys (base64url-encoded)\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ty: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Y coordinate for elliptic curve keys (base64url-encoded)\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trequired: [\"kid\", \"kty\", \"alg\"],\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\trequired: [\"keys\"],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\t// Disables endpoint if using remote url strategy\n\t\t\t\t\tif (options?.jwks?.remoteUrl) {\n\t\t\t\t\t\tthrow new APIError(\"NOT_FOUND\");\n\t\t\t\t\t}\n\n\t\t\t\t\tconst adapter = getJwksAdapter(ctx.context.adapter, options);\n\n\t\t\t\t\tlet keySets = await adapter.getAllKeys(ctx);\n\n\t\t\t\t\tif (!keySets || keySets?.length === 0) {\n\t\t\t\t\t\tawait createJwk(ctx, options);\n\t\t\t\t\t\tkeySets = await adapter.getAllKeys(ctx);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!keySets?.length) {\n\t\t\t\t\t\tthrow new BetterAuthError(\n\t\t\t\t\t\t\t\"No key sets found. Make sure you have a key in your database.\",\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst now = Date.now();\n\t\t\t\t\tconst DEFAULT_GRACE_PERIOD = 60 * 60 * 24 * 30;\n\t\t\t\t\tconst gracePeriod =\n\t\t\t\t\t\t(options?.jwks?.gracePeriod ?? DEFAULT_GRACE_PERIOD) * 1000;\n\n\t\t\t\t\tconst keys = keySets.filter((key) => {\n\t\t\t\t\t\tif (!key.expiresAt) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn key.expiresAt.getTime() + gracePeriod > now;\n\t\t\t\t\t});\n\n\t\t\t\t\tconst keyPairConfig = options?.jwks?.keyPairConfig;\n\t\t\t\t\tconst defaultCrv = keyPairConfig\n\t\t\t\t\t\t? \"crv\" in keyPairConfig\n\t\t\t\t\t\t\t? (keyPairConfig as { crv: string }).crv\n\t\t\t\t\t\t\t: undefined\n\t\t\t\t\t\t: undefined;\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\tkeys: keys.map((keySet) => {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\talg: keySet.alg ?? options?.jwks?.keyPairConfig?.alg ?? \"EdDSA\",\n\t\t\t\t\t\t\t\tcrv: keySet.crv ?? defaultCrv,\n\t\t\t\t\t\t\t\t...JSON.parse(keySet.publicKey),\n\t\t\t\t\t\t\t\tkid: keySet.id,\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}),\n\t\t\t\t\t} satisfies JSONWebKeySet as JSONWebKeySet);\n\t\t\t\t},\n\t\t\t),\n\n\t\t\tgetToken: createAuthEndpoint(\n\t\t\t\t\"/token\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\trequireHeaders: true,\n\t\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\toperationId: \"getJSONWebToken\",\n\t\t\t\t\t\t\tdescription: \"Get a JWT token\",\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttoken: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tconst jwt = await getJwtToken(ctx, options);\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\ttoken: jwt,\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t),\n\t\t\tsignJWT: createAuthEndpoint(\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\t$Infer: {\n\t\t\t\t\t\t\tbody: {} as {\n\t\t\t\t\t\t\t\tpayload: JWTPayload;\n\t\t\t\t\t\t\t\toverrideOptions?: JwtOptions | undefined;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tbody: signJWTBodySchema,\n\t\t\t\t},\n\t\t\t\tasync (c) => {\n\t\t\t\t\tconst jwt = await signJWT(c, {\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t...options,\n\t\t\t\t\t\t\t...c.body.overrideOptions,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpayload: c.body.payload,\n\t\t\t\t\t});\n\t\t\t\t\treturn c.json({ token: jwt });\n\t\t\t\t},\n\t\t\t),\n\t\t\tverifyJWT: createAuthEndpoint(\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\t$Infer: {\n\t\t\t\t\t\t\tbody: {} as {\n\t\t\t\t\t\t\t\ttoken: string;\n\t\t\t\t\t\t\t\tissuer?: string;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tresponse: {} as {\n\t\t\t\t\t\t\t\tpayload: {\n\t\t\t\t\t\t\t\t\tsub: string;\n\t\t\t\t\t\t\t\t\taud: string;\n\t\t\t\t\t\t\t\t\t[key: string]: any;\n\t\t\t\t\t\t\t\t} | null;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tbody: verifyJWTBodySchema,\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tconst overrideOptions = ctx.body.issuer\n\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t...options,\n\t\t\t\t\t\t\t\tjwt: {\n\t\t\t\t\t\t\t\t\t...options?.jwt,\n\t\t\t\t\t\t\t\t\tissuer: ctx.body.issuer,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t: options;\n\n\t\t\t\t\tconst payload = await verifyJWTHelper(\n\t\t\t\t\t\tctx.body.token,\n\t\t\t\t\t\toverrideOptions,\n\t\t\t\t\t);\n\n\t\t\t\t\treturn ctx.json({ payload });\n\t\t\t\t},\n\t\t\t),\n\t\t},\n\t\thooks: {\n\t\t\tafter: [\n\t\t\t\t{\n\t\t\t\t\tmatcher(context) {\n\t\t\t\t\t\treturn context.path === \"/get-session\";\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tif (options?.disableSettingJwtHeader) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst session = ctx.context.session || ctx.context.newSession;\n\t\t\t\t\t\tif (session && session.session) {\n\t\t\t\t\t\t\tconst jwt = await getJwtToken(ctx, options);\n\t\t\t\t\t\t\tconst exposedHeaders =\n\t\t\t\t\t\t\t\tctx.context.responseHeaders?.get(\n\t\t\t\t\t\t\t\t\t\"access-control-expose-headers\",\n\t\t\t\t\t\t\t\t) || \"\";\n\t\t\t\t\t\t\tconst headersSet = new Set(\n\t\t\t\t\t\t\t\texposedHeaders\n\t\t\t\t\t\t\t\t\t.split(\",\")\n\t\t\t\t\t\t\t\t\t.map((header) => header.trim())\n\t\t\t\t\t\t\t\t\t.filter(Boolean),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\theadersSet.add(\"set-auth-jwt\");\n\t\t\t\t\t\t\tctx.setHeader(\"set-auth-jwt\", jwt);\n\t\t\t\t\t\t\tctx.setHeader(\n\t\t\t\t\t\t\t\t\"Access-Control-Expose-Headers\",\n\t\t\t\t\t\t\t\tArray.from(headersSet).join(\", \"),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\tschema: mergeSchema(schema, options?.schema),\n\t} satisfies BetterAuthPlugin;\n};\n\nexport { getJwtToken };\n"],"names":["jwt","verifyJWTHelper"],"mappings":"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"}},
    {"offset": {"line": 8005, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/last-login-method/index.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/last-login-method/index.ts"],"sourcesContent":["import type {\n\tBetterAuthPlugin,\n\tGenericEndpointContext,\n} from \"@better-auth/core\";\nimport { createAuthMiddleware } from \"@better-auth/core/api\";\n\n/**\n * Configuration for tracking different authentication methods\n */\nexport interface LastLoginMethodOptions {\n\t/**\n\t * Name of the cookie to store the last login method\n\t * @default \"better-auth.last_used_login_method\"\n\t */\n\tcookieName?: string | undefined;\n\t/**\n\t * Cookie expiration time in seconds\n\t * @default 2592000 (30 days)\n\t */\n\tmaxAge?: number | undefined;\n\t/**\n\t * Custom method to resolve the last login method\n\t * @param ctx - The context from the hook\n\t * @returns The last login method\n\t */\n\tcustomResolveMethod?:\n\t\t| ((ctx: GenericEndpointContext) => string | null)\n\t\t| undefined;\n\t/**\n\t * Store the last login method in the database. This will create a new field in the user table.\n\t * @default false\n\t */\n\tstoreInDatabase?: boolean | undefined;\n\t/**\n\t * Custom schema for the plugin\n\t * @default undefined\n\t */\n\tschema?:\n\t\t| {\n\t\t\t\tuser?: {\n\t\t\t\t\tlastLoginMethod?: string;\n\t\t\t\t};\n\t\t  }\n\t\t| undefined;\n}\n\n/**\n * Plugin to track the last used login method\n */\nexport const lastLoginMethod = <O extends LastLoginMethodOptions>(\n\tuserConfig?: O | undefined,\n) => {\n\tconst paths = [\n\t\t\"/callback/:id\",\n\t\t\"/oauth2/callback/:providerId\",\n\t\t\"/sign-in/email\",\n\t\t\"/sign-up/email\",\n\t];\n\n\tconst defaultResolveMethod = (ctx: GenericEndpointContext) => {\n\t\tif (paths.includes(ctx.path)) {\n\t\t\treturn (\n\t\t\t\tctx.params?.id || ctx.params?.providerId || ctx.path.split(\"/\").pop()\n\t\t\t);\n\t\t}\n\t\tif (ctx.path.includes(\"siwe\")) return \"siwe\";\n\t\tif (ctx.path.includes(\"/passkey/verify-authentication\")) return \"passkey\";\n\t\treturn null;\n\t};\n\n\tconst config = {\n\t\tcookieName: \"better-auth.last_used_login_method\",\n\t\tmaxAge: 60 * 60 * 24 * 30,\n\t\t...userConfig,\n\t} satisfies LastLoginMethodOptions;\n\n\treturn {\n\t\tid: \"last-login-method\",\n\t\tinit(ctx) {\n\t\t\treturn {\n\t\t\t\toptions: {\n\t\t\t\t\tdatabaseHooks: {\n\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\tcreate: {\n\t\t\t\t\t\t\t\tasync before(user, context) {\n\t\t\t\t\t\t\t\t\tif (!config.storeInDatabase) return;\n\t\t\t\t\t\t\t\t\tif (!context) return;\n\t\t\t\t\t\t\t\t\tconst lastUsedLoginMethod =\n\t\t\t\t\t\t\t\t\t\tconfig.customResolveMethod?.(context) ??\n\t\t\t\t\t\t\t\t\t\tdefaultResolveMethod(context);\n\t\t\t\t\t\t\t\t\tif (lastUsedLoginMethod) {\n\t\t\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\t\t\t\t...user,\n\t\t\t\t\t\t\t\t\t\t\t\tlastLoginMethod: lastUsedLoginMethod,\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsession: {\n\t\t\t\t\t\t\tcreate: {\n\t\t\t\t\t\t\t\tasync after(session, context) {\n\t\t\t\t\t\t\t\t\tif (!config.storeInDatabase) return;\n\t\t\t\t\t\t\t\t\tif (!context) return;\n\t\t\t\t\t\t\t\t\tconst lastUsedLoginMethod =\n\t\t\t\t\t\t\t\t\t\tconfig.customResolveMethod?.(context) ??\n\t\t\t\t\t\t\t\t\t\tdefaultResolveMethod(context);\n\t\t\t\t\t\t\t\t\tif (lastUsedLoginMethod && session?.userId) {\n\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\tawait ctx.internalAdapter.updateUser(session.userId, {\n\t\t\t\t\t\t\t\t\t\t\t\tlastLoginMethod: lastUsedLoginMethod,\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\t\t\t\t\tctx.logger.error(\n\t\t\t\t\t\t\t\t\t\t\t\t\"Failed to update lastLoginMethod\",\n\t\t\t\t\t\t\t\t\t\t\t\terror,\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\thooks: {\n\t\t\tafter: [\n\t\t\t\t{\n\t\t\t\t\tmatcher() {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tconst lastUsedLoginMethod =\n\t\t\t\t\t\t\tconfig.customResolveMethod?.(ctx) ?? defaultResolveMethod(ctx);\n\t\t\t\t\t\tif (lastUsedLoginMethod) {\n\t\t\t\t\t\t\tconst setCookie = ctx.context.responseHeaders?.get(\"set-cookie\");\n\t\t\t\t\t\t\tconst sessionTokenName =\n\t\t\t\t\t\t\t\tctx.context.authCookies.sessionToken.name;\n\t\t\t\t\t\t\tconst hasSessionToken =\n\t\t\t\t\t\t\t\tsetCookie && setCookie.includes(sessionTokenName);\n\t\t\t\t\t\t\tif (hasSessionToken) {\n\t\t\t\t\t\t\t\t// Inherit cookie attributes from Better Auth's centralized cookie system\n\t\t\t\t\t\t\t\t// This ensures consistency with cross-origin, cross-subdomain, and security settings\n\t\t\t\t\t\t\t\tconst cookieAttributes = {\n\t\t\t\t\t\t\t\t\t...ctx.context.authCookies.sessionToken.attributes,\n\t\t\t\t\t\t\t\t\tmaxAge: config.maxAge,\n\t\t\t\t\t\t\t\t\thttpOnly: false, // Override: plugin cookies are not httpOnly\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\tctx.setCookie(\n\t\t\t\t\t\t\t\t\tconfig.cookieName,\n\t\t\t\t\t\t\t\t\tlastUsedLoginMethod,\n\t\t\t\t\t\t\t\t\tcookieAttributes,\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\tschema: (config.storeInDatabase\n\t\t\t? {\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\tlastLoginMethod: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\tinput: false,\n\t\t\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\t\t\tfieldName:\n\t\t\t\t\t\t\t\t\tconfig.schema?.user?.lastLoginMethod || \"lastLoginMethod\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t: undefined) as O[\"storeInDatabase\"] extends true\n\t\t\t? {\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\tlastLoginMethod: {\n\t\t\t\t\t\t\t\ttype: \"string\";\n\t\t\t\t\t\t\t\trequired: false;\n\t\t\t\t\t\t\t\tinput: false;\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t};\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t: undefined,\n\t\toptions: userConfig as NoInfer<O>,\n\t} satisfies BetterAuthPlugin;\n};\n"],"names":[],"mappings":";;;;;;;;;GAiDA,MAAa,kBAAA,CACZ,eACI;IACJ,MAAM,QAAQ;QACb;QACA;QACA;QACA;KACA;IAED,MAAM,uBAAA,CAAwB,QAAgC;QAC7D,IAAI,MAAM,QAAA,CAAS,IAAI,IAAA,CAAK,CAC3B,CAAA,OACC,IAAI,MAAA,EAAQ,MAAM,IAAI,MAAA,EAAQ,cAAc,IAAI,IAAA,CAAK,KAAA,CAAM,IAAI,CAAC,GAAA,EAAK;QAGvE,IAAI,IAAI,IAAA,CAAK,QAAA,CAAS,OAAO,CAAE,CAAA,OAAO;QACtC,IAAI,IAAI,IAAA,CAAK,QAAA,CAAS,iCAAiC,CAAE,CAAA,OAAO;QAChE,OAAO;;IAGR,MAAM,SAAS;QACd,YAAY;QACZ,QAAQ,OAAU,KAAK;QACvB,GAAG,UAAA;KACH;IAED,OAAO;QACN,IAAI;QACJ,MAAK,GAAA,EAAK;YACT,OAAO;gBACN,SAAS;oBACR,eAAe;wBACd,MAAM;4BACL,QAAQ;gCACP,MAAM,QAAO,IAAA,EAAM,OAAA,EAAS;oCAC3B,IAAI,CAAC,OAAO,eAAA,CAAiB,CAAA;oCAC7B,IAAI,CAAC,QAAS,CAAA;oCACd,MAAM,sBACL,OAAO,mBAAA,GAAsB,QAAQ,IACrC,qBAAqB,QAAQ;oCAC9B,IAAI,oBACH,CAAA,OAAO;wCACN,MAAM;4CACL,GAAG,IAAA;4CACH,iBAAiB;yCACjB;oCAAA,CACD;;6BAGH;wBAAA,CACD;wBACD,SAAS;4BACR,QAAQ;gCACP,MAAM,OAAM,OAAA,EAAS,OAAA,EAAS;oCAC7B,IAAI,CAAC,OAAO,eAAA,CAAiB,CAAA;oCAC7B,IAAI,CAAC,QAAS,CAAA;oCACd,MAAM,sBACL,OAAO,mBAAA,GAAsB,QAAQ,IACrC,qBAAqB,QAAQ;oCAC9B,IAAI,uBAAuB,SAAS,OACnC,CAAA,IAAI;wCACH,MAAM,IAAI,eAAA,CAAgB,UAAA,CAAW,QAAQ,MAAA,EAAQ;4CACpD,iBAAiB;wCAAA,CACjB,CAAC;6CACM,OAAO;wCACf,IAAI,MAAA,CAAO,KAAA,CACV,oCACA,MACA;;;6BAIJ;wBAAA,CACD;qBACD;gBAAA,CACD;YAAA,CACD;;QAEF,OAAO;YACN,OAAO;gBACN;oBACC,UAAU;wBACT,OAAO;;oBAER,aAAS,2LAAA,EAAqB,OAAO,QAAQ;wBAC5C,MAAM,sBACL,OAAO,mBAAA,GAAsB,IAAI,IAAI,qBAAqB,IAAI;wBAC/D,IAAI,qBAAqB;4BACxB,MAAM,YAAY,IAAI,OAAA,CAAQ,eAAA,EAAiB,IAAI,aAAa;4BAChE,MAAM,mBACL,IAAI,OAAA,CAAQ,WAAA,CAAY,YAAA,CAAa,IAAA;4BAGtC,IADC,aAAa,UAAU,QAAA,CAAS,iBAAiB,EAC7B;gCAGpB,MAAM,mBAAmB;oCACxB,GAAG,IAAI,OAAA,CAAQ,WAAA,CAAY,YAAA,CAAa,UAAA;oCACxC,QAAQ,OAAO,MAAA;oCACf,UAAU;iCACV;gCAED,IAAI,SAAA,CACH,OAAO,UAAA,EACP,qBACA,iBACA;;;sBAGF;iBACF;aACD;QAAA,CACD;QACD,QAAS,OAAO,eAAA,GACb;YACA,MAAM;gBACL,QAAQ;oBACP,iBAAiB;wBAChB,MAAM;wBACN,OAAO;wBACP,UAAU;wBACV,WACC,OAAO,MAAA,EAAQ,MAAM,mBAAmB;qBACzC;gBAAA,CACD;YAAA,CACD;QAAA,CACD,GACA,KAAA;QAaH,SAAS;KACT"}},
    {"offset": {"line": 8118, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/magic-link/utils.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/magic-link/utils.ts"],"sourcesContent":["import { base64Url } from \"@better-auth/utils/base64\";\nimport { createHash } from \"@better-auth/utils/hash\";\n\nexport const defaultKeyHasher = async (otp: string) => {\n\tconst hash = await createHash(\"SHA-256\").digest(\n\t\tnew TextEncoder().encode(otp),\n\t);\n\tconst hashed = base64Url.encode(new Uint8Array(hash), {\n\t\tpadding: false,\n\t});\n\treturn hashed;\n};\n"],"names":[],"mappings":";;;;;;;;;AAGA,MAAa,mBAAmB,OAAO,QAAgB;IACtD,MAAM,OAAO,UAAM,0KAAA,EAAW,UAAU,CAAC,MAAA,CACxC,IAAI,aAAa,CAAC,MAAA,CAAO,IAAI,CAC7B;IAID,OAHe,2KAAA,CAAU,MAAA,CAAO,IAAI,WAAW,KAAK,EAAE;QACrD,SAAS;IAAA,CACT,CAAC"}},
    {"offset": {"line": 8139, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/magic-link/index.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/magic-link/index.ts"],"sourcesContent":["import type {\n\tAwaitable,\n\tBetterAuthPlugin,\n\tGenericEndpointContext,\n} from \"@better-auth/core\";\nimport { createAuthEndpoint } from \"@better-auth/core/api\";\nimport * as z from \"zod\";\nimport { originCheck } from \"../../api\";\nimport { setSessionCookie } from \"../../cookies\";\nimport { generateRandomString } from \"../../crypto\";\nimport { parseUserOutput } from \"../../db/schema\";\nimport { defaultKeyHasher } from \"./utils\";\n\nexport interface MagicLinkOptions {\n\t/**\n\t * Time in seconds until the magic link expires.\n\t * @default (60 * 5) // 5 minutes\n\t */\n\texpiresIn?: number | undefined;\n\t/**\n\t * Send magic link implementation.\n\t */\n\tsendMagicLink: (\n\t\tdata: {\n\t\t\temail: string;\n\t\t\turl: string;\n\t\t\ttoken: string;\n\t\t},\n\t\tctx?: GenericEndpointContext | undefined,\n\t) => Awaitable<void>;\n\t/**\n\t * Disable sign up if user is not found.\n\t *\n\t * @default false\n\t */\n\tdisableSignUp?: boolean | undefined;\n\t/**\n\t * Rate limit configuration.\n\t *\n\t * @default {\n\t *  window: 60,\n\t *  max: 5,\n\t * }\n\t */\n\trateLimit?:\n\t\t| {\n\t\t\t\twindow: number;\n\t\t\t\tmax: number;\n\t\t  }\n\t\t| undefined;\n\t/**\n\t * Custom function to generate a token\n\t */\n\tgenerateToken?: ((email: string) => Awaitable<string>) | undefined;\n\n\t/**\n\t * This option allows you to configure how the token is stored in your database.\n\t * Note: This will not affect the token that's sent, it will only affect the token stored in your database.\n\t *\n\t * @default \"plain\"\n\t */\n\tstoreToken?:\n\t\t| (\n\t\t\t\t| \"plain\"\n\t\t\t\t| \"hashed\"\n\t\t\t\t| { type: \"custom-hasher\"; hash: (token: string) => Promise<string> }\n\t\t  )\n\t\t| undefined;\n}\n\nconst signInMagicLinkBodySchema = z.object({\n\temail: z.email().meta({\n\t\tdescription: \"Email address to send the magic link\",\n\t}),\n\tname: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'User display name. Only used if the user is registering for the first time. Eg: \"my-name\"',\n\t\t})\n\t\t.optional(),\n\tcallbackURL: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: \"URL to redirect after magic link verification\",\n\t\t})\n\t\t.optional(),\n\tnewUserCallbackURL: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t\"URL to redirect after new user signup. Only used if the user is registering for the first time.\",\n\t\t})\n\t\t.optional(),\n\terrorCallbackURL: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: \"URL to redirect after error.\",\n\t\t})\n\t\t.optional(),\n});\nconst magicLinkVerifyQuerySchema = z.object({\n\ttoken: z.string().meta({\n\t\tdescription: \"Verification token\",\n\t}),\n\tcallbackURL: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'URL to redirect after magic link verification, if not provided the user will be redirected to the root URL. Eg: \"/dashboard\"',\n\t\t})\n\t\t.optional(),\n\terrorCallbackURL: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: \"URL to redirect after error.\",\n\t\t})\n\t\t.optional(),\n\tnewUserCallbackURL: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t\"URL to redirect after new user signup. Only used if the user is registering for the first time.\",\n\t\t})\n\t\t.optional(),\n});\nexport const magicLink = (options: MagicLinkOptions) => {\n\tconst opts = {\n\t\tstoreToken: \"plain\",\n\t\t...options,\n\t} satisfies MagicLinkOptions;\n\n\tasync function storeToken(ctx: GenericEndpointContext, token: string) {\n\t\tif (opts.storeToken === \"hashed\") {\n\t\t\treturn await defaultKeyHasher(token);\n\t\t}\n\t\tif (\n\t\t\ttypeof opts.storeToken === \"object\" &&\n\t\t\t\"type\" in opts.storeToken &&\n\t\t\topts.storeToken.type === \"custom-hasher\"\n\t\t) {\n\t\t\treturn await opts.storeToken.hash(token);\n\t\t}\n\t\treturn token;\n\t}\n\n\treturn {\n\t\tid: \"magic-link\",\n\t\tendpoints: {\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * POST `/sign-in/magic-link`\n\t\t\t *\n\t\t\t * ### API Methods\n\t\t\t *\n\t\t\t * **server:**\n\t\t\t * `auth.api.signInMagicLink`\n\t\t\t *\n\t\t\t * **client:**\n\t\t\t * `authClient.signIn.magicLink`\n\t\t\t *\n\t\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/sign-in#api-method-sign-in-magic-link)\n\t\t\t */\n\t\t\tsignInMagicLink: createAuthEndpoint(\n\t\t\t\t\"/sign-in/magic-link\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\trequireHeaders: true,\n\t\t\t\t\tbody: signInMagicLinkBodySchema,\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\toperationId: \"signInWithMagicLink\",\n\t\t\t\t\t\t\tdescription: \"Sign in with magic link\",\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tstatus: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tconst { email } = ctx.body;\n\n\t\t\t\t\tconst verificationToken = opts?.generateToken\n\t\t\t\t\t\t? await opts.generateToken(email)\n\t\t\t\t\t\t: generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\t\tconst storedToken = await storeToken(ctx, verificationToken);\n\t\t\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\t\t\tidentifier: storedToken,\n\t\t\t\t\t\tvalue: JSON.stringify({ email, name: ctx.body.name }),\n\t\t\t\t\t\texpiresAt: new Date(Date.now() + (opts.expiresIn || 60 * 5) * 1000),\n\t\t\t\t\t});\n\t\t\t\t\tconst realBaseURL = new URL(ctx.context.baseURL);\n\t\t\t\t\tconst pathname =\n\t\t\t\t\t\trealBaseURL.pathname === \"/\" ? \"\" : realBaseURL.pathname;\n\t\t\t\t\tconst basePath = pathname ? \"\" : ctx.context.options.basePath || \"\";\n\t\t\t\t\tconst url = new URL(\n\t\t\t\t\t\t`${pathname}${basePath}/magic-link/verify`,\n\t\t\t\t\t\trealBaseURL.origin,\n\t\t\t\t\t);\n\t\t\t\t\turl.searchParams.set(\"token\", verificationToken);\n\t\t\t\t\turl.searchParams.set(\"callbackURL\", ctx.body.callbackURL || \"/\");\n\t\t\t\t\tif (ctx.body.newUserCallbackURL) {\n\t\t\t\t\t\turl.searchParams.set(\n\t\t\t\t\t\t\t\"newUserCallbackURL\",\n\t\t\t\t\t\t\tctx.body.newUserCallbackURL,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tif (ctx.body.errorCallbackURL) {\n\t\t\t\t\t\turl.searchParams.set(\"errorCallbackURL\", ctx.body.errorCallbackURL);\n\t\t\t\t\t}\n\t\t\t\t\tawait options.sendMagicLink(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\temail,\n\t\t\t\t\t\t\turl: url.toString(),\n\t\t\t\t\t\t\ttoken: verificationToken,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tctx,\n\t\t\t\t\t);\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\tstatus: true,\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t),\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * GET `/magic-link/verify`\n\t\t\t *\n\t\t\t * ### API Methods\n\t\t\t *\n\t\t\t * **server:**\n\t\t\t * `auth.api.magicLinkVerify`\n\t\t\t *\n\t\t\t * **client:**\n\t\t\t * `authClient.magicLink.verify`\n\t\t\t *\n\t\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/magic-link#api-method-magic-link-verify)\n\t\t\t */\n\t\t\tmagicLinkVerify: createAuthEndpoint(\n\t\t\t\t\"/magic-link/verify\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\tquery: magicLinkVerifyQuerySchema,\n\t\t\t\t\tuse: [\n\t\t\t\t\t\toriginCheck((ctx) => {\n\t\t\t\t\t\t\treturn ctx.query.callbackURL\n\t\t\t\t\t\t\t\t? decodeURIComponent(ctx.query.callbackURL)\n\t\t\t\t\t\t\t\t: \"/\";\n\t\t\t\t\t\t}),\n\t\t\t\t\t\toriginCheck((ctx) => {\n\t\t\t\t\t\t\treturn ctx.query.newUserCallbackURL\n\t\t\t\t\t\t\t\t? decodeURIComponent(ctx.query.newUserCallbackURL)\n\t\t\t\t\t\t\t\t: \"/\";\n\t\t\t\t\t\t}),\n\t\t\t\t\t\toriginCheck((ctx) => {\n\t\t\t\t\t\t\treturn ctx.query.errorCallbackURL\n\t\t\t\t\t\t\t\t? decodeURIComponent(ctx.query.errorCallbackURL)\n\t\t\t\t\t\t\t\t: \"/\";\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t\trequireHeaders: true,\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\toperationId: \"verifyMagicLink\",\n\t\t\t\t\t\t\tdescription: \"Verify magic link\",\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tsession: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/Session\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/User\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tconst token = ctx.query.token;\n\t\t\t\t\t// If the first argument provides the origin, it will ignore the second argument of `new URL`.\n\t\t\t\t\t// new URL(\"http://localhost:3001/hello\", \"http://localhost:3000\").toString()\n\t\t\t\t\t// Returns http://localhost:3001/hello\n\t\t\t\t\tconst callbackURL = new URL(\n\t\t\t\t\t\tctx.query.callbackURL\n\t\t\t\t\t\t\t? decodeURIComponent(ctx.query.callbackURL)\n\t\t\t\t\t\t\t: \"/\",\n\t\t\t\t\t\tctx.context.baseURL,\n\t\t\t\t\t).toString();\n\t\t\t\t\tconst errorCallbackURL = new URL(\n\t\t\t\t\t\tctx.query.errorCallbackURL\n\t\t\t\t\t\t\t? decodeURIComponent(ctx.query.errorCallbackURL)\n\t\t\t\t\t\t\t: callbackURL,\n\t\t\t\t\t\tctx.context.baseURL,\n\t\t\t\t\t);\n\n\t\t\t\t\tfunction redirectWithError(error: string): never {\n\t\t\t\t\t\terrorCallbackURL.searchParams.set(\"error\", error);\n\t\t\t\t\t\tthrow ctx.redirect(errorCallbackURL.toString());\n\t\t\t\t\t}\n\n\t\t\t\t\tconst newUserCallbackURL = new URL(\n\t\t\t\t\t\tctx.query.newUserCallbackURL\n\t\t\t\t\t\t\t? decodeURIComponent(ctx.query.newUserCallbackURL)\n\t\t\t\t\t\t\t: callbackURL,\n\t\t\t\t\t\tctx.context.baseURL,\n\t\t\t\t\t).toString();\n\t\t\t\t\tconst storedToken = await storeToken(ctx, token);\n\t\t\t\t\tconst tokenValue =\n\t\t\t\t\t\tawait ctx.context.internalAdapter.findVerificationValue(\n\t\t\t\t\t\t\tstoredToken,\n\t\t\t\t\t\t);\n\t\t\t\t\tif (!tokenValue) {\n\t\t\t\t\t\tredirectWithError(\"INVALID_TOKEN\");\n\t\t\t\t\t}\n\t\t\t\t\tif (tokenValue.expiresAt < new Date()) {\n\t\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(\n\t\t\t\t\t\t\ttokenValue.id,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tredirectWithError(\"EXPIRED_TOKEN\");\n\t\t\t\t\t}\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(\n\t\t\t\t\t\ttokenValue.id,\n\t\t\t\t\t);\n\t\t\t\t\tconst { email, name } = JSON.parse(tokenValue.value) as {\n\t\t\t\t\t\temail: string;\n\t\t\t\t\t\tname?: string | undefined;\n\t\t\t\t\t};\n\t\t\t\t\tlet isNewUser = false;\n\t\t\t\t\tlet user = await ctx.context.internalAdapter\n\t\t\t\t\t\t.findUserByEmail(email)\n\t\t\t\t\t\t.then((res) => res?.user);\n\n\t\t\t\t\tif (!user) {\n\t\t\t\t\t\tif (!opts.disableSignUp) {\n\t\t\t\t\t\t\tconst newUser = await ctx.context.internalAdapter.createUser({\n\t\t\t\t\t\t\t\temail: email,\n\t\t\t\t\t\t\t\temailVerified: true,\n\t\t\t\t\t\t\t\tname: name || \"\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tisNewUser = true;\n\t\t\t\t\t\t\tuser = newUser;\n\t\t\t\t\t\t\tif (!user) {\n\t\t\t\t\t\t\t\tredirectWithError(\"failed_to_create_user\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tredirectWithError(\"new_user_signup_disabled\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!user.emailVerified) {\n\t\t\t\t\t\tuser = await ctx.context.internalAdapter.updateUser(user.id, {\n\t\t\t\t\t\t\temailVerified: true,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tconst session = await ctx.context.internalAdapter.createSession(\n\t\t\t\t\t\tuser.id,\n\t\t\t\t\t);\n\n\t\t\t\t\tif (!session) {\n\t\t\t\t\t\tredirectWithError(\"failed_to_create_session\");\n\t\t\t\t\t}\n\n\t\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\t\tsession,\n\t\t\t\t\t\tuser,\n\t\t\t\t\t});\n\t\t\t\t\tif (!ctx.query.callbackURL) {\n\t\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\t\ttoken: session.token,\n\t\t\t\t\t\t\tuser: parseUserOutput(ctx.context.options, user),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (isNewUser) {\n\t\t\t\t\t\tthrow ctx.redirect(newUserCallbackURL);\n\t\t\t\t\t}\n\t\t\t\t\tthrow ctx.redirect(callbackURL);\n\t\t\t\t},\n\t\t\t),\n\t\t},\n\t\trateLimit: [\n\t\t\t{\n\t\t\t\tpathMatcher(path) {\n\t\t\t\t\treturn (\n\t\t\t\t\t\tpath.startsWith(\"/sign-in/magic-link\") ||\n\t\t\t\t\t\tpath.startsWith(\"/magic-link/verify\")\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\twindow: opts.rateLimit?.window || 60,\n\t\t\t\tmax: opts.rateLimit?.max || 5,\n\t\t\t},\n\t\t],\n\t\toptions,\n\t} satisfies BetterAuthPlugin;\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 8368, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/oidc-provider/error.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/oidc-provider/error.ts"],"sourcesContent":["import { APIError } from \"better-call\";\n\nclass OIDCProviderError extends APIError {}\n\nexport class InvalidRequest extends OIDCProviderError {\n\tconstructor(error_description: string, error_detail?: string) {\n\t\tsuper(\"BAD_REQUEST\", {\n\t\t\tmessage: \"invalid_request\",\n\t\t\terror_description,\n\t\t\terror_detail,\n\t\t});\n\t}\n}\n"],"names":[],"mappings":";;;;;;;;AAEA,IAAM,oBAAN,cAAgC,8JAAA,CAAS;AAAA;AAEzC,IAAa,iBAAb,cAAoC,kBAAkB;IACrD,YAAY,iBAAA,EAA2B,YAAA,CAAuB;QAC7D,KAAA,CAAM,eAAe;YACpB,SAAS;YACT;YACA;SACA,CAAC"}},
    {"offset": {"line": 8393, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/oidc-provider/utils/prompt.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/oidc-provider/utils/prompt.ts"],"sourcesContent":["import { InvalidRequest } from \"../error\";\n\nexport type AuthorizePrompt = \"login\" | \"consent\" | \"select_account\" | \"none\";\nexport type AuthorizePromptSet = ReadonlySet<AuthorizePrompt>;\n\n/**\n * Parse space-separated prompt string into a set of prompts\n *\n * @param prompt\n */\nexport function parsePrompt(prompt: string) {\n\tconst prompts = prompt.split(\" \").map((p) => p.trim());\n\tconst set = new Set<AuthorizePrompt>();\n\tfor (const p of prompts) {\n\t\tif (\n\t\t\tp === \"login\" ||\n\t\t\tp === \"consent\" ||\n\t\t\tp === \"select_account\" ||\n\t\t\tp === \"none\"\n\t\t) {\n\t\t\tset.add(p);\n\t\t}\n\t}\n\n\tif (set.has(\"none\") && set.size > 1) {\n\t\tthrow new InvalidRequest(\"prompt none must only be used alone\");\n\t}\n\n\treturn new Set(set) as AuthorizePromptSet;\n}\n"],"names":[],"mappings":";;;;;;;;;;;GAUA,SAAgB,YAAY,MAAA,EAAgB;IAC3C,MAAM,UAAU,OAAO,KAAA,CAAM,IAAI,CAAC,GAAA,CAAA,CAAK,IAAM,EAAE,IAAA,EAAM,CAAC;IACtD,MAAM,MAAA,aAAA,GAAM,IAAI,KAAsB;IACtC,KAAK,MAAM,KAAK,QACf,IACC,MAAM,WACN,MAAM,aACN,MAAM,oBACN,MAAM,OAEN,CAAA,IAAI,GAAA,CAAI,EAAE;IAIZ,IAAI,IAAI,GAAA,CAAI,OAAO,IAAI,IAAI,IAAA,GAAO,EACjC,CAAA,MAAM,IAAI,mMAAA,CAAe,sCAAsC;IAGhE,OAAO,IAAI,IAAI,IAAI"}},
    {"offset": {"line": 8417, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/oidc-provider/authorize.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/oidc-provider/authorize.ts"],"sourcesContent":["import type { GenericEndpointContext } from \"@better-auth/core\";\nimport { APIError } from \"better-call\";\nimport { getSessionFromCtx } from \"../../api\";\nimport { generateRandomString } from \"../../crypto\";\nimport { getClient } from \"./index\";\nimport type { AuthorizationQuery, OIDCOptions } from \"./types\";\nimport { parsePrompt } from \"./utils/prompt\";\n\nfunction formatErrorURL(url: string, error: string, description: string) {\n\treturn `${\n\t\turl.includes(\"?\") ? \"&\" : \"?\"\n\t}error=${error}&error_description=${description}`;\n}\n\nfunction getErrorURL(\n\tctx: GenericEndpointContext,\n\terror: string,\n\tdescription: string,\n) {\n\tconst baseURL =\n\t\tctx.context.options.onAPIError?.errorURL || `${ctx.context.baseURL}/error`;\n\tconst formattedURL = formatErrorURL(baseURL, error, description);\n\treturn formattedURL;\n}\n\nexport async function authorize(\n\tctx: GenericEndpointContext,\n\toptions: OIDCOptions,\n) {\n\tconst handleRedirect = (url: string) => {\n\t\tconst fromFetch = ctx.request?.headers.get(\"sec-fetch-mode\") === \"cors\";\n\t\tif (fromFetch) {\n\t\t\treturn ctx.json({\n\t\t\t\tredirect: true,\n\t\t\t\turl,\n\t\t\t});\n\t\t} else {\n\t\t\tthrow ctx.redirect(url);\n\t\t}\n\t};\n\n\tconst opts = {\n\t\tcodeExpiresIn: 600,\n\t\tdefaultScope: \"openid\",\n\t\t...options,\n\t\tscopes: [\n\t\t\t\"openid\",\n\t\t\t\"profile\",\n\t\t\t\"email\",\n\t\t\t\"offline_access\",\n\t\t\t...(options?.scopes || []),\n\t\t],\n\t};\n\tif (!ctx.request) {\n\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\terror_description: \"request not found\",\n\t\t\terror: \"invalid_request\",\n\t\t});\n\t}\n\tconst session = await getSessionFromCtx(ctx);\n\tif (!session) {\n\t\t// Handle prompt=none per OIDC spec - must return error instead of redirecting\n\t\tconst query = ctx.query as AuthorizationQuery;\n\t\tconst promptSet = parsePrompt(query.prompt ?? \"\");\n\t\tif (promptSet.has(\"none\") && query.redirect_uri) {\n\t\t\treturn handleRedirect(\n\t\t\t\tformatErrorURL(\n\t\t\t\t\tquery.redirect_uri,\n\t\t\t\t\t\"login_required\",\n\t\t\t\t\t\"Authentication required but prompt is none\",\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\n\t\t/**\n\t\t * If the user is not logged in, we need to redirect them to the\n\t\t * login page.\n\t\t */\n\t\tawait ctx.setSignedCookie(\n\t\t\t\"oidc_login_prompt\",\n\t\t\tJSON.stringify(ctx.query),\n\t\t\tctx.context.secret,\n\t\t\t{\n\t\t\t\tmaxAge: 600,\n\t\t\t\tpath: \"/\",\n\t\t\t\tsameSite: \"lax\",\n\t\t\t},\n\t\t);\n\t\tconst queryFromURL = ctx.request.url?.split(\"?\")[1]!;\n\t\treturn handleRedirect(`${options.loginPage}?${queryFromURL}`);\n\t}\n\n\tconst query = ctx.query as AuthorizationQuery;\n\tif (!query.client_id) {\n\t\tconst errorURL = getErrorURL(\n\t\t\tctx,\n\t\t\t\"invalid_client\",\n\t\t\t\"client_id is required\",\n\t\t);\n\t\tthrow ctx.redirect(errorURL);\n\t}\n\n\tif (!query.response_type) {\n\t\tconst errorURL = getErrorURL(\n\t\t\tctx,\n\t\t\t\"invalid_request\",\n\t\t\t\"response_type is required\",\n\t\t);\n\t\tthrow ctx.redirect(errorURL);\n\t}\n\n\tconst client = await getClient(\n\t\tctx.query.client_id,\n\t\toptions.trustedClients || [],\n\t);\n\tif (!client) {\n\t\tconst errorURL = getErrorURL(\n\t\t\tctx,\n\t\t\t\"invalid_client\",\n\t\t\t\"client_id is required\",\n\t\t);\n\t\tthrow ctx.redirect(errorURL);\n\t}\n\tconst redirectURI = client.redirectUrls.find(\n\t\t(url) => url === ctx.query.redirect_uri,\n\t);\n\n\tif (!redirectURI || !query.redirect_uri) {\n\t\t/**\n\t\t * show UI error here warning the user that the redirect URI is invalid\n\t\t */\n\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\tmessage: \"Invalid redirect URI\",\n\t\t});\n\t}\n\tif (client.disabled) {\n\t\tconst errorURL = getErrorURL(ctx, \"client_disabled\", \"client is disabled\");\n\t\tthrow ctx.redirect(errorURL);\n\t}\n\n\tif (query.response_type !== \"code\") {\n\t\tconst errorURL = getErrorURL(\n\t\t\tctx,\n\t\t\t\"unsupported_response_type\",\n\t\t\t\"unsupported response type\",\n\t\t);\n\t\tthrow ctx.redirect(errorURL);\n\t}\n\n\tconst requestScope =\n\t\tquery.scope?.split(\" \").filter((s) => s) ||\n\t\topts.defaultScope?.split(\" \") ||\n\t\t[];\n\tconst invalidScopes = requestScope.filter((scope) => {\n\t\treturn !opts.scopes.includes(scope);\n\t});\n\tif (invalidScopes.length) {\n\t\treturn handleRedirect(\n\t\t\tformatErrorURL(\n\t\t\t\tquery.redirect_uri,\n\t\t\t\t\"invalid_scope\",\n\t\t\t\t`The following scopes are invalid: ${invalidScopes.join(\", \")}`,\n\t\t\t),\n\t\t);\n\t}\n\n\tif (\n\t\t(!query.code_challenge || !query.code_challenge_method) &&\n\t\toptions.requirePKCE\n\t) {\n\t\treturn handleRedirect(\n\t\t\tformatErrorURL(query.redirect_uri, \"invalid_request\", \"pkce is required\"),\n\t\t);\n\t}\n\n\tif (!query.code_challenge_method) {\n\t\tquery.code_challenge_method = \"plain\";\n\t}\n\n\tif (\n\t\t![\n\t\t\t\"s256\",\n\t\t\toptions.allowPlainCodeChallengeMethod ? \"plain\" : \"s256\",\n\t\t].includes(query.code_challenge_method?.toLowerCase() || \"\")\n\t) {\n\t\treturn handleRedirect(\n\t\t\tformatErrorURL(\n\t\t\t\tquery.redirect_uri,\n\t\t\t\t\"invalid_request\",\n\t\t\t\t\"invalid code_challenge method\",\n\t\t\t),\n\t\t);\n\t}\n\n\tconst code = generateRandomString(32, \"a-z\", \"A-Z\", \"0-9\");\n\tconst codeExpiresInMs = opts.codeExpiresIn! * 1000;\n\tconst expiresAt = new Date(Date.now() + codeExpiresInMs);\n\n\t// Determine if consent is required\n\t// Consent is ALWAYS required unless:\n\t// 1. The client is trusted (skipConsent = true)\n\t// 2. The user has already consented and prompt is not \"consent\"\n\tconst skipConsentForTrustedClient = client.skipConsent;\n\tconst hasAlreadyConsented = await ctx.context.adapter\n\t\t.findOne<{\n\t\t\tconsentGiven: boolean;\n\t\t\tscopes: string;\n\t\t}>({\n\t\t\tmodel: \"oauthConsent\",\n\t\t\twhere: [\n\t\t\t\t{\n\t\t\t\t\tfield: \"clientId\",\n\t\t\t\t\tvalue: client.clientId,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\tvalue: session.user.id,\n\t\t\t\t},\n\t\t\t],\n\t\t})\n\t\t.then((res) => {\n\t\t\tif (!res?.consentGiven) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tconst consentedScopes = res.scopes ? res.scopes.split(\" \") : [];\n\t\t\tconst hasConsented = requestScope.every((scope) =>\n\t\t\t\tconsentedScopes.includes(scope),\n\t\t\t);\n\t\t\treturn hasConsented;\n\t\t});\n\n\tconst promptSet = parsePrompt(query.prompt ?? \"\");\n\n\t// Handle prompt=none per OIDC spec 3.1.2.1\n\t// The Authorization Server MUST NOT display any authentication or consent UI\n\tif (promptSet.has(\"none\")) {\n\t\t// If consent is required, return consent_required error\n\t\tif (!skipConsentForTrustedClient && !hasAlreadyConsented) {\n\t\t\treturn handleRedirect(\n\t\t\t\tformatErrorURL(\n\t\t\t\t\tquery.redirect_uri,\n\t\t\t\t\t\"consent_required\",\n\t\t\t\t\t\"Consent required but prompt is none\",\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\t\t// If we reach here, user is authenticated and consent is satisfied\n\t\t// Continue without any UI interaction\n\t}\n\n\t// Handle max_age parameter per OIDC spec 3.1.2.1\n\t// max_age=0 is equivalent to prompt=login\n\tlet requireLogin = promptSet.has(\"login\");\n\tif (query.max_age !== undefined) {\n\t\tconst maxAge = Number(query.max_age);\n\t\tif (Number.isInteger(maxAge) && maxAge >= 0) {\n\t\t\tconst sessionAge =\n\t\t\t\t(Date.now() - new Date(session.session.createdAt).getTime()) / 1000;\n\t\t\tif (sessionAge > maxAge) {\n\t\t\t\t// Session is older than max_age, force re-authentication\n\t\t\t\trequireLogin = true;\n\t\t\t}\n\t\t}\n\t\t// If max_age is invalid (not a non-negative integer), ignore it per OIDC spec\n\t}\n\n\tconst requireConsent =\n\t\t!skipConsentForTrustedClient &&\n\t\t(!hasAlreadyConsented || promptSet.has(\"consent\"));\n\n\ttry {\n\t\t/**\n\t\t * Save the code in the database\n\t\t */\n\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\tvalue: JSON.stringify({\n\t\t\t\tclientId: client.clientId,\n\t\t\t\tredirectURI: query.redirect_uri,\n\t\t\t\tscope: requestScope,\n\t\t\t\tuserId: session.user.id,\n\t\t\t\tauthTime: new Date(session.session.createdAt).getTime(),\n\t\t\t\t/**\n\t\t\t\t * Consent is required per OIDC spec unless:\n\t\t\t\t * 1. Client is trusted (skipConsent = true)\n\t\t\t\t * 2. User has already consented (and prompt is not \"consent\")\n\t\t\t\t *\n\t\t\t\t * When consent is required, the code needs to be treated as a\n\t\t\t\t * consent request. Once the user consents, the code will be\n\t\t\t\t * updated with the actual authorization code.\n\t\t\t\t */\n\t\t\t\trequireConsent,\n\t\t\t\tstate: requireConsent ? query.state : null,\n\t\t\t\tcodeChallenge: query.code_challenge,\n\t\t\t\tcodeChallengeMethod: query.code_challenge_method,\n\t\t\t\tnonce: query.nonce,\n\t\t\t}),\n\t\t\tidentifier: code,\n\t\t\texpiresAt,\n\t\t});\n\t} catch {\n\t\treturn handleRedirect(\n\t\t\tformatErrorURL(\n\t\t\t\tquery.redirect_uri,\n\t\t\t\t\"server_error\",\n\t\t\t\t\"An error occurred while processing the request\",\n\t\t\t),\n\t\t);\n\t}\n\n\tif (requireLogin) {\n\t\tawait ctx.setSignedCookie(\n\t\t\t\"oidc_login_prompt\",\n\t\t\tJSON.stringify(ctx.query),\n\t\t\tctx.context.secret,\n\t\t\t{\n\t\t\t\tmaxAge: 600,\n\t\t\t\tpath: \"/\",\n\t\t\t\tsameSite: \"lax\",\n\t\t\t},\n\t\t);\n\t\tawait ctx.setSignedCookie(\"oidc_consent_prompt\", code, ctx.context.secret, {\n\t\t\tmaxAge: 600,\n\t\t\tpath: \"/\",\n\t\t\tsameSite: \"lax\",\n\t\t});\n\n\t\tconst loginURI = `${options.loginPage}?${new URLSearchParams({\n\t\t\tclient_id: client.clientId,\n\t\t\tcode,\n\t\t\tstate: query.state,\n\t\t}).toString()}`;\n\t\treturn handleRedirect(loginURI);\n\t}\n\n\t// If consent is not required, redirect with the code immediately\n\tif (!requireConsent) {\n\t\tconst redirectURIWithCode = new URL(redirectURI);\n\t\tredirectURIWithCode.searchParams.set(\"code\", code);\n\t\tredirectURIWithCode.searchParams.set(\"state\", ctx.query.state);\n\t\treturn handleRedirect(redirectURIWithCode.toString());\n\t}\n\n\t// Consent is required - redirect to consent page or show consent HTML\n\n\tif (options?.consentPage) {\n\t\t// Set cookie to support cookie-based consent flows\n\t\tawait ctx.setSignedCookie(\"oidc_consent_prompt\", code, ctx.context.secret, {\n\t\t\tmaxAge: 600,\n\t\t\tpath: \"/\",\n\t\t\tsameSite: \"lax\",\n\t\t});\n\n\t\t// Pass the consent code as a URL parameter to support URL-based consent flows\n\t\tconst urlParams = new URLSearchParams();\n\t\turlParams.set(\"consent_code\", code);\n\t\turlParams.set(\"client_id\", client.clientId);\n\t\turlParams.set(\"scope\", requestScope.join(\" \"));\n\t\tconst consentURI = `${options.consentPage}?${urlParams.toString()}`;\n\n\t\treturn handleRedirect(consentURI);\n\t}\n\tconst htmlFn = options?.getConsentHTML;\n\n\tif (!htmlFn) {\n\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\tmessage: \"No consent page provided\",\n\t\t});\n\t}\n\n\treturn new Response(\n\t\thtmlFn({\n\t\t\tscopes: requestScope,\n\t\t\tclientMetadata: client.metadata,\n\t\t\tclientIcon: client?.icon,\n\t\t\tclientId: client.clientId,\n\t\t\tclientName: client.name,\n\t\t\tcode,\n\t\t}),\n\t\t{\n\t\t\theaders: {\n\t\t\t\t\"content-type\": \"text/html\",\n\t\t\t},\n\t\t},\n\t);\n}\n"],"names":["query"],"mappings":"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"}},
    {"offset": {"line": 8634, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/oidc-provider/schema.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/oidc-provider/schema.ts"],"sourcesContent":["import type { BetterAuthPluginDBSchema } from \"@better-auth/core/db\";\nimport * as z from \"zod\";\n\nconst oAuthApplicationSchema = z.object({\n\t/**\n\t * Client ID\n\t *\n\t * size 32\n\t *\n\t * as described on https://www.rfc-editor.org/rfc/rfc6749.html#section-2.2\n\t */\n\tclientId: z.string(),\n\t/**\n\t * Client Secret\n\t *\n\t * A secret for the client, if required by the authorization server.\n\t * Optional for public clients using PKCE.\n\t *\n\t * size 32\n\t */\n\tclientSecret: z.string().optional(),\n\t/**\n\t * The client type\n\t *\n\t * as described on https://www.rfc-editor.org/rfc/rfc6749.html#section-2.1\n\t *\n\t * - web - A web application\n\t * - native - A mobile application\n\t * - user-agent-based - A user-agent-based application\n\t * - public - A public client (PKCE-enabled, no client_secret)\n\t */\n\ttype: z.enum([\"web\", \"native\", \"user-agent-based\", \"public\"]),\n\t/**\n\t * The name of the client.\n\t */\n\tname: z.string(),\n\t/**\n\t * The icon of the client.\n\t */\n\ticon: z.string().optional(),\n\t/**\n\t * Additional metadata about the client.\n\t */\n\tmetadata: z.string().optional(),\n\t/**\n\t * Whether the client is disabled or not.\n\t */\n\tdisabled: z.boolean().optional().default(false),\n\n\t// Database fields\n\tredirectUrls: z.string(),\n\tuserId: z.string().optional(),\n\tcreatedAt: z.date(),\n\tupdatedAt: z.date(),\n});\n\nexport type OAuthApplication = z.infer<typeof oAuthApplicationSchema>;\n\nexport const schema = {\n\toauthApplication: {\n\t\tmodelName: \"oauthApplication\",\n\t\tfields: {\n\t\t\tname: {\n\t\t\t\ttype: \"string\",\n\t\t\t},\n\t\t\ticon: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: false,\n\t\t\t},\n\t\t\tmetadata: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: false,\n\t\t\t},\n\t\t\tclientId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\tunique: true,\n\t\t\t},\n\t\t\tclientSecret: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: false,\n\t\t\t},\n\t\t\tredirectUrls: {\n\t\t\t\ttype: \"string\",\n\t\t\t},\n\t\t\ttype: {\n\t\t\t\ttype: \"string\",\n\t\t\t},\n\t\t\tdisabled: {\n\t\t\t\ttype: \"boolean\",\n\t\t\t\trequired: false,\n\t\t\t\tdefaultValue: false,\n\t\t\t},\n\t\t\tuserId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: false,\n\t\t\t\treferences: {\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tonDelete: \"cascade\",\n\t\t\t\t},\n\t\t\t\tindex: true,\n\t\t\t},\n\t\t\tcreatedAt: {\n\t\t\t\ttype: \"date\",\n\t\t\t},\n\t\t\tupdatedAt: {\n\t\t\t\ttype: \"date\",\n\t\t\t},\n\t\t},\n\t},\n\toauthAccessToken: {\n\t\tmodelName: \"oauthAccessToken\",\n\t\tfields: {\n\t\t\taccessToken: {\n\t\t\t\ttype: \"string\",\n\t\t\t\tunique: true,\n\t\t\t},\n\t\t\trefreshToken: {\n\t\t\t\ttype: \"string\",\n\t\t\t\tunique: true,\n\t\t\t},\n\t\t\taccessTokenExpiresAt: {\n\t\t\t\ttype: \"date\",\n\t\t\t},\n\t\t\trefreshTokenExpiresAt: {\n\t\t\t\ttype: \"date\",\n\t\t\t},\n\t\t\tclientId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\treferences: {\n\t\t\t\t\tmodel: \"oauthApplication\",\n\t\t\t\t\tfield: \"clientId\",\n\t\t\t\t\tonDelete: \"cascade\",\n\t\t\t\t},\n\t\t\t\tindex: true,\n\t\t\t},\n\t\t\tuserId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: false,\n\t\t\t\treferences: {\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tonDelete: \"cascade\",\n\t\t\t\t},\n\t\t\t\tindex: true,\n\t\t\t},\n\t\t\tscopes: {\n\t\t\t\ttype: \"string\",\n\t\t\t},\n\t\t\tcreatedAt: {\n\t\t\t\ttype: \"date\",\n\t\t\t},\n\t\t\tupdatedAt: {\n\t\t\t\ttype: \"date\",\n\t\t\t},\n\t\t},\n\t},\n\toauthConsent: {\n\t\tmodelName: \"oauthConsent\",\n\t\tfields: {\n\t\t\tclientId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\treferences: {\n\t\t\t\t\tmodel: \"oauthApplication\",\n\t\t\t\t\tfield: \"clientId\",\n\t\t\t\t\tonDelete: \"cascade\",\n\t\t\t\t},\n\t\t\t\tindex: true,\n\t\t\t},\n\t\t\tuserId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\treferences: {\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tonDelete: \"cascade\",\n\t\t\t\t},\n\t\t\t\tindex: true,\n\t\t\t},\n\t\t\tscopes: {\n\t\t\t\ttype: \"string\",\n\t\t\t},\n\t\t\tcreatedAt: {\n\t\t\t\ttype: \"date\",\n\t\t\t},\n\t\t\tupdatedAt: {\n\t\t\t\ttype: \"date\",\n\t\t\t},\n\t\t\tconsentGiven: {\n\t\t\t\ttype: \"boolean\",\n\t\t\t},\n\t\t},\n\t},\n} satisfies BetterAuthPluginDBSchema;\n"],"names":[],"mappings":";;;;;;;AAG+B,EAAE,yJAAA,CAAO;IAQvC,UAAU,EAAE,yJAAA,EAAQ;IASpB,cAAc,EAAE,yJAAA,EAAQ,CAAC,QAAA,EAAU;IAWnC,MAAM,EAAE,uJAAA,CAAK;QAAC;QAAO;QAAU;QAAoB;KAAS,CAAC;IAI7D,MAAM,EAAE,yJAAA,EAAQ;IAIhB,MAAM,EAAE,yJAAA,EAAQ,CAAC,QAAA,EAAU;IAI3B,UAAU,EAAE,yJAAA,EAAQ,CAAC,QAAA,EAAU;IAI/B,UAAU,EAAE,0JAAA,EAAS,CAAC,QAAA,EAAU,CAAC,OAAA,CAAQ,MAAM;IAG/C,cAAc,EAAE,yJAAA,EAAQ;IACxB,QAAQ,EAAE,yJAAA,EAAQ,CAAC,QAAA,EAAU;IAC7B,WAAW,EAAE,uJAAA,EAAM;IACnB,WAAW,EAAE,uJAAA,EAAM;CACnB,CAAC;AAIF,MAAa,SAAS;IACrB,kBAAkB;QACjB,WAAW;QACX,QAAQ;YACP,MAAM;gBACL,MAAM;YAAA,CACN;YACD,MAAM;gBACL,MAAM;gBACN,UAAU;aACV;YACD,UAAU;gBACT,MAAM;gBACN,UAAU;aACV;YACD,UAAU;gBACT,MAAM;gBACN,QAAQ;aACR;YACD,cAAc;gBACb,MAAM;gBACN,UAAU;aACV;YACD,cAAc;gBACb,MAAM;YAAA,CACN;YACD,MAAM;gBACL,MAAM;YAAA,CACN;YACD,UAAU;gBACT,MAAM;gBACN,UAAU;gBACV,cAAc;aACd;YACD,QAAQ;gBACP,MAAM;gBACN,UAAU;gBACV,YAAY;oBACX,OAAO;oBACP,OAAO;oBACP,UAAU;iBACV;gBACD,OAAO;aACP;YACD,WAAW;gBACV,MAAM;YAAA,CACN;YACD,WAAW;gBACV,MAAM;YAAA,CACN;SACD;KACD;IACD,kBAAkB;QACjB,WAAW;QACX,QAAQ;YACP,aAAa;gBACZ,MAAM;gBACN,QAAQ;aACR;YACD,cAAc;gBACb,MAAM;gBACN,QAAQ;aACR;YACD,sBAAsB;gBACrB,MAAM;YAAA,CACN;YACD,uBAAuB;gBACtB,MAAM;YAAA,CACN;YACD,UAAU;gBACT,MAAM;gBACN,YAAY;oBACX,OAAO;oBACP,OAAO;oBACP,UAAU;iBACV;gBACD,OAAO;aACP;YACD,QAAQ;gBACP,MAAM;gBACN,UAAU;gBACV,YAAY;oBACX,OAAO;oBACP,OAAO;oBACP,UAAU;iBACV;gBACD,OAAO;aACP;YACD,QAAQ;gBACP,MAAM;YAAA,CACN;YACD,WAAW;gBACV,MAAM;YAAA,CACN;YACD,WAAW;gBACV,MAAM;YAAA,CACN;SACD;KACD;IACD,cAAc;QACb,WAAW;QACX,QAAQ;YACP,UAAU;gBACT,MAAM;gBACN,YAAY;oBACX,OAAO;oBACP,OAAO;oBACP,UAAU;iBACV;gBACD,OAAO;aACP;YACD,QAAQ;gBACP,MAAM;gBACN,YAAY;oBACX,OAAO;oBACP,OAAO;oBACP,UAAU;iBACV;gBACD,OAAO;aACP;YACD,QAAQ;gBACP,MAAM;YAAA,CACN;YACD,WAAW;gBACV,MAAM;YAAA,CACN;YACD,WAAW;gBACV,MAAM;YAAA,CACN;YACD,cAAc;gBACb,MAAM;YAAA,CACN;SACD;KACD;CACD"}},
    {"offset": {"line": 8800, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/oidc-provider/utils.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/oidc-provider/utils.ts"],"sourcesContent":["import { base64Url } from \"@better-auth/utils/base64\";\nimport { createHash } from \"@better-auth/utils/hash\";\n\n/**\n * Default client secret hasher using SHA-256\n */\nexport const defaultClientSecretHasher = async (clientSecret: string) => {\n\tconst hash = await createHash(\"SHA-256\").digest(\n\t\tnew TextEncoder().encode(clientSecret),\n\t);\n\tconst hashed = base64Url.encode(new Uint8Array(hash), {\n\t\tpadding: false,\n\t});\n\treturn hashed;\n};\n"],"names":[],"mappings":";;;;;;;;;;;GAMA,MAAa,4BAA4B,OAAO,iBAAyB;IACxE,MAAM,OAAO,UAAM,0KAAA,EAAW,UAAU,CAAC,MAAA,CACxC,IAAI,aAAa,CAAC,MAAA,CAAO,aAAa,CACtC;IAID,OAHe,2KAAA,CAAU,MAAA,CAAO,IAAI,WAAW,KAAK,EAAE;QACrD,SAAS;IAAA,CACT,CAAC"}},
    {"offset": {"line": 8823, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/oidc-provider/index.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/oidc-provider/index.ts"],"sourcesContent":["import type {\n\tBetterAuthPlugin,\n\tGenericEndpointContext,\n} from \"@better-auth/core\";\nimport {\n\tcreateAuthEndpoint,\n\tcreateAuthMiddleware,\n} from \"@better-auth/core/api\";\nimport { getCurrentAuthContext } from \"@better-auth/core/context\";\nimport { base64 } from \"@better-auth/utils/base64\";\nimport { createHash } from \"@better-auth/utils/hash\";\nimport type { OpenAPIParameter } from \"better-call\";\nimport { jwtVerify, SignJWT } from \"jose\";\nimport * as z from \"zod\";\nimport { APIError, getSessionFromCtx, sessionMiddleware } from \"../../api\";\nimport { expireCookie, parseSetCookieHeader } from \"../../cookies\";\nimport {\n\tgenerateRandomString,\n\tsymmetricDecrypt,\n\tsymmetricEncrypt,\n} from \"../../crypto\";\nimport { mergeSchema } from \"../../db\";\nimport { HIDE_METADATA } from \"../../utils\";\nimport type { jwt } from \"../jwt\";\nimport { getJwtToken, verifyJWT } from \"../jwt\";\nimport { authorize } from \"./authorize\";\nimport type { OAuthApplication } from \"./schema\";\nimport { schema } from \"./schema\";\nimport type {\n\tClient,\n\tCodeVerificationValue,\n\tOAuthAccessToken,\n\tOIDCMetadata,\n\tOIDCOptions,\n} from \"./types\";\nimport { defaultClientSecretHasher } from \"./utils\";\nimport { parsePrompt } from \"./utils/prompt\";\n\nconst getJwtPlugin = (ctx: GenericEndpointContext) => {\n\treturn ctx.context.getPlugin<ReturnType<typeof jwt>>(\"jwt\");\n};\n\n/**\n * Get a client by ID, checking trusted clients first, then database\n */\nexport async function getClient(\n\tclientId: string,\n\ttrustedClients: (Client & { skipConsent?: boolean | undefined })[] = [],\n): Promise<(Client & { skipConsent?: boolean | undefined }) | null> {\n\tconst {\n\t\tcontext: { adapter },\n\t} = await getCurrentAuthContext();\n\tconst trustedClient = trustedClients.find(\n\t\t(client) => client.clientId === clientId,\n\t);\n\tif (trustedClient) {\n\t\treturn trustedClient;\n\t}\n\treturn adapter\n\t\t.findOne<OAuthApplication>({\n\t\t\tmodel: \"oauthApplication\",\n\t\t\twhere: [{ field: \"clientId\", value: clientId }],\n\t\t})\n\t\t.then((res) => {\n\t\t\tif (!res) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\t// omit sensitive fields\n\t\t\treturn {\n\t\t\t\tclientId: res.clientId,\n\t\t\t\tclientSecret: res.clientSecret,\n\t\t\t\ttype: res.type,\n\t\t\t\tname: res.name,\n\t\t\t\ticon: res.icon,\n\t\t\t\tdisabled: res.disabled,\n\t\t\t\tredirectUrls: (res.redirectUrls ?? \"\").split(\",\"),\n\t\t\t\tmetadata: res.metadata ? JSON.parse(res.metadata) : {},\n\t\t\t} satisfies Client;\n\t\t});\n}\n\nexport const getMetadata = (\n\tctx: GenericEndpointContext,\n\toptions?: OIDCOptions | undefined,\n): OIDCMetadata => {\n\tconst jwtPlugin = getJwtPlugin(ctx);\n\tconst issuer =\n\t\tjwtPlugin && jwtPlugin.options?.jwt && jwtPlugin.options.jwt.issuer\n\t\t\t? jwtPlugin.options.jwt.issuer\n\t\t\t: (ctx.context.options.baseURL as string);\n\tconst baseURL = ctx.context.baseURL;\n\tconst supportedAlgs = options?.useJWTPlugin\n\t\t? [\"RS256\", \"EdDSA\", \"none\"]\n\t\t: [\"HS256\", \"none\"];\n\treturn {\n\t\tissuer,\n\t\tauthorization_endpoint: `${baseURL}/oauth2/authorize`,\n\t\ttoken_endpoint: `${baseURL}/oauth2/token`,\n\t\tuserinfo_endpoint: `${baseURL}/oauth2/userinfo`,\n\t\tjwks_uri: `${baseURL}/jwks`,\n\t\tregistration_endpoint: `${baseURL}/oauth2/register`,\n\t\tend_session_endpoint: `${baseURL}/oauth2/endsession`,\n\t\tscopes_supported: [\"openid\", \"profile\", \"email\", \"offline_access\"],\n\t\tresponse_types_supported: [\"code\"],\n\t\tresponse_modes_supported: [\"query\"],\n\t\tgrant_types_supported: [\"authorization_code\", \"refresh_token\"],\n\t\tacr_values_supported: [\n\t\t\t\"urn:mace:incommon:iap:silver\",\n\t\t\t\"urn:mace:incommon:iap:bronze\",\n\t\t],\n\t\tsubject_types_supported: [\"public\"],\n\t\tid_token_signing_alg_values_supported: supportedAlgs,\n\t\ttoken_endpoint_auth_methods_supported: [\n\t\t\t\"client_secret_basic\",\n\t\t\t\"client_secret_post\",\n\t\t\t\"none\",\n\t\t],\n\t\tcode_challenge_methods_supported: [\"S256\"],\n\t\tclaims_supported: [\n\t\t\t\"sub\",\n\t\t\t\"iss\",\n\t\t\t\"aud\",\n\t\t\t\"exp\",\n\t\t\t\"nbf\",\n\t\t\t\"iat\",\n\t\t\t\"jti\",\n\t\t\t\"email\",\n\t\t\t\"email_verified\",\n\t\t\t\"name\",\n\t\t],\n\t\t...options?.metadata,\n\t};\n};\n\nconst oAuthConsentBodySchema = z.object({\n\taccept: z.boolean(),\n\tconsent_code: z.string().optional().nullish(),\n});\n\nconst oAuth2TokenBodySchema = z.record(z.any(), z.any());\n\nconst registerOAuthApplicationBodySchema = z.object({\n\tredirect_uris: z.array(z.string()).meta({\n\t\tdescription:\n\t\t\t'A list of redirect URIs. Eg: [\"https://client.example.com/callback\"]',\n\t}),\n\ttoken_endpoint_auth_method: z\n\t\t.enum([\"none\", \"client_secret_basic\", \"client_secret_post\"])\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The authentication method for the token endpoint. Eg: \"client_secret_basic\"',\n\t\t})\n\t\t.default(\"client_secret_basic\")\n\t\t.optional(),\n\tgrant_types: z\n\t\t.array(\n\t\t\tz.enum([\n\t\t\t\t\"authorization_code\",\n\t\t\t\t\"implicit\",\n\t\t\t\t\"password\",\n\t\t\t\t\"client_credentials\",\n\t\t\t\t\"refresh_token\",\n\t\t\t\t\"urn:ietf:params:oauth:grant-type:jwt-bearer\",\n\t\t\t\t\"urn:ietf:params:oauth:grant-type:saml2-bearer\",\n\t\t\t]),\n\t\t)\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The grant types supported by the application. Eg: [\"authorization_code\"]',\n\t\t})\n\t\t.default([\"authorization_code\"])\n\t\t.optional(),\n\tresponse_types: z\n\t\t.array(z.enum([\"code\", \"token\"]))\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The response types supported by the application. Eg: [\"code\"]',\n\t\t})\n\t\t.default([\"code\"])\n\t\t.optional(),\n\tclient_name: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: 'The name of the application. Eg: \"My App\"',\n\t\t})\n\t\t.optional(),\n\tclient_uri: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The URI of the application. Eg: \"https://client.example.com\"',\n\t\t})\n\t\t.optional(),\n\tlogo_uri: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The URI of the application logo. Eg: \"https://client.example.com/logo.png\"',\n\t\t})\n\t\t.optional(),\n\tscope: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The scopes supported by the application. Separated by spaces. Eg: \"profile email\"',\n\t\t})\n\t\t.optional(),\n\tcontacts: z\n\t\t.array(z.string())\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The contact information for the application. Eg: [\"admin@example.com\"]',\n\t\t})\n\t\t.optional(),\n\ttos_uri: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The URI of the application terms of service. Eg: \"https://client.example.com/tos\"',\n\t\t})\n\t\t.optional(),\n\tpolicy_uri: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The URI of the application privacy policy. Eg: \"https://client.example.com/policy\"',\n\t\t})\n\t\t.optional(),\n\tjwks_uri: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The URI of the application JWKS. Eg: \"https://client.example.com/jwks\"',\n\t\t})\n\t\t.optional(),\n\tjwks: z\n\t\t.record(z.any(), z.any())\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The JWKS of the application. Eg: {\"keys\": [{\"kty\": \"RSA\", \"alg\": \"RS256\", \"use\": \"sig\", \"n\": \"...\", \"e\": \"...\"}]}',\n\t\t})\n\t\t.optional(),\n\tmetadata: z\n\t\t.record(z.any(), z.any())\n\t\t.meta({\n\t\t\tdescription: 'The metadata of the application. Eg: {\"key\": \"value\"}',\n\t\t})\n\t\t.optional(),\n\tsoftware_id: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: 'The software ID of the application. Eg: \"my-software\"',\n\t\t})\n\t\t.optional(),\n\tsoftware_version: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: 'The software version of the application. Eg: \"1.0.0\"',\n\t\t})\n\t\t.optional(),\n\tsoftware_statement: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: \"The software statement of the application.\",\n\t\t})\n\t\t.optional(),\n});\n\nconst DEFAULT_CODE_EXPIRES_IN = 600;\nconst DEFAULT_ACCESS_TOKEN_EXPIRES_IN = 3600;\nconst DEFAULT_REFRESH_TOKEN_EXPIRES_IN = 604800;\n\n/**\n * OpenID Connect (OIDC) plugin for Better Auth. This plugin implements the\n * authorization code flow and the token exchange flow. It also implements the\n * userinfo endpoint.\n *\n * @param options - The options for the OIDC plugin.\n * @returns A Better Auth plugin.\n */\nexport const oidcProvider = (options: OIDCOptions) => {\n\tconst modelName = {\n\t\toauthClient: \"oauthApplication\",\n\t\toauthAccessToken: \"oauthAccessToken\",\n\t\toauthConsent: \"oauthConsent\",\n\t};\n\n\tconst opts = {\n\t\tcodeExpiresIn: DEFAULT_CODE_EXPIRES_IN,\n\t\tdefaultScope: \"openid\",\n\t\taccessTokenExpiresIn: DEFAULT_ACCESS_TOKEN_EXPIRES_IN,\n\t\trefreshTokenExpiresIn: DEFAULT_REFRESH_TOKEN_EXPIRES_IN,\n\t\tallowPlainCodeChallengeMethod: true,\n\t\tstoreClientSecret: \"plain\" as const,\n\t\t...options,\n\t\tscopes: [\n\t\t\t\"openid\",\n\t\t\t\"profile\",\n\t\t\t\"email\",\n\t\t\t\"offline_access\",\n\t\t\t...(options?.scopes || []),\n\t\t],\n\t};\n\n\tconst trustedClients = options.trustedClients || [];\n\n\t/**\n\t * Store client secret according to the configured storage method\n\t */\n\tasync function storeClientSecret(\n\t\tctx: GenericEndpointContext,\n\t\tclientSecret: string,\n\t) {\n\t\tif (opts.storeClientSecret === \"encrypted\") {\n\t\t\treturn await symmetricEncrypt({\n\t\t\t\tkey: ctx.context.secret,\n\t\t\t\tdata: clientSecret,\n\t\t\t});\n\t\t}\n\t\tif (opts.storeClientSecret === \"hashed\") {\n\t\t\treturn await defaultClientSecretHasher(clientSecret);\n\t\t}\n\t\tif (\n\t\t\ttypeof opts.storeClientSecret === \"object\" &&\n\t\t\t\"hash\" in opts.storeClientSecret\n\t\t) {\n\t\t\treturn await opts.storeClientSecret.hash(clientSecret);\n\t\t}\n\t\tif (\n\t\t\ttypeof opts.storeClientSecret === \"object\" &&\n\t\t\t\"encrypt\" in opts.storeClientSecret\n\t\t) {\n\t\t\treturn await opts.storeClientSecret.encrypt(clientSecret);\n\t\t}\n\n\t\treturn clientSecret;\n\t}\n\n\t/**\n\t * Verify stored client secret against provided client secret\n\t */\n\tasync function verifyStoredClientSecret(\n\t\tctx: GenericEndpointContext,\n\t\tstoredClientSecret: string,\n\t\tclientSecret: string,\n\t): Promise<boolean> {\n\t\tif (opts.storeClientSecret === \"encrypted\") {\n\t\t\treturn (\n\t\t\t\t(await symmetricDecrypt({\n\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\tdata: storedClientSecret,\n\t\t\t\t})) === clientSecret\n\t\t\t);\n\t\t}\n\t\tif (opts.storeClientSecret === \"hashed\") {\n\t\t\tconst hashedClientSecret = await defaultClientSecretHasher(clientSecret);\n\t\t\treturn hashedClientSecret === storedClientSecret;\n\t\t}\n\t\tif (\n\t\t\ttypeof opts.storeClientSecret === \"object\" &&\n\t\t\t\"hash\" in opts.storeClientSecret\n\t\t) {\n\t\t\tconst hashedClientSecret =\n\t\t\t\tawait opts.storeClientSecret.hash(clientSecret);\n\t\t\treturn hashedClientSecret === storedClientSecret;\n\t\t}\n\t\tif (\n\t\t\ttypeof opts.storeClientSecret === \"object\" &&\n\t\t\t\"decrypt\" in opts.storeClientSecret\n\t\t) {\n\t\t\tconst decryptedClientSecret =\n\t\t\t\tawait opts.storeClientSecret.decrypt(storedClientSecret);\n\t\t\treturn decryptedClientSecret === clientSecret;\n\t\t}\n\n\t\treturn clientSecret === storedClientSecret;\n\t}\n\n\treturn {\n\t\tid: \"oidc\",\n\t\thooks: {\n\t\t\tafter: [\n\t\t\t\t{\n\t\t\t\t\tmatcher() {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tconst loginPromptCookie = await ctx.getSignedCookie(\n\t\t\t\t\t\t\t\"oidc_login_prompt\",\n\t\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst cookieName = ctx.context.authCookies.sessionToken.name;\n\t\t\t\t\t\tconst parsedSetCookieHeader = parseSetCookieHeader(\n\t\t\t\t\t\t\tctx.context.responseHeaders?.get(\"set-cookie\") || \"\",\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst hasSessionToken = parsedSetCookieHeader.has(cookieName);\n\t\t\t\t\t\tif (!loginPromptCookie || !hasSessionToken) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\texpireCookie(ctx, {\n\t\t\t\t\t\t\tname: \"oidc_login_prompt\",\n\t\t\t\t\t\t\tattributes: { path: \"/\" },\n\t\t\t\t\t\t});\n\t\t\t\t\t\tconst sessionCookie = parsedSetCookieHeader.get(cookieName)?.value;\n\t\t\t\t\t\tconst sessionToken = sessionCookie?.split(\".\")[0]!;\n\t\t\t\t\t\tif (!sessionToken) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst session =\n\t\t\t\t\t\t\t(await ctx.context.internalAdapter.findSession(sessionToken)) ||\n\t\t\t\t\t\t\tctx.context.newSession;\n\t\t\t\t\t\tif (!session) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tctx.query = JSON.parse(loginPromptCookie);\n\n\t\t\t\t\t\t// Remove \"login\" from prompt since user just logged in\n\t\t\t\t\t\tconst promptSet = parsePrompt(String(ctx.query?.prompt));\n\t\t\t\t\t\tif (promptSet.has(\"login\")) {\n\t\t\t\t\t\t\tconst newPromptSet = new Set(promptSet);\n\t\t\t\t\t\t\tnewPromptSet.delete(\"login\");\n\t\t\t\t\t\t\tctx.query = {\n\t\t\t\t\t\t\t\t...ctx.query,\n\t\t\t\t\t\t\t\tprompt: Array.from(newPromptSet).join(\" \"),\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tctx.context.session = session;\n\t\t\t\t\t\tconst response = await authorize(ctx, opts);\n\t\t\t\t\t\treturn response;\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\tendpoints: {\n\t\t\tgetOpenIdConfig: createAuthEndpoint(\n\t\t\t\t\"/.well-known/openid-configuration\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\toperationId: \"getOpenIdConfig\",\n\t\t\t\t\tmetadata: HIDE_METADATA,\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tconst metadata = getMetadata(ctx, options);\n\t\t\t\t\treturn ctx.json(metadata);\n\t\t\t\t},\n\t\t\t),\n\t\t\toAuth2authorize: createAuthEndpoint(\n\t\t\t\t\"/oauth2/authorize\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\toperationId: \"oauth2Authorize\",\n\t\t\t\t\tquery: z.record(z.string(), z.any()),\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\tdescription: \"Authorize an OAuth2 request\",\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\t\t\tdescription: \"Authorization response generated successfully\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tadditionalProperties: true,\n\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Authorization response, contents depend on the authorize function implementation\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\treturn authorize(ctx, opts);\n\t\t\t\t},\n\t\t\t),\n\t\t\toAuthConsent: createAuthEndpoint(\n\t\t\t\t\"/oauth2/consent\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\toperationId: \"oauth2Consent\",\n\t\t\t\t\tbody: oAuthConsentBodySchema,\n\t\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\"Handle OAuth2 consent. Supports both URL parameter-based flows (consent_code in body) and cookie-based flows (signed cookie).\",\n\t\t\t\t\t\t\trequestBody: {\n\t\t\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\taccept: {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Whether the user accepts or denies the consent request\",\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\tconsent_code: {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"The consent code from the authorization request. Optional if using cookie-based flow.\",\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\trequired: [\"accept\"],\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\t\t\tdescription: \"Consent processed successfully\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tredirectURI: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"uri\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"The URI to redirect to, either with an authorization code or an error\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\trequired: [\"redirectURI\"],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\t// Support both consent flow methods:\n\t\t\t\t\t// 1. URL parameter-based: consent_code in request body (standard OAuth2 pattern)\n\t\t\t\t\t// 2. Cookie-based: using signed cookie for stateful consent flows\n\t\t\t\t\tlet consentCode: string | null = ctx.body.consent_code || null;\n\n\t\t\t\t\tif (!consentCode) {\n\t\t\t\t\t\t// Check for cookie-based consent flow\n\t\t\t\t\t\tconst cookieValue = await ctx.getSignedCookie(\n\t\t\t\t\t\t\t\"oidc_consent_prompt\",\n\t\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (cookieValue) {\n\t\t\t\t\t\t\tconsentCode = cookieValue;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!consentCode) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description:\n\t\t\t\t\t\t\t\t\"consent_code is required (either in body or cookie)\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tconst verification =\n\t\t\t\t\t\tawait ctx.context.internalAdapter.findVerificationValue(\n\t\t\t\t\t\t\tconsentCode,\n\t\t\t\t\t\t);\n\t\t\t\t\tif (!verification) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"Invalid code\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (verification.expiresAt < new Date()) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"Code expired\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// Clear the cookie\n\t\t\t\t\texpireCookie(ctx, {\n\t\t\t\t\t\tname: \"oidc_consent_prompt\",\n\t\t\t\t\t\tattributes: { path: \"/\" },\n\t\t\t\t\t});\n\n\t\t\t\t\tconst value = JSON.parse(verification.value) as CodeVerificationValue;\n\t\t\t\t\tif (!value.requireConsent) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"Consent not required\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!ctx.body.accept) {\n\t\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(\n\t\t\t\t\t\t\tverification.id,\n\t\t\t\t\t\t);\n\t\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\t\tredirectURI: `${value.redirectURI}?error=access_denied&error_description=User denied access`,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst code = generateRandomString(32, \"a-z\", \"A-Z\", \"0-9\");\n\t\t\t\t\tconst codeExpiresInMs =\n\t\t\t\t\t\t(opts?.codeExpiresIn ?? DEFAULT_CODE_EXPIRES_IN) * 1000;\n\t\t\t\t\tconst expiresAt = new Date(Date.now() + codeExpiresInMs);\n\t\t\t\t\tawait ctx.context.internalAdapter.updateVerificationValue(\n\t\t\t\t\t\tverification.id,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvalue: JSON.stringify({\n\t\t\t\t\t\t\t\t...value,\n\t\t\t\t\t\t\t\trequireConsent: false,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\tidentifier: code,\n\t\t\t\t\t\t\texpiresAt,\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\t\tmodel: modelName.oauthConsent,\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tclientId: value.clientId,\n\t\t\t\t\t\t\tuserId: value.userId,\n\t\t\t\t\t\t\tscopes: value.scope.join(\" \"),\n\t\t\t\t\t\t\tconsentGiven: true,\n\t\t\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t\t\t\tupdatedAt: new Date(),\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\tconst redirectURI = new URL(value.redirectURI);\n\t\t\t\t\tredirectURI.searchParams.set(\"code\", code);\n\t\t\t\t\tif (value.state) redirectURI.searchParams.set(\"state\", value.state);\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\tredirectURI: redirectURI.toString(),\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t),\n\t\t\toAuth2token: createAuthEndpoint(\n\t\t\t\t\"/oauth2/token\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\toperationId: \"oauth2Token\",\n\t\t\t\t\tbody: oAuth2TokenBodySchema,\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\t...HIDE_METADATA,\n\t\t\t\t\t\tallowedMediaTypes: [\n\t\t\t\t\t\t\t\"application/x-www-form-urlencoded\",\n\t\t\t\t\t\t\t\"application/json\",\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tlet { body } = ctx;\n\t\t\t\t\tif (!body) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\terror_description: \"request body not found\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (body instanceof FormData) {\n\t\t\t\t\t\tbody = Object.fromEntries(body.entries());\n\t\t\t\t\t}\n\t\t\t\t\tif (!(body instanceof Object)) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\terror_description: \"request body is not an object\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tlet { client_id, client_secret } = body;\n\t\t\t\t\tconst authorization =\n\t\t\t\t\t\tctx.request?.headers.get(\"authorization\") || null;\n\t\t\t\t\tif (\n\t\t\t\t\t\tauthorization &&\n\t\t\t\t\t\t!client_id &&\n\t\t\t\t\t\t!client_secret &&\n\t\t\t\t\t\tauthorization.startsWith(\"Basic \")\n\t\t\t\t\t) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst encoded = authorization.replace(\"Basic \", \"\");\n\t\t\t\t\t\t\tconst decoded = new TextDecoder().decode(base64.decode(encoded));\n\t\t\t\t\t\t\tif (!decoded.includes(\":\")) {\n\t\t\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\t\t\terror_description: \"invalid authorization header format\",\n\t\t\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconst [id, secret] = decoded.split(\":\");\n\t\t\t\t\t\t\tif (!id || !secret) {\n\t\t\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\t\t\terror_description: \"invalid authorization header format\",\n\t\t\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tclient_id = id;\n\t\t\t\t\t\t\tclient_secret = secret;\n\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\t\terror_description: \"invalid authorization header format\",\n\t\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tconst now = Date.now();\n\t\t\t\t\tconst iat = Math.floor(now / 1000);\n\t\t\t\t\tconst exp = iat + (opts.accessTokenExpiresIn ?? 3600);\n\n\t\t\t\t\tconst accessTokenExpiresAt = new Date(exp * 1000);\n\t\t\t\t\tconst refreshTokenExpiresAt = new Date(\n\t\t\t\t\t\t(iat + (opts.refreshTokenExpiresIn ?? 604800)) * 1000,\n\t\t\t\t\t);\n\n\t\t\t\t\tconst {\n\t\t\t\t\t\tgrant_type,\n\t\t\t\t\t\tcode,\n\t\t\t\t\t\tredirect_uri,\n\t\t\t\t\t\trefresh_token,\n\t\t\t\t\t\tcode_verifier,\n\t\t\t\t\t} = body;\n\t\t\t\t\tif (grant_type === \"refresh_token\") {\n\t\t\t\t\t\tif (!refresh_token) {\n\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\terror_description: \"refresh_token is required\",\n\t\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst token = await ctx.context.adapter.findOne<OAuthAccessToken>({\n\t\t\t\t\t\t\tmodel: modelName.oauthAccessToken,\n\t\t\t\t\t\t\twhere: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tfield: \"refreshToken\",\n\t\t\t\t\t\t\t\t\tvalue: refresh_token.toString(),\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (!token) {\n\t\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\t\terror_description: \"invalid refresh token\",\n\t\t\t\t\t\t\t\terror: \"invalid_grant\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (token.clientId !== client_id?.toString()) {\n\t\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\t\terror_description: \"invalid client_id\",\n\t\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (token.refreshTokenExpiresAt < new Date()) {\n\t\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\t\terror_description: \"refresh token expired\",\n\t\t\t\t\t\t\t\terror: \"invalid_grant\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst accessToken = generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\t\t\tconst newRefreshToken = generateRandomString(32, \"a-z\", \"A-Z\");\n\n\t\t\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\t\t\tmodel: modelName.oauthAccessToken,\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\taccessToken,\n\t\t\t\t\t\t\t\trefreshToken: newRefreshToken,\n\t\t\t\t\t\t\t\taccessTokenExpiresAt,\n\t\t\t\t\t\t\t\trefreshTokenExpiresAt,\n\t\t\t\t\t\t\t\tclientId: client_id.toString(),\n\t\t\t\t\t\t\t\tuserId: token.userId,\n\t\t\t\t\t\t\t\tscopes: token.scopes,\n\t\t\t\t\t\t\t\tcreatedAt: new Date(iat * 1000),\n\t\t\t\t\t\t\t\tupdatedAt: new Date(iat * 1000),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\t\taccess_token: accessToken,\n\t\t\t\t\t\t\ttoken_type: \"Bearer\",\n\t\t\t\t\t\t\texpires_in: opts.accessTokenExpiresIn,\n\t\t\t\t\t\t\trefresh_token: newRefreshToken,\n\t\t\t\t\t\t\tscope: token.scopes,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!code) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\terror_description: \"code is required\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (options.requirePKCE && !code_verifier) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\terror_description: \"code verifier is missing\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t/**\n\t\t\t\t\t * We need to check if the code is valid before we can proceed\n\t\t\t\t\t * with the rest of the request.\n\t\t\t\t\t */\n\t\t\t\t\tconst verificationValue =\n\t\t\t\t\t\tawait ctx.context.internalAdapter.findVerificationValue(\n\t\t\t\t\t\t\tcode.toString(),\n\t\t\t\t\t\t);\n\t\t\t\t\tif (!verificationValue) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"invalid code\",\n\t\t\t\t\t\t\terror: \"invalid_grant\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (verificationValue.expiresAt < new Date()) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"code expired\",\n\t\t\t\t\t\t\terror: \"invalid_grant\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(\n\t\t\t\t\t\tverificationValue.id,\n\t\t\t\t\t);\n\t\t\t\t\tif (!client_id) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"client_id is required\",\n\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (!grant_type) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\terror_description: \"grant_type is required\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (grant_type !== \"authorization_code\") {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\terror_description: \"grant_type must be 'authorization_code'\",\n\t\t\t\t\t\t\terror: \"unsupported_grant_type\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!redirect_uri) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\terror_description: \"redirect_uri is required\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tconst client = await getClient(client_id.toString(), trustedClients);\n\t\t\t\t\tif (!client) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"invalid client_id\",\n\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (client.disabled) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"client is disabled\",\n\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tconst value = JSON.parse(\n\t\t\t\t\t\tverificationValue.value,\n\t\t\t\t\t) as CodeVerificationValue;\n\t\t\t\t\tif (value.clientId !== client_id.toString()) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"invalid client_id\",\n\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (value.redirectURI !== redirect_uri.toString()) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"invalid redirect_uri\",\n\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (value.codeChallenge && !code_verifier) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\terror_description: \"code verifier is missing\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (client.type === \"public\") {\n\t\t\t\t\t\t// For public clients (type: 'public'), validate PKCE instead of client_secret\n\t\t\t\t\t\tif (!code_verifier) {\n\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\terror_description:\n\t\t\t\t\t\t\t\t\t\"code verifier is required for public clients\",\n\t\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// PKCE validation happens later in the flow, so we skip client_secret validation\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (!client.clientSecret || !client_secret) {\n\t\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\t\terror_description:\n\t\t\t\t\t\t\t\t\t\"client_secret is required for confidential clients\",\n\t\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst isValidSecret = await verifyStoredClientSecret(\n\t\t\t\t\t\t\tctx,\n\t\t\t\t\t\t\tclient.clientSecret,\n\t\t\t\t\t\t\tclient_secret.toString(),\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (!isValidSecret) {\n\t\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\t\terror_description: \"invalid client_secret\",\n\t\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tconst challenge =\n\t\t\t\t\t\tvalue.codeChallengeMethod === \"plain\"\n\t\t\t\t\t\t\t? code_verifier\n\t\t\t\t\t\t\t: await createHash(\"SHA-256\", \"base64urlnopad\").digest(\n\t\t\t\t\t\t\t\t\tcode_verifier,\n\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\tif (challenge !== value.codeChallenge) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"code verification failed\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tconst requestedScopes = value.scope;\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(\n\t\t\t\t\t\tverificationValue.id,\n\t\t\t\t\t);\n\t\t\t\t\tconst accessToken = generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\t\tconst refreshToken = generateRandomString(32, \"A-Z\", \"a-z\");\n\t\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\t\tmodel: modelName.oauthAccessToken,\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\taccessToken,\n\t\t\t\t\t\t\trefreshToken,\n\t\t\t\t\t\t\taccessTokenExpiresAt,\n\t\t\t\t\t\t\trefreshTokenExpiresAt,\n\t\t\t\t\t\t\tclientId: client_id.toString(),\n\t\t\t\t\t\t\tuserId: value.userId,\n\t\t\t\t\t\t\tscopes: requestedScopes.join(\" \"),\n\t\t\t\t\t\t\tcreatedAt: new Date(iat * 1000),\n\t\t\t\t\t\t\tupdatedAt: new Date(iat * 1000),\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\tconst user = await ctx.context.internalAdapter.findUserById(\n\t\t\t\t\t\tvalue.userId,\n\t\t\t\t\t);\n\t\t\t\t\tif (!user) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"user not found\",\n\t\t\t\t\t\t\terror: \"invalid_grant\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tconst profile = {\n\t\t\t\t\t\tgiven_name: user.name.split(\" \")[0]!,\n\t\t\t\t\t\tfamily_name: user.name.split(\" \")[1]!,\n\t\t\t\t\t\tname: user.name,\n\t\t\t\t\t\tprofile: user.image,\n\t\t\t\t\t\tupdated_at: new Date(user.updatedAt).toISOString(),\n\t\t\t\t\t};\n\t\t\t\t\tconst email = {\n\t\t\t\t\t\temail: user.email,\n\t\t\t\t\t\temail_verified: user.emailVerified,\n\t\t\t\t\t};\n\t\t\t\t\tconst userClaims = {\n\t\t\t\t\t\t...(requestedScopes.includes(\"profile\") ? profile : {}),\n\t\t\t\t\t\t...(requestedScopes.includes(\"email\") ? email : {}),\n\t\t\t\t\t};\n\n\t\t\t\t\tconst additionalUserClaims = options.getAdditionalUserInfoClaim\n\t\t\t\t\t\t? await options.getAdditionalUserInfoClaim(\n\t\t\t\t\t\t\t\tuser,\n\t\t\t\t\t\t\t\trequestedScopes,\n\t\t\t\t\t\t\t\tclient,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t: {};\n\n\t\t\t\t\tconst payload = {\n\t\t\t\t\t\tsub: user.id,\n\t\t\t\t\t\taud: client_id.toString(),\n\t\t\t\t\t\tiat: iat,\n\t\t\t\t\t\tauth_time: ctx.context.session\n\t\t\t\t\t\t\t? new Date(ctx.context.session.session.createdAt).getTime()\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\tnonce: value.nonce,\n\t\t\t\t\t\tacr: \"urn:mace:incommon:iap:silver\", // default to silver -  this should be configurable and should be validated against the client's metadata\n\t\t\t\t\t\t...userClaims,\n\t\t\t\t\t\t...additionalUserClaims,\n\t\t\t\t\t};\n\t\t\t\t\tconst expirationTime =\n\t\t\t\t\t\tMath.floor(Date.now() / 1000) +\n\t\t\t\t\t\t(opts?.accessTokenExpiresIn ?? DEFAULT_ACCESS_TOKEN_EXPIRES_IN);\n\n\t\t\t\t\tlet idToken: string;\n\n\t\t\t\t\t// The JWT plugin is enabled, so we use the JWKS keys to sign\n\t\t\t\t\tif (options.useJWTPlugin) {\n\t\t\t\t\t\tconst jwtPlugin = getJwtPlugin(ctx);\n\t\t\t\t\t\tif (!jwtPlugin) {\n\t\t\t\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t\t\t\t\"OIDC: `useJWTPlugin` is enabled but the JWT plugin is not available. Make sure you have the JWT Plugin in your plugins array or set `useJWTPlugin` to false.\",\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\t\t\t\t\terror_description: \"JWT plugin is not enabled\",\n\t\t\t\t\t\t\t\terror: \"internal_server_error\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tidToken = await getJwtToken(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t...ctx,\n\t\t\t\t\t\t\t\tcontext: {\n\t\t\t\t\t\t\t\t\t...ctx.context,\n\t\t\t\t\t\t\t\t\tsession: {\n\t\t\t\t\t\t\t\t\t\tsession: {\n\t\t\t\t\t\t\t\t\t\t\tid: generateRandomString(32, \"a-z\", \"A-Z\"),\n\t\t\t\t\t\t\t\t\t\t\tcreatedAt: new Date(iat * 1000),\n\t\t\t\t\t\t\t\t\t\t\tupdatedAt: new Date(iat * 1000),\n\t\t\t\t\t\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\t\t\t\t\t\texpiresAt: accessTokenExpiresAt,\n\t\t\t\t\t\t\t\t\t\t\ttoken: accessToken,\n\t\t\t\t\t\t\t\t\t\t\tipAddress: ctx.request?.headers.get(\"x-forwarded-for\"),\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tuser,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t...jwtPlugin.options,\n\t\t\t\t\t\t\t\tjwt: {\n\t\t\t\t\t\t\t\t\t...jwtPlugin.options?.jwt,\n\t\t\t\t\t\t\t\t\tgetSubject: () => user.id,\n\t\t\t\t\t\t\t\t\taudience: client_id.toString(),\n\t\t\t\t\t\t\t\t\tissuer:\n\t\t\t\t\t\t\t\t\t\tjwtPlugin.options?.jwt?.issuer ??\n\t\t\t\t\t\t\t\t\t\tctx.context.options.baseURL,\n\t\t\t\t\t\t\t\t\texpirationTime,\n\t\t\t\t\t\t\t\t\tdefinePayload: () => payload,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\t// If the JWT token is not enabled, create a key and use it to sign\n\t\t\t\t\t} else {\n\t\t\t\t\t\tidToken = await new SignJWT(payload)\n\t\t\t\t\t\t\t.setProtectedHeader({ alg: \"HS256\" })\n\t\t\t\t\t\t\t.setIssuedAt(iat)\n\t\t\t\t\t\t\t.setExpirationTime(accessTokenExpiresAt)\n\t\t\t\t\t\t\t.sign(new TextEncoder().encode(client.clientSecret));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn ctx.json(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\taccess_token: accessToken,\n\t\t\t\t\t\t\ttoken_type: \"Bearer\",\n\t\t\t\t\t\t\texpires_in: opts.accessTokenExpiresIn,\n\t\t\t\t\t\t\trefresh_token: requestedScopes.includes(\"offline_access\")\n\t\t\t\t\t\t\t\t? refreshToken\n\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t\tscope: requestedScopes.join(\" \"),\n\t\t\t\t\t\t\tid_token: requestedScopes.includes(\"openid\")\n\t\t\t\t\t\t\t\t? idToken\n\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t\"Cache-Control\": \"no-store\",\n\t\t\t\t\t\t\t\tPragma: \"no-cache\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t),\n\t\t\toAuth2userInfo: createAuthEndpoint(\n\t\t\t\t\"/oauth2/userinfo\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\toperationId: \"oauth2Userinfo\",\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\t...HIDE_METADATA,\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\tdescription: \"Get OAuth2 user information\",\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\t\t\tdescription: \"User information retrieved successfully\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tsub: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Subject identifier (user ID)\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\temail: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"email\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"User's email address, included if 'email' scope is granted\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"User's full name, included if 'profile' scope is granted\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tpicture: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"uri\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"User's profile picture URL, included if 'profile' scope is granted\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tgiven_name: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"User's given name, included if 'profile' scope is granted\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tfamily_name: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"User's family name, included if 'profile' scope is granted\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\temail_verified: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Whether the email is verified, included if 'email' scope is granted\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\trequired: [\"sub\"],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tif (!ctx.request) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"request not found\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst authorization = ctx.request.headers.get(\"authorization\");\n\t\t\t\t\tif (!authorization) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"authorization header not found\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst token = authorization.replace(\"Bearer \", \"\");\n\t\t\t\t\tconst accessToken =\n\t\t\t\t\t\tawait ctx.context.adapter.findOne<OAuthAccessToken>({\n\t\t\t\t\t\t\tmodel: modelName.oauthAccessToken,\n\t\t\t\t\t\t\twhere: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tfield: \"accessToken\",\n\t\t\t\t\t\t\t\t\tvalue: token,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t});\n\t\t\t\t\tif (!accessToken) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"invalid access token\",\n\t\t\t\t\t\t\terror: \"invalid_token\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (accessToken.accessTokenExpiresAt < new Date()) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"The Access Token expired\",\n\t\t\t\t\t\t\terror: \"invalid_token\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tconst client = await getClient(accessToken.clientId, trustedClients);\n\t\t\t\t\tif (!client) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"client not found\",\n\t\t\t\t\t\t\terror: \"invalid_token\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tconst user = await ctx.context.internalAdapter.findUserById(\n\t\t\t\t\t\taccessToken.userId,\n\t\t\t\t\t);\n\t\t\t\t\tif (!user) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"user not found\",\n\t\t\t\t\t\t\terror: \"invalid_token\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst requestedScopes = accessToken.scopes.split(\" \");\n\t\t\t\t\tconst baseUserClaims = {\n\t\t\t\t\t\tsub: user.id,\n\t\t\t\t\t\temail: requestedScopes.includes(\"email\") ? user.email : undefined,\n\t\t\t\t\t\tname: requestedScopes.includes(\"profile\") ? user.name : undefined,\n\t\t\t\t\t\tpicture: requestedScopes.includes(\"profile\")\n\t\t\t\t\t\t\t? user.image\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\tgiven_name: requestedScopes.includes(\"profile\")\n\t\t\t\t\t\t\t? user.name.split(\" \")[0]!\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\tfamily_name: requestedScopes.includes(\"profile\")\n\t\t\t\t\t\t\t? user.name.split(\" \")[1]!\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\temail_verified: requestedScopes.includes(\"email\")\n\t\t\t\t\t\t\t? user.emailVerified\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t};\n\t\t\t\t\tconst userClaims = options.getAdditionalUserInfoClaim\n\t\t\t\t\t\t? await options.getAdditionalUserInfoClaim(\n\t\t\t\t\t\t\t\tuser,\n\t\t\t\t\t\t\t\trequestedScopes,\n\t\t\t\t\t\t\t\tclient,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t: baseUserClaims;\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\t...baseUserClaims,\n\t\t\t\t\t\t...userClaims,\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t),\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * POST `/oauth2/register`\n\t\t\t *\n\t\t\t * ### API Methods\n\t\t\t *\n\t\t\t * **server:**\n\t\t\t * `auth.api.registerOAuthApplication`\n\t\t\t *\n\t\t\t * **client:**\n\t\t\t * `authClient.oauth2.register`\n\t\t\t *\n\t\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/oidc-provider#api-method-oauth2-register)\n\t\t\t */\n\t\t\tregisterOAuthApplication: createAuthEndpoint(\n\t\t\t\t\"/oauth2/register\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tbody: registerOAuthApplicationBodySchema,\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\tdescription: \"Register an OAuth2 application\",\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\t\t\tdescription: \"OAuth2 application registered successfully\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Name of the OAuth2 application\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\ticon: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Icon URL for the application\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tmetadata: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tadditionalProperties: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Additional metadata for the application\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tclientId: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Unique identifier for the client\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tclientSecret: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Secret key for the client\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tredirectURLs: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\titems: { type: \"string\", format: \"uri\" },\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"List of allowed redirect URLs\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Type of the client\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tenum: [\"web\"],\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tauthenticationScheme: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Authentication scheme used by the client\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tenum: [\"client_secret\"],\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Whether the client is disabled\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tenum: [false],\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tuserId: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"ID of the user who registered the client, null if registered anonymously\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Creation timestamp\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Last update timestamp\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"name\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"clientId\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"clientSecret\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"redirectURLs\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"type\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"authenticationScheme\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"disabled\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"updatedAt\",\n\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tconst body = ctx.body;\n\t\t\t\t\tconst session = await getSessionFromCtx(ctx);\n\n\t\t\t\t\t// Check authorization\n\t\t\t\t\tif (!session && !options.allowDynamicClientRegistration) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror: \"invalid_token\",\n\t\t\t\t\t\t\terror_description:\n\t\t\t\t\t\t\t\t\"Authentication required for client registration\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// Validate redirect URIs for redirect-based flows\n\t\t\t\t\tif (\n\t\t\t\t\t\t(!body.grant_types ||\n\t\t\t\t\t\t\tbody.grant_types.includes(\"authorization_code\") ||\n\t\t\t\t\t\t\tbody.grant_types.includes(\"implicit\")) &&\n\t\t\t\t\t\t(!body.redirect_uris || body.redirect_uris.length === 0)\n\t\t\t\t\t) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\terror: \"invalid_redirect_uri\",\n\t\t\t\t\t\t\terror_description:\n\t\t\t\t\t\t\t\t\"Redirect URIs are required for authorization_code and implicit grant types\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// Validate correlation between grant_types and response_types\n\t\t\t\t\tif (body.grant_types && body.response_types) {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tbody.grant_types.includes(\"authorization_code\") &&\n\t\t\t\t\t\t\t!body.response_types.includes(\"code\")\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\terror: \"invalid_client_metadata\",\n\t\t\t\t\t\t\t\terror_description:\n\t\t\t\t\t\t\t\t\t\"When 'authorization_code' grant type is used, 'code' response type must be included\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tbody.grant_types.includes(\"implicit\") &&\n\t\t\t\t\t\t\t!body.response_types.includes(\"token\")\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\terror: \"invalid_client_metadata\",\n\t\t\t\t\t\t\t\terror_description:\n\t\t\t\t\t\t\t\t\t\"When 'implicit' grant type is used, 'token' response type must be included\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tconst clientId =\n\t\t\t\t\t\toptions.generateClientId?.() ||\n\t\t\t\t\t\tgenerateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\t\tconst clientSecret =\n\t\t\t\t\t\toptions.generateClientSecret?.() ||\n\t\t\t\t\t\tgenerateRandomString(32, \"a-z\", \"A-Z\");\n\n\t\t\t\t\tconst storedClientSecret = await storeClientSecret(ctx, clientSecret);\n\n\t\t\t\t\t// Create the client with the existing schema\n\t\t\t\t\tconst client: Client = await ctx.context.adapter.create({\n\t\t\t\t\t\tmodel: modelName.oauthClient,\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tname: body.client_name,\n\t\t\t\t\t\t\ticon: body.logo_uri,\n\t\t\t\t\t\t\tmetadata: body.metadata ? JSON.stringify(body.metadata) : null,\n\t\t\t\t\t\t\tclientId: clientId,\n\t\t\t\t\t\t\tclientSecret: storedClientSecret,\n\t\t\t\t\t\t\tredirectUrls: body.redirect_uris.join(\",\"),\n\t\t\t\t\t\t\ttype: \"web\",\n\t\t\t\t\t\t\tauthenticationScheme:\n\t\t\t\t\t\t\t\tbody.token_endpoint_auth_method || \"client_secret_basic\",\n\t\t\t\t\t\t\tdisabled: false,\n\t\t\t\t\t\t\tuserId: session?.session.userId,\n\t\t\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t\t\t\tupdatedAt: new Date(),\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\t// Format the response according to RFC7591\n\t\t\t\t\treturn ctx.json(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tclient_id: clientId,\n\t\t\t\t\t\t\t...(client.type !== \"public\"\n\t\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\t\tclient_secret: clientSecret,\n\t\t\t\t\t\t\t\t\t\tclient_secret_expires_at: 0, // 0 means it doesn't expire\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t: {}),\n\t\t\t\t\t\t\tclient_id_issued_at: Math.floor(Date.now() / 1000),\n\t\t\t\t\t\t\tclient_secret_expires_at: 0, // 0 means it doesn't expire\n\t\t\t\t\t\t\tredirect_uris: body.redirect_uris,\n\t\t\t\t\t\t\ttoken_endpoint_auth_method:\n\t\t\t\t\t\t\t\tbody.token_endpoint_auth_method || \"client_secret_basic\",\n\t\t\t\t\t\t\tgrant_types: body.grant_types || [\"authorization_code\"],\n\t\t\t\t\t\t\tresponse_types: body.response_types || [\"code\"],\n\t\t\t\t\t\t\tclient_name: body.client_name,\n\t\t\t\t\t\t\tclient_uri: body.client_uri,\n\t\t\t\t\t\t\tlogo_uri: body.logo_uri,\n\t\t\t\t\t\t\tscope: body.scope,\n\t\t\t\t\t\t\tcontacts: body.contacts,\n\t\t\t\t\t\t\ttos_uri: body.tos_uri,\n\t\t\t\t\t\t\tpolicy_uri: body.policy_uri,\n\t\t\t\t\t\t\tjwks_uri: body.jwks_uri,\n\t\t\t\t\t\t\tjwks: body.jwks,\n\t\t\t\t\t\t\tsoftware_id: body.software_id,\n\t\t\t\t\t\t\tsoftware_version: body.software_version,\n\t\t\t\t\t\t\tsoftware_statement: body.software_statement,\n\t\t\t\t\t\t\tmetadata: body.metadata,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstatus: 201,\n\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t\"Cache-Control\": \"no-store\",\n\t\t\t\t\t\t\t\tPragma: \"no-cache\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t),\n\t\t\tgetOAuthClient: createAuthEndpoint(\n\t\t\t\t\"/oauth2/client/:id\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\tdescription: \"Get OAuth2 client details\",\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\t\t\tdescription: \"OAuth2 client retrieved successfully\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tclientId: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Unique identifier for the client\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Name of the OAuth2 application\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\ticon: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Icon URL for the application\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\trequired: [\"clientId\", \"name\"],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (\n\t\t\t\t\tctx,\n\t\t\t\t): Promise<{\n\t\t\t\t\tclientId: string;\n\t\t\t\t\tname: string;\n\t\t\t\t\ticon: string | null;\n\t\t\t\t}> => {\n\t\t\t\t\tconst client = await getClient(ctx.params.id, trustedClients);\n\t\t\t\t\tif (!client) {\n\t\t\t\t\t\tthrow new APIError(\"NOT_FOUND\", {\n\t\t\t\t\t\t\terror_description: \"client not found\",\n\t\t\t\t\t\t\terror: \"not_found\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\tclientId: client.clientId,\n\t\t\t\t\t\tname: client.name,\n\t\t\t\t\t\ticon: client.icon || null,\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t),\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * GET/POST `/oauth2/endsession`\n\t\t\t *\n\t\t\t * Implements RP-Initiated Logout as per OpenID Connect RP-Initiated Logout 1.0.\n\t\t\t * Allows relying parties to request that an OpenID Provider log out the end-user.\n\t\t\t *\n\t\t\t * @see [OpenID Connect RP-Initiated Logout Spec](https://openid.net/specs/openid-connect-rpinitiated-1_0.html)\n\t\t\t */\n\t\t\tendSession: createAuthEndpoint(\n\t\t\t\t\"/oauth2/endsession\",\n\t\t\t\t{\n\t\t\t\t\tmethod: [\"GET\", \"POST\"],\n\t\t\t\t\tquery: z\n\t\t\t\t\t\t.object({\n\t\t\t\t\t\t\tid_token_hint: z.string().optional(),\n\t\t\t\t\t\t\tlogout_hint: z.string().optional(),\n\t\t\t\t\t\t\tclient_id: z.string().optional(),\n\t\t\t\t\t\t\tpost_logout_redirect_uri: z.string().optional(),\n\t\t\t\t\t\t\tstate: z.string().optional(),\n\t\t\t\t\t\t\tui_locales: z.string().optional(),\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.optional(),\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\t...HIDE_METADATA,\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\"RP-Initiated Logout endpoint. Logs out the end-user and optionally redirects to a post-logout URI.\",\n\t\t\t\t\t\t\tparameters: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tname: \"id_token_hint\",\n\t\t\t\t\t\t\t\t\tin: \"query\",\n\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\"Previously issued ID Token passed as a hint about the End-User's current authenticated session\",\n\t\t\t\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\t\t\t\tschema: { type: \"string\" },\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tname: \"logout_hint\",\n\t\t\t\t\t\t\t\t\tin: \"query\",\n\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\"Hint to the Authorization Server about the End-User that is logging out\",\n\t\t\t\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\t\t\t\tschema: { type: \"string\" },\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tname: \"client_id\",\n\t\t\t\t\t\t\t\t\tin: \"query\",\n\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\"OAuth 2.0 Client Identifier. Required if post_logout_redirect_uri is used without id_token_hint\",\n\t\t\t\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\t\t\t\tschema: { type: \"string\" },\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tname: \"post_logout_redirect_uri\",\n\t\t\t\t\t\t\t\t\tin: \"query\",\n\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\"URL to which the RP is requesting that the End-User's User Agent be redirected after a logout has been performed\",\n\t\t\t\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\t\t\t\tschema: { type: \"string\", format: \"uri\" },\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tname: \"state\",\n\t\t\t\t\t\t\t\t\tin: \"query\",\n\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\"Opaque value used by the RP to maintain state between the logout request and the callback\",\n\t\t\t\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\t\t\t\tschema: { type: \"string\" },\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tname: \"ui_locales\",\n\t\t\t\t\t\t\t\t\tin: \"query\",\n\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\"End-User's preferred languages and scripts for the user interface\",\n\t\t\t\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\t\t\t\tschema: { type: \"string\" },\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t] as OpenAPIParameter[],\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t\"302\": {\n\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\"Redirect to post_logout_redirect_uri or logout confirmation page\",\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\t\t\tdescription: \"Logout completed successfully\",\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tconst { id_token_hint, client_id, post_logout_redirect_uri, state } =\n\t\t\t\t\t\tctx.query || {};\n\n\t\t\t\t\tlet validatedClientId: string | null = null;\n\t\t\t\t\tlet validatedUserId: string | null = null;\n\n\t\t\t\t\t// Validate id_token_hint if provided\n\t\t\t\t\tif (id_token_hint) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst jwtPlugin = getJwtPlugin(ctx);\n\t\t\t\t\t\t\tif (jwtPlugin && jwtPlugin.options && options?.useJWTPlugin) {\n\t\t\t\t\t\t\t\t// For JWT plugin tokens, verify using JWKS\n\t\t\t\t\t\t\t\tconst verified = await verifyJWT(\n\t\t\t\t\t\t\t\t\tid_token_hint,\n\t\t\t\t\t\t\t\t\tjwtPlugin.options,\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tif (verified) {\n\t\t\t\t\t\t\t\t\tvalidatedUserId = verified.sub;\n\t\t\t\t\t\t\t\t\tvalidatedClientId = verified.aud\n\t\t\t\t\t\t\t\t\t\t? typeof verified.aud === \"string\"\n\t\t\t\t\t\t\t\t\t\t\t? verified.aud\n\t\t\t\t\t\t\t\t\t\t\t: verified.aud[0]!\n\t\t\t\t\t\t\t\t\t\t: null;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// For HS256 tokens, we need the client_id to verify\n\t\t\t\t\t\t\t\tif (client_id) {\n\t\t\t\t\t\t\t\t\tconst client = await getClient(client_id, trustedClients);\n\t\t\t\t\t\t\t\t\tif (client && client.clientSecret) {\n\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\tconst { payload } = await jwtVerify(\n\t\t\t\t\t\t\t\t\t\t\t\tid_token_hint,\n\t\t\t\t\t\t\t\t\t\t\t\tnew TextEncoder().encode(client.clientSecret),\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\tvalidatedUserId = payload.sub as string;\n\t\t\t\t\t\t\t\t\t\t\tvalidatedClientId = payload.aud as string;\n\t\t\t\t\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t\t\t\t\t// Invalid token, continue with logout but no validation\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t// Invalid id_token_hint, but we continue with logout anyway\n\t\t\t\t\t\t\tctx.context.logger.debug(\n\t\t\t\t\t\t\t\t\"Invalid id_token_hint provided to end_session endpoint\",\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Validate client_id if provided\n\t\t\t\t\tif (client_id) {\n\t\t\t\t\t\tconst client = await getClient(client_id, trustedClients);\n\t\t\t\t\t\tif (!client) {\n\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t\t\terror_description: \"Invalid client_id\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// If we have a validated client from the token, ensure they match\n\t\t\t\t\t\tif (validatedClientId && validatedClientId !== client_id) {\n\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t\t\terror_description:\n\t\t\t\t\t\t\t\t\t\"client_id does not match the ID Token's audience\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvalidatedClientId = client_id;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Validate post_logout_redirect_uri if provided\n\t\t\t\t\tif (post_logout_redirect_uri) {\n\t\t\t\t\t\tif (!validatedClientId) {\n\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t\t\terror_description:\n\t\t\t\t\t\t\t\t\t\"client_id is required when using post_logout_redirect_uri without a valid id_token_hint\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst client = await getClient(validatedClientId, trustedClients);\n\t\t\t\t\t\tif (!client) {\n\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t\t\terror_description: \"Invalid client\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst isValidRedirectUri = client.redirectUrls.some(\n\t\t\t\t\t\t\t(registeredUri) => post_logout_redirect_uri === registeredUri,\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tif (!isValidRedirectUri) {\n\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t\t\terror_description:\n\t\t\t\t\t\t\t\t\t\"post_logout_redirect_uri is not registered for this client\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tconst session = await getSessionFromCtx(ctx);\n\n\t\t\t\t\tif (validatedUserId || session) {\n\t\t\t\t\t\tconst userId = validatedUserId || session?.user.id;\n\t\t\t\t\t\tif (userId) {\n\t\t\t\t\t\t\tawait ctx.context.adapter.deleteMany({\n\t\t\t\t\t\t\t\tmodel: modelName.oauthAccessToken,\n\t\t\t\t\t\t\t\twhere: [{ field: \"userId\", value: userId }],\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (session) {\n\t\t\t\t\t\tawait ctx.context.internalAdapter.deleteSession(\n\t\t\t\t\t\t\tsession.session.token,\n\t\t\t\t\t\t);\n\t\t\t\t\t\texpireCookie(ctx, ctx.context.authCookies.sessionToken);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (post_logout_redirect_uri) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst redirectUrl = new URL(post_logout_redirect_uri);\n\t\t\t\t\t\t\tif (state) {\n\t\t\t\t\t\t\t\tredirectUrl.searchParams.set(\"state\", state);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn ctx.redirect(redirectUrl.toString());\n\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t\t\terror_description: \"Invalid post_logout_redirect_uri format\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\tsuccess: true,\n\t\t\t\t\t\tmessage: \"Logout successful\",\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t),\n\t\t},\n\t\tschema: mergeSchema(schema, options?.schema),\n\t\tget options() {\n\t\t\treturn opts;\n\t\t},\n\t} satisfies BetterAuthPlugin;\n};\nexport type * from \"./types\";\n"],"names":["consentCode: string | null","accessToken","idToken: string","client: Client","validatedClientId: string | null","validatedUserId: string | null"],"mappings":"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"}},
    {"offset": {"line": 10118, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/mcp/authorize.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/mcp/authorize.ts"],"sourcesContent":["import type { GenericEndpointContext } from \"@better-auth/core\";\nimport { APIError } from \"better-call\";\nimport { getSessionFromCtx } from \"../../api\";\nimport { generateRandomString } from \"../../crypto\";\nimport type { OAuthApplication } from \"../oidc-provider/schema\";\nimport type {\n\tAuthorizationQuery,\n\tClient,\n\tOIDCOptions,\n} from \"../oidc-provider/types\";\n\nfunction redirectErrorURL(url: string, error: string, description: string) {\n\treturn `${\n\t\turl.includes(\"?\") ? \"&\" : \"?\"\n\t}error=${error}&error_description=${description}`;\n}\n\nexport async function authorizeMCPOAuth(\n\tctx: GenericEndpointContext,\n\toptions: OIDCOptions,\n) {\n\tctx.setHeader(\"Access-Control-Allow-Origin\", \"*\");\n\tctx.setHeader(\"Access-Control-Allow-Methods\", \"POST, OPTIONS\");\n\tctx.setHeader(\"Access-Control-Allow-Headers\", \"Content-Type, Authorization\");\n\tctx.setHeader(\"Access-Control-Max-Age\", \"86400\");\n\tconst opts = {\n\t\tcodeExpiresIn: 600,\n\t\tdefaultScope: \"openid\",\n\t\t...options,\n\t\tscopes: [\n\t\t\t\"openid\",\n\t\t\t\"profile\",\n\t\t\t\"email\",\n\t\t\t\"offline_access\",\n\t\t\t...(options?.scopes || []),\n\t\t],\n\t};\n\tif (!ctx.request) {\n\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\terror_description: \"request not found\",\n\t\t\terror: \"invalid_request\",\n\t\t});\n\t}\n\tconst session = await getSessionFromCtx(ctx);\n\tif (!session) {\n\t\t/**\n\t\t * If the user is not logged in, we need to redirect them to the\n\t\t * login page.\n\t\t */\n\t\tawait ctx.setSignedCookie(\n\t\t\t\"oidc_login_prompt\",\n\t\t\tJSON.stringify(ctx.query),\n\t\t\tctx.context.secret,\n\t\t\t{\n\t\t\t\tmaxAge: 600,\n\t\t\t\tpath: \"/\",\n\t\t\t\tsameSite: \"lax\",\n\t\t\t},\n\t\t);\n\t\tconst queryFromURL = ctx.request.url?.split(\"?\")[1]!;\n\t\tthrow ctx.redirect(`${options.loginPage}?${queryFromURL}`);\n\t}\n\n\tconst query = ctx.query as AuthorizationQuery;\n\tif (!query.client_id) {\n\t\tthrow ctx.redirect(`${ctx.context.baseURL}/error?error=invalid_client`);\n\t}\n\n\tif (!query.response_type) {\n\t\tthrow ctx.redirect(\n\t\t\tredirectErrorURL(\n\t\t\t\t`${ctx.context.baseURL}/error`,\n\t\t\t\t\"invalid_request\",\n\t\t\t\t\"response_type is required\",\n\t\t\t),\n\t\t);\n\t}\n\n\tconst client = await ctx.context.adapter\n\t\t.findOne<OAuthApplication>({\n\t\t\tmodel: \"oauthApplication\",\n\t\t\twhere: [\n\t\t\t\t{\n\t\t\t\t\tfield: \"clientId\",\n\t\t\t\t\tvalue: ctx.query.client_id,\n\t\t\t\t},\n\t\t\t],\n\t\t})\n\t\t.then((res) => {\n\t\t\tif (!res) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\t...res,\n\t\t\t\tredirectUrls: res.redirectUrls.split(\",\"),\n\t\t\t\tmetadata: res.metadata ? JSON.parse(res.metadata) : {},\n\t\t\t} as Client;\n\t\t});\n\tif (!client) {\n\t\tthrow ctx.redirect(`${ctx.context.baseURL}/error?error=invalid_client`);\n\t}\n\tconst redirectURI = client.redirectUrls.find(\n\t\t(url) => url === ctx.query.redirect_uri,\n\t);\n\n\tif (!redirectURI || !query.redirect_uri) {\n\t\t/**\n\t\t * show UI error here warning the user that the redirect URI is invalid\n\t\t */\n\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\tmessage: \"Invalid redirect URI\",\n\t\t});\n\t}\n\tif (client.disabled) {\n\t\tthrow ctx.redirect(`${ctx.context.baseURL}/error?error=client_disabled`);\n\t}\n\n\tif (query.response_type !== \"code\") {\n\t\tthrow ctx.redirect(\n\t\t\t`${ctx.context.baseURL}/error?error=unsupported_response_type`,\n\t\t);\n\t}\n\n\tconst requestScope =\n\t\tquery.scope?.split(\" \").filter((s) => s) || opts.defaultScope.split(\" \");\n\tconst invalidScopes = requestScope.filter((scope) => {\n\t\treturn !opts.scopes.includes(scope);\n\t});\n\tif (invalidScopes.length) {\n\t\tthrow ctx.redirect(\n\t\t\tredirectErrorURL(\n\t\t\t\tquery.redirect_uri,\n\t\t\t\t\"invalid_scope\",\n\t\t\t\t`The following scopes are invalid: ${invalidScopes.join(\", \")}`,\n\t\t\t),\n\t\t);\n\t}\n\n\tif (\n\t\t(!query.code_challenge || !query.code_challenge_method) &&\n\t\toptions.requirePKCE\n\t) {\n\t\tthrow ctx.redirect(\n\t\t\tredirectErrorURL(\n\t\t\t\tquery.redirect_uri,\n\t\t\t\t\"invalid_request\",\n\t\t\t\t\"pkce is required\",\n\t\t\t),\n\t\t);\n\t}\n\n\tif (!query.code_challenge_method) {\n\t\tquery.code_challenge_method = \"plain\";\n\t}\n\n\tif (\n\t\t![\n\t\t\t\"s256\",\n\t\t\toptions.allowPlainCodeChallengeMethod ? \"plain\" : \"s256\",\n\t\t].includes(query.code_challenge_method?.toLowerCase() || \"\")\n\t) {\n\t\tthrow ctx.redirect(\n\t\t\tredirectErrorURL(\n\t\t\t\tquery.redirect_uri,\n\t\t\t\t\"invalid_request\",\n\t\t\t\t\"invalid code_challenge method\",\n\t\t\t),\n\t\t);\n\t}\n\n\tconst code = generateRandomString(32, \"a-z\", \"A-Z\", \"0-9\");\n\tconst codeExpiresInMs = opts.codeExpiresIn * 1000;\n\tconst expiresAt = new Date(Date.now() + codeExpiresInMs);\n\ttry {\n\t\t/**\n\t\t * Save the code in the database\n\t\t */\n\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\tvalue: JSON.stringify({\n\t\t\t\tclientId: client.clientId,\n\t\t\t\tredirectURI: query.redirect_uri,\n\t\t\t\tscope: requestScope,\n\t\t\t\tuserId: session.user.id,\n\t\t\t\tauthTime: new Date(session.session.createdAt).getTime(),\n\t\t\t\t/**\n\t\t\t\t * If the prompt is set to `consent`, then we need\n\t\t\t\t * to require the user to consent to the scopes.\n\t\t\t\t *\n\t\t\t\t * This means the code now needs to be treated as a\n\t\t\t\t * consent request.\n\t\t\t\t *\n\t\t\t\t * once the user consents, the code will be updated\n\t\t\t\t * with the actual code. This is to prevent the\n\t\t\t\t * client from using the code before the user\n\t\t\t\t * consents.\n\t\t\t\t */\n\t\t\t\trequireConsent: query.prompt === \"consent\",\n\t\t\t\tstate: query.prompt === \"consent\" ? query.state : null,\n\t\t\t\tcodeChallenge: query.code_challenge,\n\t\t\t\tcodeChallengeMethod: query.code_challenge_method,\n\t\t\t\tnonce: query.nonce,\n\t\t\t}),\n\t\t\tidentifier: code,\n\t\t\texpiresAt,\n\t\t});\n\t} catch {\n\t\tthrow ctx.redirect(\n\t\t\tredirectErrorURL(\n\t\t\t\tquery.redirect_uri,\n\t\t\t\t\"server_error\",\n\t\t\t\t\"An error occurred while processing the request\",\n\t\t\t),\n\t\t);\n\t}\n\n\t// Consent is NOT required - redirect with the code immediately\n\tif (query.prompt !== \"consent\") {\n\t\tconst redirectURIWithCode = new URL(redirectURI);\n\t\tredirectURIWithCode.searchParams.set(\"code\", code);\n\t\tif (ctx.query.state) {\n\t\t\tredirectURIWithCode.searchParams.set(\"state\", ctx.query.state);\n\t\t}\n\t\tthrow ctx.redirect(redirectURIWithCode.toString());\n\t}\n\n\t// Consent is REQUIRED - redirect to consent page or show consent HTML\n\tif (options?.consentPage) {\n\t\t// Set cookie to support cookie-based consent flows\n\t\tawait ctx.setSignedCookie(\"oidc_consent_prompt\", code, ctx.context.secret, {\n\t\t\tmaxAge: 600,\n\t\t\tpath: \"/\",\n\t\t\tsameSite: \"lax\",\n\t\t});\n\n\t\t// Pass the consent code as a URL parameter to support URL-BASED consent flows\n\t\tconst urlParams = new URLSearchParams();\n\t\turlParams.set(\"consent_code\", code);\n\t\turlParams.set(\"client_id\", client.clientId);\n\t\turlParams.set(\"scope\", requestScope.join(\" \"));\n\t\tconst consentURI = `${options.consentPage}?${urlParams.toString()}`;\n\n\t\tthrow ctx.redirect(consentURI);\n\t}\n\n\t// No consent page configured - fall back to direct redirect with code\n\tconst redirectURIWithCode = new URL(redirectURI);\n\tredirectURIWithCode.searchParams.set(\"code\", code);\n\tif (ctx.query.state) {\n\t\tredirectURIWithCode.searchParams.set(\"state\", ctx.query.state);\n\t}\n\tthrow ctx.redirect(redirectURIWithCode.toString());\n}\n"],"names":["redirectURIWithCode"],"mappings":";;;;;;;;;;;;;;;;AAWA,SAAS,iBAAiB,GAAA,EAAa,KAAA,EAAe,WAAA,EAAqB;IAC1E,OAAO,GACN,IAAI,QAAA,CAAS,IAAI,GAAG,MAAM,IAC1B,MAAA,EAAQ,MAAM,mBAAA,EAAqB,aAAA;;AAGrC,eAAsB,kBACrB,GAAA,EACA,OAAA,EACC;IACD,IAAI,SAAA,CAAU,+BAA+B,IAAI;IACjD,IAAI,SAAA,CAAU,gCAAgC,gBAAgB;IAC9D,IAAI,SAAA,CAAU,gCAAgC,8BAA8B;IAC5E,IAAI,SAAA,CAAU,0BAA0B,QAAQ;IAChD,MAAM,OAAO;QACZ,eAAe;QACf,cAAc;QACd,GAAG,OAAA;QACH,QAAQ;YACP;YACA;YACA;YACA;eACI,SAAS,UAAU,EAAE;SACzB;KACD;IACD,IAAI,CAAC,IAAI,OAAA,CACR,CAAA,MAAM,IAAI,8JAAA,CAAS,gBAAgB;QAClC,mBAAmB;QACnB,OAAO;KACP,CAAC;IAEH,MAAM,UAAU,UAAM,0LAAA,EAAkB,IAAI;IAC5C,IAAI,CAAC,SAAS;;;;KAKb,MAAM,IAAI,eAAA,CACT,qBACA,KAAK,SAAA,CAAU,IAAI,KAAA,CAAM,EACzB,IAAI,OAAA,CAAQ,MAAA,EACZ;YACC,QAAQ;YACR,MAAM;YACN,UAAU;SACV,CACD;QACD,MAAM,eAAe,IAAI,OAAA,CAAQ,GAAA,EAAK,MAAM,IAAI,CAAC,EAAA;QACjD,MAAM,IAAI,QAAA,CAAS,GAAG,QAAQ,SAAA,CAAU,CAAA,EAAG,cAAA,CAAe;;IAG3D,MAAM,QAAQ,IAAI,KAAA;IAClB,IAAI,CAAC,MAAM,SAAA,CACV,CAAA,MAAM,IAAI,QAAA,CAAS,GAAG,IAAI,OAAA,CAAQ,OAAA,CAAQ,2BAAA,CAAA,CAA6B;IAGxE,IAAI,CAAC,MAAM,aAAA,CACV,CAAA,MAAM,IAAI,QAAA,CACT,iBACC,GAAG,IAAI,OAAA,CAAQ,OAAA,CAAQ,MAAA,CAAA,EACvB,mBACA,4BACA,CACD;IAGF,MAAM,SAAS,MAAM,IAAI,OAAA,CAAQ,OAAA,CAC/B,OAAA,CAA0B;QAC1B,OAAO;QACP,OAAO;YACN;gBACC,OAAO;gBACP,OAAO,IAAI,KAAA,CAAM,SAAA;aACjB;SACD;KACD,CAAC,CACD,IAAA,CAAA,CAAM,QAAQ;QACd,IAAI,CAAC,IACJ,CAAA,OAAO;QAER,OAAO;YACN,GAAG,GAAA;YACH,cAAc,IAAI,YAAA,CAAa,KAAA,CAAM,IAAI;YACzC,UAAU,IAAI,QAAA,GAAW,KAAK,KAAA,CAAM,IAAI,QAAA,CAAS,GAAG,CAAA,CAAE;SACtD;MACA;IACH,IAAI,CAAC,OACJ,CAAA,MAAM,IAAI,QAAA,CAAS,GAAG,IAAI,OAAA,CAAQ,OAAA,CAAQ,2BAAA,CAAA,CAA6B;IAExE,MAAM,cAAc,OAAO,YAAA,CAAa,IAAA,CAAA,CACtC,MAAQ,QAAQ,IAAI,KAAA,CAAM,YAAA,CAC3B;IAED,IAAI,CAAC,eAAe,CAAC,MAAM,YAAA;;IAI1B,MAAM,IAAI,8JAAA,CAAS,eAAe;QACjC,SAAS;IAAA,CACT,CAAC;IAEH,IAAI,OAAO,QAAA,CACV,CAAA,MAAM,IAAI,QAAA,CAAS,GAAG,IAAI,OAAA,CAAQ,OAAA,CAAQ,4BAAA,CAAA,CAA8B;IAGzE,IAAI,MAAM,aAAA,KAAkB,OAC3B,CAAA,MAAM,IAAI,QAAA,CACT,GAAG,IAAI,OAAA,CAAQ,OAAA,CAAQ,sCAAA,CAAA,CACvB;IAGF,MAAM,eACL,MAAM,KAAA,EAAO,MAAM,IAAI,CAAC,OAAA,CAAQ,IAAM,EAAE,IAAI,KAAK,YAAA,CAAa,KAAA,CAAM,IAAI;IACzE,MAAM,gBAAgB,aAAa,MAAA,CAAA,CAAQ,UAAU;QACpD,OAAO,CAAC,KAAK,MAAA,CAAO,QAAA,CAAS,MAAM;MAClC;IACF,IAAI,cAAc,MAAA,CACjB,CAAA,MAAM,IAAI,QAAA,CACT,iBACC,MAAM,YAAA,EACN,iBACA,CAAA,kCAAA,EAAqC,cAAc,IAAA,CAAK,KAAK,EAAA,CAC7D,CACD;IAGF,IAAA,CACE,CAAC,MAAM,cAAA,IAAkB,CAAC,MAAM,qBAAA,KACjC,QAAQ,WAAA,CAER,CAAA,MAAM,IAAI,QAAA,CACT,iBACC,MAAM,YAAA,EACN,mBACA,mBACA,CACD;IAGF,IAAI,CAAC,MAAM,qBAAA,CACV,CAAA,MAAM,qBAAA,GAAwB;IAG/B,IACC,CAAC;QACA;QACA,QAAQ,6BAAA,GAAgC,UAAU;KAClD,CAAC,QAAA,CAAS,MAAM,qBAAA,EAAuB,aAAa,IAAI,GAAG,CAE5D,CAAA,MAAM,IAAI,QAAA,CACT,iBACC,MAAM,YAAA,EACN,mBACA,gCACA,CACD;IAGF,MAAM,WAAO,qLAAA,EAAqB,IAAI,OAAO,OAAO,MAAM;IAC1D,MAAM,kBAAkB,KAAK,aAAA,GAAgB;IAC7C,MAAM,YAAY,IAAI,KAAK,KAAK,GAAA,EAAK,GAAG,gBAAgB;IACxD,IAAI;;;KAIH,MAAM,IAAI,OAAA,CAAQ,eAAA,CAAgB,uBAAA,CAAwB;YACzD,OAAO,KAAK,SAAA,CAAU;gBACrB,UAAU,OAAO,QAAA;gBACjB,aAAa,MAAM,YAAA;gBACnB,OAAO;gBACP,QAAQ,QAAQ,IAAA,CAAK,EAAA;gBACrB,UAAU,IAAI,KAAK,QAAQ,OAAA,CAAQ,SAAA,CAAU,CAAC,OAAA,EAAS;gBAavD,gBAAgB,MAAM,MAAA,KAAW;gBACjC,OAAO,MAAM,MAAA,KAAW,YAAY,MAAM,KAAA,GAAQ;gBAClD,eAAe,MAAM,cAAA;gBACrB,qBAAqB,MAAM,qBAAA;gBAC3B,OAAO,MAAM,KAAA;aACb,CAAC;YACF,YAAY;YACZ;SACA,CAAC;aACK;QACP,MAAM,IAAI,QAAA,CACT,iBACC,MAAM,YAAA,EACN,gBACA,iDACA,CACD;;IAIF,IAAI,MAAM,MAAA,KAAW,WAAW;QAC/B,MAAMA,wBAAsB,IAAI,IAAI,YAAY;QAChD,sBAAoB,YAAA,CAAa,GAAA,CAAI,QAAQ,KAAK;QAClD,IAAI,IAAI,KAAA,CAAM,KAAA,CACb,CAAA,sBAAoB,YAAA,CAAa,GAAA,CAAI,SAAS,IAAI,KAAA,CAAM,KAAA,CAAM;QAE/D,MAAM,IAAI,QAAA,CAASA,sBAAoB,QAAA,EAAU,CAAC;;IAInD,IAAI,SAAS,aAAa;QAEzB,MAAM,IAAI,eAAA,CAAgB,uBAAuB,MAAM,IAAI,OAAA,CAAQ,MAAA,EAAQ;YAC1E,QAAQ;YACR,MAAM;YACN,UAAU;SACV,CAAC;QAGF,MAAM,YAAY,IAAI,iBAAiB;QACvC,UAAU,GAAA,CAAI,gBAAgB,KAAK;QACnC,UAAU,GAAA,CAAI,aAAa,OAAO,QAAA,CAAS;QAC3C,UAAU,GAAA,CAAI,SAAS,aAAa,IAAA,CAAK,IAAI,CAAC;QAC9C,MAAM,aAAa,GAAG,QAAQ,WAAA,CAAY,CAAA,EAAG,UAAU,QAAA,EAAU,EAAA;QAEjE,MAAM,IAAI,QAAA,CAAS,WAAW;;IAI/B,MAAM,sBAAsB,IAAI,IAAI,YAAY;IAChD,oBAAoB,YAAA,CAAa,GAAA,CAAI,QAAQ,KAAK;IAClD,IAAI,IAAI,KAAA,CAAM,KAAA,CACb,CAAA,oBAAoB,YAAA,CAAa,GAAA,CAAI,SAAS,IAAI,KAAA,CAAM,KAAA,CAAM;IAE/D,MAAM,IAAI,QAAA,CAAS,oBAAoB,QAAA,EAAU,CAAC"}},
    {"offset": {"line": 10265, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/mcp/index.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/mcp/index.ts"],"sourcesContent":["import type {\n\tBetterAuthOptions,\n\tBetterAuthPlugin,\n\tGenericEndpointContext,\n} from \"@better-auth/core\";\nimport {\n\tcreateAuthEndpoint,\n\tcreateAuthMiddleware,\n} from \"@better-auth/core/api\";\nimport { isProduction, logger } from \"@better-auth/core/env\";\nimport { safeJSONParse } from \"@better-auth/core/utils\";\nimport { getWebcryptoSubtle } from \"@better-auth/utils\";\nimport { base64 } from \"@better-auth/utils/base64\";\nimport { createHash } from \"@better-auth/utils/hash\";\nimport { SignJWT } from \"jose\";\nimport * as z from \"zod\";\nimport { APIError, getSessionFromCtx } from \"../../api\";\nimport { expireCookie, parseSetCookieHeader } from \"../../cookies\";\nimport { generateRandomString } from \"../../crypto\";\nimport { HIDE_METADATA } from \"../../utils\";\nimport { getBaseURL } from \"../../utils/url\";\nimport type {\n\tClient,\n\tCodeVerificationValue,\n\tOAuthAccessToken,\n\tOIDCMetadata,\n\tOIDCOptions,\n} from \"../oidc-provider\";\nimport { oidcProvider } from \"../oidc-provider\";\nimport { schema } from \"../oidc-provider/schema\";\nimport { parsePrompt } from \"../oidc-provider/utils/prompt\";\nimport { authorizeMCPOAuth } from \"./authorize\";\n\ninterface MCPOptions {\n\tloginPage: string;\n\tresource?: string | undefined;\n\toidcConfig?: OIDCOptions | undefined;\n}\n\nexport const getMCPProviderMetadata = (\n\tctx: GenericEndpointContext,\n\toptions?: OIDCOptions | undefined,\n): OIDCMetadata => {\n\tconst issuer = ctx.context.options.baseURL as string;\n\tconst baseURL = ctx.context.baseURL;\n\tif (!issuer || !baseURL) {\n\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\terror: \"invalid_issuer\",\n\t\t\terror_description:\n\t\t\t\t\"issuer or baseURL is not set. If you're the app developer, please make sure to set the `baseURL` in your auth config.\",\n\t\t});\n\t}\n\treturn {\n\t\tissuer,\n\t\tauthorization_endpoint: `${baseURL}/mcp/authorize`,\n\t\ttoken_endpoint: `${baseURL}/mcp/token`,\n\t\tuserinfo_endpoint: `${baseURL}/mcp/userinfo`,\n\t\tjwks_uri: `${baseURL}/mcp/jwks`,\n\t\tregistration_endpoint: `${baseURL}/mcp/register`,\n\t\tscopes_supported: [\"openid\", \"profile\", \"email\", \"offline_access\"],\n\t\tresponse_types_supported: [\"code\"],\n\t\tresponse_modes_supported: [\"query\"],\n\t\tgrant_types_supported: [\"authorization_code\", \"refresh_token\"],\n\t\tacr_values_supported: [\n\t\t\t\"urn:mace:incommon:iap:silver\",\n\t\t\t\"urn:mace:incommon:iap:bronze\",\n\t\t],\n\t\tsubject_types_supported: [\"public\"],\n\t\tid_token_signing_alg_values_supported: [\"RS256\", \"none\"],\n\t\ttoken_endpoint_auth_methods_supported: [\n\t\t\t\"client_secret_basic\",\n\t\t\t\"client_secret_post\",\n\t\t\t\"none\",\n\t\t],\n\t\tcode_challenge_methods_supported: [\"S256\"],\n\t\tclaims_supported: [\n\t\t\t\"sub\",\n\t\t\t\"iss\",\n\t\t\t\"aud\",\n\t\t\t\"exp\",\n\t\t\t\"nbf\",\n\t\t\t\"iat\",\n\t\t\t\"jti\",\n\t\t\t\"email\",\n\t\t\t\"email_verified\",\n\t\t\t\"name\",\n\t\t],\n\t\t...options?.metadata,\n\t};\n};\n\nexport const getMCPProtectedResourceMetadata = (\n\tctx: GenericEndpointContext,\n\toptions?: MCPOptions | undefined,\n) => {\n\tconst baseURL = ctx.context.baseURL;\n\tconst origin = new URL(baseURL).origin;\n\n\treturn {\n\t\tresource: options?.resource ?? origin,\n\t\tauthorization_servers: [origin],\n\t\tjwks_uri: options?.oidcConfig?.metadata?.jwks_uri ?? `${baseURL}/mcp/jwks`,\n\t\tscopes_supported: options?.oidcConfig?.metadata?.scopes_supported ?? [\n\t\t\t\"openid\",\n\t\t\t\"profile\",\n\t\t\t\"email\",\n\t\t\t\"offline_access\",\n\t\t],\n\t\tbearer_methods_supported: [\"header\"],\n\t\tresource_signing_alg_values_supported: [\"RS256\", \"none\"],\n\t};\n};\n\nconst registerMcpClientBodySchema = z.object({\n\tredirect_uris: z.array(z.string()),\n\ttoken_endpoint_auth_method: z\n\t\t.enum([\"none\", \"client_secret_basic\", \"client_secret_post\"])\n\t\t.default(\"client_secret_basic\")\n\t\t.optional(),\n\tgrant_types: z\n\t\t.array(\n\t\t\tz.enum([\n\t\t\t\t\"authorization_code\",\n\t\t\t\t\"implicit\",\n\t\t\t\t\"password\",\n\t\t\t\t\"client_credentials\",\n\t\t\t\t\"refresh_token\",\n\t\t\t\t\"urn:ietf:params:oauth:grant-type:jwt-bearer\",\n\t\t\t\t\"urn:ietf:params:oauth:grant-type:saml2-bearer\",\n\t\t\t]),\n\t\t)\n\t\t.default([\"authorization_code\"])\n\t\t.optional(),\n\tresponse_types: z\n\t\t.array(z.enum([\"code\", \"token\"]))\n\t\t.default([\"code\"])\n\t\t.optional(),\n\tclient_name: z.string().optional(),\n\tclient_uri: z.string().optional(),\n\tlogo_uri: z.string().optional(),\n\tscope: z.string().optional(),\n\tcontacts: z.array(z.string()).optional(),\n\ttos_uri: z.string().optional(),\n\tpolicy_uri: z.string().optional(),\n\tjwks_uri: z.string().optional(),\n\tjwks: z.record(z.string(), z.any()).optional(),\n\tmetadata: z.record(z.any(), z.any()).optional(),\n\tsoftware_id: z.string().optional(),\n\tsoftware_version: z.string().optional(),\n\tsoftware_statement: z.string().optional(),\n});\n\nconst mcpOAuthTokenBodySchema = z.record(z.any(), z.any());\n\nexport const mcp = (options: MCPOptions) => {\n\tconst opts = {\n\t\tcodeExpiresIn: 600,\n\t\tdefaultScope: \"openid\",\n\t\taccessTokenExpiresIn: 3600,\n\t\trefreshTokenExpiresIn: 604800,\n\t\tallowPlainCodeChallengeMethod: true,\n\t\t...options.oidcConfig,\n\t\tloginPage: options.loginPage,\n\t\tscopes: [\n\t\t\t\"openid\",\n\t\t\t\"profile\",\n\t\t\t\"email\",\n\t\t\t\"offline_access\",\n\t\t\t...(options.oidcConfig?.scopes || []),\n\t\t],\n\t};\n\tconst modelName = {\n\t\toauthClient: \"oauthApplication\",\n\t\toauthAccessToken: \"oauthAccessToken\",\n\t\toauthConsent: \"oauthConsent\",\n\t};\n\tconst provider = oidcProvider(opts);\n\treturn {\n\t\tid: \"mcp\",\n\t\thooks: {\n\t\t\tafter: [\n\t\t\t\t{\n\t\t\t\t\tmatcher() {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tconst cookie = await ctx.getSignedCookie(\n\t\t\t\t\t\t\t\"oidc_login_prompt\",\n\t\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst cookieName = ctx.context.authCookies.sessionToken.name;\n\t\t\t\t\t\tconst parsedSetCookieHeader = parseSetCookieHeader(\n\t\t\t\t\t\t\tctx.context.responseHeaders?.get(\"set-cookie\") || \"\",\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst hasSessionToken = parsedSetCookieHeader.has(cookieName);\n\t\t\t\t\t\tif (!cookie || !hasSessionToken) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\texpireCookie(ctx, {\n\t\t\t\t\t\t\tname: \"oidc_login_prompt\",\n\t\t\t\t\t\t\tattributes: { path: \"/\" },\n\t\t\t\t\t\t});\n\t\t\t\t\t\tconst sessionCookie = parsedSetCookieHeader.get(cookieName)?.value;\n\t\t\t\t\t\tconst sessionToken = sessionCookie?.split(\".\")[0]!;\n\t\t\t\t\t\tif (!sessionToken) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst session =\n\t\t\t\t\t\t\t(await ctx.context.internalAdapter.findSession(sessionToken)) ||\n\t\t\t\t\t\t\tctx.context.newSession;\n\t\t\t\t\t\tif (!session) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst parsedCookie = safeJSONParse<Record<string, string>>(cookie);\n\t\t\t\t\t\tif (!parsedCookie) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tctx.query = parsedCookie;\n\n\t\t\t\t\t\t// Remove \"login\" from prompt since user just logged in\n\t\t\t\t\t\tconst promptSet = parsePrompt(String(ctx.query?.prompt));\n\t\t\t\t\t\tif (promptSet.has(\"login\")) {\n\t\t\t\t\t\t\tconst newPromptSet = new Set(promptSet);\n\t\t\t\t\t\t\tnewPromptSet.delete(\"login\");\n\t\t\t\t\t\t\tctx.query = {\n\t\t\t\t\t\t\t\t...ctx.query,\n\t\t\t\t\t\t\t\tprompt: Array.from(newPromptSet).join(\" \"),\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tctx.context.session = session;\n\t\t\t\t\t\tconst response = await authorizeMCPOAuth(ctx, opts);\n\t\t\t\t\t\treturn response;\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\tendpoints: {\n\t\t\toAuthConsent: provider.endpoints.oAuthConsent,\n\t\t\tgetMcpOAuthConfig: createAuthEndpoint(\n\t\t\t\t\"/.well-known/oauth-authorization-server\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\tmetadata: HIDE_METADATA,\n\t\t\t\t},\n\t\t\t\tasync (c) => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst metadata = getMCPProviderMetadata(c, options);\n\t\t\t\t\t\treturn c.json(metadata);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t\treturn c.json(null);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t),\n\t\t\tgetMCPProtectedResource: createAuthEndpoint(\n\t\t\t\t\"/.well-known/oauth-protected-resource\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\tmetadata: HIDE_METADATA,\n\t\t\t\t},\n\t\t\t\tasync (c) => {\n\t\t\t\t\tconst metadata = getMCPProtectedResourceMetadata(c, options);\n\t\t\t\t\treturn c.json(metadata);\n\t\t\t\t},\n\t\t\t),\n\t\t\tmcpOAuthAuthorize: createAuthEndpoint(\n\t\t\t\t\"/mcp/authorize\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\tquery: z.record(z.string(), z.any()),\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\tdescription: \"Authorize an OAuth2 request using MCP\",\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\t\t\tdescription: \"Authorization response generated successfully\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tadditionalProperties: true,\n\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Authorization response, contents depend on the authorize function implementation\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\treturn authorizeMCPOAuth(ctx, opts);\n\t\t\t\t},\n\t\t\t),\n\t\t\tmcpOAuthToken: createAuthEndpoint(\n\t\t\t\t\"/mcp/token\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tbody: mcpOAuthTokenBodySchema,\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\t...HIDE_METADATA,\n\t\t\t\t\t\tallowedMediaTypes: [\n\t\t\t\t\t\t\t\"application/x-www-form-urlencoded\",\n\t\t\t\t\t\t\t\"application/json\",\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\t//cors\n\t\t\t\t\tctx.setHeader(\"Access-Control-Allow-Origin\", \"*\");\n\t\t\t\t\tctx.setHeader(\"Access-Control-Allow-Methods\", \"POST, OPTIONS\");\n\t\t\t\t\tctx.setHeader(\n\t\t\t\t\t\t\"Access-Control-Allow-Headers\",\n\t\t\t\t\t\t\"Content-Type, Authorization\",\n\t\t\t\t\t);\n\t\t\t\t\tctx.setHeader(\"Access-Control-Max-Age\", \"86400\");\n\n\t\t\t\t\tlet { body } = ctx;\n\t\t\t\t\tif (!body) {\n\t\t\t\t\t\tthrow ctx.error(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\terror_description: \"request body not found\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (body instanceof FormData) {\n\t\t\t\t\t\tbody = Object.fromEntries(body.entries());\n\t\t\t\t\t}\n\t\t\t\t\tif (!(body instanceof Object)) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\terror_description: \"request body is not an object\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tlet { client_id, client_secret } = body;\n\t\t\t\t\tconst authorization =\n\t\t\t\t\t\tctx.request?.headers.get(\"authorization\") || null;\n\t\t\t\t\tif (\n\t\t\t\t\t\tauthorization &&\n\t\t\t\t\t\t!client_id &&\n\t\t\t\t\t\t!client_secret &&\n\t\t\t\t\t\tauthorization.startsWith(\"Basic \")\n\t\t\t\t\t) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst encoded = authorization.replace(\"Basic \", \"\");\n\t\t\t\t\t\t\tconst decoded = new TextDecoder().decode(base64.decode(encoded));\n\t\t\t\t\t\t\tif (!decoded.includes(\":\")) {\n\t\t\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\t\t\terror_description: \"invalid authorization header format\",\n\t\t\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconst [id, secret] = decoded.split(\":\");\n\t\t\t\t\t\t\tif (!id || !secret) {\n\t\t\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\t\t\terror_description: \"invalid authorization header format\",\n\t\t\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tclient_id = id;\n\t\t\t\t\t\t\tclient_secret = secret;\n\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\t\terror_description: \"invalid authorization header format\",\n\t\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tconst {\n\t\t\t\t\t\tgrant_type,\n\t\t\t\t\t\tcode,\n\t\t\t\t\t\tredirect_uri,\n\t\t\t\t\t\trefresh_token,\n\t\t\t\t\t\tcode_verifier,\n\t\t\t\t\t} = body;\n\t\t\t\t\tif (grant_type === \"refresh_token\") {\n\t\t\t\t\t\tif (!refresh_token) {\n\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\terror_description: \"refresh_token is required\",\n\t\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst token = await ctx.context.adapter.findOne<OAuthAccessToken>({\n\t\t\t\t\t\t\tmodel: \"oauthAccessToken\",\n\t\t\t\t\t\t\twhere: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tfield: \"refreshToken\",\n\t\t\t\t\t\t\t\t\tvalue: refresh_token.toString(),\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (!token) {\n\t\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\t\terror_description: \"invalid refresh token\",\n\t\t\t\t\t\t\t\terror: \"invalid_grant\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (token.clientId !== client_id?.toString()) {\n\t\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\t\terror_description: \"invalid client_id\",\n\t\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (token.refreshTokenExpiresAt < new Date()) {\n\t\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\t\terror_description: \"refresh token expired\",\n\t\t\t\t\t\t\t\terror: \"invalid_grant\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst accessToken = generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\t\t\tconst newRefreshToken = generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\t\t\tconst accessTokenExpiresAt = new Date(\n\t\t\t\t\t\t\tDate.now() + opts.accessTokenExpiresIn * 1000,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst refreshTokenExpiresAt = new Date(\n\t\t\t\t\t\t\tDate.now() + opts.refreshTokenExpiresIn * 1000,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\t\t\tmodel: modelName.oauthAccessToken,\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\taccessToken,\n\t\t\t\t\t\t\t\trefreshToken: newRefreshToken,\n\t\t\t\t\t\t\t\taccessTokenExpiresAt,\n\t\t\t\t\t\t\t\trefreshTokenExpiresAt,\n\t\t\t\t\t\t\t\tclientId: client_id.toString(),\n\t\t\t\t\t\t\t\tuserId: token.userId,\n\t\t\t\t\t\t\t\tscopes: token.scopes,\n\t\t\t\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t\t\t\t\tupdatedAt: new Date(),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\t\taccess_token: accessToken,\n\t\t\t\t\t\t\ttoken_type: \"bearer\",\n\t\t\t\t\t\t\texpires_in: opts.accessTokenExpiresIn,\n\t\t\t\t\t\t\trefresh_token: newRefreshToken,\n\t\t\t\t\t\t\tscope: token.scopes,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!code) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\terror_description: \"code is required\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (opts.requirePKCE && !code_verifier) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\terror_description: \"code verifier is missing\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t/**\n\t\t\t\t\t * We need to check if the code is valid before we can proceed\n\t\t\t\t\t * with the rest of the request.\n\t\t\t\t\t */\n\t\t\t\t\tconst verificationValue =\n\t\t\t\t\t\tawait ctx.context.internalAdapter.findVerificationValue(\n\t\t\t\t\t\t\tcode.toString(),\n\t\t\t\t\t\t);\n\t\t\t\t\tif (!verificationValue) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"invalid code\",\n\t\t\t\t\t\t\terror: \"invalid_grant\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (verificationValue.expiresAt < new Date()) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"code expired\",\n\t\t\t\t\t\t\terror: \"invalid_grant\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(\n\t\t\t\t\t\tverificationValue.id,\n\t\t\t\t\t);\n\n\t\t\t\t\tif (!client_id) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"client_id is required\",\n\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (!grant_type) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\terror_description: \"grant_type is required\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (grant_type !== \"authorization_code\") {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\terror_description: \"grant_type must be 'authorization_code'\",\n\t\t\t\t\t\t\terror: \"unsupported_grant_type\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!redirect_uri) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\terror_description: \"redirect_uri is required\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tconst client = await ctx.context.adapter\n\t\t\t\t\t\t.findOne<Record<string, any>>({\n\t\t\t\t\t\t\tmodel: modelName.oauthClient,\n\t\t\t\t\t\t\twhere: [{ field: \"clientId\", value: client_id.toString() }],\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then((res) => {\n\t\t\t\t\t\t\tif (!res) {\n\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t...res,\n\t\t\t\t\t\t\t\tredirectUrls: res.redirectUrls.split(\",\"),\n\t\t\t\t\t\t\t\tmetadata: res.metadata ? JSON.parse(res.metadata) : {},\n\t\t\t\t\t\t\t} as Client;\n\t\t\t\t\t\t});\n\t\t\t\t\tif (!client) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"invalid client_id\",\n\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (client.disabled) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"client is disabled\",\n\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\t// For public clients (type: 'public'), validate PKCE instead of client_secret\n\t\t\t\t\tif (client.type === \"public\") {\n\t\t\t\t\t\t// Public clients must use PKCE\n\t\t\t\t\t\tif (!code_verifier) {\n\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\terror_description:\n\t\t\t\t\t\t\t\t\t\"code verifier is required for public clients\",\n\t\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// PKCE validation happens later in the flow, so we skip client_secret validation\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// For confidential clients, validate client_secret\n\t\t\t\t\t\tif (!client_secret) {\n\t\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\t\terror_description:\n\t\t\t\t\t\t\t\t\t\"client_secret is required for confidential clients\",\n\t\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst isValidSecret =\n\t\t\t\t\t\t\tclient.clientSecret === client_secret.toString();\n\t\t\t\t\t\tif (!isValidSecret) {\n\t\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\t\terror_description: \"invalid client_secret\",\n\t\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tconst value = JSON.parse(\n\t\t\t\t\t\tverificationValue.value,\n\t\t\t\t\t) as CodeVerificationValue;\n\t\t\t\t\tif (value.clientId !== client_id.toString()) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"invalid client_id\",\n\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (value.redirectURI !== redirect_uri.toString()) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"invalid redirect_uri\",\n\t\t\t\t\t\t\terror: \"invalid_client\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (value.codeChallenge && !code_verifier) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\terror_description: \"code verifier is missing\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tconst challenge =\n\t\t\t\t\t\tvalue.codeChallengeMethod === \"plain\"\n\t\t\t\t\t\t\t? code_verifier\n\t\t\t\t\t\t\t: await createHash(\"SHA-256\", \"base64urlnopad\").digest(\n\t\t\t\t\t\t\t\t\tcode_verifier,\n\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\tif (challenge !== value.codeChallenge) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"code verification failed\",\n\t\t\t\t\t\t\terror: \"invalid_request\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tconst requestedScopes = value.scope;\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(\n\t\t\t\t\t\tverificationValue.id,\n\t\t\t\t\t);\n\t\t\t\t\tconst accessToken = generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\t\tconst refreshToken = generateRandomString(32, \"A-Z\", \"a-z\");\n\t\t\t\t\tconst accessTokenExpiresAt = new Date(\n\t\t\t\t\t\tDate.now() + opts.accessTokenExpiresIn * 1000,\n\t\t\t\t\t);\n\t\t\t\t\tconst refreshTokenExpiresAt = new Date(\n\t\t\t\t\t\tDate.now() + opts.refreshTokenExpiresIn * 1000,\n\t\t\t\t\t);\n\t\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\t\tmodel: modelName.oauthAccessToken,\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\taccessToken,\n\t\t\t\t\t\t\trefreshToken,\n\t\t\t\t\t\t\taccessTokenExpiresAt,\n\t\t\t\t\t\t\trefreshTokenExpiresAt,\n\t\t\t\t\t\t\tclientId: client_id.toString(),\n\t\t\t\t\t\t\tuserId: value.userId,\n\t\t\t\t\t\t\tscopes: requestedScopes.join(\" \"),\n\t\t\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t\t\t\tupdatedAt: new Date(),\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\tconst user = await ctx.context.internalAdapter.findUserById(\n\t\t\t\t\t\tvalue.userId,\n\t\t\t\t\t);\n\t\t\t\t\tif (!user) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\terror_description: \"user not found\",\n\t\t\t\t\t\t\terror: \"invalid_grant\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst secretKey = {\n\t\t\t\t\t\talg: \"HS256\",\n\t\t\t\t\t\tkey: await getWebcryptoSubtle().generateKey(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: \"HMAC\",\n\t\t\t\t\t\t\t\thash: \"SHA-256\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\t[\"sign\", \"verify\"],\n\t\t\t\t\t\t),\n\t\t\t\t\t};\n\t\t\t\t\tconst profile = {\n\t\t\t\t\t\tgiven_name: user.name.split(\" \")[0]!,\n\t\t\t\t\t\tfamily_name: user.name.split(\" \")[1]!,\n\t\t\t\t\t\tname: user.name,\n\t\t\t\t\t\tprofile: user.image,\n\t\t\t\t\t\tupdated_at: Math.floor(new Date(user.updatedAt).getTime() / 1000),\n\t\t\t\t\t};\n\t\t\t\t\tconst email = {\n\t\t\t\t\t\temail: user.email,\n\t\t\t\t\t\temail_verified: user.emailVerified,\n\t\t\t\t\t};\n\t\t\t\t\tconst userClaims = {\n\t\t\t\t\t\t...(requestedScopes.includes(\"profile\") ? profile : {}),\n\t\t\t\t\t\t...(requestedScopes.includes(\"email\") ? email : {}),\n\t\t\t\t\t};\n\n\t\t\t\t\tconst additionalUserClaims = opts.getAdditionalUserInfoClaim\n\t\t\t\t\t\t? await opts.getAdditionalUserInfoClaim(\n\t\t\t\t\t\t\t\tuser,\n\t\t\t\t\t\t\t\trequestedScopes,\n\t\t\t\t\t\t\t\tclient,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t: {};\n\n\t\t\t\t\tconst idToken = await new SignJWT({\n\t\t\t\t\t\tsub: user.id,\n\t\t\t\t\t\taud: client_id.toString(),\n\t\t\t\t\t\tiat: Date.now(),\n\t\t\t\t\t\tauth_time: ctx.context.session\n\t\t\t\t\t\t\t? new Date(ctx.context.session.session.createdAt).getTime()\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\tnonce: value.nonce,\n\t\t\t\t\t\tacr: \"urn:mace:incommon:iap:silver\", // default to silver -  this should be configurable and should be validated against the client's metadata\n\t\t\t\t\t\t...userClaims,\n\t\t\t\t\t\t...additionalUserClaims,\n\t\t\t\t\t})\n\t\t\t\t\t\t.setProtectedHeader({ alg: secretKey.alg })\n\t\t\t\t\t\t.setIssuedAt()\n\t\t\t\t\t\t.setExpirationTime(\n\t\t\t\t\t\t\tMath.floor(Date.now() / 1000) + opts.accessTokenExpiresIn,\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.sign(secretKey.key);\n\t\t\t\t\treturn ctx.json(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\taccess_token: accessToken,\n\t\t\t\t\t\t\ttoken_type: \"Bearer\",\n\t\t\t\t\t\t\texpires_in: opts.accessTokenExpiresIn,\n\t\t\t\t\t\t\trefresh_token: requestedScopes.includes(\"offline_access\")\n\t\t\t\t\t\t\t\t? refreshToken\n\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t\tscope: requestedScopes.join(\" \"),\n\t\t\t\t\t\t\tid_token: requestedScopes.includes(\"openid\")\n\t\t\t\t\t\t\t\t? idToken\n\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t\"Cache-Control\": \"no-store\",\n\t\t\t\t\t\t\t\tPragma: \"no-cache\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t),\n\t\t\tregisterMcpClient: createAuthEndpoint(\n\t\t\t\t\"/mcp/register\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tbody: registerMcpClientBodySchema,\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\tdescription: \"Register an OAuth2 application\",\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\t\t\tdescription: \"OAuth2 application registered successfully\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Name of the OAuth2 application\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\ticon: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Icon URL for the application\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tmetadata: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tadditionalProperties: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Additional metadata for the application\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tclientId: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Unique identifier for the client\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tclientSecret: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Secret key for the client. Not included for public clients.\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tredirectUrls: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\titems: { type: \"string\", format: \"uri\" },\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"List of allowed redirect URLs\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Type of the client\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tenum: [\"web\", \"public\"],\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tauthenticationScheme: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Authentication scheme used by the client\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tenum: [\"client_secret\", \"none\"],\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Whether the client is disabled\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tenum: [false],\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tuserId: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"ID of the user who registered the client, null if registered anonymously\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Creation timestamp\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Last update timestamp\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"name\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"clientId\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"redirectUrls\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"type\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"authenticationScheme\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"disabled\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"updatedAt\",\n\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tconst body = ctx.body;\n\t\t\t\t\tconst session = await getSessionFromCtx(ctx);\n\t\t\t\t\tctx.setHeader(\"Access-Control-Allow-Origin\", \"*\");\n\t\t\t\t\tctx.setHeader(\"Access-Control-Allow-Methods\", \"POST, OPTIONS\");\n\t\t\t\t\tctx.setHeader(\n\t\t\t\t\t\t\"Access-Control-Allow-Headers\",\n\t\t\t\t\t\t\"Content-Type, Authorization\",\n\t\t\t\t\t);\n\t\t\t\t\tctx.setHeader(\"Access-Control-Max-Age\", \"86400\");\n\t\t\t\t\tctx.headers?.set(\"Access-Control-Max-Age\", \"86400\");\n\t\t\t\t\tif (\n\t\t\t\t\t\t(!body.grant_types ||\n\t\t\t\t\t\t\tbody.grant_types.includes(\"authorization_code\") ||\n\t\t\t\t\t\t\tbody.grant_types.includes(\"implicit\")) &&\n\t\t\t\t\t\t(!body.redirect_uris || body.redirect_uris.length === 0)\n\t\t\t\t\t) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\terror: \"invalid_redirect_uri\",\n\t\t\t\t\t\t\terror_description:\n\t\t\t\t\t\t\t\t\"Redirect URIs are required for authorization_code and implicit grant types\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (body.grant_types && body.response_types) {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tbody.grant_types.includes(\"authorization_code\") &&\n\t\t\t\t\t\t\t!body.response_types.includes(\"code\")\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\terror: \"invalid_client_metadata\",\n\t\t\t\t\t\t\t\terror_description:\n\t\t\t\t\t\t\t\t\t\"When 'authorization_code' grant type is used, 'code' response type must be included\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tbody.grant_types.includes(\"implicit\") &&\n\t\t\t\t\t\t\t!body.response_types.includes(\"token\")\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\terror: \"invalid_client_metadata\",\n\t\t\t\t\t\t\t\terror_description:\n\t\t\t\t\t\t\t\t\t\"When 'implicit' grant type is used, 'token' response type must be included\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tconst clientId =\n\t\t\t\t\t\topts.generateClientId?.() || generateRandomString(32, \"a-z\", \"A-Z\");\n\t\t\t\t\tconst clientSecret =\n\t\t\t\t\t\topts.generateClientSecret?.() ||\n\t\t\t\t\t\tgenerateRandomString(32, \"a-z\", \"A-Z\");\n\n\t\t\t\t\t// Determine client type based on auth method\n\t\t\t\t\tconst clientType =\n\t\t\t\t\t\tbody.token_endpoint_auth_method === \"none\" ? \"public\" : \"web\";\n\t\t\t\t\tconst finalClientSecret = clientType === \"public\" ? \"\" : clientSecret;\n\n\t\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\t\tmodel: modelName.oauthClient,\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tname: body.client_name,\n\t\t\t\t\t\t\ticon: body.logo_uri,\n\t\t\t\t\t\t\tmetadata: body.metadata ? JSON.stringify(body.metadata) : null,\n\t\t\t\t\t\t\tclientId: clientId,\n\t\t\t\t\t\t\tclientSecret: finalClientSecret,\n\t\t\t\t\t\t\tredirectUrls: body.redirect_uris.join(\",\"),\n\t\t\t\t\t\t\ttype: clientType,\n\t\t\t\t\t\t\tauthenticationScheme:\n\t\t\t\t\t\t\t\tbody.token_endpoint_auth_method || \"client_secret_basic\",\n\t\t\t\t\t\t\tdisabled: false,\n\t\t\t\t\t\t\tuserId: session?.session.userId,\n\t\t\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t\t\t\tupdatedAt: new Date(),\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\tconst responseData = {\n\t\t\t\t\t\tclient_id: clientId,\n\t\t\t\t\t\tclient_id_issued_at: Math.floor(Date.now() / 1000),\n\t\t\t\t\t\tredirect_uris: body.redirect_uris,\n\t\t\t\t\t\ttoken_endpoint_auth_method:\n\t\t\t\t\t\t\tbody.token_endpoint_auth_method || \"client_secret_basic\",\n\t\t\t\t\t\tgrant_types: body.grant_types || [\"authorization_code\"],\n\t\t\t\t\t\tresponse_types: body.response_types || [\"code\"],\n\t\t\t\t\t\tclient_name: body.client_name,\n\t\t\t\t\t\tclient_uri: body.client_uri,\n\t\t\t\t\t\tlogo_uri: body.logo_uri,\n\t\t\t\t\t\tscope: body.scope,\n\t\t\t\t\t\tcontacts: body.contacts,\n\t\t\t\t\t\ttos_uri: body.tos_uri,\n\t\t\t\t\t\tpolicy_uri: body.policy_uri,\n\t\t\t\t\t\tjwks_uri: body.jwks_uri,\n\t\t\t\t\t\tjwks: body.jwks,\n\t\t\t\t\t\tsoftware_id: body.software_id,\n\t\t\t\t\t\tsoftware_version: body.software_version,\n\t\t\t\t\t\tsoftware_statement: body.software_statement,\n\t\t\t\t\t\tmetadata: body.metadata,\n\t\t\t\t\t\t...(clientType !== \"public\"\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\tclient_secret: finalClientSecret,\n\t\t\t\t\t\t\t\t\tclient_secret_expires_at: 0, // 0 means it doesn't expire\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t: {}),\n\t\t\t\t\t};\n\n\t\t\t\t\treturn new Response(JSON.stringify(responseData), {\n\t\t\t\t\t\tstatus: 201,\n\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\t\t\t\"Cache-Control\": \"no-store\",\n\t\t\t\t\t\t\tPragma: \"no-cache\",\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t),\n\t\t\tgetMcpSession: createAuthEndpoint(\n\t\t\t\t\"/mcp/get-session\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\trequireHeaders: true,\n\t\t\t\t},\n\t\t\t\tasync (c) => {\n\t\t\t\t\tconst accessToken = c.headers\n\t\t\t\t\t\t?.get(\"Authorization\")\n\t\t\t\t\t\t?.replace(\"Bearer \", \"\");\n\t\t\t\t\tif (!accessToken) {\n\t\t\t\t\t\tc.headers?.set(\"WWW-Authenticate\", \"Bearer\");\n\t\t\t\t\t\treturn c.json(null);\n\t\t\t\t\t}\n\t\t\t\t\tconst accessTokenData =\n\t\t\t\t\t\tawait c.context.adapter.findOne<OAuthAccessToken>({\n\t\t\t\t\t\t\tmodel: modelName.oauthAccessToken,\n\t\t\t\t\t\t\twhere: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tfield: \"accessToken\",\n\t\t\t\t\t\t\t\t\tvalue: accessToken,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t});\n\t\t\t\t\tif (!accessTokenData) {\n\t\t\t\t\t\treturn c.json(null);\n\t\t\t\t\t}\n\t\t\t\t\treturn c.json(accessTokenData);\n\t\t\t\t},\n\t\t\t),\n\t\t},\n\t\tschema,\n\t\toptions,\n\t} satisfies BetterAuthPlugin;\n};\n\nexport const withMcpAuth = <\n\tAuth extends {\n\t\tapi: {\n\t\t\tgetMcpSession: (...args: any) => Promise<OAuthAccessToken | null>;\n\t\t};\n\t\toptions: BetterAuthOptions;\n\t},\n>(\n\tauth: Auth,\n\thandler: (\n\t\treq: Request,\n\t\tsession: OAuthAccessToken,\n\t) => Response | Promise<Response>,\n) => {\n\treturn async (req: Request) => {\n\t\tconst baseURL = getBaseURL(auth.options.baseURL, auth.options.basePath);\n\t\tif (!baseURL && !isProduction) {\n\t\t\tlogger.warn(\"Unable to get the baseURL, please check your config!\");\n\t\t}\n\t\tconst session = await auth.api.getMcpSession({\n\t\t\theaders: req.headers,\n\t\t});\n\t\tconst wwwAuthenticateValue = `Bearer resource_metadata=\"${baseURL}/.well-known/oauth-protected-resource\"`;\n\t\tif (!session) {\n\t\t\treturn Response.json(\n\t\t\t\t{\n\t\t\t\t\tjsonrpc: \"2.0\",\n\t\t\t\t\terror: {\n\t\t\t\t\t\tcode: -32000,\n\t\t\t\t\t\tmessage: \"Unauthorized: Authentication required\",\n\t\t\t\t\t\t\"www-authenticate\": wwwAuthenticateValue,\n\t\t\t\t\t},\n\t\t\t\t\tid: null,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tstatus: 401,\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t\"WWW-Authenticate\": wwwAuthenticateValue,\n\t\t\t\t\t\t// we also add this headers otherwise browser based clients will not be able to read the `www-authenticate` header\n\t\t\t\t\t\t\"Access-Control-Expose-Headers\": \"WWW-Authenticate\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\t\treturn handler(req, session);\n\t};\n};\n\nexport const oAuthDiscoveryMetadata = <\n\tAuth extends {\n\t\tapi: {\n\t\t\tgetMcpOAuthConfig: (...args: any) => any;\n\t\t};\n\t},\n>(\n\tauth: Auth,\n) => {\n\treturn async (request: Request) => {\n\t\tconst res = await auth.api.getMcpOAuthConfig();\n\t\treturn new Response(JSON.stringify(res), {\n\t\t\tstatus: 200,\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\"Access-Control-Allow-Origin\": \"*\",\n\t\t\t\t\"Access-Control-Allow-Methods\": \"POST, OPTIONS\",\n\t\t\t\t\"Access-Control-Allow-Headers\": \"Content-Type, Authorization\",\n\t\t\t\t\"Access-Control-Max-Age\": \"86400\",\n\t\t\t},\n\t\t});\n\t};\n};\n\nexport const oAuthProtectedResourceMetadata = <\n\tAuth extends {\n\t\tapi: {\n\t\t\tgetMCPProtectedResource: (...args: any) => any;\n\t\t};\n\t},\n>(\n\tauth: Auth,\n) => {\n\treturn async (request: Request) => {\n\t\tconst res = await auth.api.getMCPProtectedResource();\n\t\treturn new Response(JSON.stringify(res), {\n\t\t\tstatus: 200,\n\t\t\theaders: {\n\t\t\t\t\"Content-Type\": \"application/json\",\n\t\t\t\t\"Access-Control-Allow-Origin\": \"*\",\n\t\t\t\t\"Access-Control-Allow-Methods\": \"POST, OPTIONS\",\n\t\t\t\t\"Access-Control-Allow-Headers\": \"Content-Type, Authorization\",\n\t\t\t\t\"Access-Control-Max-Age\": \"86400\",\n\t\t\t},\n\t\t});\n\t};\n};\n"],"names":["accessToken","accessTokenExpiresAt","refreshTokenExpiresAt"],"mappings":"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"}},
    {"offset": {"line": 11104, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/multi-session/index.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/multi-session/index.ts"],"sourcesContent":["import type { BetterAuthPlugin } from \"@better-auth/core\";\nimport {\n\tcreateAuthEndpoint,\n\tcreateAuthMiddleware,\n} from \"@better-auth/core/api\";\nimport { defineErrorCodes } from \"@better-auth/core/utils\";\nimport * as z from \"zod\";\nimport { APIError, sessionMiddleware } from \"../../api\";\nimport {\n\tdeleteSessionCookie,\n\texpireCookie,\n\tparseCookies,\n\tparseSetCookieHeader,\n\tSECURE_COOKIE_PREFIX,\n\tsetSessionCookie,\n} from \"../../cookies\";\nimport { parseSessionOutput, parseUserOutput } from \"../../db/schema\";\n\nexport interface MultiSessionConfig {\n\t/**\n\t * The maximum number of sessions a user can have\n\t * at a time\n\t * @default 5\n\t */\n\tmaximumSessions?: number | undefined;\n}\n\nconst ERROR_CODES = defineErrorCodes({\n\tINVALID_SESSION_TOKEN: \"Invalid session token\",\n});\n\nconst setActiveSessionBodySchema = z.object({\n\tsessionToken: z.string().meta({\n\t\tdescription: \"The session token to set as active\",\n\t}),\n});\n\nconst revokeDeviceSessionBodySchema = z.object({\n\tsessionToken: z.string().meta({\n\t\tdescription: \"The session token to revoke\",\n\t}),\n});\n\nexport const multiSession = (options?: MultiSessionConfig | undefined) => {\n\tconst opts = {\n\t\tmaximumSessions: 5,\n\t\t...options,\n\t};\n\n\tconst isMultiSessionCookie = (key: string) => key.includes(\"_multi-\");\n\n\treturn {\n\t\tid: \"multi-session\",\n\t\tendpoints: {\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * GET `/multi-session/list-device-sessions`\n\t\t\t *\n\t\t\t * ### API Methods\n\t\t\t *\n\t\t\t * **server:**\n\t\t\t * `auth.api.listDeviceSessions`\n\t\t\t *\n\t\t\t * **client:**\n\t\t\t * `authClient.multiSession.listDeviceSessions`\n\t\t\t *\n\t\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/multi-session#api-method-multi-session-list-device-sessions)\n\t\t\t */\n\t\t\tlistDeviceSessions: createAuthEndpoint(\n\t\t\t\t\"/multi-session/list-device-sessions\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\trequireHeaders: true,\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tconst cookieHeader = ctx.headers?.get(\"cookie\");\n\t\t\t\t\tif (!cookieHeader) return ctx.json([]);\n\n\t\t\t\t\tconst cookies = Object.fromEntries(parseCookies(cookieHeader));\n\t\t\t\t\tconst sessionTokens = (\n\t\t\t\t\t\tawait Promise.all(\n\t\t\t\t\t\t\tObject.entries(cookies)\n\t\t\t\t\t\t\t\t.filter(([key]) => isMultiSessionCookie(key))\n\t\t\t\t\t\t\t\t.map(\n\t\t\t\t\t\t\t\t\tasync ([key]) =>\n\t\t\t\t\t\t\t\t\t\tawait ctx.getSignedCookie(key, ctx.context.secret),\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t)\n\t\t\t\t\t).filter((v) => typeof v === \"string\");\n\n\t\t\t\t\tif (!sessionTokens.length) return ctx.json([]);\n\t\t\t\t\tconst sessions =\n\t\t\t\t\t\tawait ctx.context.internalAdapter.findSessions(sessionTokens);\n\t\t\t\t\tconst validSessions = sessions.filter(\n\t\t\t\t\t\t(session) => session && session.session.expiresAt > new Date(),\n\t\t\t\t\t);\n\t\t\t\t\tconst uniqueUserSessions = validSessions.reduce(\n\t\t\t\t\t\t(acc, session) => {\n\t\t\t\t\t\t\tif (!acc.find((s) => s.user.id === session.user.id)) {\n\t\t\t\t\t\t\t\tacc.push(session);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn acc;\n\t\t\t\t\t\t},\n\t\t\t\t\t\t[] as typeof validSessions,\n\t\t\t\t\t);\n\t\t\t\t\treturn ctx.json(\n\t\t\t\t\t\tuniqueUserSessions.map((item) => ({\n\t\t\t\t\t\t\tsession: parseSessionOutput(ctx.context.options, item.session),\n\t\t\t\t\t\t\tuser: parseUserOutput(ctx.context.options, item.user),\n\t\t\t\t\t\t})),\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t),\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * POST `/multi-session/set-active`\n\t\t\t *\n\t\t\t * ### API Methods\n\t\t\t *\n\t\t\t * **server:**\n\t\t\t * `auth.api.setActiveSession`\n\t\t\t *\n\t\t\t * **client:**\n\t\t\t * `authClient.multiSession.setActive`\n\t\t\t *\n\t\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/multi-session#api-method-multi-session-set-active)\n\t\t\t */\n\t\t\tsetActiveSession: createAuthEndpoint(\n\t\t\t\t\"/multi-session/set-active\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tbody: setActiveSessionBodySchema,\n\t\t\t\t\trequireHeaders: true,\n\t\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\tdescription: \"Set the active session\",\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tsession: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/Session\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tconst sessionToken = ctx.body.sessionToken;\n\t\t\t\t\tconst multiSessionCookieName = `${\n\t\t\t\t\t\tctx.context.authCookies.sessionToken.name\n\t\t\t\t\t}_multi-${sessionToken.toLowerCase()}`;\n\t\t\t\t\tconst sessionCookie = await ctx.getSignedCookie(\n\t\t\t\t\t\tmultiSessionCookieName,\n\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t);\n\t\t\t\t\tif (!sessionCookie) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\tmessage: ERROR_CODES.INVALID_SESSION_TOKEN,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst session =\n\t\t\t\t\t\tawait ctx.context.internalAdapter.findSession(sessionToken);\n\t\t\t\t\tif (!session || session.session.expiresAt < new Date()) {\n\t\t\t\t\t\texpireCookie(ctx, {\n\t\t\t\t\t\t\tname: multiSessionCookieName,\n\t\t\t\t\t\t\tattributes: ctx.context.authCookies.sessionToken.attributes,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\tmessage: ERROR_CODES.INVALID_SESSION_TOKEN,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tawait setSessionCookie(ctx, session);\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\tsession: parseSessionOutput(ctx.context.options, session.session),\n\t\t\t\t\t\tuser: parseUserOutput(ctx.context.options, session.user),\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t),\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * POST `/multi-session/revoke`\n\t\t\t *\n\t\t\t * ### API Methods\n\t\t\t *\n\t\t\t * **server:**\n\t\t\t * `auth.api.revokeDeviceSession`\n\t\t\t *\n\t\t\t * **client:**\n\t\t\t * `authClient.multiSession.revoke`\n\t\t\t *\n\t\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/multi-session#api-method-multi-session-revoke)\n\t\t\t */\n\t\t\trevokeDeviceSession: createAuthEndpoint(\n\t\t\t\t\"/multi-session/revoke\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tbody: revokeDeviceSessionBodySchema,\n\t\t\t\t\trequireHeaders: true,\n\t\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\tdescription: \"Revoke a device session\",\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tstatus: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tconst sessionToken = ctx.body.sessionToken;\n\t\t\t\t\tconst multiSessionCookieName = `${\n\t\t\t\t\t\tctx.context.authCookies.sessionToken.name\n\t\t\t\t\t}_multi-${sessionToken.toLowerCase()}`;\n\t\t\t\t\tconst sessionCookie = await ctx.getSignedCookie(\n\t\t\t\t\t\tmultiSessionCookieName,\n\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t);\n\t\t\t\t\tif (!sessionCookie) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\tmessage: ERROR_CODES.INVALID_SESSION_TOKEN,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteSession(sessionToken);\n\t\t\t\t\texpireCookie(ctx, {\n\t\t\t\t\t\tname: multiSessionCookieName,\n\t\t\t\t\t\tattributes: ctx.context.authCookies.sessionToken.attributes,\n\t\t\t\t\t});\n\t\t\t\t\tconst isActive = ctx.context.session?.session.token === sessionToken;\n\t\t\t\t\tif (!isActive) return ctx.json({ status: true });\n\n\t\t\t\t\tconst cookieHeader = ctx.headers?.get(\"cookie\");\n\t\t\t\t\tif (cookieHeader) {\n\t\t\t\t\t\tconst cookies = Object.fromEntries(parseCookies(cookieHeader));\n\n\t\t\t\t\t\tconst sessionTokens = (\n\t\t\t\t\t\t\tawait Promise.all(\n\t\t\t\t\t\t\t\tObject.entries(cookies)\n\t\t\t\t\t\t\t\t\t.filter(([key]) => isMultiSessionCookie(key))\n\t\t\t\t\t\t\t\t\t.map(\n\t\t\t\t\t\t\t\t\t\tasync ([key]) =>\n\t\t\t\t\t\t\t\t\t\t\tawait ctx.getSignedCookie(key, ctx.context.secret),\n\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t).filter((v) => typeof v === \"string\");\n\t\t\t\t\t\tconst internalAdapter = ctx.context.internalAdapter;\n\n\t\t\t\t\t\tif (sessionTokens.length > 0) {\n\t\t\t\t\t\t\tconst sessions =\n\t\t\t\t\t\t\t\tawait internalAdapter.findSessions(sessionTokens);\n\t\t\t\t\t\t\tconst validSessions = sessions.filter(\n\t\t\t\t\t\t\t\t(session) => session && session.session.expiresAt > new Date(),\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tif (validSessions.length > 0) {\n\t\t\t\t\t\t\t\tconst nextSession = validSessions[0]!;\n\t\t\t\t\t\t\t\tawait setSessionCookie(ctx, nextSession);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdeleteSessionCookie(ctx);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdeleteSessionCookie(ctx);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdeleteSessionCookie(ctx);\n\t\t\t\t\t}\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\tstatus: true,\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t),\n\t\t},\n\t\thooks: {\n\t\t\tafter: [\n\t\t\t\t{\n\t\t\t\t\tmatcher: () => true,\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tconst cookieString = ctx.context.responseHeaders?.get(\"set-cookie\");\n\t\t\t\t\t\tif (!cookieString) return;\n\t\t\t\t\t\tconst newSession = ctx.context.newSession;\n\t\t\t\t\t\tif (!newSession) return;\n\n\t\t\t\t\t\tconst sessionCookieConfig = ctx.context.authCookies.sessionToken;\n\t\t\t\t\t\tconst sessionToken = newSession.session.token;\n\t\t\t\t\t\tconst cookieName = `${sessionCookieConfig.name}_multi-${sessionToken.toLowerCase()}`;\n\n\t\t\t\t\t\tconst setCookies = parseSetCookieHeader(cookieString);\n\t\t\t\t\t\tconst cookies = parseCookies(ctx.headers?.get(\"cookie\") || \"\");\n\t\t\t\t\t\tif (setCookies.get(cookieName) || cookies.get(cookieName)) return;\n\n\t\t\t\t\t\tconst multiSessionKeys = Object.keys(\n\t\t\t\t\t\t\tObject.fromEntries(cookies),\n\t\t\t\t\t\t).filter(isMultiSessionCookie);\n\n\t\t\t\t\t\tconst tokensToDelete: string[] = [];\n\t\t\t\t\t\tfor (const key of multiSessionKeys) {\n\t\t\t\t\t\t\tconst token = await ctx.getSignedCookie(key, ctx.context.secret);\n\t\t\t\t\t\t\tif (!token) continue;\n\t\t\t\t\t\t\tconst session =\n\t\t\t\t\t\t\t\tawait ctx.context.internalAdapter.findSession(token);\n\t\t\t\t\t\t\tif (session?.user.id === newSession.user.id) {\n\t\t\t\t\t\t\t\ttokensToDelete.push(token);\n\t\t\t\t\t\t\t\tctx.setCookie(key, \"\", {\n\t\t\t\t\t\t\t\t\t...sessionCookieConfig.attributes,\n\t\t\t\t\t\t\t\t\tmaxAge: 0,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (tokensToDelete.length > 0) {\n\t\t\t\t\t\t\tawait ctx.context.internalAdapter.deleteSessions(tokensToDelete);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst currentCount =\n\t\t\t\t\t\t\tmultiSessionKeys.length -\n\t\t\t\t\t\t\ttokensToDelete.length +\n\t\t\t\t\t\t\t(cookieString.includes(sessionCookieConfig.name) ? 1 : 0);\n\n\t\t\t\t\t\tif (currentCount > opts.maximumSessions) return;\n\n\t\t\t\t\t\tawait ctx.setSignedCookie(\n\t\t\t\t\t\t\tcookieName,\n\t\t\t\t\t\t\tsessionToken,\n\t\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t\t\tsessionCookieConfig.attributes,\n\t\t\t\t\t\t);\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tmatcher: (context) => context.path === \"/sign-out\",\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tconst cookieHeader = ctx.headers?.get(\"cookie\");\n\t\t\t\t\t\tif (!cookieHeader) return;\n\t\t\t\t\t\tconst cookies = Object.fromEntries(parseCookies(cookieHeader));\n\t\t\t\t\t\tconst multiSessionKeys = Object.keys(cookies).filter((key) =>\n\t\t\t\t\t\t\tisMultiSessionCookie(key),\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst verifiedTokens = (\n\t\t\t\t\t\t\tawait Promise.all(\n\t\t\t\t\t\t\t\tmultiSessionKeys.map(async (key) => {\n\t\t\t\t\t\t\t\t\tconst verifiedToken = await ctx.getSignedCookie(\n\t\t\t\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\tif (verifiedToken) {\n\t\t\t\t\t\t\t\t\t\texpireCookie(ctx, {\n\t\t\t\t\t\t\t\t\t\t\tname: key\n\t\t\t\t\t\t\t\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t\t\t\t\t\t\t\t.replace(\n\t\t\t\t\t\t\t\t\t\t\t\t\tSECURE_COOKIE_PREFIX.toLowerCase(),\n\t\t\t\t\t\t\t\t\t\t\t\t\tSECURE_COOKIE_PREFIX,\n\t\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t\tattributes:\n\t\t\t\t\t\t\t\t\t\t\t\tctx.context.authCookies.sessionToken.attributes,\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\treturn verifiedToken;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t).filter((v) => typeof v === \"string\");\n\t\t\t\t\t\tif (verifiedTokens.length > 0) {\n\t\t\t\t\t\t\tawait ctx.context.internalAdapter.deleteSessions(verifiedTokens);\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\toptions,\n\t\t$ERROR_CODES: ERROR_CODES,\n\t} satisfies BetterAuthPlugin;\n};\n"],"names":["tokensToDelete: string[]"],"mappings":"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"}},
    {"offset": {"line": 11345, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/oauth-proxy/utils.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/oauth-proxy/utils.ts"],"sourcesContent":["import { env } from \"@better-auth/core/env\";\nimport type { EndpointContext } from \"better-call\";\nimport { getOrigin } from \"../../utils/url\";\nimport type { OAuthProxyOptions } from \"./index\";\n\n/**\n * Strip trailing slashes from URL to prevent double slashes\n */\nexport function stripTrailingSlash(url: string | undefined): string {\n\tif (!url) return \"\";\n\treturn url.replace(/\\/+$/, \"\");\n}\n\n/**\n * Get base URL from vendor-specific environment variables\n */\nfunction getVendorBaseURL() {\n\tconst vercel = env.VERCEL_URL ? `https://${env.VERCEL_URL}` : undefined;\n\tconst netlify = env.NETLIFY_URL;\n\tconst render = env.RENDER_URL;\n\tconst aws = env.AWS_LAMBDA_FUNCTION_NAME;\n\tconst google = env.GOOGLE_CLOUD_FUNCTION_NAME;\n\tconst azure = env.AZURE_FUNCTION_NAME;\n\n\treturn vercel || netlify || render || aws || google || azure;\n}\n\n/**\n * Resolve the current URL from various sources\n */\nexport function resolveCurrentURL(\n\tctx: EndpointContext<string, any>,\n\topts?: OAuthProxyOptions,\n) {\n\treturn new URL(\n\t\topts?.currentURL ||\n\t\t\tctx.request?.url ||\n\t\t\tgetVendorBaseURL() ||\n\t\t\tctx.context.baseURL,\n\t);\n}\n\n/**\n * Check if the proxy should be skipped for this request\n */\nexport function checkSkipProxy(\n\tctx: EndpointContext<string, any>,\n\topts?: OAuthProxyOptions,\n) {\n\t// If skip proxy header is set, we don't need to proxy\n\tconst skipProxyHeader = ctx.request?.headers.get(\"x-skip-oauth-proxy\");\n\tif (skipProxyHeader) {\n\t\treturn true;\n\t}\n\n\tconst productionURL = opts?.productionURL || env.BETTER_AUTH_URL;\n\tif (!productionURL) {\n\t\treturn false;\n\t}\n\n\tconst currentURL = ctx.request?.url || getVendorBaseURL();\n\tif (!currentURL) {\n\t\treturn false;\n\t}\n\n\tconst productionOrigin = getOrigin(productionURL);\n\tconst currentOrigin = getOrigin(currentURL);\n\n\treturn productionOrigin === currentOrigin;\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;GAQA,SAAgB,mBAAmB,GAAA,EAAiC;IACnE,IAAI,CAAC,IAAK,CAAA,OAAO;IACjB,OAAO,IAAI,OAAA,CAAQ,QAAQ,GAAG;;;;GAM/B,SAAS,mBAAmB;IAC3B,MAAM,SAAS,gLAAA,CAAI,UAAA,GAAa,CAAA,QAAA,EAAW,gLAAA,CAAI,UAAA,EAAA,GAAe,KAAA;IAC9D,MAAM,UAAU,gLAAA,CAAI,WAAA;IACpB,MAAM,SAAS,gLAAA,CAAI,UAAA;IACnB,MAAM,MAAM,gLAAA,CAAI,wBAAA;IAChB,MAAM,SAAS,gLAAA,CAAI,0BAAA;IACnB,MAAM,QAAQ,gLAAA,CAAI,mBAAA;IAElB,OAAO,UAAU,WAAW,UAAU,OAAO,UAAU;;;;GAMxD,SAAgB,kBACf,GAAA,EACA,IAAA,EACC;IACD,OAAO,IAAI,IACV,MAAM,cACL,IAAI,OAAA,EAAS,OACb,kBAAkB,IAClB,IAAI,OAAA,CAAQ,OAAA,CACb;;;;GAMF,SAAgB,eACf,GAAA,EACA,IAAA,EACC;IAGD,IADwB,IAAI,OAAA,EAAS,QAAQ,IAAI,qBAAqB,CAErE,CAAA,OAAO;IAGR,MAAM,gBAAgB,MAAM,iBAAiB,gLAAA,CAAI,eAAA;IACjD,IAAI,CAAC,cACJ,CAAA,OAAO;IAGR,MAAM,aAAa,IAAI,OAAA,EAAS,OAAO,kBAAkB;IACzD,IAAI,CAAC,WACJ,CAAA,OAAO;IAMR,WAHyB,sKAAA,EAAU,cAAc,SAC3B,sKAAA,EAAU,WAAW"}},
    {"offset": {"line": 11397, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/oauth-proxy/index.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/oauth-proxy/index.ts"],"sourcesContent":["import type { BetterAuthPlugin } from \"@better-auth/core\";\nimport {\n\tcreateAuthEndpoint,\n\tcreateAuthMiddleware,\n} from \"@better-auth/core/api\";\nimport type { CookieOptions } from \"better-call\";\nimport * as z from \"zod\";\nimport { originCheck } from \"../../api\";\nimport { parseJSON } from \"../../client/parser\";\nimport { parseSetCookieHeader, stripSecureCookiePrefix } from \"../../cookies\";\nimport { symmetricDecrypt, symmetricEncrypt } from \"../../crypto\";\nimport { getOrigin } from \"../../utils/url\";\nimport type { AuthContextWithSnapshot, OAuthProxyStatePackage } from \"./types\";\nimport { checkSkipProxy, resolveCurrentURL, stripTrailingSlash } from \"./utils\";\n\nexport interface OAuthProxyOptions {\n\t/**\n\t * The current URL of the application.\n\t * The plugin will attempt to infer the current URL from your environment\n\t * by checking the base URL from popular hosting providers,\n\t * from the request URL if invoked by a client,\n\t * or as a fallback, from the `baseURL` in your auth config.\n\t * If the URL is not inferred correctly, you can provide a value here.\"\n\t */\n\tcurrentURL?: string | undefined;\n\t/**\n\t * If a request in a production url it won't be proxied.\n\t *\n\t * default to `BETTER_AUTH_URL`\n\t */\n\tproductionURL?: string | undefined;\n\t/**\n\t * Maximum age in seconds for the encrypted cookies payload.\n\t * Payloads older than this will be rejected to prevent replay attacks.\n\t *\n\t * Keep this value short (e.g., 30-60 seconds) to minimize the window\n\t * for potential replay attacks while still allowing normal OAuth flows.\n\t *\n\t * @default 60 (1 minute)\n\t */\n\tmaxAge?: number | undefined;\n}\n\ninterface EncryptedCookiesPayload {\n\tcookies: string;\n\ttimestamp: number;\n}\n\nconst oAuthProxyQuerySchema = z.object({\n\tcallbackURL: z.string().meta({\n\t\tdescription: \"The URL to redirect to after the proxy\",\n\t}),\n\tcookies: z.string().meta({\n\t\tdescription: \"The cookies to set after the proxy\",\n\t}),\n});\n\nexport const oAuthProxy = <O extends OAuthProxyOptions>(opts?: O) => {\n\tconst maxAge = opts?.maxAge ?? 60; // Default 60 seconds\n\n\treturn {\n\t\tid: \"oauth-proxy\",\n\t\toptions: opts as NoInfer<O>,\n\t\tendpoints: {\n\t\t\toAuthProxy: createAuthEndpoint(\n\t\t\t\t\"/oauth-proxy-callback\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\toperationId: \"oauthProxyCallback\",\n\t\t\t\t\tquery: oAuthProxyQuerySchema,\n\t\t\t\t\tuse: [originCheck((ctx) => ctx.query.callbackURL)],\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\toperationId: \"oauthProxyCallback\",\n\t\t\t\t\t\t\tdescription: \"OAuth Proxy Callback\",\n\t\t\t\t\t\t\tparameters: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tin: \"query\",\n\t\t\t\t\t\t\t\t\tname: \"callbackURL\",\n\t\t\t\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\t\t\t\tdescription: \"The URL to redirect to after the proxy\",\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tin: \"query\",\n\t\t\t\t\t\t\t\t\tname: \"cookies\",\n\t\t\t\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\t\t\t\tdescription: \"The cookies to set after the proxy\",\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t302: {\n\t\t\t\t\t\t\t\t\tdescription: \"Redirect\",\n\t\t\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t\t\tLocation: {\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"The URL to redirect to\",\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tlet decryptedPayload: string | null = null;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdecryptedPayload = await symmetricDecrypt({\n\t\t\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\t\t\tdata: ctx.query.cookies,\n\t\t\t\t\t\t});\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t\t\t\"Failed to decrypt OAuth proxy cookies:\",\n\t\t\t\t\t\t\te,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!decryptedPayload) {\n\t\t\t\t\t\tconst errorURL =\n\t\t\t\t\t\t\tctx.context.options.onAPIError?.errorURL ||\n\t\t\t\t\t\t\t`${stripTrailingSlash(ctx.context.options.baseURL)}/api/auth/error`;\n\n\t\t\t\t\t\tthrow ctx.redirect(\n\t\t\t\t\t\t\t`${errorURL}?error=OAuthProxy - Invalid cookies or secret`,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet payload: EncryptedCookiesPayload;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tpayload = parseJSON<EncryptedCookiesPayload>(decryptedPayload);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tctx.context.logger.error(\"Failed to parse OAuth proxy payload:\", e);\n\t\t\t\t\t\tconst errorURL =\n\t\t\t\t\t\t\tctx.context.options.onAPIError?.errorURL ||\n\t\t\t\t\t\t\t`${stripTrailingSlash(ctx.context.options.baseURL)}/api/auth/error`;\n\n\t\t\t\t\t\tthrow ctx.redirect(\n\t\t\t\t\t\t\t`${errorURL}?error=OAuthProxy - Invalid payload format`,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tif (\n\t\t\t\t\t\t!payload.cookies ||\n\t\t\t\t\t\ttypeof payload.cookies !== \"string\" ||\n\t\t\t\t\t\ttypeof payload.timestamp !== \"number\"\n\t\t\t\t\t) {\n\t\t\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t\t\t\"OAuth proxy payload missing required fields\",\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst errorURL =\n\t\t\t\t\t\t\tctx.context.options.onAPIError?.errorURL ||\n\t\t\t\t\t\t\t`${stripTrailingSlash(ctx.context.options.baseURL)}/api/auth/error`;\n\n\t\t\t\t\t\tthrow ctx.redirect(\n\t\t\t\t\t\t\t`${errorURL}?error=OAuthProxy - Invalid payload structure`,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst now = Date.now();\n\t\t\t\t\tconst age = (now - payload.timestamp) / 1000;\n\n\t\t\t\t\t// Allow up to 10 seconds of future skew for clock differences\n\t\t\t\t\tif (age > maxAge || age < -10) {\n\t\t\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t\t\t`OAuth proxy payload expired or invalid (age: ${age}s, maxAge: ${maxAge}s)`,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst errorURL =\n\t\t\t\t\t\t\tctx.context.options.onAPIError?.errorURL ||\n\t\t\t\t\t\t\t`${stripTrailingSlash(ctx.context.options.baseURL)}/api/auth/error`;\n\n\t\t\t\t\t\tthrow ctx.redirect(\n\t\t\t\t\t\t\t`${errorURL}?error=OAuthProxy - Payload expired or invalid`,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst decryptedCookies = payload.cookies;\n\n\t\t\t\t\tconst currentURL = resolveCurrentURL(ctx, opts);\n\t\t\t\t\tconst isSecureContext = currentURL.protocol === \"https:\";\n\n\t\t\t\t\tconst parsedCookies = parseSetCookieHeader(decryptedCookies);\n\t\t\t\t\tconst processedCookies = Array.from(parsedCookies.entries()).map(\n\t\t\t\t\t\t([name, attrs]) => {\n\t\t\t\t\t\t\tconst options: CookieOptions = {};\n\t\t\t\t\t\t\tif (attrs.path) {\n\t\t\t\t\t\t\t\toptions.path = attrs.path;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (attrs.expires) {\n\t\t\t\t\t\t\t\toptions.expires = attrs.expires;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (attrs.samesite) {\n\t\t\t\t\t\t\t\toptions.sameSite = attrs.samesite;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (attrs.httponly) {\n\t\t\t\t\t\t\t\toptions.httpOnly = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (attrs[\"max-age\"] !== undefined) {\n\t\t\t\t\t\t\t\toptions.maxAge = attrs[\"max-age\"];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (isSecureContext) {\n\t\t\t\t\t\t\t\toptions.secure = true;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Remove __Secure- or __Host- prefix for non-HTTPS contexts\n\t\t\t\t\t\t\tconst cookieName = isSecureContext\n\t\t\t\t\t\t\t\t? name\n\t\t\t\t\t\t\t\t: stripSecureCookiePrefix(name);\n\n\t\t\t\t\t\t\t// URI-decoded value because `ctx.setCookie` will URI-encode it again\n\t\t\t\t\t\t\tlet cookieValue: string;\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tcookieValue = decodeURIComponent(attrs.value);\n\t\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t\tcookieValue = attrs.value;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tname: cookieName,\n\t\t\t\t\t\t\t\tvalue: cookieValue,\n\t\t\t\t\t\t\t\toptions,\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\n\t\t\t\t\tfor (const cookie of processedCookies) {\n\t\t\t\t\t\t// using `ctx.setHeader` overrides previous Set-Cookie headers\n\t\t\t\t\t\t// so use ctx.setCookie helper instead\n\t\t\t\t\t\t// https://github.com/Bekacru/better-call/blob/d27ac20e64b329a4851e97adf864098a9bc2a260/src/context.ts#L217\n\t\t\t\t\t\tctx.setCookie(cookie.name, cookie.value, cookie.options);\n\t\t\t\t\t}\n\t\t\t\t\tthrow ctx.redirect(ctx.query.callbackURL);\n\t\t\t\t},\n\t\t\t),\n\t\t},\n\t\thooks: {\n\t\t\tbefore: [\n\t\t\t\t{\n\t\t\t\t\tmatcher(context) {\n\t\t\t\t\t\treturn !!(\n\t\t\t\t\t\t\tcontext.path?.startsWith(\"/sign-in/social\") ||\n\t\t\t\t\t\t\tcontext.path?.startsWith(\"/sign-in/oauth2\")\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tconst skipProxy = checkSkipProxy(ctx, opts);\n\t\t\t\t\t\tif (skipProxy) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst currentURL = resolveCurrentURL(ctx, opts);\n\t\t\t\t\t\tconst productionURL = opts?.productionURL;\n\t\t\t\t\t\tconst originalCallbackURL =\n\t\t\t\t\t\t\tctx.body?.callbackURL || ctx.context.baseURL;\n\n\t\t\t\t\t\t// Override baseURL to production so redirect_uri points to production\n\t\t\t\t\t\t// This ensures OAuth provider callbacks go to the production server\n\t\t\t\t\t\tif (productionURL) {\n\t\t\t\t\t\t\tconst productionBaseURL = `${stripTrailingSlash(productionURL)}${ctx.context.options.basePath || \"/api/auth\"}`;\n\t\t\t\t\t\t\tctx.context.baseURL = productionBaseURL;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Construct proxy callback URL\n\t\t\t\t\t\tconst newCallbackURL = `${stripTrailingSlash(currentURL.origin)}${\n\t\t\t\t\t\t\tctx.context.options.basePath || \"/api/auth\"\n\t\t\t\t\t\t}/oauth-proxy-callback?callbackURL=${encodeURIComponent(\n\t\t\t\t\t\t\toriginalCallbackURL,\n\t\t\t\t\t\t)}`;\n\n\t\t\t\t\t\tif (!ctx.body) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tctx.body.callbackURL = newCallbackURL;\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tmatcher(context) {\n\t\t\t\t\t\treturn !!(\n\t\t\t\t\t\t\tcontext.path?.startsWith(\"/callback\") ||\n\t\t\t\t\t\t\tcontext.path?.startsWith(\"/oauth2/callback\")\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tconst state = ctx.query?.state || ctx.body?.state;\n\t\t\t\t\t\tif (!state || typeof state !== \"string\") {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Try to decrypt and parse OAuth proxy state package\n\t\t\t\t\t\tlet statePackage: OAuthProxyStatePackage | undefined;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst decryptedPackage = await symmetricDecrypt({\n\t\t\t\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\t\t\t\tdata: state,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tstatePackage =\n\t\t\t\t\t\t\t\tparseJSON<OAuthProxyStatePackage>(decryptedPackage);\n\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t// Not an OAuth proxy state, continue normally\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t!statePackage.isOAuthProxy ||\n\t\t\t\t\t\t\t!statePackage.state ||\n\t\t\t\t\t\t\t!statePackage.stateCookie\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Decrypt the state cookie content\n\t\t\t\t\t\tlet stateCookieValue: string;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tstateCookieValue = await symmetricDecrypt({\n\t\t\t\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\t\t\t\tdata: statePackage.stateCookie,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tparseJSON(stateCookieValue);\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t\t\t\t\"Failed to decrypt OAuth proxy state cookie:\",\n\t\t\t\t\t\t\t\te,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Snapshot original configuration for restoration in after hook\n\t\t\t\t\t\t(ctx.context as AuthContextWithSnapshot)._oauthProxySnapshot = {\n\t\t\t\t\t\t\tstoreStateStrategy: ctx.context.oauthConfig.storeStateStrategy,\n\t\t\t\t\t\t\tskipStateCookieCheck:\n\t\t\t\t\t\t\t\tctx.context.oauthConfig.skipStateCookieCheck,\n\t\t\t\t\t\t\tinternalAdapter: ctx.context.internalAdapter,\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t// Temporarily switch to database mode and inject verification value\n\t\t\t\t\t\t// This allows the OAuth callback handler to retrieve state data without database\n\t\t\t\t\t\tconst originalAdapter = ctx.context.internalAdapter;\n\t\t\t\t\t\tconst capturedStatePackage = statePackage;\n\t\t\t\t\t\tctx.context.oauthConfig.storeStateStrategy = \"database\";\n\t\t\t\t\t\tctx.context.internalAdapter = {\n\t\t\t\t\t\t\t...ctx.context.internalAdapter,\n\t\t\t\t\t\t\tfindVerificationValue: async (identifier: string) => {\n\t\t\t\t\t\t\t\tif (identifier === capturedStatePackage.state) {\n\t\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\t\tid: `oauth-proxy-${capturedStatePackage.state}`,\n\t\t\t\t\t\t\t\t\t\tidentifier: capturedStatePackage.state,\n\t\t\t\t\t\t\t\t\t\tvalue: stateCookieValue,\n\t\t\t\t\t\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t\t\t\t\t\t\tupdatedAt: new Date(),\n\t\t\t\t\t\t\t\t\t\t// Align expiration time with `generateState` in oauth2\n\t\t\t\t\t\t\t\t\t\texpiresAt: new Date(Date.now() + 10 * 60 * 1000),\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn originalAdapter.findVerificationValue(identifier);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t// Restore original state parameter\n\t\t\t\t\t\tif (ctx.query?.state) {\n\t\t\t\t\t\t\tctx.query.state = statePackage.state;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (ctx.body?.state) {\n\t\t\t\t\t\t\tctx.body.state = statePackage.state;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Enable skipStateCookieCheck for database mode\n\t\t\t\t\t\tctx.context.oauthConfig.skipStateCookieCheck = true;\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tmatcher() {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tif (ctx.path !== \"/callback/:id\") {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (ctx.context.oauthConfig.storeStateStrategy === \"cookie\") {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Skip if OAuth proxy stateless flow already handled by previous hook\n\t\t\t\t\t\tif ((ctx.context as AuthContextWithSnapshot)._oauthProxySnapshot) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst state = ctx.query?.state || ctx.body?.state;\n\t\t\t\t\t\tif (!state) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst data =\n\t\t\t\t\t\t\tawait ctx.context.internalAdapter.findVerificationValue(state);\n\t\t\t\t\t\tif (!data) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet parsedState: { callbackURL?: string } | undefined;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tparsedState = parseJSON<{ callbackURL?: string }>(data.value);\n\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\tparsedState = undefined;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!parsedState?.callbackURL?.includes(\"/oauth-proxy-callback\")) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Snapshot original configuration for restoration in after hook\n\t\t\t\t\t\t(ctx.context as AuthContextWithSnapshot)._oauthProxySnapshot = {\n\t\t\t\t\t\t\tstoreStateStrategy: ctx.context.oauthConfig.storeStateStrategy,\n\t\t\t\t\t\t\tskipStateCookieCheck:\n\t\t\t\t\t\t\t\tctx.context.oauthConfig.skipStateCookieCheck,\n\t\t\t\t\t\t\tinternalAdapter: ctx.context.internalAdapter,\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tctx.context.oauthConfig.skipStateCookieCheck = true;\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t],\n\t\t\tafter: [\n\t\t\t\t{\n\t\t\t\t\tmatcher(context) {\n\t\t\t\t\t\treturn !!(\n\t\t\t\t\t\t\tcontext.path?.startsWith(\"/sign-in/social\") ||\n\t\t\t\t\t\t\tcontext.path?.startsWith(\"/sign-in/oauth2\")\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tconst skipProxy = checkSkipProxy(ctx, opts);\n\t\t\t\t\t\tif (skipProxy) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Only process in stateless mode\n\t\t\t\t\t\tif (ctx.context.oauthConfig.storeStateStrategy !== \"cookie\") {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Extract OAuth provider URL from sign-in response\n\t\t\t\t\t\tconst signInResponse = ctx.context.returned;\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t!signInResponse ||\n\t\t\t\t\t\t\ttypeof signInResponse !== \"object\" ||\n\t\t\t\t\t\t\t!(\"url\" in signInResponse)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst { url: providerURL } = signInResponse;\n\t\t\t\t\t\tif (typeof providerURL !== \"string\") {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Parse provider URL and extract state parameter\n\t\t\t\t\t\tconst oauthURL = new URL(providerURL);\n\t\t\t\t\t\tconst originalState = oauthURL.searchParams.get(\"state\");\n\t\t\t\t\t\tif (!originalState) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Extract state cookie from response headers\n\t\t\t\t\t\tconst headers = ctx.context.responseHeaders;\n\t\t\t\t\t\tconst setCookieHeader = headers?.get(\"set-cookie\");\n\t\t\t\t\t\tif (!setCookieHeader) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst stateCookie = ctx.context.createAuthCookie(\"oauth_state\");\n\t\t\t\t\t\tconst parsedStateCookies = parseSetCookieHeader(setCookieHeader);\n\t\t\t\t\t\tconst stateCookieAttrs = parsedStateCookies.get(stateCookie.name);\n\t\t\t\t\t\tif (!stateCookieAttrs?.value) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst stateCookieValue = stateCookieAttrs.value;\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t// Create and encrypt state package\n\t\t\t\t\t\t\tconst statePackage: OAuthProxyStatePackage = {\n\t\t\t\t\t\t\t\tstate: originalState,\n\t\t\t\t\t\t\t\tstateCookie: stateCookieValue,\n\t\t\t\t\t\t\t\tisOAuthProxy: true,\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tconst encryptedPackage = await symmetricEncrypt({\n\t\t\t\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\t\t\t\tdata: JSON.stringify(statePackage),\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t// Replace state parameter with encrypted package\n\t\t\t\t\t\t\toauthURL.searchParams.set(\"state\", encryptedPackage);\n\n\t\t\t\t\t\t\t// Update response with modified URL\n\t\t\t\t\t\t\tctx.context.returned = {\n\t\t\t\t\t\t\t\t...signInResponse,\n\t\t\t\t\t\t\t\turl: oauthURL.toString(),\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t\t\t\t\"Failed to encrypt OAuth proxy state package:\",\n\t\t\t\t\t\t\t\te,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t// Continue without proxy\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tmatcher(context) {\n\t\t\t\t\t\treturn !!(\n\t\t\t\t\t\t\tcontext.path?.startsWith(\"/callback\") ||\n\t\t\t\t\t\t\tcontext.path?.startsWith(\"/oauth2/callback\")\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tconst headers = ctx.context.responseHeaders;\n\t\t\t\t\t\tconst location = headers?.get(\"location\");\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t!location?.includes(\"/oauth-proxy-callback?callbackURL\") ||\n\t\t\t\t\t\t\t!location.startsWith(\"http\")\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst productionURL =\n\t\t\t\t\t\t\topts?.productionURL ||\n\t\t\t\t\t\t\tctx.context.options.baseURL ||\n\t\t\t\t\t\t\tctx.context.baseURL;\n\t\t\t\t\t\tconst productionOrigin = getOrigin(productionURL);\n\n\t\t\t\t\t\tconst locationURL = new URL(location);\n\t\t\t\t\t\tconst locationOrigin = locationURL.origin;\n\n\t\t\t\t\t\t//\n\t\t\t\t\t\t// Same origin: unwrap proxy redirect to original destination\n\t\t\t\t\t\t//\n\t\t\t\t\t\tif (locationOrigin === productionOrigin) {\n\t\t\t\t\t\t\tconst newLocation = locationURL.searchParams.get(\"callbackURL\");\n\t\t\t\t\t\t\tif (!newLocation) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tctx.setHeader(\"location\", newLocation);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t//\n\t\t\t\t\t\t// Cross-origin: encrypt and forward cookies through proxy\n\t\t\t\t\t\t//\n\t\t\t\t\t\tconst setCookies = headers?.get(\"set-cookie\");\n\t\t\t\t\t\tif (!setCookies) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Create payload with timestamp for replay attack protection\n\t\t\t\t\t\tconst payload: EncryptedCookiesPayload = {\n\t\t\t\t\t\t\tcookies: setCookies,\n\t\t\t\t\t\t\ttimestamp: Date.now(),\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tconst encryptedCookies = await symmetricEncrypt({\n\t\t\t\t\t\t\tkey: ctx.context.secret,\n\t\t\t\t\t\t\tdata: JSON.stringify(payload),\n\t\t\t\t\t\t});\n\t\t\t\t\t\tconst locationWithCookies = `${location}&cookies=${encodeURIComponent(\n\t\t\t\t\t\t\tencryptedCookies,\n\t\t\t\t\t\t)}`;\n\n\t\t\t\t\t\tctx.setHeader(\"location\", locationWithCookies);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t// Restore OAuth config after processing callback\n\t\t\t\t\tmatcher(context) {\n\t\t\t\t\t\treturn !!(\n\t\t\t\t\t\t\tcontext.path?.startsWith(\"/callback\") ||\n\t\t\t\t\t\t\tcontext.path?.startsWith(\"/oauth2/callback\")\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tconst contextWithSnapshot = ctx.context as AuthContextWithSnapshot;\n\t\t\t\t\t\tconst snapshot = contextWithSnapshot._oauthProxySnapshot;\n\t\t\t\t\t\tif (snapshot) {\n\t\t\t\t\t\t\tctx.context.oauthConfig.storeStateStrategy =\n\t\t\t\t\t\t\t\tsnapshot.storeStateStrategy;\n\t\t\t\t\t\t\tctx.context.oauthConfig.skipStateCookieCheck =\n\t\t\t\t\t\t\t\tsnapshot.skipStateCookieCheck;\n\t\t\t\t\t\t\tctx.context.internalAdapter = snapshot.internalAdapter;\n\n\t\t\t\t\t\t\t// Clear the temporary extended context value\n\t\t\t\t\t\t\tcontextWithSnapshot._oauthProxySnapshot = undefined;\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t} satisfies BetterAuthPlugin;\n};\n"],"names":["decryptedPayload: string | null","payload: EncryptedCookiesPayload","options: CookieOptions","cookieValue: string","statePackage: OAuthProxyStatePackage | undefined","stateCookieValue: string","parsedState: { callbackURL?: string } | undefined","statePackage: OAuthProxyStatePackage"],"mappings":"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"}},
    {"offset": {"line": 11736, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/one-tap/index.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/one-tap/index.ts"],"sourcesContent":["import type { BetterAuthPlugin } from \"@better-auth/core\";\nimport { createAuthEndpoint } from \"@better-auth/core/api\";\nimport { createRemoteJWKSet, jwtVerify } from \"jose\";\nimport * as z from \"zod\";\nimport { APIError } from \"../../api\";\nimport { setSessionCookie } from \"../../cookies\";\nimport { parseUserOutput } from \"../../db/schema\";\nimport { toBoolean } from \"../../utils/boolean\";\n\nexport interface OneTapOptions {\n\t/**\n\t * Disable the signup flow\n\t *\n\t * @default false\n\t */\n\tdisableSignup?: boolean | undefined;\n\t/**\n\t * Google Client ID\n\t *\n\t * If a client ID is provided in the social provider configuration,\n\t * it will be used.\n\t */\n\tclientId?: string | undefined;\n}\n\nconst oneTapCallbackBodySchema = z.object({\n\tidToken: z.string().meta({\n\t\tdescription:\n\t\t\t\"Google ID token, which the client obtains from the One Tap API\",\n\t}),\n});\n\nexport const oneTap = (options?: OneTapOptions | undefined) =>\n\t({\n\t\tid: \"one-tap\",\n\t\tendpoints: {\n\t\t\toneTapCallback: createAuthEndpoint(\n\t\t\t\t\"/one-tap/callback\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tbody: oneTapCallbackBodySchema,\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\tsummary: \"One tap callback\",\n\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\"Use this endpoint to authenticate with Google One Tap\",\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\t\t\tdescription: \"Successful response\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tsession: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/Session\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/User\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t400: {\n\t\t\t\t\t\t\t\t\tdescription: \"Invalid token\",\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tconst { idToken } = ctx.body;\n\t\t\t\t\tlet payload: any;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst JWKS = createRemoteJWKSet(\n\t\t\t\t\t\t\tnew URL(\"https://www.googleapis.com/oauth2/v3/certs\"),\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst { payload: verifiedPayload } = await jwtVerify(\n\t\t\t\t\t\t\tidToken,\n\t\t\t\t\t\t\tJWKS,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tissuer: [\"https://accounts.google.com\", \"accounts.google.com\"],\n\t\t\t\t\t\t\t\taudience:\n\t\t\t\t\t\t\t\t\toptions?.clientId ||\n\t\t\t\t\t\t\t\t\tctx.context.options.socialProviders?.google?.clientId,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t);\n\t\t\t\t\t\tpayload = verifiedPayload;\n\t\t\t\t\t} catch {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage: \"invalid id token\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst { email, email_verified, name, picture, sub } = payload;\n\t\t\t\t\tif (!email) {\n\t\t\t\t\t\treturn ctx.json({ error: \"Email not available in token\" });\n\t\t\t\t\t}\n\n\t\t\t\t\tconst user = await ctx.context.internalAdapter.findUserByEmail(email);\n\t\t\t\t\tif (!user) {\n\t\t\t\t\t\tif (options?.disableSignup) {\n\t\t\t\t\t\t\tthrow new APIError(\"BAD_GATEWAY\", {\n\t\t\t\t\t\t\t\tmessage: \"User not found\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst newUser = await ctx.context.internalAdapter.createOAuthUser(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\temail,\n\t\t\t\t\t\t\t\temailVerified:\n\t\t\t\t\t\t\t\t\ttypeof email_verified === \"boolean\"\n\t\t\t\t\t\t\t\t\t\t? email_verified\n\t\t\t\t\t\t\t\t\t\t: toBoolean(email_verified),\n\t\t\t\t\t\t\t\tname,\n\t\t\t\t\t\t\t\timage: picture,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tproviderId: \"google\",\n\t\t\t\t\t\t\t\taccountId: sub,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (!newUser) {\n\t\t\t\t\t\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\t\t\t\t\tmessage: \"Could not create user\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst session = await ctx.context.internalAdapter.createSession(\n\t\t\t\t\t\t\tnewUser.user.id,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\t\t\tuser: newUser.user,\n\t\t\t\t\t\t\tsession,\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\t\ttoken: session.token,\n\t\t\t\t\t\t\tuser: parseUserOutput(ctx.context.options, newUser.user),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst account = await ctx.context.internalAdapter.findAccount(sub);\n\t\t\t\t\tif (!account) {\n\t\t\t\t\t\tconst accountLinking = ctx.context.options.account?.accountLinking;\n\t\t\t\t\t\tconst shouldLinkAccount =\n\t\t\t\t\t\t\taccountLinking?.enabled !== false &&\n\t\t\t\t\t\t\t(accountLinking?.trustedProviders?.includes(\"google\") ||\n\t\t\t\t\t\t\t\temail_verified);\n\t\t\t\t\t\tif (shouldLinkAccount) {\n\t\t\t\t\t\t\tawait ctx.context.internalAdapter.linkAccount({\n\t\t\t\t\t\t\t\tuserId: user.user.id,\n\t\t\t\t\t\t\t\tproviderId: \"google\",\n\t\t\t\t\t\t\t\taccountId: sub,\n\t\t\t\t\t\t\t\tscope: \"openid,profile,email\",\n\t\t\t\t\t\t\t\tidToken,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\t\tmessage: \"Google sub doesn't match\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tconst session = await ctx.context.internalAdapter.createSession(\n\t\t\t\t\t\tuser.user.id,\n\t\t\t\t\t);\n\n\t\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\t\tuser: user.user,\n\t\t\t\t\t\tsession,\n\t\t\t\t\t});\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\ttoken: session.token,\n\t\t\t\t\t\tuser: parseUserOutput(ctx.context.options, user.user),\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t),\n\t\t},\n\t\toptions,\n\t}) satisfies BetterAuthPlugin;\n"],"names":["payload: any","session"],"mappings":"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"}},
    {"offset": {"line": 11877, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/one-time-token/utils.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/one-time-token/utils.ts"],"sourcesContent":["import { base64Url } from \"@better-auth/utils/base64\";\nimport { createHash } from \"@better-auth/utils/hash\";\nexport const defaultKeyHasher = async (token: string) => {\n\tconst hash = await createHash(\"SHA-256\").digest(\n\t\tnew TextEncoder().encode(token),\n\t);\n\tconst hashed = base64Url.encode(new Uint8Array(hash), {\n\t\tpadding: false,\n\t});\n\treturn hashed;\n};\n"],"names":[],"mappings":";;;;;;;;;AAEA,MAAa,mBAAmB,OAAO,UAAkB;IACxD,MAAM,OAAO,UAAM,0KAAA,EAAW,UAAU,CAAC,MAAA,CACxC,IAAI,aAAa,CAAC,MAAA,CAAO,MAAM,CAC/B;IAID,OAHe,2KAAA,CAAU,MAAA,CAAO,IAAI,WAAW,KAAK,EAAE;QACrD,SAAS;IAAA,CACT,CAAC"}},
    {"offset": {"line": 11898, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/one-time-token/index.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/one-time-token/index.ts"],"sourcesContent":["import type {\n\tBetterAuthPlugin,\n\tGenericEndpointContext,\n} from \"@better-auth/core\";\nimport {\n\tcreateAuthEndpoint,\n\tcreateAuthMiddleware,\n} from \"@better-auth/core/api\";\nimport * as z from \"zod\";\nimport { sessionMiddleware } from \"../../api\";\nimport { setSessionCookie } from \"../../cookies\";\nimport { generateRandomString } from \"../../crypto\";\nimport type { Session, User } from \"../../types\";\nimport { defaultKeyHasher } from \"./utils\";\n\nexport interface OneTimeTokenOptions {\n\t/**\n\t * Expires in minutes\n\t *\n\t * @default 3\n\t */\n\texpiresIn?: number | undefined;\n\t/**\n\t * Only allow server initiated requests\n\t */\n\tdisableClientRequest?: boolean | undefined;\n\t/**\n\t * Generate a custom token\n\t */\n\tgenerateToken?:\n\t\t| ((\n\t\t\t\tsession: {\n\t\t\t\t\tuser: User & Record<string, any>;\n\t\t\t\t\tsession: Session & Record<string, any>;\n\t\t\t\t},\n\t\t\t\tctx: GenericEndpointContext,\n\t\t  ) => Promise<string>)\n\t\t| undefined;\n\t/**\n\t * Disable setting the session cookie when the token is verified\n\t */\n\tdisableSetSessionCookie?: boolean;\n\t/**\n\t * This option allows you to configure how the token is stored in your database.\n\t * Note: This will not affect the token that's sent, it will only affect the token stored in your database.\n\t *\n\t * @default \"plain\"\n\t */\n\tstoreToken?:\n\t\t| (\n\t\t\t\t| \"plain\"\n\t\t\t\t| \"hashed\"\n\t\t\t\t| { type: \"custom-hasher\"; hash: (token: string) => Promise<string> }\n\t\t  )\n\t\t| undefined;\n\t/**\n\t * Set the OTT header on new sessions\n\t */\n\tsetOttHeaderOnNewSession?: boolean;\n}\n\nconst verifyOneTimeTokenBodySchema = z.object({\n\ttoken: z.string().meta({\n\t\tdescription: 'The token to verify. Eg: \"some-token\"',\n\t}),\n});\n\nexport const oneTimeToken = (options?: OneTimeTokenOptions | undefined) => {\n\tconst opts = {\n\t\tstoreToken: \"plain\",\n\t\t...options,\n\t} satisfies OneTimeTokenOptions;\n\n\tasync function storeToken(ctx: GenericEndpointContext, token: string) {\n\t\tif (opts.storeToken === \"hashed\") {\n\t\t\treturn await defaultKeyHasher(token);\n\t\t}\n\t\tif (\n\t\t\ttypeof opts.storeToken === \"object\" &&\n\t\t\t\"type\" in opts.storeToken &&\n\t\t\topts.storeToken.type === \"custom-hasher\"\n\t\t) {\n\t\t\treturn await opts.storeToken.hash(token);\n\t\t}\n\n\t\treturn token;\n\t}\n\n\tasync function generateToken(\n\t\tc: GenericEndpointContext,\n\t\tsession: {\n\t\t\tsession: Session;\n\t\t\tuser: User;\n\t\t},\n\t) {\n\t\tconst token = opts?.generateToken\n\t\t\t? await opts.generateToken(session, c)\n\t\t\t: generateRandomString(32);\n\t\tconst expiresAt = new Date(Date.now() + (opts?.expiresIn ?? 3) * 60 * 1000);\n\t\tconst storedToken = await storeToken(c, token);\n\t\tawait c.context.internalAdapter.createVerificationValue({\n\t\t\tvalue: session.session.token,\n\t\t\tidentifier: `one-time-token:${storedToken}`,\n\t\t\texpiresAt,\n\t\t});\n\t\treturn token;\n\t}\n\n\treturn {\n\t\tid: \"one-time-token\",\n\t\tendpoints: {\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * GET `/one-time-token/generate`\n\t\t\t *\n\t\t\t * ### API Methods\n\t\t\t *\n\t\t\t * **server:**\n\t\t\t * `auth.api.generateOneTimeToken`\n\t\t\t *\n\t\t\t * **client:**\n\t\t\t * `authClient.oneTimeToken.generate`\n\t\t\t *\n\t\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/one-time-token#api-method-one-time-token-generate)\n\t\t\t */\n\t\t\tgenerateOneTimeToken: createAuthEndpoint(\n\t\t\t\t\"/one-time-token/generate\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\tuse: [sessionMiddleware],\n\t\t\t\t},\n\t\t\t\tasync (c) => {\n\t\t\t\t\t//if request exist, it means it's a client request\n\t\t\t\t\tif (opts?.disableClientRequest && c.request) {\n\t\t\t\t\t\tthrow c.error(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage: \"Client requests are disabled\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst session = c.context.session;\n\t\t\t\t\tconst token = await generateToken(c, session);\n\t\t\t\t\treturn c.json({ token });\n\t\t\t\t},\n\t\t\t),\n\t\t\t/**\n\t\t\t * ### Endpoint\n\t\t\t *\n\t\t\t * POST `/one-time-token/verify`\n\t\t\t *\n\t\t\t * ### API Methods\n\t\t\t *\n\t\t\t * **server:**\n\t\t\t * `auth.api.verifyOneTimeToken`\n\t\t\t *\n\t\t\t * **client:**\n\t\t\t * `authClient.oneTimeToken.verify`\n\t\t\t *\n\t\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/one-time-token#api-method-one-time-token-verify)\n\t\t\t */\n\t\t\tverifyOneTimeToken: createAuthEndpoint(\n\t\t\t\t\"/one-time-token/verify\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tbody: verifyOneTimeTokenBodySchema,\n\t\t\t\t},\n\t\t\t\tasync (c) => {\n\t\t\t\t\tconst { token } = c.body;\n\t\t\t\t\tconst storedToken = await storeToken(c, token);\n\t\t\t\t\tconst verificationValue =\n\t\t\t\t\t\tawait c.context.internalAdapter.findVerificationValue(\n\t\t\t\t\t\t\t`one-time-token:${storedToken}`,\n\t\t\t\t\t\t);\n\t\t\t\t\tif (!verificationValue) {\n\t\t\t\t\t\tthrow c.error(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage: \"Invalid token\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tawait c.context.internalAdapter.deleteVerificationValue(\n\t\t\t\t\t\tverificationValue.id,\n\t\t\t\t\t);\n\t\t\t\t\tif (verificationValue.expiresAt < new Date()) {\n\t\t\t\t\t\tthrow c.error(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage: \"Token expired\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst session = await c.context.internalAdapter.findSession(\n\t\t\t\t\t\tverificationValue.value,\n\t\t\t\t\t);\n\t\t\t\t\tif (!session) {\n\t\t\t\t\t\tthrow c.error(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage: \"Session not found\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (!opts?.disableSetSessionCookie) {\n\t\t\t\t\t\tawait setSessionCookie(c, session);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (session.session.expiresAt < new Date()) {\n\t\t\t\t\t\tthrow c.error(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage: \"Session expired\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn c.json(session);\n\t\t\t\t},\n\t\t\t),\n\t\t},\n\t\thooks: {\n\t\t\tafter: [\n\t\t\t\t{\n\t\t\t\t\tmatcher: () => true,\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tif (ctx.context.newSession) {\n\t\t\t\t\t\t\tif (!opts?.setOttHeaderOnNewSession) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconst exposedHeaders =\n\t\t\t\t\t\t\t\tctx.context.responseHeaders?.get(\n\t\t\t\t\t\t\t\t\t\"access-control-expose-headers\",\n\t\t\t\t\t\t\t\t) || \"\";\n\t\t\t\t\t\t\tconst headersSet = new Set(\n\t\t\t\t\t\t\t\texposedHeaders\n\t\t\t\t\t\t\t\t\t.split(\",\")\n\t\t\t\t\t\t\t\t\t.map((header) => header.trim())\n\t\t\t\t\t\t\t\t\t.filter(Boolean),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\theadersSet.add(\"set-ott\");\n\t\t\t\t\t\t\tconst token = await generateToken(ctx, ctx.context.newSession);\n\t\t\t\t\t\t\tctx.setHeader(\"set-ott\", token);\n\t\t\t\t\t\t\tctx.setHeader(\n\t\t\t\t\t\t\t\t\"Access-Control-Expose-Headers\",\n\t\t\t\t\t\t\t\tArray.from(headersSet).join(\", \"),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\toptions,\n\t} satisfies BetterAuthPlugin;\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 12015, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/open-api/generator.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/open-api/generator.ts"],"sourcesContent":["import type { AuthContext, BetterAuthOptions } from \"@better-auth/core\";\nimport type {\n\tDBFieldAttribute,\n\tDBFieldAttributeConfig,\n\tDBFieldType,\n} from \"@better-auth/core/db\";\nimport type {\n\tEndpoint,\n\tEndpointOptions,\n\tOpenAPIParameter,\n\tOpenAPISchemaType,\n} from \"better-call\";\nimport * as z from \"zod\";\nimport { getEndpoints } from \"../../api\";\nimport { getAuthTables } from \"../../db\";\n\nexport interface Path {\n\tget?:\n\t\t| {\n\t\t\t\ttags?: string[];\n\t\t\t\toperationId?: string;\n\t\t\t\tdescription?: string;\n\t\t\t\tsecurity?: [{ bearerAuth: string[] }];\n\t\t\t\tparameters?: OpenAPIParameter[];\n\t\t\t\tresponses?: {\n\t\t\t\t\t[key in string]: {\n\t\t\t\t\t\tdescription?: string;\n\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\ttype?: OpenAPISchemaType;\n\t\t\t\t\t\t\t\t\tproperties?: Record<string, any>;\n\t\t\t\t\t\t\t\t\trequired?: string[];\n\t\t\t\t\t\t\t\t\t$ref?: string;\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t};\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t  }\n\t\t| undefined;\n\tpost?:\n\t\t| {\n\t\t\t\ttags?: string[];\n\t\t\t\toperationId?: string;\n\t\t\t\tdescription?: string;\n\t\t\t\tsecurity?: [{ bearerAuth: string[] }];\n\t\t\t\tparameters?: OpenAPIParameter[];\n\t\t\t\trequestBody?: {\n\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\ttype?: OpenAPISchemaType;\n\t\t\t\t\t\t\t\tproperties?: Record<string, any>;\n\t\t\t\t\t\t\t\trequired?: string[];\n\t\t\t\t\t\t\t\t$ref?: string;\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t};\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t\t\tresponses?: {\n\t\t\t\t\t[key in string]: {\n\t\t\t\t\t\tdescription?: string;\n\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\ttype?: OpenAPISchemaType;\n\t\t\t\t\t\t\t\t\tproperties?: Record<string, any>;\n\t\t\t\t\t\t\t\t\trequired?: string[];\n\t\t\t\t\t\t\t\t\t$ref?: string;\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t};\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t  }\n\t\t| undefined;\n}\n\ntype AllowedType = \"string\" | \"number\" | \"boolean\" | \"array\" | \"object\";\nconst allowedType = new Set([\"string\", \"number\", \"boolean\", \"array\", \"object\"]);\nfunction getTypeFromZodType(zodType: z.ZodType<any>) {\n\t// unwrap ZodDefault to get the inner type\n\tif (zodType instanceof z.ZodDefault) {\n\t\treturn getTypeFromZodType(zodType.unwrap() as any);\n\t}\n\tconst type = zodType.type;\n\treturn allowedType.has(type) ? (type as AllowedType) : \"string\";\n}\n\nexport type FieldSchema = {\n\ttype: DBFieldType;\n\tdefault?:\n\t\t| (DBFieldAttributeConfig[\"defaultValue\"] | \"Generated at runtime\")\n\t\t| undefined;\n\treadOnly?: boolean | undefined;\n\tformat?: string;\n};\n\nexport type OpenAPIModelSchema = {\n\ttype: \"object\";\n\tproperties: Record<string, FieldSchema>;\n\trequired?: string[] | undefined;\n};\n\nfunction getFieldSchema(field: DBFieldAttribute) {\n\tconst schema: FieldSchema = {\n\t\ttype: field.type === \"date\" ? \"string\" : field.type,\n\t\t...(field.type === \"date\" && { format: \"date-time\" }),\n\t};\n\n\tif (field.defaultValue !== undefined) {\n\t\tschema.default =\n\t\t\ttypeof field.defaultValue === \"function\"\n\t\t\t\t? \"Generated at runtime\"\n\t\t\t\t: field.defaultValue;\n\t}\n\n\tif (field.input === false) {\n\t\tschema.readOnly = true;\n\t}\n\n\treturn schema;\n}\n\nfunction getParameters(options: EndpointOptions) {\n\tconst parameters: OpenAPIParameter[] = [];\n\tif (options.metadata?.openapi?.parameters) {\n\t\tparameters.push(...options.metadata.openapi.parameters);\n\t\treturn parameters;\n\t}\n\tif (options.query instanceof z.ZodObject) {\n\t\tObject.entries(options.query.shape).forEach(([key, value]) => {\n\t\t\tif (value instanceof z.ZodType) {\n\t\t\t\tparameters.push({\n\t\t\t\t\tname: key,\n\t\t\t\t\tin: \"query\",\n\t\t\t\t\tschema: {\n\t\t\t\t\t\t...processZodType(value as z.ZodType<any>),\n\t\t\t\t\t\t...(\"minLength\" in value && (value as any).minLength\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\tminLength: (value as any).minLength as number,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t: {}),\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\treturn parameters;\n}\n\nfunction getRequestBody(options: EndpointOptions): any {\n\tif (options.metadata?.openapi?.requestBody) {\n\t\treturn options.metadata.openapi.requestBody;\n\t}\n\tif (!options.body) return undefined;\n\tif (\n\t\toptions.body instanceof z.ZodObject ||\n\t\toptions.body instanceof z.ZodOptional\n\t) {\n\t\t// @ts-expect-error\n\t\tconst shape = options.body.shape;\n\t\tif (!shape) return undefined;\n\t\tconst properties: Record<string, any> = {};\n\t\tconst required: string[] = [];\n\t\tObject.entries(shape).forEach(([key, value]) => {\n\t\t\tif (value instanceof z.ZodType) {\n\t\t\t\tproperties[key] = processZodType(value as z.ZodType<any>);\n\t\t\t\tif (!(value instanceof z.ZodOptional)) {\n\t\t\t\t\trequired.push(key);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn {\n\t\t\trequired:\n\t\t\t\toptions.body instanceof z.ZodOptional\n\t\t\t\t\t? false\n\t\t\t\t\t: options.body\n\t\t\t\t\t\t? true\n\t\t\t\t\t\t: false,\n\t\t\tcontent: {\n\t\t\t\t\"application/json\": {\n\t\t\t\t\tschema: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\tproperties,\n\t\t\t\t\t\trequired,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\treturn undefined;\n}\n\nfunction processZodType(zodType: z.ZodType<any>): any {\n\t// optional unwrapping\n\tif (zodType instanceof z.ZodOptional) {\n\t\tconst innerType = zodType.unwrap() as any;\n\t\tconst innerSchema = processZodType(innerType);\n\t\tif (innerSchema.type) {\n\t\t\tconst type = Array.isArray(innerSchema.type)\n\t\t\t\t? innerSchema.type\n\t\t\t\t: [innerSchema.type];\n\t\t\treturn {\n\t\t\t\t...innerSchema,\n\t\t\t\ttype: Array.from(new Set([...type, \"null\"])),\n\t\t\t};\n\t\t}\n\t\treturn {\n\t\t\tanyOf: [innerSchema, { type: \"null\" }],\n\t\t};\n\t}\n\t// default unwrapping\n\tif (zodType instanceof z.ZodDefault) {\n\t\tconst innerType = zodType.unwrap() as any;\n\t\tconst innerSchema = processZodType(innerType);\n\t\tconst defaultValueDef = (zodType as any)._def.defaultValue;\n\t\tconst defaultValue =\n\t\t\ttypeof defaultValueDef === \"function\"\n\t\t\t\t? defaultValueDef()\n\t\t\t\t: defaultValueDef;\n\t\treturn {\n\t\t\t...innerSchema,\n\t\t\tdefault: defaultValue,\n\t\t};\n\t}\n\t// object unwrapping\n\tif (zodType instanceof z.ZodObject) {\n\t\tconst shape = (zodType as any).shape;\n\t\tif (shape) {\n\t\t\tconst properties: Record<string, any> = {};\n\t\t\tconst required: string[] = [];\n\t\t\tObject.entries(shape).forEach(([key, value]) => {\n\t\t\t\tif (value instanceof z.ZodType) {\n\t\t\t\t\tproperties[key] = processZodType(value as z.ZodType<any>);\n\t\t\t\t\tif (!(value instanceof z.ZodOptional)) {\n\t\t\t\t\t\trequired.push(key);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn {\n\t\t\t\ttype: \"object\",\n\t\t\t\tproperties,\n\t\t\t\t...(required.length > 0 ? { required } : {}),\n\t\t\t\tdescription: (zodType as any).description,\n\t\t\t};\n\t\t}\n\t}\n\n\t// For primitive types, get the correct type from the unwrapped ZodType\n\tconst baseSchema = {\n\t\ttype: getTypeFromZodType(zodType),\n\t\tdescription: (zodType as any).description,\n\t};\n\n\treturn baseSchema;\n}\n\nfunction getResponse(responses?: Record<string, any> | undefined) {\n\treturn {\n\t\t\"400\": {\n\t\t\tcontent: {\n\t\t\t\t\"application/json\": {\n\t\t\t\t\tschema: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tmessage: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\trequired: [\"message\"],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\tdescription:\n\t\t\t\t\"Bad Request. Usually due to missing parameters, or invalid parameters.\",\n\t\t},\n\t\t\"401\": {\n\t\t\tcontent: {\n\t\t\t\t\"application/json\": {\n\t\t\t\t\tschema: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tmessage: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\trequired: [\"message\"],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\tdescription: \"Unauthorized. Due to missing or invalid authentication.\",\n\t\t},\n\t\t\"403\": {\n\t\t\tcontent: {\n\t\t\t\t\"application/json\": {\n\t\t\t\t\tschema: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tmessage: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\tdescription:\n\t\t\t\t\"Forbidden. You do not have permission to access this resource or to perform this action.\",\n\t\t},\n\t\t\"404\": {\n\t\t\tcontent: {\n\t\t\t\t\"application/json\": {\n\t\t\t\t\tschema: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tmessage: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\tdescription: \"Not Found. The requested resource was not found.\",\n\t\t},\n\t\t\"429\": {\n\t\t\tcontent: {\n\t\t\t\t\"application/json\": {\n\t\t\t\t\tschema: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tmessage: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\tdescription:\n\t\t\t\t\"Too Many Requests. You have exceeded the rate limit. Try again later.\",\n\t\t},\n\t\t\"500\": {\n\t\t\tcontent: {\n\t\t\t\t\"application/json\": {\n\t\t\t\t\tschema: {\n\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tmessage: {\n\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\tdescription:\n\t\t\t\t\"Internal Server Error. This is a problem with the server that you cannot fix.\",\n\t\t},\n\t\t...responses,\n\t} as any;\n}\n\nfunction toOpenApiPath(path: string) {\n\t// /reset-password/:token -> /reset-password/{token}\n\t// replace all : with {}\n\treturn path\n\t\t.split(\"/\")\n\t\t.map((part) => (part.startsWith(\":\") ? `{${part.slice(1)}}` : part))\n\t\t.join(\"/\");\n}\n\nexport async function generator(ctx: AuthContext, options: BetterAuthOptions) {\n\tconst baseEndpoints = getEndpoints(ctx, {\n\t\t...options,\n\t\tplugins: [],\n\t});\n\n\tconst tables = getAuthTables({\n\t\t...options,\n\t\tsession: {\n\t\t\t...options.session,\n\t\t\tstoreSessionInDatabase: true, // Forcing this to true to return the session table schema\n\t\t},\n\t});\n\tconst models = Object.entries(tables).reduce<\n\t\tRecord<string, OpenAPIModelSchema>\n\t>((acc, [key, value]) => {\n\t\tconst modelName = key.charAt(0).toUpperCase() + key.slice(1);\n\t\tconst fields = value.fields;\n\t\tconst required: string[] = [];\n\t\tconst properties: Record<string, FieldSchema> = {\n\t\t\tid: { type: \"string\" },\n\t\t};\n\t\tObject.entries(fields).forEach(([fieldKey, fieldValue]) => {\n\t\t\tif (!fieldValue) return;\n\t\t\tproperties[fieldKey] = getFieldSchema(fieldValue);\n\t\t\tif (fieldValue.required && fieldValue.input !== false) {\n\t\t\t\trequired.push(fieldKey);\n\t\t\t}\n\t\t});\n\n\t\tObject.entries(properties).forEach(([key, prop]) => {\n\t\t\tconst field = value.fields[key];\n\t\t\tif (field && field.type === \"date\" && prop.type === \"string\") {\n\t\t\t\tprop.format = \"date-time\";\n\t\t\t}\n\t\t});\n\t\tacc[modelName] = {\n\t\t\ttype: \"object\",\n\t\t\tproperties,\n\t\t\trequired,\n\t\t};\n\t\treturn acc;\n\t}, {});\n\n\tconst components = {\n\t\tschemas: {\n\t\t\t...models,\n\t\t},\n\t};\n\n\tconst paths: Record<string, Path> = {};\n\n\tObject.entries(baseEndpoints.api).forEach(([_, value]) => {\n\t\tif (!value.path || ctx.options.disabledPaths?.includes(value.path)) return;\n\t\tconst options = value.options as EndpointOptions;\n\t\tif (options.metadata?.SERVER_ONLY) return;\n\t\tconst path = toOpenApiPath(value.path);\n\t\tif (options.method === \"GET\" || options.method === \"DELETE\") {\n\t\t\tpaths[path] = {\n\t\t\t\t...paths[path],\n\t\t\t\t[options.method.toLowerCase()]: {\n\t\t\t\t\ttags: [\"Default\", ...(options.metadata?.openapi?.tags || [])],\n\t\t\t\t\tdescription: options.metadata?.openapi?.description,\n\t\t\t\t\toperationId: options.metadata?.openapi?.operationId,\n\t\t\t\t\tsecurity: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbearerAuth: [],\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tparameters: getParameters(options),\n\t\t\t\t\tresponses: getResponse(options.metadata?.openapi?.responses),\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\tif (\n\t\t\toptions.method === \"POST\" ||\n\t\t\toptions.method === \"PATCH\" ||\n\t\t\toptions.method === \"PUT\"\n\t\t) {\n\t\t\tconst body = getRequestBody(options);\n\t\t\tpaths[path] = {\n\t\t\t\t...paths[path],\n\t\t\t\t[options.method.toLowerCase()]: {\n\t\t\t\t\ttags: [\"Default\", ...(options.metadata?.openapi?.tags || [])],\n\t\t\t\t\tdescription: options.metadata?.openapi?.description,\n\t\t\t\t\toperationId: options.metadata?.openapi?.operationId,\n\t\t\t\t\tsecurity: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tbearerAuth: [],\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tparameters: getParameters(options),\n\t\t\t\t\t...(body\n\t\t\t\t\t\t? { requestBody: body }\n\t\t\t\t\t\t: {\n\t\t\t\t\t\t\t\trequestBody: {\n\t\t\t\t\t\t\t\t\t//set body none\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {},\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}),\n\t\t\t\t\tresponses: getResponse(options.metadata?.openapi?.responses),\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t});\n\n\tfor (const plugin of options.plugins || []) {\n\t\tif (plugin.id === \"open-api\") {\n\t\t\tcontinue;\n\t\t}\n\t\tconst pluginEndpoints = getEndpoints(ctx, {\n\t\t\t...options,\n\t\t\tplugins: [plugin],\n\t\t});\n\t\tconst api = Object.keys(pluginEndpoints.api)\n\t\t\t.map((key) => {\n\t\t\t\tif (\n\t\t\t\t\tbaseEndpoints.api[key as keyof typeof baseEndpoints.api] === undefined\n\t\t\t\t) {\n\t\t\t\t\treturn pluginEndpoints.api[key as keyof typeof pluginEndpoints.api];\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t})\n\t\t\t.filter((x) => x !== null) as Endpoint[];\n\t\tObject.entries(api).forEach(([key, value]) => {\n\t\t\tif (!value.path || ctx.options.disabledPaths?.includes(value.path))\n\t\t\t\treturn;\n\t\t\tconst options = value.options as EndpointOptions;\n\t\t\tif (options.metadata?.SERVER_ONLY) return;\n\t\t\tconst path = toOpenApiPath(value.path);\n\t\t\tif (options.method === \"GET\" || options.method === \"DELETE\") {\n\t\t\t\tpaths[path] = {\n\t\t\t\t\t...paths[path],\n\t\t\t\t\t[options.method.toLowerCase()]: {\n\t\t\t\t\t\ttags: options.metadata?.openapi?.tags || [\n\t\t\t\t\t\t\tplugin.id.charAt(0).toUpperCase() + plugin.id.slice(1),\n\t\t\t\t\t\t],\n\t\t\t\t\t\tdescription: options.metadata?.openapi?.description,\n\t\t\t\t\t\toperationId: options.metadata?.openapi?.operationId,\n\t\t\t\t\t\tsecurity: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbearerAuth: [],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t\tparameters: getParameters(options),\n\t\t\t\t\t\tresponses: getResponse(options.metadata?.openapi?.responses),\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t}\n\t\t\tif (\n\t\t\t\toptions.method === \"POST\" ||\n\t\t\t\toptions.method === \"PATCH\" ||\n\t\t\t\toptions.method === \"PUT\"\n\t\t\t) {\n\t\t\t\tpaths[path] = {\n\t\t\t\t\t...paths[path],\n\t\t\t\t\t[options.method.toLowerCase()]: {\n\t\t\t\t\t\ttags: options.metadata?.openapi?.tags || [\n\t\t\t\t\t\t\tplugin.id.charAt(0).toUpperCase() + plugin.id.slice(1),\n\t\t\t\t\t\t],\n\t\t\t\t\t\tdescription: options.metadata?.openapi?.description,\n\t\t\t\t\t\toperationId: options.metadata?.openapi?.operationId,\n\t\t\t\t\t\tsecurity: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbearerAuth: [],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t\tparameters: getParameters(options),\n\t\t\t\t\t\trequestBody: getRequestBody(options),\n\t\t\t\t\t\tresponses: getResponse(options.metadata?.openapi?.responses),\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\t}\n\n\tconst res = {\n\t\topenapi: \"3.1.1\",\n\t\tinfo: {\n\t\t\ttitle: \"Better Auth\",\n\t\t\tdescription: \"API Reference for your Better Auth Instance\",\n\t\t\tversion: \"1.1.0\",\n\t\t},\n\t\tcomponents: {\n\t\t\t...components,\n\t\t\tsecuritySchemes: {\n\t\t\t\tapiKeyCookie: {\n\t\t\t\t\ttype: \"apiKey\",\n\t\t\t\t\tin: \"cookie\",\n\t\t\t\t\tname: \"apiKeyCookie\",\n\t\t\t\t\tdescription: \"API Key authentication via cookie\",\n\t\t\t\t},\n\t\t\t\tbearerAuth: {\n\t\t\t\t\ttype: \"http\",\n\t\t\t\t\tscheme: \"bearer\",\n\t\t\t\t\tdescription: \"Bearer token authentication\",\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tsecurity: [\n\t\t\t{\n\t\t\t\tapiKeyCookie: [],\n\t\t\t\tbearerAuth: [],\n\t\t\t},\n\t\t],\n\t\tservers: [\n\t\t\t{\n\t\t\t\turl: ctx.baseURL,\n\t\t\t},\n\t\t],\n\t\ttags: [\n\t\t\t{\n\t\t\t\tname: \"Default\",\n\t\t\t\tdescription:\n\t\t\t\t\t\"Default endpoints that are included with Better Auth by default. These endpoints are not part of any plugin.\",\n\t\t\t},\n\t\t],\n\t\tpaths,\n\t};\n\treturn res;\n}\n"],"names":["schema: FieldSchema","parameters: OpenAPIParameter[]","properties: Record<string, any>","required: string[]","properties: Record<string, FieldSchema>","key","paths: Record<string, Path>","options"],"mappings":"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"}},
    {"offset": {"line": 12464, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/open-api/logo.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/open-api/logo.ts"],"sourcesContent":["export const logo = `<svg width=\"75\" height=\"75\" viewBox=\"0 0 75 75\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n<rect width=\"75\" height=\"75\" fill=\"url(#pattern0_21_12)\"/>\n<defs>\n<pattern id=\"pattern0_21_12\" patternContentUnits=\"objectBoundingBox\" width=\"1\" height=\"1\">\n<use xlink:href=\"#image0_21_12\" transform=\"scale(0.00094697)\"/>\n</pattern>\n<image id=\"image0_21_12\" width=\"1056\" height=\"1056\" xlink:href=\"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAASABIAAD/4QBARXhpZgAATU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAEIKADAAQAAAABAAAEIAAAAAD/7QA4UGhvdG9zaG9wIDMuMAA4QklNBAQAAAAAAAA4QklNBCUAAAAAABDUHYzZjwCyBOmACZjs+EJ+/+ICKElDQ19QUk9GSUxFAAEBAAACGGFwcGwEAAAAbW50clJHQiBYWVogB+YAAQABAAAAAAAAYWNzcEFQUEwAAAAAQVBQTAAAAAAAAAAAAAAAAAAAAAAAAPbWAAEAAAAA0y1hcHBs7P2jjjiFR8NttL1PetoYLwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKZGVzYwAAAPwAAAAwY3BydAAAASwAAABQd3RwdAAAAXwAAAAUclhZWgAAAZAAAAAUZ1hZWgAAAaQAAAAUYlhZWgAAAbgAAAAUclRSQwAAAcwAAAAgY2hhZAAAAewAAAAsYlRSQwAAAcwAAAAgZ1RSQwAAAcwAAAAgbWx1YwAAAAAAAAABAAAADGVuVVMAAAAUAAAAHABEAGkAcwBwAGwAYQB5ACAAUAAzbWx1YwAAAAAAAAABAAAADGVuVVMAAAA0AAAAHABDAG8AcAB5AHIAaQBnAGgAdAAgAEEAcABwAGwAZQAgAEkAbgBjAC4ALAAgADIAMAAyADJYWVogAAAAAAAA9tUAAQAAAADTLFhZWiAAAAAAAACD3wAAPb////+7WFlaIAAAAAAAAEq/AACxNwAACrlYWVogAAAAAAAAKDgAABELAADIuXBhcmEAAAAAAAMAAAACZmYAAPKnAAANWQAAE9AAAApbc2YzMgAAAAAAAQxCAAAF3v//8yYAAAeTAAD9kP//+6L///2jAAAD3AAAwG7/wAARCAQgBCADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9sAQwACAgICAgIDAgIDBAMDAwQFBAQEBAUHBQUFBQUHCAcHBwcHBwgICAgICAgICgoKCgoKCwsLCwsNDQ0NDQ0NDQ0N/9sAQwECAgIDAwMGAwMGDQkHCQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0N/90ABABC/9oADAMBAAIRAxEAPwD9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//Q/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9L9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//T/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//W/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//R/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//U/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9b9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9H9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//S/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9T9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//V/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Ln/gq38a/in8Dvgp4T8R/CfxFdeG9SvvFMdlcXFoELyW5srqQxnzEcY3op4Gciv1Gr8Z/+C2X/JvXgj/sc4v/AE33lAH4z/8ADwv9tD/oq2tf9823/wAZo/4eF/tof9FW1r/vm2/+M18Z0UAfZn/Dwv8AbQ/6KtrX/fNt/wDGaP8Ah4X+2h/0VbWv++bb/wCM18Z0UAfZn/Dwv9tD/oq2tf8AfNt/8Zo/4eF/tof9FW1r/vm2/wDjNfGdFAH2Z/w8L/bQ/wCira1/3zbf/GaP+Hhf7aH/AEVbWv8Avm2/+M18Z0UAfZn/AA8L/bQ/6KtrX/fNt/8AGaP+Hhf7aH/RVta/75tv/jNfGdFAH2Z/w8L/AG0P+ira1/3zbf8Axmj/AIeF/tof9FW1r/vm2/8AjNfGdFAH63/sVftq/tTfEb9qb4deCfG3xF1TVtD1bVGgvbKdYBHPGIJW2ttiVsblB4I6V/UbX8Z//BPT/k9D4U/9hpv/AEmmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+M/wD4eF/tof8ARVta/wC+bb/4zR/w8L/bQ/6KtrX/AHzbf/Ga+M6KAPsz/h4X+2h/0VbWv++bb/4zR/w8L/bQ/wCira1/3zbf/Ga+M6KAPsz/AIeF/tof9FW1r/vm2/8AjNH/AA8L/bQ/6KtrX/fNt/8AGa+M6KAPsz/h4X+2h/0VbWv++bb/AOM0f8PC/wBtD/oq2tf9823/AMZr4zooA+zP+Hhf7aH/AEVbWv8Avm2/+M0f8PC/20P+ira1/wB823/xmvjOigD7M/4eF/tof9FW1r/vm2/+M0f8PC/20P8Aoq2tf9823/xmvjOigD7M/wCHhf7aH/RVta/75tv/AIzR/wAPC/20P+ira1/3zbf/ABmvjOigD7M/4eF/tof9FW1r/vm2/wDjNH/Dwv8AbQ/6KtrX/fNt/wDGa+M6KAPsz/h4X+2h/wBFW1r/AL5tv/jNH/Dwv9tD/oq2tf8AfNt/8Zr4zooA+zP+Hhf7aH/RVta/75tv/jNH/Dwv9tD/AKKtrX/fNt/8Zr4zooA+zP8Ah4X+2h/0VbWv++bb/wCM0f8ADwv9tD/oq2tf9823/wAZr4zooA+zP+Hhf7aH/RVta/75tv8A4zR/w8L/AG0P+ira1/3zbf8AxmvjOigD7M/4eF/tof8ARVta/wC+bb/4zR/w8L/bQ/6KtrX/AHzbf/Ga+M6KAP6tv+CUnxr+Kfxx+CnizxH8WPEV14k1Kx8UyWVvcXYQPHbiytZBGPLRBje7HkZya/Uavxn/AOCJv/JvXjf/ALHOX/032dfsxQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAf//X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/0f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKAPsz/gnp/yeh8Kf+w03/pNNX9mFfxn/APBPT/k9D4U/9hpv/Saav7MKACiiigAooooAKKKKACiiigAooooAKKKKAP4A6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/S/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/1P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKAPsz/gnp/yeh8Kf+w03/pNNX9mFfwq/BT4r638Dvin4d+LHhy0tb7UvDd0bu3t70ObeRzG0eJBGyPjDnowOa/Ub/h9l+0L/ANCR4M/79ah/8m0Af0yUV/M3/wAPsv2hf+hI8Gf9+tQ/+TaP+H2X7Qv/AEJHgz/v1qH/AMm0Af0yUV/M3/w+y/aF/wChI8Gf9+tQ/wDk2j/h9l+0L/0JHgz/AL9ah/8AJtAH9MlFfzN/8Psv2hf+hI8Gf9+tQ/8Ak2j/AIfZftC/9CR4M/79ah/8m0Af0yUV/M3/AMPsv2hf+hI8Gf8AfrUP/k2j/h9l+0L/ANCR4M/79ah/8m0Af0yUV/M3/wAPsv2hf+hI8Gf9+tQ/+TaP+H2X7Qv/AEJHgz/v1qH/AMm0Af0yUV/M3/w+y/aF/wChI8Gf9+tQ/wDk2j/h9l+0L/0JHgz/AL9ah/8AJtAH4z0V/TJ/w5N/Z6/6Hfxn/wB/dP8A/kKj/hyb+z1/0O/jP/v7p/8A8hUAfzN0V/TJ/wAOTf2ev+h38Z/9/dP/APkKj/hyb+z1/wBDv4z/AO/un/8AyFQB/M3RX9Mn/Dk39nr/AKHfxn/390//AOQqP+HJv7PX/Q7+M/8Av7p//wAhUAfzN0V/TJ/w5N/Z6/6Hfxn/AN/dP/8AkKj/AIcm/s9f9Dv4z/7+6f8A/IVAH8zdFf0yf8OTf2ev+h38Z/8Af3T/AP5Co/4cm/s9f9Dv4z/7+6f/APIVAH8zdFf0yf8ADk39nr/od/Gf/f3T/wD5Co/4cm/s9f8AQ7+M/wDv7p//AMhUAfzN0V/TJ/w5N/Z6/wCh38Z/9/dP/wDkKvwV/ag+FGifA74++M/hP4cu7q+03w3fi0t7i9KG4kQxRyZkMaomcueigYoA8FooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/AOxzl/8ATfZ1+zFfjP8A8ETf+TevG/8A2Ocv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/v8ooooAKKKKACiiigAooooAKKKKACiiigAr+M//goX/wAnofFb/sNL/wCk0Nf2YV/Gf/wUL/5PQ+K3/YaX/wBJoaAPjOiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/W/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP7/KKKKACiiigAooooAKKKKACiiigAooooAK/jP/4KF/8AJ6HxW/7DS/8ApNDX9mFfxn/8FC/+T0Pit/2Gl/8ASaGgD4zooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/1/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+/yiiigAooooAKKKKACiiigAooooAKKKKACv4z/+Chf/ACeh8Vv+w0v/AKTQ1/ZhX8Z//BQv/k9D4rf9hpf/AEmhoA+M6KKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/v8ooooAKKKKACiiigAooooAKKKKACiiigAr+M//goX/wAnofFb/sNL/wCk0Nf2YV/Gf/wUL/5PQ+K3/YaX/wBJoaAPjOiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/R/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP7/KKKKACiiigAooooAKKKKACiiigAooooAK/jP/4KF/8AJ6HxW/7DS/8ApNDX9mFfxn/8FC/+T0Pit/2Gl/8ASaGgD4zooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/0v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+/yiiigAooooAKKKKACiiigAooooAKKKKACv4z/+Chf/ACeh8Vv+w0v/AKTQ1/ZhX8Z//BQv/k9D4rf9hpf/AEmhoA+M6KKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD1L4KfCjW/jj8U/Dvwn8OXdrY6l4kujaW9xelxbxuI2kzIY1d8YQ9FJzX6jf8OTf2hf8Aod/Bn/f3UP8A5Cr4z/4J6f8AJ6Hwp/7DTf8ApNNX9mFAH8zf/Dk39oX/AKHfwZ/391D/AOQqP+HJv7Qv/Q7+DP8Av7qH/wAhV/TJRQB/M3/w5N/aF/6HfwZ/391D/wCQqP8Ahyb+0L/0O/gz/v7qH/yFX9MlFAH8zf8Aw5N/aF/6HfwZ/wB/dQ/+QqP+HJv7Qv8A0O/gz/v7qH/yFX9MlFAH8zf/AA5N/aF/6HfwZ/391D/5Co/4cm/tC/8AQ7+DP+/uof8AyFX9MlFAH8zf/Dk39oX/AKHfwZ/391D/AOQqP+HJv7Qv/Q7+DP8Av7qH/wAhV/TJRQB/M3/w5N/aF/6HfwZ/391D/wCQqP8Ahyb+0L/0O/gz/v7qH/yFX9MlFAH4z/8AD7L9nr/oSPGf/frT/wD5No/4fZfs9f8AQkeM/wDv1p//AMm1/M3RQB/TJ/w+y/Z6/wChI8Z/9+tP/wDk2j/h9l+z1/0JHjP/AL9af/8AJtfzN0UAf0yf8Psv2ev+hI8Z/wDfrT//AJNo/wCH2X7PX/QkeM/+/Wn/APybX8zdFAH9Mn/D7L9nr/oSPGf/AH60/wD+TaP+H2X7PX/QkeM/+/Wn/wDybX8zdFAH9Mn/AA+y/Z6/6Ejxn/360/8A+TaP+H2X7PX/AEJHjP8A79af/wDJtfzN0UAf0yf8Psv2ev8AoSPGf/frT/8A5No/4fZfs9f9CR4z/wC/Wn//ACbX8zdFAH9Mn/D7L9nr/oSPGf8A360//wCTa/BX9qD4r6J8cfj74z+LHhy0urHTfEl+Lu3t70ILiNBFHHiQRs6Zyh6MRivBaKACiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/ACb143/7HOX/ANN9nX7MV+M//BE3/k3rxv8A9jnL/wCm+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD//U/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/1v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKAPsz/gnp/yeh8Kf+w03/pNNX9mFfxn/APBPT/k9D4U/9hpv/Saav7MKACiiigAooooAKKKKACiiigAooooAKKKKAP4A6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/0f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+XP/BVv4KfFP44/BTwn4c+E/h268SalY+KY724t7QoHjtxZXUZkPmOgxvdRwc5NAH8pNFfZn/DvT9tD/olOtf99W3/AMeo/wCHen7aH/RKda/76tv/AI9QB8Z0V9mf8O9P20P+iU61/wB9W3/x6j/h3p+2h/0SnWv++rb/AOPUAfGdFfZn/DvT9tD/AKJTrX/fVt/8eo/4d6ftof8ARKda/wC+rb/49QB8Z0V9mf8ADvT9tD/olOtf99W3/wAeo/4d6ftof9Ep1r/vq2/+PUAfGdFfZn/DvT9tD/olOtf99W3/AMeo/wCHen7aH/RKda/76tv/AI9QB8Z0V9mf8O9P20P+iU61/wB9W3/x6j/h3p+2h/0SnWv++rb/AOPUAH/BPT/k9D4U/wDYab/0mmr+zCv5cv2Kv2Kv2pvhz+1N8OvG3jb4dappOh6TqjT3t7O0BjgjMEq7m2ys2NzAcA9a/qNoAKKKKACiiigAooooAKKKKACiiigAooooA/gDor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD4zor7M/4d6ftof9Ep1r/vq2/wDj1H/DvT9tD/olOtf99W3/AMeoA+M6K+zP+Hen7aH/AESnWv8Avq2/+PUf8O9P20P+iU61/wB9W3/x6gD4zor7M/4d6ftof9Ep1r/vq2/+PUf8O9P20P8AolOtf99W3/x6gD4zor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD4zor7M/4d6ftof9Ep1r/vq2/wDj1H/DvT9tD/olOtf99W3/AMeoA+M6K+zP+Hen7aH/AESnWv8Avq2/+PUf8O9P20P+iU61/wB9W3/x6gD4zor7M/4d6ftof9Ep1r/vq2/+PUf8O9P20P8AolOtf99W3/x6gD4zor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD4zor7M/4d6ftof9Ep1r/vq2/wDj1H/DvT9tD/olOtf99W3/AMeoA+M6K+zP+Hen7aH/AESnWv8Avq2/+PUf8O9P20P+iU61/wB9W3/x6gD4zor7M/4d6ftof9Ep1r/vq2/+PUf8O9P20P8AolOtf99W3/x6gD4zor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD9mP+CJv/JvXjf8A7HOX/wBN9nX7MV+XP/BKT4KfFP4HfBTxZ4c+LHh268N6lfeKZL23t7soXktzZWsYkHlu4xvRhyc5FfqNQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAf/9L9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//T/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//W/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//R/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//U/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9b9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9H9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//S/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9T9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//V/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9f9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//Q/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/2Q==\"/>\n</defs>\n</svg>\n`;\n"],"names":[],"mappings":";;;;;AAAA,MAAa,OAAO,CAAA"}},
    {"offset": {"line": 12485, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/open-api/index.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/open-api/index.ts"],"sourcesContent":["import type { BetterAuthPlugin, LiteralString } from \"@better-auth/core\";\nimport { createAuthEndpoint } from \"@better-auth/core/api\";\nimport { APIError } from \"../../api\";\nimport { HIDE_METADATA } from \"../../utils\";\nimport { generator } from \"./generator\";\nimport { logo } from \"./logo\";\n\nexport type { FieldSchema, OpenAPIModelSchema, Path } from \"./generator\";\n\ntype ScalarTheme =\n\t| \"alternate\"\n\t| \"default\"\n\t| \"moon\"\n\t| \"purple\"\n\t| \"solarized\"\n\t| \"bluePlanet\"\n\t| \"saturn\"\n\t| \"kepler\"\n\t| \"mars\"\n\t| \"deepSpace\"\n\t| \"laserwave\"\n\t| \"none\";\n\nconst getHTML = (\n\tapiReference: Record<string, any>,\n\ttheme?: ScalarTheme | undefined,\n\tnonce?: string | undefined,\n) => {\n\tconst nonceAttr = nonce ? `nonce=\"${nonce}\"` : \"\";\n\treturn `<!doctype html>\n<html>\n  <head>\n    <title>Scalar API Reference</title>\n    <meta charset=\"utf-8\" />\n    <meta\n      name=\"viewport\"\n      content=\"width=device-width, initial-scale=1\" />\n  </head>\n  <body>\n    <script\n      id=\"api-reference\"\n      type=\"application/json\">\n    ${JSON.stringify(apiReference)}\n    </script>\n\t <script ${nonceAttr}>\n      var configuration = {\n\t  \tfavicon: \"data:image/svg+xml;utf8,${encodeURIComponent(logo)}\",\n\t   \ttheme: \"${theme || \"default\"}\",\n        metaData: {\n\t\t\ttitle: \"Better Auth API\",\n\t\t\tdescription: \"API Reference for your Better Auth Instance\",\n\t\t}\n      }\n\n      document.getElementById('api-reference').dataset.configuration =\n        JSON.stringify(configuration)\n    </script>\n\t  <script src=\"https://cdn.jsdelivr.net/npm/@scalar/api-reference\" ${nonceAttr}></script>\n  </body>\n</html>`;\n};\n\nexport interface OpenAPIOptions {\n\t/**\n\t * The path to the OpenAPI reference page\n\t *\n\t * keep in mind that this path will be appended to the base URL `/api/auth` path\n\t * by default, so if you set this to `/reference`, the full path will be `/api/auth/reference`\n\t *\n\t * @default \"/reference\"\n\t */\n\tpath?: LiteralString | undefined;\n\t/**\n\t * Disable the default reference page that is generated by Scalar\n\t *\n\t * @default false\n\t */\n\tdisableDefaultReference?: boolean | undefined;\n\t/**\n\t * Theme of the OpenAPI reference page.\n\t *\n\t * @default \"default\"\n\t */\n\ttheme?: ScalarTheme | undefined;\n\t/**\n\t * A 'nonce' string to be attached to inline scripts\n\t * for Content Security Policy (CSP) compliance.\n\t * @default undefined\n\t */\n\tnonce?: string | undefined;\n}\n\nexport const openAPI = <O extends OpenAPIOptions>(options?: O | undefined) => {\n\tconst path = (options?.path ?? \"/reference\") as \"/reference\";\n\treturn {\n\t\tid: \"open-api\",\n\t\tendpoints: {\n\t\t\tgenerateOpenAPISchema: createAuthEndpoint(\n\t\t\t\t\"/open-api/generate-schema\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tconst schema = await generator(ctx.context, ctx.context.options);\n\t\t\t\t\treturn ctx.json(schema);\n\t\t\t\t},\n\t\t\t),\n\t\t\topenAPIReference: createAuthEndpoint(\n\t\t\t\tpath,\n\t\t\t\t{\n\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\tmetadata: HIDE_METADATA,\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tif (options?.disableDefaultReference) {\n\t\t\t\t\t\tthrow new APIError(\"NOT_FOUND\");\n\t\t\t\t\t}\n\t\t\t\t\tconst schema = await generator(ctx.context, ctx.context.options);\n\t\t\t\t\treturn new Response(getHTML(schema, options?.theme, options?.nonce), {\n\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\"Content-Type\": \"text/html\",\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t),\n\t\t},\n\t\toptions: options as NoInfer<O>,\n\t} satisfies BetterAuthPlugin;\n};\n\nexport type * from \"./generator\";\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAuBA,MAAM,UAAA,CACL,cACA,OACA,UACI;IACJ,MAAM,YAAY,QAAQ,CAAA,OAAA,EAAU,MAAM,CAAA,CAAA,GAAK;IAC/C,OAAO,CAAA;;;;;;;;;;;;;MAaF,KAAK,SAAA,CAAU,aAAa,CAAC;;YAEvB,UAAU;;wCAEkB,mBAAmB,mLAAA,CAAK,CAAC;eAClD,SAAS,UAAU;;;;;;;;;;sEAUoC,UAAU;;;;AAmChF,MAAa,UAAA,CAAqC,YAA4B;IAC7E,MAAM,OAAQ,SAAS,QAAQ;IAC/B,OAAO;QACN,IAAI;QACJ,WAAW;YACV,2BAAuB,yLAAA,EACtB,6BACA;gBACC,QAAQ;YAAA,CACR,EACD,OAAO,QAAQ;gBACd,MAAM,SAAS,UAAM,6LAAA,EAAU,IAAI,OAAA,EAAS,IAAI,OAAA,CAAQ,OAAA,CAAQ;gBAChE,OAAO,IAAI,IAAA,CAAK,OAAO;cAExB;YACD,sBAAkB,yLAAA,EACjB,MACA;gBACC,QAAQ;gBACR,UAAU,uLAAA;aACV,EACD,OAAO,QAAQ;gBACd,IAAI,SAAS,wBACZ,CAAA,MAAM,IAAI,8JAAA,CAAS,YAAY;gBAEhC,MAAM,SAAS,UAAM,6LAAA,EAAU,IAAI,OAAA,EAAS,IAAI,OAAA,CAAQ,OAAA,CAAQ;gBAChE,OAAO,IAAI,SAAS,QAAQ,QAAQ,SAAS,OAAO,SAAS,MAAM,EAAE;oBACpE,SAAS;wBACR,gBAAgB;oBAAA,CAChB;gBAAA,CACD,CAAC;cAEH;SACD;QACQ;KACT"}},
    {"offset": {"line": 12570, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/phone-number/error-codes.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/phone-number/error-codes.ts"],"sourcesContent":["import { defineErrorCodes } from \"@better-auth/core/utils\";\n\nexport const PHONE_NUMBER_ERROR_CODES = defineErrorCodes({\n\tINVALID_PHONE_NUMBER: \"Invalid phone number\",\n\tPHONE_NUMBER_EXIST: \"Phone number already exists\",\n\tPHONE_NUMBER_NOT_EXIST: \"phone number isn't registered\",\n\tINVALID_PHONE_NUMBER_OR_PASSWORD: \"Invalid phone number or password\",\n\tUNEXPECTED_ERROR: \"Unexpected error\",\n\tOTP_NOT_FOUND: \"OTP not found\",\n\tOTP_EXPIRED: \"OTP expired\",\n\tINVALID_OTP: \"Invalid OTP\",\n\tPHONE_NUMBER_NOT_VERIFIED: \"Phone number not verified\",\n\tPHONE_NUMBER_CANNOT_BE_UPDATED: \"Phone number cannot be updated\",\n\tSEND_OTP_NOT_IMPLEMENTED: \"sendOTP not implemented\",\n\tTOO_MANY_ATTEMPTS: \"Too many attempts\",\n});\n"],"names":[],"mappings":";;;;;;;;AAEA,MAAa,+BAA2B,kMAAA,EAAiB;IACxD,sBAAsB;IACtB,oBAAoB;IACpB,wBAAwB;IACxB,kCAAkC;IAClC,kBAAkB;IAClB,eAAe;IACf,aAAa;IACb,aAAa;IACb,2BAA2B;IAC3B,gCAAgC;IAChC,0BAA0B;IAC1B,mBAAmB;CACnB,CAAC"}},
    {"offset": {"line": 12598, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/phone-number/routes.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/phone-number/routes.ts"],"sourcesContent":["import { createAuthEndpoint } from \"@better-auth/core/api\";\nimport { BASE_ERROR_CODES } from \"@better-auth/core/error\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { getSessionFromCtx } from \"../../api\";\nimport { setSessionCookie } from \"../../cookies\";\nimport { generateRandomString } from \"../../crypto/random\";\nimport { parseUserOutput } from \"../../db/schema\";\nimport type { User } from \"../../types\";\nimport { getDate } from \"../../utils/date\";\nimport { PHONE_NUMBER_ERROR_CODES } from \"./error-codes\";\nimport type { PhoneNumberOptions, UserWithPhoneNumber } from \"./types\";\n\nexport type RequiredPhoneNumberOptions = PhoneNumberOptions & {\n\texpiresIn: number;\n\totpLength: number;\n\tphoneNumber: string;\n\tphoneNumberVerified: string;\n\tcode: string;\n\tcreatedAt: string;\n};\n\nconst signInPhoneNumberBodySchema = z.object({\n\tphoneNumber: z.string().meta({\n\t\tdescription: 'Phone number to sign in. Eg: \"+1234567890\"',\n\t}),\n\tpassword: z.string().meta({\n\t\tdescription: \"Password to use for sign in.\",\n\t}),\n\trememberMe: z\n\t\t.boolean()\n\t\t.meta({\n\t\t\tdescription: \"Remember the session. Eg: true\",\n\t\t})\n\t\t.optional(),\n});\n\n/**\n * ### Endpoint\n *\n * POST `/sign-in/phone-number`\n *\n * ### API Methods\n *\n * **server:**\n * `auth.api.signInPhoneNumber`\n *\n * **client:**\n * `authClient.signIn.phoneNumber`\n *\n * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/phone-number#api-method-sign-in-phone-number)\n */\nexport const signInPhoneNumber = (opts: RequiredPhoneNumberOptions) =>\n\tcreateAuthEndpoint(\n\t\t\"/sign-in/phone-number\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: signInPhoneNumberBodySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tsummary: \"Sign in with phone number\",\n\t\t\t\t\tdescription: \"Use this endpoint to sign in with phone number\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/User\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tsession: {\n\t\t\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/Session\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\t400: {\n\t\t\t\t\t\t\tdescription: \"Invalid phone number or password\",\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst { password, phoneNumber } = ctx.body;\n\n\t\t\tif (opts.phoneNumberValidator) {\n\t\t\t\tconst isValidNumber = await opts.phoneNumberValidator(\n\t\t\t\t\tctx.body.phoneNumber,\n\t\t\t\t);\n\t\t\t\tif (!isValidNumber) {\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\tmessage: PHONE_NUMBER_ERROR_CODES.INVALID_PHONE_NUMBER,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst user = await ctx.context.adapter.findOne<UserWithPhoneNumber>({\n\t\t\t\tmodel: \"user\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"phoneNumber\",\n\t\t\t\t\t\tvalue: phoneNumber,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\tif (!user) {\n\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\tmessage: PHONE_NUMBER_ERROR_CODES.INVALID_PHONE_NUMBER_OR_PASSWORD,\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (opts.requireVerification) {\n\t\t\t\tif (!user.phoneNumberVerified) {\n\t\t\t\t\tconst otp = generateOTP(opts.otpLength);\n\t\t\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\t\t\tvalue: otp,\n\t\t\t\t\t\tidentifier: phoneNumber,\n\t\t\t\t\t\texpiresAt: getDate(opts.expiresIn, \"sec\"),\n\t\t\t\t\t});\n\t\t\t\t\tif (opts.sendOTP) {\n\t\t\t\t\t\tawait ctx.context.runInBackgroundOrAwait(\n\t\t\t\t\t\t\topts.sendOTP(\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tphoneNumber,\n\t\t\t\t\t\t\t\t\tcode: otp,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tctx,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\tmessage: PHONE_NUMBER_ERROR_CODES.PHONE_NUMBER_NOT_VERIFIED,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst accounts = await ctx.context.internalAdapter.findAccountByUserId(\n\t\t\t\tuser.id,\n\t\t\t);\n\t\t\tconst credentialAccount = accounts.find(\n\t\t\t\t(a) => a.providerId === \"credential\",\n\t\t\t);\n\t\t\tif (!credentialAccount) {\n\t\t\t\tctx.context.logger.error(\"Credential account not found\", {\n\t\t\t\t\tphoneNumber,\n\t\t\t\t});\n\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\tmessage: PHONE_NUMBER_ERROR_CODES.INVALID_PHONE_NUMBER_OR_PASSWORD,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst currentPassword = credentialAccount?.password;\n\t\t\tif (!currentPassword) {\n\t\t\t\tctx.context.logger.error(\"Password not found\", { phoneNumber });\n\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\tmessage: PHONE_NUMBER_ERROR_CODES.UNEXPECTED_ERROR,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst validPassword = await ctx.context.password.verify({\n\t\t\t\thash: currentPassword,\n\t\t\t\tpassword,\n\t\t\t});\n\t\t\tif (!validPassword) {\n\t\t\t\tctx.context.logger.error(\"Invalid password\");\n\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\tmessage: PHONE_NUMBER_ERROR_CODES.INVALID_PHONE_NUMBER_OR_PASSWORD,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst session = await ctx.context.internalAdapter.createSession(\n\t\t\t\tuser.id,\n\t\t\t\tctx.body.rememberMe === false,\n\t\t\t);\n\t\t\tif (!session) {\n\t\t\t\tctx.context.logger.error(\"Failed to create session\");\n\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\tmessage: BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tawait setSessionCookie(\n\t\t\t\tctx,\n\t\t\t\t{\n\t\t\t\t\tsession,\n\t\t\t\t\tuser: user,\n\t\t\t\t},\n\t\t\t\tctx.body.rememberMe === false,\n\t\t\t);\n\t\t\treturn ctx.json({\n\t\t\t\ttoken: session.token,\n\t\t\t\tuser: parseUserOutput(ctx.context.options, user),\n\t\t\t});\n\t\t},\n\t);\n\nconst sendPhoneNumberOTPBodySchema = z.object({\n\tphoneNumber: z.string().meta({\n\t\tdescription: 'Phone number to send OTP. Eg: \"+1234567890\"',\n\t}),\n});\n\n/**\n * ### Endpoint\n *\n * POST `/phone-number/send-otp`\n *\n * ### API Methods\n *\n * **server:**\n * `auth.api.sendPhoneNumberOTP`\n *\n * **client:**\n * `authClient.phoneNumber.sendOtp`\n *\n * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/phone-number#api-method-phone-number-send-otp)\n */\nexport const sendPhoneNumberOTP = (opts: RequiredPhoneNumberOptions) =>\n\tcreateAuthEndpoint(\n\t\t\"/phone-number/send-otp\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: sendPhoneNumberOTPBodySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tsummary: \"Send OTP to phone number\",\n\t\t\t\t\tdescription: \"Use this endpoint to send OTP to phone number\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tmessage: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tif (!opts?.sendOTP) {\n\t\t\t\tctx.context.logger.warn(\"sendOTP not implemented\");\n\t\t\t\tthrow new APIError(\"NOT_IMPLEMENTED\", {\n\t\t\t\t\tmessage: PHONE_NUMBER_ERROR_CODES.SEND_OTP_NOT_IMPLEMENTED,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (opts.phoneNumberValidator) {\n\t\t\t\tconst isValidNumber = await opts.phoneNumberValidator(\n\t\t\t\t\tctx.body.phoneNumber,\n\t\t\t\t);\n\t\t\t\tif (!isValidNumber) {\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\tmessage: PHONE_NUMBER_ERROR_CODES.INVALID_PHONE_NUMBER,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst code = generateOTP(opts.otpLength);\n\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\tvalue: `${code}:0`,\n\t\t\t\tidentifier: ctx.body.phoneNumber,\n\t\t\t\texpiresAt: getDate(opts.expiresIn, \"sec\"),\n\t\t\t});\n\t\t\tawait ctx.context.runInBackgroundOrAwait(\n\t\t\t\topts.sendOTP(\n\t\t\t\t\t{\n\t\t\t\t\t\tphoneNumber: ctx.body.phoneNumber,\n\t\t\t\t\t\tcode,\n\t\t\t\t\t},\n\t\t\t\t\tctx,\n\t\t\t\t),\n\t\t\t);\n\t\t\treturn ctx.json({ message: \"code sent\" });\n\t\t},\n\t);\n\nconst verifyPhoneNumberBodySchema = z.object({\n\t/**\n\t * Phone number\n\t */\n\tphoneNumber: z.string().meta({\n\t\tdescription: 'Phone number to verify. Eg: \"+1234567890\"',\n\t}),\n\t/**\n\t * OTP code\n\t */\n\tcode: z.string().meta({\n\t\tdescription: 'OTP code. Eg: \"123456\"',\n\t}),\n\t/**\n\t * Disable session creation after verification\n\t * @default false\n\t */\n\tdisableSession: z\n\t\t.boolean()\n\t\t.meta({\n\t\t\tdescription: \"Disable session creation after verification. Eg: false\",\n\t\t})\n\t\t.optional(),\n\t/**\n\t * This checks if there is a session already\n\t * and updates the phone number with the provided\n\t * phone number\n\t */\n\tupdatePhoneNumber: z\n\t\t.boolean()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t\"Check if there is a session and update the phone number. Eg: true\",\n\t\t})\n\t\t.optional(),\n});\n\n/**\n * ### Endpoint\n *\n * POST `/phone-number/verify`\n *\n * ### API Methods\n *\n * **server:**\n * `auth.api.verifyPhoneNumber`\n *\n * **client:**\n * `authClient.phoneNumber.verify`\n *\n * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/phone-number#api-method-phone-number-verify)\n */\nexport const verifyPhoneNumber = (opts: RequiredPhoneNumberOptions) =>\n\tcreateAuthEndpoint(\n\t\t\"/phone-number/verify\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: verifyPhoneNumberBodySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tsummary: \"Verify phone number\",\n\t\t\t\t\tdescription: \"Use this endpoint to verify phone number\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Phone number verified successfully\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tstatus: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Indicates if the verification was successful\",\n\t\t\t\t\t\t\t\t\t\t\t\tenum: [true],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\ttoken: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Session token if session is created, null if disableSession is true or no session is created\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Unique identifier of the user\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\temail: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"email\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's email address\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\temailVerified: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Whether the email is verified\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's name\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\timage: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"uri\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's profile image URL\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tphoneNumber: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"User's phone number\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tphoneNumberVerified: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Whether the phone number is verified\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Timestamp when the user was created\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Timestamp when the user was last updated\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"phoneNumber\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"phoneNumberVerified\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"updatedAt\",\n\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"User object with phone number details, null if no user is created or found\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\trequired: [\"status\"],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\t400: {\n\t\t\t\t\t\t\tdescription: \"Invalid OTP\",\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tif (opts?.verifyOTP) {\n\t\t\t\t// Use custom verifyOTP if provided\n\t\t\t\tconst isValid = await opts.verifyOTP(\n\t\t\t\t\t{\n\t\t\t\t\t\tphoneNumber: ctx.body.phoneNumber,\n\t\t\t\t\t\tcode: ctx.body.code,\n\t\t\t\t\t},\n\t\t\t\t\tctx,\n\t\t\t\t);\n\n\t\t\t\tif (!isValid) {\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\tmessage: PHONE_NUMBER_ERROR_CODES.INVALID_OTP,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// Clean up verification value\n\t\t\t\tconst otp = await ctx.context.internalAdapter.findVerificationValue(\n\t\t\t\t\tctx.body.phoneNumber,\n\t\t\t\t);\n\t\t\t\tif (otp) {\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(otp.id);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Default internal verification logic\n\t\t\t\tconst otp = await ctx.context.internalAdapter.findVerificationValue(\n\t\t\t\t\tctx.body.phoneNumber,\n\t\t\t\t);\n\n\t\t\t\tif (!otp || otp.expiresAt < new Date()) {\n\t\t\t\t\tif (otp && otp.expiresAt < new Date()) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage: PHONE_NUMBER_ERROR_CODES.OTP_EXPIRED,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\tmessage: PHONE_NUMBER_ERROR_CODES.OTP_NOT_FOUND,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst [otpValue, attempts] = otp.value.split(\":\");\n\t\t\t\tconst allowedAttempts = opts?.allowedAttempts || 3;\n\t\t\t\tif (attempts && parseInt(attempts) >= allowedAttempts) {\n\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(otp.id);\n\t\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\t\tmessage: PHONE_NUMBER_ERROR_CODES.TOO_MANY_ATTEMPTS,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (otpValue !== ctx.body.code) {\n\t\t\t\t\tawait ctx.context.internalAdapter.updateVerificationValue(otp.id, {\n\t\t\t\t\t\tvalue: `${otpValue}:${parseInt(attempts || \"0\") + 1}`,\n\t\t\t\t\t});\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\tmessage: PHONE_NUMBER_ERROR_CODES.INVALID_OTP,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(otp.id);\n\t\t\t}\n\n\t\t\tif (ctx.body.updatePhoneNumber) {\n\t\t\t\tconst session = await getSessionFromCtx(ctx);\n\t\t\t\tif (!session) {\n\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\tmessage: BASE_ERROR_CODES.USER_NOT_FOUND,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst existingUser =\n\t\t\t\t\tawait ctx.context.adapter.findMany<UserWithPhoneNumber>({\n\t\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\t\twhere: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfield: \"phoneNumber\",\n\t\t\t\t\t\t\t\tvalue: ctx.body.phoneNumber,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\t\t\t\tif (existingUser.length) {\n\t\t\t\t\tthrow ctx.error(\"BAD_REQUEST\", {\n\t\t\t\t\t\tmessage: PHONE_NUMBER_ERROR_CODES.PHONE_NUMBER_EXIST,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst user =\n\t\t\t\t\tawait ctx.context.internalAdapter.updateUser<UserWithPhoneNumber>(\n\t\t\t\t\t\tsession.user.id,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t[opts.phoneNumber]: ctx.body.phoneNumber,\n\t\t\t\t\t\t\t[opts.phoneNumberVerified]: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tstatus: true,\n\t\t\t\t\ttoken: session.session.token,\n\t\t\t\t\tuser: parseUserOutput(ctx.context.options, user),\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tlet user = await ctx.context.adapter.findOne<UserWithPhoneNumber>({\n\t\t\t\tmodel: \"user\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: ctx.body.phoneNumber,\n\t\t\t\t\t\tfield: opts.phoneNumber,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\tif (!user) {\n\t\t\t\tif (opts?.signUpOnVerification) {\n\t\t\t\t\tuser =\n\t\t\t\t\t\tawait ctx.context.internalAdapter.createUser<UserWithPhoneNumber>({\n\t\t\t\t\t\t\temail: opts.signUpOnVerification.getTempEmail(\n\t\t\t\t\t\t\t\tctx.body.phoneNumber,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tname: opts.signUpOnVerification.getTempName\n\t\t\t\t\t\t\t\t? opts.signUpOnVerification.getTempName(ctx.body.phoneNumber)\n\t\t\t\t\t\t\t\t: ctx.body.phoneNumber,\n\t\t\t\t\t\t\t[opts.phoneNumber]: ctx.body.phoneNumber,\n\t\t\t\t\t\t\t[opts.phoneNumberVerified]: true,\n\t\t\t\t\t\t});\n\t\t\t\t\tif (!user) {\n\t\t\t\t\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\t\t\t\tmessage: BASE_ERROR_CODES.FAILED_TO_CREATE_USER,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tuser =\n\t\t\t\t\tawait ctx.context.internalAdapter.updateUser<UserWithPhoneNumber>(\n\t\t\t\t\t\tuser.id,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t[opts.phoneNumberVerified]: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t}\n\t\t\tif (!user) {\n\t\t\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\t\tmessage: BASE_ERROR_CODES.FAILED_TO_UPDATE_USER,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tawait opts?.callbackOnVerification?.(\n\t\t\t\t{\n\t\t\t\t\tphoneNumber: ctx.body.phoneNumber,\n\t\t\t\t\tuser,\n\t\t\t\t},\n\t\t\t\tctx,\n\t\t\t);\n\n\t\t\tif (!ctx.body.disableSession) {\n\t\t\t\tconst session = await ctx.context.internalAdapter.createSession(\n\t\t\t\t\tuser.id,\n\t\t\t\t);\n\t\t\t\tif (!session) {\n\t\t\t\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\t\t\tmessage: BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\tsession,\n\t\t\t\t\tuser,\n\t\t\t\t});\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tstatus: true,\n\t\t\t\t\ttoken: session.token,\n\t\t\t\t\tuser: parseUserOutput(ctx.context.options, user),\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn ctx.json({\n\t\t\t\tstatus: true,\n\t\t\t\ttoken: null,\n\t\t\t\tuser: parseUserOutput(ctx.context.options, user),\n\t\t\t});\n\t\t},\n\t);\n\nconst requestPasswordResetPhoneNumberBodySchema = z.object({\n\tphoneNumber: z.string(),\n});\n\nexport const requestPasswordResetPhoneNumber = (\n\topts: RequiredPhoneNumberOptions,\n) =>\n\tcreateAuthEndpoint(\n\t\t\"/phone-number/request-password-reset\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: requestPasswordResetPhoneNumberBodySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"Request OTP for password reset via phone number\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"OTP sent successfully for password reset\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tstatus: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Indicates if the OTP was sent successfully\",\n\t\t\t\t\t\t\t\t\t\t\t\tenum: [true],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\trequired: [\"status\"],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst user = await ctx.context.adapter.findOne<UserWithPhoneNumber>({\n\t\t\t\tmodel: \"user\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: ctx.body.phoneNumber,\n\t\t\t\t\t\tfield: opts.phoneNumber,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\tconst code = generateOTP(opts.otpLength);\n\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\tvalue: `${code}:0`,\n\t\t\t\tidentifier: `${ctx.body.phoneNumber}-request-password-reset`,\n\t\t\t\texpiresAt: getDate(opts.expiresIn, \"sec\"),\n\t\t\t});\n\t\t\t// to avoid leaking the existence of the phone number\n\t\t\tif (!user) {\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tstatus: true,\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (opts.sendPasswordResetOTP) {\n\t\t\t\tawait ctx.context.runInBackgroundOrAwait(\n\t\t\t\t\topts.sendPasswordResetOTP(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tphoneNumber: ctx.body.phoneNumber,\n\t\t\t\t\t\t\tcode,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tctx,\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn ctx.json({\n\t\t\t\tstatus: true,\n\t\t\t});\n\t\t},\n\t);\n\nconst resetPasswordPhoneNumberBodySchema = z.object({\n\totp: z.string().meta({\n\t\tdescription: 'The one time password to reset the password. Eg: \"123456\"',\n\t}),\n\tphoneNumber: z.string().meta({\n\t\tdescription:\n\t\t\t'The phone number to the account which intends to reset the password for. Eg: \"+1234567890\"',\n\t}),\n\tnewPassword: z.string().meta({\n\t\tdescription: `The new password. Eg: \"new-and-secure-password\"`,\n\t}),\n});\n\nexport const resetPasswordPhoneNumber = (opts: RequiredPhoneNumberOptions) =>\n\tcreateAuthEndpoint(\n\t\t\"/phone-number/reset-password\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: resetPasswordPhoneNumberBodySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"Reset password using phone number OTP\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Password reset successfully\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tstatus: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Indicates if the password was reset successfully\",\n\t\t\t\t\t\t\t\t\t\t\t\tenum: [true],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\trequired: [\"status\"],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst verification =\n\t\t\t\tawait ctx.context.internalAdapter.findVerificationValue(\n\t\t\t\t\t`${ctx.body.phoneNumber}-request-password-reset`,\n\t\t\t\t);\n\t\t\tif (!verification) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: PHONE_NUMBER_ERROR_CODES.OTP_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (verification.expiresAt < new Date()) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: PHONE_NUMBER_ERROR_CODES.OTP_EXPIRED,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst [otpValue, attempts] = verification.value.split(\":\");\n\t\t\tconst allowedAttempts = opts?.allowedAttempts || 3;\n\t\t\tif (attempts && parseInt(attempts) >= allowedAttempts) {\n\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(\n\t\t\t\t\tverification.id,\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage: PHONE_NUMBER_ERROR_CODES.TOO_MANY_ATTEMPTS,\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (ctx.body.otp !== otpValue) {\n\t\t\t\tawait ctx.context.internalAdapter.updateVerificationValue(\n\t\t\t\t\tverification.id,\n\t\t\t\t\t{\n\t\t\t\t\t\tvalue: `${otpValue}:${parseInt(attempts || \"0\") + 1}`,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: PHONE_NUMBER_ERROR_CODES.INVALID_OTP,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst user = await ctx.context.adapter.findOne<User>({\n\t\t\t\tmodel: \"user\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"phoneNumber\",\n\t\t\t\t\t\tvalue: ctx.body.phoneNumber,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\tif (!user) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: PHONE_NUMBER_ERROR_CODES.UNEXPECTED_ERROR,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst minLength = ctx.context.password.config.minPasswordLength;\n\t\t\tconst maxLength = ctx.context.password.config.maxPasswordLength;\n\t\t\tif (ctx.body.newPassword.length < minLength) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: BASE_ERROR_CODES.PASSWORD_TOO_SHORT,\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (ctx.body.newPassword.length > maxLength) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: BASE_ERROR_CODES.PASSWORD_TOO_LONG,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst hashedPassword = await ctx.context.password.hash(\n\t\t\t\tctx.body.newPassword,\n\t\t\t);\n\t\t\tawait ctx.context.internalAdapter.updatePassword(user.id, hashedPassword);\n\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(\n\t\t\t\tverification.id,\n\t\t\t);\n\n\t\t\tif (ctx.context.options.emailAndPassword?.revokeSessionsOnPasswordReset) {\n\t\t\t\tawait ctx.context.internalAdapter.deleteSessions(user.id);\n\t\t\t}\n\n\t\t\treturn ctx.json({\n\t\t\t\tstatus: true,\n\t\t\t});\n\t\t},\n\t);\n\nfunction generateOTP(size: number) {\n\treturn generateRandomString(size, \"0-9\");\n}\n"],"names":["user"],"mappings":"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"}},
    {"offset": {"line": 13251, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/phone-number/schema.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/phone-number/schema.ts"],"sourcesContent":["import type { BetterAuthPluginDBSchema } from \"@better-auth/core/db\";\n\nexport const schema = {\n\tuser: {\n\t\tfields: {\n\t\t\tphoneNumber: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: false,\n\t\t\t\tunique: true,\n\t\t\t\tsortable: true,\n\t\t\t\treturned: true,\n\t\t\t},\n\t\t\tphoneNumberVerified: {\n\t\t\t\ttype: \"boolean\",\n\t\t\t\trequired: false,\n\t\t\t\treturned: true,\n\t\t\t\tinput: false,\n\t\t\t},\n\t\t},\n\t},\n} satisfies BetterAuthPluginDBSchema;\n"],"names":[],"mappings":";;;;;AAEA,MAAa,SAAS;IACrB,MAAM;QACL,QAAQ;YACP,aAAa;gBACZ,MAAM;gBACN,UAAU;gBACV,QAAQ;gBACR,UAAU;gBACV,UAAU;aACV;YACD,qBAAqB;gBACpB,MAAM;gBACN,UAAU;gBACV,UAAU;gBACV,OAAO;aACP;SACD;IAAA,CACD;AAAA,CACD"}},
    {"offset": {"line": 13281, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/phone-number/index.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/phone-number/index.ts"],"sourcesContent":["import type { BetterAuthPlugin } from \"@better-auth/core\";\nimport { createAuthMiddleware } from \"@better-auth/core/api\";\nimport { APIError } from \"better-call\";\nimport { mergeSchema } from \"../../db/schema\";\nimport { PHONE_NUMBER_ERROR_CODES } from \"./error-codes\";\nimport type { RequiredPhoneNumberOptions } from \"./routes\";\nimport {\n\trequestPasswordResetPhoneNumber,\n\tresetPasswordPhoneNumber,\n\tsendPhoneNumberOTP,\n\tsignInPhoneNumber,\n\tverifyPhoneNumber,\n} from \"./routes\";\nimport { schema } from \"./schema\";\nimport type { PhoneNumberOptions, UserWithPhoneNumber } from \"./types\";\n\nexport type { PhoneNumberOptions, UserWithPhoneNumber };\n\nexport const phoneNumber = (options?: PhoneNumberOptions | undefined) => {\n\tconst opts = {\n\t\texpiresIn: options?.expiresIn || 300,\n\t\totpLength: options?.otpLength || 6,\n\t\t...options,\n\t\tphoneNumber: \"phoneNumber\",\n\t\tphoneNumberVerified: \"phoneNumberVerified\",\n\t\tcode: \"code\",\n\t\tcreatedAt: \"createdAt\",\n\t};\n\n\treturn {\n\t\tid: \"phone-number\",\n\t\thooks: {\n\t\t\tbefore: [\n\t\t\t\t{\n\t\t\t\t\t// Stop any requests attempting to update the user's phone number\n\t\t\t\t\tmatcher: (ctx) =>\n\t\t\t\t\t\tctx.path === \"/update-user\" && \"phoneNumber\" in ctx.body,\n\t\t\t\t\thandler: createAuthMiddleware(async (_ctx) => {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage: PHONE_NUMBER_ERROR_CODES.PHONE_NUMBER_CANNOT_BE_UPDATED,\n\t\t\t\t\t\t});\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\tendpoints: {\n\t\t\tsignInPhoneNumber: signInPhoneNumber(opts as RequiredPhoneNumberOptions),\n\t\t\tsendPhoneNumberOTP: sendPhoneNumberOTP(\n\t\t\t\topts as RequiredPhoneNumberOptions,\n\t\t\t),\n\t\t\tverifyPhoneNumber: verifyPhoneNumber(opts as RequiredPhoneNumberOptions),\n\t\t\trequestPasswordResetPhoneNumber: requestPasswordResetPhoneNumber(\n\t\t\t\topts as RequiredPhoneNumberOptions,\n\t\t\t),\n\t\t\tresetPasswordPhoneNumber: resetPasswordPhoneNumber(\n\t\t\t\topts as RequiredPhoneNumberOptions,\n\t\t\t),\n\t\t},\n\t\tschema: mergeSchema(schema, options?.schema),\n\t\trateLimit: [\n\t\t\t{\n\t\t\t\tpathMatcher(path) {\n\t\t\t\t\treturn path.startsWith(\"/phone-number\");\n\t\t\t\t},\n\t\t\t\twindow: 60 * 1000,\n\t\t\t\tmax: 10,\n\t\t\t},\n\t\t],\n\t\toptions,\n\t\t$ERROR_CODES: PHONE_NUMBER_ERROR_CODES,\n\t} satisfies BetterAuthPlugin;\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAkBA,MAAa,cAAA,CAAe,YAA6C;IACxE,MAAM,OAAO;QACZ,WAAW,SAAS,aAAa;QACjC,WAAW,SAAS,aAAa;QACjC,GAAG,OAAA;QACH,aAAa;QACb,qBAAqB;QACrB,MAAM;QACN,WAAW;KACX;IAED,OAAO;QACN,IAAI;QACJ,OAAO;YACN,QAAQ;gBACP;oBAEC,SAAA,CAAU,MACT,IAAI,IAAA,KAAS,kBAAkB,iBAAiB,IAAI,IAAA;oBACrD,aAAS,2LAAA,EAAqB,OAAO,SAAS;wBAC7C,MAAM,IAAI,8JAAA,CAAS,eAAe;4BACjC,SAAS,qNAAA,CAAyB,8BAAA;wBAAA,CAClC,CAAC;sBACD;iBACF;aACD;QAAA,CACD;QACD,WAAW;YACV,uBAAmB,sMAAA,EAAkB,KAAmC;YACxE,wBAAoB,uMAAA,EACnB,KACA;YACD,uBAAmB,sMAAA,EAAkB,KAAmC;YACxE,qCAAiC,oNAAA,EAChC,KACA;YACD,8BAA0B,6MAAA,EACzB,KACA;SACD;QACD,YAAQ,wKAAA,EAAY,2LAAA,EAAQ,SAAS,OAAO;QAC5C,WAAW;YACV;gBACC,aAAY,IAAA,EAAM;oBACjB,OAAO,KAAK,UAAA,CAAW,gBAAgB;;gBAExC,QAAQ,KAAK;gBACb,KAAK;aACL;SACD;QACD;QACA,cAAc,qNAAA;KACd"}},
    {"offset": {"line": 13350, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/siwe/schema.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/siwe/schema.ts"],"sourcesContent":["import type { BetterAuthPluginDBSchema } from \"@better-auth/core/db\";\n\nexport const schema = {\n\twalletAddress: {\n\t\tfields: {\n\t\t\tuserId: {\n\t\t\t\ttype: \"string\",\n\t\t\t\treferences: {\n\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t},\n\t\t\t\trequired: true,\n\t\t\t\tindex: true,\n\t\t\t},\n\t\t\taddress: {\n\t\t\t\ttype: \"string\",\n\t\t\t\trequired: true,\n\t\t\t},\n\t\t\tchainId: {\n\t\t\t\ttype: \"number\",\n\t\t\t\trequired: true,\n\t\t\t},\n\t\t\tisPrimary: {\n\t\t\t\ttype: \"boolean\",\n\t\t\t\tdefaultValue: false,\n\t\t\t},\n\t\t\tcreatedAt: {\n\t\t\t\ttype: \"date\",\n\t\t\t\trequired: true,\n\t\t\t},\n\t\t},\n\t},\n} satisfies BetterAuthPluginDBSchema;\n"],"names":[],"mappings":";;;;;AAEA,MAAa,SAAS;IACrB,eAAe;QACd,QAAQ;YACP,QAAQ;gBACP,MAAM;gBACN,YAAY;oBACX,OAAO;oBACP,OAAO;iBACP;gBACD,UAAU;gBACV,OAAO;aACP;YACD,SAAS;gBACR,MAAM;gBACN,UAAU;aACV;YACD,SAAS;gBACR,MAAM;gBACN,UAAU;aACV;YACD,WAAW;gBACV,MAAM;gBACN,cAAc;aACd;YACD,WAAW;gBACV,MAAM;gBACN,UAAU;aACV;SACD;IAAA,CACD;AAAA,CACD"}},
    {"offset": {"line": 13392, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/siwe/index.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/siwe/index.ts"],"sourcesContent":["import type { BetterAuthPlugin } from \"@better-auth/core\";\nimport { createAuthEndpoint } from \"@better-auth/core/api\";\nimport * as z from \"zod\";\nimport { APIError } from \"../../api\";\nimport { setSessionCookie } from \"../../cookies\";\nimport { mergeSchema } from \"../../db/schema\";\nimport type { InferOptionSchema, User } from \"../../types\";\nimport { toChecksumAddress } from \"../../utils/hashing\";\nimport { getOrigin } from \"../../utils/url\";\nimport { schema } from \"./schema\";\nimport type {\n\tENSLookupArgs,\n\tENSLookupResult,\n\tSIWEVerifyMessageArgs,\n\tWalletAddress,\n} from \"./types\";\n\nexport interface SIWEPluginOptions {\n\tdomain: string;\n\temailDomainName?: string | undefined;\n\tanonymous?: boolean | undefined;\n\tgetNonce: () => Promise<string>;\n\tverifyMessage: (args: SIWEVerifyMessageArgs) => Promise<boolean>;\n\tensLookup?: ((args: ENSLookupArgs) => Promise<ENSLookupResult>) | undefined;\n\tschema?: InferOptionSchema<typeof schema> | undefined;\n}\n\nconst getSiweNonceBodySchema = z.object({\n\twalletAddress: z\n\t\t.string()\n\t\t.regex(/^0[xX][a-fA-F0-9]{40}$/i)\n\t\t.length(42),\n\tchainId: z.number().int().positive().max(2147483647).optional().default(1),\n});\n\nexport const siwe = (options: SIWEPluginOptions) =>\n\t({\n\t\tid: \"siwe\",\n\t\tschema: mergeSchema(schema, options?.schema),\n\t\tendpoints: {\n\t\t\tgetSiweNonce: createAuthEndpoint(\n\t\t\t\t\"/siwe/nonce\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tbody: getSiweNonceBodySchema,\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tconst { walletAddress: rawWalletAddress, chainId } = ctx.body;\n\t\t\t\t\tconst walletAddress = toChecksumAddress(rawWalletAddress);\n\t\t\t\t\tconst nonce = await options.getNonce();\n\n\t\t\t\t\t// Store nonce with wallet address and chain ID context\n\t\t\t\t\tawait ctx.context.internalAdapter.createVerificationValue({\n\t\t\t\t\t\tidentifier: `siwe:${walletAddress}:${chainId}`,\n\t\t\t\t\t\tvalue: nonce,\n\t\t\t\t\t\texpiresAt: new Date(Date.now() + 15 * 60 * 1000),\n\t\t\t\t\t});\n\n\t\t\t\t\treturn ctx.json({ nonce });\n\t\t\t\t},\n\t\t\t),\n\t\t\tverifySiweMessage: createAuthEndpoint(\n\t\t\t\t\"/siwe/verify\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tbody: z\n\t\t\t\t\t\t.object({\n\t\t\t\t\t\t\tmessage: z.string().min(1),\n\t\t\t\t\t\t\tsignature: z.string().min(1),\n\t\t\t\t\t\t\twalletAddress: z\n\t\t\t\t\t\t\t\t.string()\n\t\t\t\t\t\t\t\t.regex(/^0[xX][a-fA-F0-9]{40}$/i)\n\t\t\t\t\t\t\t\t.length(42),\n\t\t\t\t\t\t\tchainId: z\n\t\t\t\t\t\t\t\t.number()\n\t\t\t\t\t\t\t\t.int()\n\t\t\t\t\t\t\t\t.positive()\n\t\t\t\t\t\t\t\t.max(2147483647)\n\t\t\t\t\t\t\t\t.optional()\n\t\t\t\t\t\t\t\t.default(1),\n\t\t\t\t\t\t\temail: z.email().optional(),\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.refine((data) => options.anonymous !== false || !!data.email, {\n\t\t\t\t\t\t\tmessage:\n\t\t\t\t\t\t\t\t\"Email is required when the anonymous plugin option is disabled.\",\n\t\t\t\t\t\t\tpath: [\"email\"],\n\t\t\t\t\t\t}),\n\t\t\t\t\trequireRequest: true,\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tconst {\n\t\t\t\t\t\tmessage,\n\t\t\t\t\t\tsignature,\n\t\t\t\t\t\twalletAddress: rawWalletAddress,\n\t\t\t\t\t\tchainId,\n\t\t\t\t\t\temail,\n\t\t\t\t\t} = ctx.body;\n\t\t\t\t\tconst walletAddress = toChecksumAddress(rawWalletAddress);\n\t\t\t\t\tconst isAnon = options.anonymous ?? true;\n\n\t\t\t\t\tif (!isAnon && !email) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage: \"Email is required when anonymous is disabled.\",\n\t\t\t\t\t\t\tstatus: 400,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Find stored nonce with wallet address and chain ID context\n\t\t\t\t\t\tconst verification =\n\t\t\t\t\t\t\tawait ctx.context.internalAdapter.findVerificationValue(\n\t\t\t\t\t\t\t\t`siwe:${walletAddress}:${chainId}`,\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t// Ensure nonce is valid and not expired\n\t\t\t\t\t\tif (!verification || new Date() > verification.expiresAt) {\n\t\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\t\tmessage: \"Unauthorized: Invalid or expired nonce\",\n\t\t\t\t\t\t\t\tstatus: 401,\n\t\t\t\t\t\t\t\tcode: \"UNAUTHORIZED_INVALID_OR_EXPIRED_NONCE\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Verify SIWE message with enhanced parameters\n\t\t\t\t\t\tconst { value: nonce } = verification;\n\t\t\t\t\t\tconst verified = await options.verifyMessage({\n\t\t\t\t\t\t\tmessage,\n\t\t\t\t\t\t\tsignature,\n\t\t\t\t\t\t\taddress: walletAddress,\n\t\t\t\t\t\t\tchainId,\n\t\t\t\t\t\t\tcacao: {\n\t\t\t\t\t\t\t\th: { t: \"caip122\" },\n\t\t\t\t\t\t\t\tp: {\n\t\t\t\t\t\t\t\t\tdomain: options.domain,\n\t\t\t\t\t\t\t\t\taud: options.domain,\n\t\t\t\t\t\t\t\t\tnonce,\n\t\t\t\t\t\t\t\t\tiss: options.domain,\n\t\t\t\t\t\t\t\t\tversion: \"1\",\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ts: { t: \"eip191\", s: signature },\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (!verified) {\n\t\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\t\tmessage: \"Unauthorized: Invalid SIWE signature\",\n\t\t\t\t\t\t\t\tstatus: 401,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Clean up used nonce\n\t\t\t\t\t\tawait ctx.context.internalAdapter.deleteVerificationValue(\n\t\t\t\t\t\t\tverification.id,\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\t// Look for existing user by their wallet addresses\n\t\t\t\t\t\tlet user: User | null = null;\n\n\t\t\t\t\t\t// Check if there's a wallet address record for this exact address+chainId combination\n\t\t\t\t\t\tconst existingWalletAddress: WalletAddress | null =\n\t\t\t\t\t\t\tawait ctx.context.adapter.findOne({\n\t\t\t\t\t\t\t\tmodel: \"walletAddress\",\n\t\t\t\t\t\t\t\twhere: [\n\t\t\t\t\t\t\t\t\t{ field: \"address\", operator: \"eq\", value: walletAddress },\n\t\t\t\t\t\t\t\t\t{ field: \"chainId\", operator: \"eq\", value: chainId },\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (existingWalletAddress) {\n\t\t\t\t\t\t\t// Get the user associated with this wallet address\n\t\t\t\t\t\t\tuser = await ctx.context.adapter.findOne({\n\t\t\t\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\t\t\t\twhere: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\t\t\t\t\t\tvalue: existingWalletAddress.userId,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// No exact match found, check if this address exists on any other chain\n\t\t\t\t\t\t\tconst anyWalletAddress: WalletAddress | null =\n\t\t\t\t\t\t\t\tawait ctx.context.adapter.findOne({\n\t\t\t\t\t\t\t\t\tmodel: \"walletAddress\",\n\t\t\t\t\t\t\t\t\twhere: [\n\t\t\t\t\t\t\t\t\t\t{ field: \"address\", operator: \"eq\", value: walletAddress },\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tif (anyWalletAddress) {\n\t\t\t\t\t\t\t\t// Same address exists on different chain, get that user\n\t\t\t\t\t\t\t\tuser = await ctx.context.adapter.findOne({\n\t\t\t\t\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\t\t\t\t\twhere: [\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\t\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\t\t\t\t\t\t\tvalue: anyWalletAddress.userId,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Create new user if none exists\n\t\t\t\t\t\tif (!user) {\n\t\t\t\t\t\t\tconst domain =\n\t\t\t\t\t\t\t\toptions.emailDomainName ?? getOrigin(ctx.context.baseURL);\n\t\t\t\t\t\t\t// Use checksummed address for email generation\n\t\t\t\t\t\t\tconst userEmail =\n\t\t\t\t\t\t\t\t!isAnon && email ? email : `${walletAddress}@${domain}`;\n\t\t\t\t\t\t\tconst { name, avatar } =\n\t\t\t\t\t\t\t\t(await options.ensLookup?.({ walletAddress })) ?? {};\n\n\t\t\t\t\t\t\tuser = await ctx.context.internalAdapter.createUser({\n\t\t\t\t\t\t\t\tname: name ?? walletAddress,\n\t\t\t\t\t\t\t\temail: userEmail,\n\t\t\t\t\t\t\t\timage: avatar ?? \"\",\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t// Create wallet address record\n\t\t\t\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\t\t\t\tmodel: \"walletAddress\",\n\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\t\t\t\taddress: walletAddress,\n\t\t\t\t\t\t\t\t\tchainId,\n\t\t\t\t\t\t\t\t\tisPrimary: true, // First address is primary\n\t\t\t\t\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t// Create account record for wallet authentication\n\t\t\t\t\t\t\tawait ctx.context.internalAdapter.createAccount({\n\t\t\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\t\t\tproviderId: \"siwe\",\n\t\t\t\t\t\t\t\taccountId: `${walletAddress}:${chainId}`,\n\t\t\t\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t\t\t\t\tupdatedAt: new Date(),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// User exists, but check if this specific address/chain combo exists\n\t\t\t\t\t\t\tif (!existingWalletAddress) {\n\t\t\t\t\t\t\t\t// Add this new chainId to existing user's addresses\n\t\t\t\t\t\t\t\tawait ctx.context.adapter.create({\n\t\t\t\t\t\t\t\t\tmodel: \"walletAddress\",\n\t\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\t\t\t\t\taddress: walletAddress,\n\t\t\t\t\t\t\t\t\t\tchainId,\n\t\t\t\t\t\t\t\t\t\tisPrimary: false, // Additional addresses are not primary by default\n\t\t\t\t\t\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t// Create account record for this new wallet+chain combination\n\t\t\t\t\t\t\t\tawait ctx.context.internalAdapter.createAccount({\n\t\t\t\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\t\t\t\tproviderId: \"siwe\",\n\t\t\t\t\t\t\t\t\taccountId: `${walletAddress}:${chainId}`,\n\t\t\t\t\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t\t\t\t\t\tupdatedAt: new Date(),\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst session = await ctx.context.internalAdapter.createSession(\n\t\t\t\t\t\t\tuser.id,\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tif (!session) {\n\t\t\t\t\t\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\t\t\t\t\tmessage: \"Internal Server Error\",\n\t\t\t\t\t\t\t\tstatus: 500,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tawait setSessionCookie(ctx, { session, user });\n\n\t\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\t\ttoken: session.token,\n\t\t\t\t\t\t\tsuccess: true,\n\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\tid: user.id,\n\t\t\t\t\t\t\t\twalletAddress,\n\t\t\t\t\t\t\t\tchainId,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t} catch (error: unknown) {\n\t\t\t\t\t\tif (error instanceof APIError) throw error;\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\tmessage: \"Something went wrong. Please try again later.\",\n\t\t\t\t\t\t\terror: error instanceof Error ? error.message : \"Unknown error\",\n\t\t\t\t\t\t\tstatus: 401,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t),\n\t\t},\n\t\toptions,\n\t}) satisfies BetterAuthPlugin;\n"],"names":["user: User | null","existingWalletAddress: WalletAddress | null","anyWalletAddress: WalletAddress | null","error: unknown"],"mappings":"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"}},
    {"offset": {"line": 13626, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/username/error-codes.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/username/error-codes.ts"],"sourcesContent":["import { defineErrorCodes } from \"@better-auth/core/utils\";\n\nexport const USERNAME_ERROR_CODES = defineErrorCodes({\n\tINVALID_USERNAME_OR_PASSWORD: \"Invalid username or password\",\n\tEMAIL_NOT_VERIFIED: \"Email not verified\",\n\tUNEXPECTED_ERROR: \"Unexpected error\",\n\tUSERNAME_IS_ALREADY_TAKEN: \"Username is already taken. Please try another.\",\n\tUSERNAME_TOO_SHORT: \"Username is too short\",\n\tUSERNAME_TOO_LONG: \"Username is too long\",\n\tINVALID_USERNAME: \"Username is invalid\",\n\tINVALID_DISPLAY_USERNAME: \"Display username is invalid\",\n});\n"],"names":[],"mappings":";;;;;;;;AAEA,MAAa,2BAAuB,kMAAA,EAAiB;IACpD,8BAA8B;IAC9B,oBAAoB;IACpB,kBAAkB;IAClB,2BAA2B;IAC3B,oBAAoB;IACpB,mBAAmB;IACnB,kBAAkB;IAClB,0BAA0B;CAC1B,CAAC"}},
    {"offset": {"line": 13650, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/username/schema.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/username/schema.ts"],"sourcesContent":["import type { BetterAuthPluginDBSchema } from \"@better-auth/core/db\";\n\nexport const getSchema = (normalizer: {\n\tusername: (username: string) => string;\n\tdisplayUsername: (displayUsername: string) => string;\n}) => {\n\treturn {\n\t\tuser: {\n\t\t\tfields: {\n\t\t\t\tusername: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: false,\n\t\t\t\t\tsortable: true,\n\t\t\t\t\tunique: true,\n\t\t\t\t\treturned: true,\n\t\t\t\t\ttransform: {\n\t\t\t\t\t\tinput(value) {\n\t\t\t\t\t\t\treturn typeof value !== \"string\"\n\t\t\t\t\t\t\t\t? value\n\t\t\t\t\t\t\t\t: normalizer.username(value as string);\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tdisplayUsername: {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\trequired: false,\n\t\t\t\t\ttransform: {\n\t\t\t\t\t\tinput(value) {\n\t\t\t\t\t\t\treturn typeof value !== \"string\"\n\t\t\t\t\t\t\t\t? value\n\t\t\t\t\t\t\t\t: normalizer.displayUsername(value as string);\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t} satisfies BetterAuthPluginDBSchema;\n};\n\nexport type UsernameSchema = ReturnType<typeof getSchema>;\n"],"names":[],"mappings":";;;;;AAEA,MAAa,YAAA,CAAa,eAGpB;IACL,OAAO;QACN,MAAM;YACL,QAAQ;gBACP,UAAU;oBACT,MAAM;oBACN,UAAU;oBACV,UAAU;oBACV,QAAQ;oBACR,UAAU;oBACV,WAAW;wBACV,OAAM,KAAA,EAAO;4BACZ,OAAO,OAAO,UAAU,WACrB,QACA,WAAW,QAAA,CAAS,MAAgB;;qBAExC;iBACD;gBACD,iBAAiB;oBAChB,MAAM;oBACN,UAAU;oBACV,WAAW;wBACV,OAAM,KAAA,EAAO;4BACZ,OAAO,OAAO,UAAU,WACrB,QACA,WAAW,eAAA,CAAgB,MAAgB;;qBAE/C;iBACD;aACD;QAAA,CACD;IAAA,CACD"}},
    {"offset": {"line": 13690, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/username/index.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/username/index.ts"],"sourcesContent":["import type { BetterAuthPlugin } from \"@better-auth/core\";\nimport {\n\tcreateAuthEndpoint,\n\tcreateAuthMiddleware,\n} from \"@better-auth/core/api\";\nimport type { Account, User } from \"@better-auth/core/db\";\nimport { BASE_ERROR_CODES } from \"@better-auth/core/error\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { createEmailVerificationToken } from \"../../api\";\nimport { setSessionCookie } from \"../../cookies\";\nimport { mergeSchema, parseUserOutput } from \"../../db\";\nimport type { InferOptionSchema } from \"../../types/plugins\";\nimport { USERNAME_ERROR_CODES as ERROR_CODES } from \"./error-codes\";\nimport type { UsernameSchema } from \"./schema\";\nimport { getSchema } from \"./schema\";\n\nexport { USERNAME_ERROR_CODES } from \"./error-codes\";\n\nexport type UsernameOptions = {\n\tschema?: InferOptionSchema<UsernameSchema> | undefined;\n\t/**\n\t * The minimum length of the username\n\t *\n\t * @default 3\n\t */\n\tminUsernameLength?: number | undefined;\n\t/**\n\t * The maximum length of the username\n\t *\n\t * @default 30\n\t */\n\tmaxUsernameLength?: number | undefined;\n\t/**\n\t * A function to validate the username\n\t *\n\t * By default, the username should only contain alphanumeric characters and underscores\n\t */\n\tusernameValidator?:\n\t\t| ((username: string) => boolean | Promise<boolean>)\n\t\t| undefined;\n\t/**\n\t * A function to validate the display username\n\t *\n\t * By default, no validation is applied to display username\n\t */\n\tdisplayUsernameValidator?:\n\t\t| ((displayUsername: string) => boolean | Promise<boolean>)\n\t\t| undefined;\n\t/**\n\t * A function to normalize the username\n\t *\n\t * @default (username) => username.toLowerCase()\n\t */\n\tusernameNormalization?: (((username: string) => string) | false) | undefined;\n\t/**\n\t * A function to normalize the display username\n\t *\n\t * @default false\n\t */\n\tdisplayUsernameNormalization?:\n\t\t| (((displayUsername: string) => string) | false)\n\t\t| undefined;\n\t/**\n\t * The order of validation\n\t *\n\t * @default { username: \"pre-normalization\", displayUsername: \"pre-normalization\" }\n\t */\n\tvalidationOrder?:\n\t\t| {\n\t\t\t\t/**\n\t\t\t\t * The order of username validation\n\t\t\t\t *\n\t\t\t\t * @default \"pre-normalization\"\n\t\t\t\t */\n\t\t\t\tusername?: \"pre-normalization\" | \"post-normalization\";\n\t\t\t\t/**\n\t\t\t\t * The order of display username validation\n\t\t\t\t *\n\t\t\t\t * @default \"pre-normalization\"\n\t\t\t\t */\n\t\t\t\tdisplayUsername?: \"pre-normalization\" | \"post-normalization\";\n\t\t  }\n\t\t| undefined;\n};\n\nfunction defaultUsernameValidator(username: string) {\n\treturn /^[a-zA-Z0-9_.]+$/.test(username);\n}\n\nconst signInUsernameBodySchema = z.object({\n\tusername: z.string().meta({ description: \"The username of the user\" }),\n\tpassword: z.string().meta({ description: \"The password of the user\" }),\n\trememberMe: z\n\t\t.boolean()\n\t\t.meta({\n\t\t\tdescription: \"Remember the user session\",\n\t\t})\n\t\t.optional(),\n\tcallbackURL: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: \"The URL to redirect to after email verification\",\n\t\t})\n\t\t.optional(),\n});\n\nconst isUsernameAvailableBodySchema = z.object({\n\tusername: z.string().meta({\n\t\tdescription: \"The username to check\",\n\t}),\n});\n\nexport const username = (options?: UsernameOptions | undefined) => {\n\tconst normalizer = (username: string) => {\n\t\tif (options?.usernameNormalization === false) {\n\t\t\treturn username;\n\t\t}\n\t\tif (options?.usernameNormalization) {\n\t\t\treturn options.usernameNormalization(username);\n\t\t}\n\t\treturn username.toLowerCase();\n\t};\n\n\tconst displayUsernameNormalizer = (displayUsername: string) => {\n\t\treturn options?.displayUsernameNormalization\n\t\t\t? options.displayUsernameNormalization(displayUsername)\n\t\t\t: displayUsername;\n\t};\n\n\treturn {\n\t\tid: \"username\",\n\t\tinit(ctx) {\n\t\t\treturn {\n\t\t\t\toptions: {\n\t\t\t\t\tdatabaseHooks: {\n\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\tcreate: {\n\t\t\t\t\t\t\t\tasync before(user, context) {\n\t\t\t\t\t\t\t\t\tconst username =\n\t\t\t\t\t\t\t\t\t\t\"username\" in user ? (user.username as string) : null;\n\t\t\t\t\t\t\t\t\tconst displayUsername =\n\t\t\t\t\t\t\t\t\t\t\"displayUsername\" in user\n\t\t\t\t\t\t\t\t\t\t\t? (user.displayUsername as string)\n\t\t\t\t\t\t\t\t\t\t\t: null;\n\n\t\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\t\t\t...user,\n\t\t\t\t\t\t\t\t\t\t\t...(username ? { username: normalizer(username) } : {}),\n\t\t\t\t\t\t\t\t\t\t\t...(displayUsername\n\t\t\t\t\t\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdisplayUsername:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdisplayUsernameNormalizer(displayUsername),\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t: {}),\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tupdate: {\n\t\t\t\t\t\t\t\tasync before(user, context) {\n\t\t\t\t\t\t\t\t\tconst username =\n\t\t\t\t\t\t\t\t\t\t\"username\" in user ? (user.username as string) : null;\n\t\t\t\t\t\t\t\t\tconst displayUsername =\n\t\t\t\t\t\t\t\t\t\t\"displayUsername\" in user\n\t\t\t\t\t\t\t\t\t\t\t? (user.displayUsername as string)\n\t\t\t\t\t\t\t\t\t\t\t: null;\n\n\t\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\t\t\t\t...user,\n\t\t\t\t\t\t\t\t\t\t\t...(username ? { username: normalizer(username) } : {}),\n\t\t\t\t\t\t\t\t\t\t\t...(displayUsername\n\t\t\t\t\t\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdisplayUsername:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdisplayUsernameNormalizer(displayUsername),\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t: {}),\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tendpoints: {\n\t\t\tsignInUsername: createAuthEndpoint(\n\t\t\t\t\"/sign-in/username\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tbody: signInUsernameBodySchema,\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\topenapi: {\n\t\t\t\t\t\t\tsummary: \"Sign in with username\",\n\t\t\t\t\t\t\tdescription: \"Sign in with username\",\n\t\t\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\t\t200: {\n\t\t\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttoken: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Session token for the authenticated session\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/User\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\trequired: [\"token\", \"user\"],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t422: {\n\t\t\t\t\t\t\t\t\tdescription: \"Unprocessable Entity. Validation error\",\n\t\t\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tmessage: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tif (!ctx.body.username || !ctx.body.password) {\n\t\t\t\t\t\tctx.context.logger.error(\"Username or password not found\");\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\tmessage: ERROR_CODES.INVALID_USERNAME_OR_PASSWORD,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tconst username =\n\t\t\t\t\t\toptions?.validationOrder?.username === \"pre-normalization\"\n\t\t\t\t\t\t\t? normalizer(ctx.body.username)\n\t\t\t\t\t\t\t: ctx.body.username;\n\n\t\t\t\t\tconst minUsernameLength = options?.minUsernameLength || 3;\n\t\t\t\t\tconst maxUsernameLength = options?.maxUsernameLength || 30;\n\n\t\t\t\t\tif (username.length < minUsernameLength) {\n\t\t\t\t\t\tctx.context.logger.error(\"Username too short\", {\n\t\t\t\t\t\t\tusername,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthrow new APIError(\"UNPROCESSABLE_ENTITY\", {\n\t\t\t\t\t\t\tcode: \"USERNAME_TOO_SHORT\",\n\t\t\t\t\t\t\tmessage: ERROR_CODES.USERNAME_TOO_SHORT,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (username.length > maxUsernameLength) {\n\t\t\t\t\t\tctx.context.logger.error(\"Username too long\", {\n\t\t\t\t\t\t\tusername,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthrow new APIError(\"UNPROCESSABLE_ENTITY\", {\n\t\t\t\t\t\t\tmessage: ERROR_CODES.USERNAME_TOO_LONG,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tconst validator =\n\t\t\t\t\t\toptions?.usernameValidator || defaultUsernameValidator;\n\n\t\t\t\t\tconst valid = await validator(username);\n\t\t\t\t\tif (!valid) {\n\t\t\t\t\t\tthrow new APIError(\"UNPROCESSABLE_ENTITY\", {\n\t\t\t\t\t\t\tmessage: ERROR_CODES.INVALID_USERNAME,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tconst user = await ctx.context.adapter.findOne<\n\t\t\t\t\t\tUser & { username: string; displayUsername: string }\n\t\t\t\t\t>({\n\t\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\t\twhere: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfield: \"username\",\n\t\t\t\t\t\t\t\tvalue: normalizer(username),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\t\t\t\t\tif (!user) {\n\t\t\t\t\t\t// Hash password to prevent timing attacks from revealing valid usernames\n\t\t\t\t\t\t// By hashing passwords for invalid usernames, we ensure consistent response times\n\t\t\t\t\t\tawait ctx.context.password.hash(ctx.body.password);\n\t\t\t\t\t\tctx.context.logger.error(\"User not found\", {\n\t\t\t\t\t\t\tusername,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\tmessage: ERROR_CODES.INVALID_USERNAME_OR_PASSWORD,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tconst account = await ctx.context.adapter.findOne<Account>({\n\t\t\t\t\t\tmodel: \"account\",\n\t\t\t\t\t\twhere: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\t\t\tvalue: user.id,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfield: \"providerId\",\n\t\t\t\t\t\t\t\tvalue: \"credential\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\t\t\t\t\tif (!account) {\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\tmessage: ERROR_CODES.INVALID_USERNAME_OR_PASSWORD,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst currentPassword = account?.password;\n\t\t\t\t\tif (!currentPassword) {\n\t\t\t\t\t\tctx.context.logger.error(\"Password not found\", {\n\t\t\t\t\t\t\tusername,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\tmessage: ERROR_CODES.INVALID_USERNAME_OR_PASSWORD,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst validPassword = await ctx.context.password.verify({\n\t\t\t\t\t\thash: currentPassword,\n\t\t\t\t\t\tpassword: ctx.body.password,\n\t\t\t\t\t});\n\t\t\t\t\tif (!validPassword) {\n\t\t\t\t\t\tctx.context.logger.error(\"Invalid password\");\n\t\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\t\t\tmessage: ERROR_CODES.INVALID_USERNAME_OR_PASSWORD,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tctx.context.options?.emailAndPassword?.requireEmailVerification &&\n\t\t\t\t\t\t!user.emailVerified\n\t\t\t\t\t) {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t!ctx.context.options?.emailVerification?.sendVerificationEmail\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\t\t\t\tmessage: ERROR_CODES.EMAIL_NOT_VERIFIED,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (ctx.context.options?.emailVerification?.sendOnSignIn) {\n\t\t\t\t\t\t\tconst token = await createEmailVerificationToken(\n\t\t\t\t\t\t\t\tctx.context.secret,\n\t\t\t\t\t\t\t\tuser.email,\n\t\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\t\tctx.context.options.emailVerification?.expiresIn,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tconst url = `${ctx.context.baseURL}/verify-email?token=${token}&callbackURL=${\n\t\t\t\t\t\t\t\tctx.body.callbackURL || \"/\"\n\t\t\t\t\t\t\t}`;\n\t\t\t\t\t\t\tawait ctx.context.runInBackgroundOrAwait(\n\t\t\t\t\t\t\t\tctx.context.options.emailVerification.sendVerificationEmail(\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tuser: user,\n\t\t\t\t\t\t\t\t\t\turl,\n\t\t\t\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tctx.request,\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\t\t\tmessage: ERROR_CODES.EMAIL_NOT_VERIFIED,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tconst session = await ctx.context.internalAdapter.createSession(\n\t\t\t\t\t\tuser.id,\n\t\t\t\t\t\tctx.body.rememberMe === false,\n\t\t\t\t\t);\n\t\t\t\t\tif (!session) {\n\t\t\t\t\t\treturn ctx.json(null, {\n\t\t\t\t\t\t\tstatus: 500,\n\t\t\t\t\t\t\tbody: {\n\t\t\t\t\t\t\t\tmessage: BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tawait setSessionCookie(\n\t\t\t\t\t\tctx,\n\t\t\t\t\t\t{ session, user },\n\t\t\t\t\t\tctx.body.rememberMe === false,\n\t\t\t\t\t);\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\ttoken: session.token,\n\t\t\t\t\t\tuser: parseUserOutput(ctx.context.options, user),\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t),\n\t\t\tisUsernameAvailable: createAuthEndpoint(\n\t\t\t\t\"/is-username-available\",\n\t\t\t\t{\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\tbody: isUsernameAvailableBodySchema,\n\t\t\t\t},\n\t\t\t\tasync (ctx) => {\n\t\t\t\t\tconst username = ctx.body.username;\n\t\t\t\t\tif (!username) {\n\t\t\t\t\t\tthrow new APIError(\"UNPROCESSABLE_ENTITY\", {\n\t\t\t\t\t\t\tmessage: ERROR_CODES.INVALID_USERNAME,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tconst minUsernameLength = options?.minUsernameLength || 3;\n\t\t\t\t\tconst maxUsernameLength = options?.maxUsernameLength || 30;\n\n\t\t\t\t\tif (username.length < minUsernameLength) {\n\t\t\t\t\t\tthrow new APIError(\"UNPROCESSABLE_ENTITY\", {\n\t\t\t\t\t\t\tcode: \"USERNAME_TOO_SHORT\",\n\t\t\t\t\t\t\tmessage: ERROR_CODES.USERNAME_TOO_SHORT,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (username.length > maxUsernameLength) {\n\t\t\t\t\t\tthrow new APIError(\"UNPROCESSABLE_ENTITY\", {\n\t\t\t\t\t\t\tmessage: ERROR_CODES.USERNAME_TOO_LONG,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tconst validator =\n\t\t\t\t\t\toptions?.usernameValidator || defaultUsernameValidator;\n\n\t\t\t\t\tconst valid = await validator(username);\n\t\t\t\t\tif (!valid) {\n\t\t\t\t\t\tthrow new APIError(\"UNPROCESSABLE_ENTITY\", {\n\t\t\t\t\t\t\tmessage: ERROR_CODES.INVALID_USERNAME,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tconst user = await ctx.context.adapter.findOne<User>({\n\t\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\t\twhere: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfield: \"username\",\n\t\t\t\t\t\t\t\tvalue: normalizer(username),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\t\t\t\t\tif (user) {\n\t\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\t\tavailable: false,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\treturn ctx.json({\n\t\t\t\t\t\tavailable: true,\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t),\n\t\t},\n\t\tschema: mergeSchema(\n\t\t\tgetSchema({\n\t\t\t\tusername: normalizer,\n\t\t\t\tdisplayUsername: displayUsernameNormalizer,\n\t\t\t}),\n\t\t\toptions?.schema,\n\t\t),\n\t\thooks: {\n\t\t\tbefore: [\n\t\t\t\t{\n\t\t\t\t\tmatcher(context) {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\tcontext.path === \"/sign-up/email\" ||\n\t\t\t\t\t\t\tcontext.path === \"/update-user\"\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tconst username =\n\t\t\t\t\t\t\ttypeof ctx.body.username === \"string\" &&\n\t\t\t\t\t\t\toptions?.validationOrder?.username === \"post-normalization\"\n\t\t\t\t\t\t\t\t? normalizer(ctx.body.username)\n\t\t\t\t\t\t\t\t: ctx.body.username;\n\n\t\t\t\t\t\tif (username !== undefined && typeof username === \"string\") {\n\t\t\t\t\t\t\tconst minUsernameLength = options?.minUsernameLength || 3;\n\t\t\t\t\t\t\tconst maxUsernameLength = options?.maxUsernameLength || 30;\n\t\t\t\t\t\t\tif (username.length < minUsernameLength) {\n\t\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\t\tcode: \"USERNAME_TOO_SHORT\",\n\t\t\t\t\t\t\t\t\tmessage: ERROR_CODES.USERNAME_TOO_SHORT,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (username.length > maxUsernameLength) {\n\t\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\t\tmessage: ERROR_CODES.USERNAME_TOO_LONG,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst validator =\n\t\t\t\t\t\t\t\toptions?.usernameValidator || defaultUsernameValidator;\n\n\t\t\t\t\t\t\tconst valid = await validator(username);\n\t\t\t\t\t\t\tif (!valid) {\n\t\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\t\tmessage: ERROR_CODES.INVALID_USERNAME,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconst user = await ctx.context.adapter.findOne<User>({\n\t\t\t\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\t\t\t\twhere: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tfield: \"username\",\n\t\t\t\t\t\t\t\t\t\tvalue: username,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tconst blockChangeSignUp = ctx.path === \"/sign-up/email\" && user;\n\t\t\t\t\t\t\tconst blockChangeUpdateUser =\n\t\t\t\t\t\t\t\tctx.path === \"/update-user\" &&\n\t\t\t\t\t\t\t\tuser &&\n\t\t\t\t\t\t\t\tctx.context.session &&\n\t\t\t\t\t\t\t\tuser.id !== ctx.context.session.session.userId;\n\t\t\t\t\t\t\tif (blockChangeSignUp || blockChangeUpdateUser) {\n\t\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\t\tmessage: ERROR_CODES.USERNAME_IS_ALREADY_TAKEN,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst displayUsername =\n\t\t\t\t\t\t\ttypeof ctx.body.displayUsername === \"string\" &&\n\t\t\t\t\t\t\toptions?.validationOrder?.displayUsername === \"post-normalization\"\n\t\t\t\t\t\t\t\t? displayUsernameNormalizer(ctx.body.displayUsername)\n\t\t\t\t\t\t\t\t: ctx.body.displayUsername;\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tdisplayUsername !== undefined &&\n\t\t\t\t\t\t\ttypeof displayUsername === \"string\"\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tif (options?.displayUsernameValidator) {\n\t\t\t\t\t\t\t\tconst valid =\n\t\t\t\t\t\t\t\t\tawait options.displayUsernameValidator(displayUsername);\n\t\t\t\t\t\t\t\tif (!valid) {\n\t\t\t\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\t\t\t\tmessage: ERROR_CODES.INVALID_DISPLAY_USERNAME,\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tmatcher(context) {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\tcontext.path === \"/sign-up/email\" ||\n\t\t\t\t\t\t\tcontext.path === \"/update-user\"\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t\thandler: createAuthMiddleware(async (ctx) => {\n\t\t\t\t\t\tif (ctx.body.username && !ctx.body.displayUsername) {\n\t\t\t\t\t\t\tctx.body.displayUsername = ctx.body.username;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (ctx.body.displayUsername && !ctx.body.username) {\n\t\t\t\t\t\t\tctx.body.username = ctx.body.displayUsername;\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\toptions,\n\t\t$ERROR_CODES: ERROR_CODES,\n\t} satisfies BetterAuthPlugin;\n};\n"],"names":["username","ERROR_CODES"],"mappings":"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"}},
    {"offset": {"line": 14068, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/dist/plugins/index.mjs"],"sourcesContent":["import { HIDE_METADATA } from \"../utils/hide-metadata.mjs\";\nimport { createAccessControl, role } from \"./access/access.mjs\";\nimport \"./access/index.mjs\";\nimport { twoFactorClient } from \"./two-factor/client.mjs\";\nimport { admin } from \"./admin/admin.mjs\";\nimport \"./admin/index.mjs\";\nimport { anonymous } from \"./anonymous/index.mjs\";\nimport { API_KEY_TABLE_NAME, ERROR_CODES, apiKey, defaultKeyHasher } from \"./api-key/index.mjs\";\nimport { bearer } from \"./bearer/index.mjs\";\nimport { captcha } from \"./captcha/index.mjs\";\nimport { customSession } from \"./custom-session/index.mjs\";\nimport { deviceAuthorization, deviceAuthorizationOptionsSchema } from \"./device-authorization/index.mjs\";\nimport { emailOTP } from \"./email-otp/index.mjs\";\nimport { auth0 } from \"./generic-oauth/providers/auth0.mjs\";\nimport { gumroad } from \"./generic-oauth/providers/gumroad.mjs\";\nimport { hubspot } from \"./generic-oauth/providers/hubspot.mjs\";\nimport { keycloak } from \"./generic-oauth/providers/keycloak.mjs\";\nimport { line } from \"./generic-oauth/providers/line.mjs\";\nimport { microsoftEntraId } from \"./generic-oauth/providers/microsoft-entra-id.mjs\";\nimport { okta } from \"./generic-oauth/providers/okta.mjs\";\nimport { patreon } from \"./generic-oauth/providers/patreon.mjs\";\nimport { slack } from \"./generic-oauth/providers/slack.mjs\";\nimport { genericOAuth } from \"./generic-oauth/index.mjs\";\nimport { haveIBeenPwned } from \"./haveibeenpwned/index.mjs\";\nimport { createJwk, generateExportedKeyPair, toExpJWT } from \"./jwt/utils.mjs\";\nimport { getJwtToken, signJWT } from \"./jwt/sign.mjs\";\nimport { verifyJWT } from \"./jwt/verify.mjs\";\nimport { jwt } from \"./jwt/index.mjs\";\nimport { lastLoginMethod } from \"./last-login-method/index.mjs\";\nimport { magicLink } from \"./magic-link/index.mjs\";\nimport { getClient, getMetadata, oidcProvider } from \"./oidc-provider/index.mjs\";\nimport { getMCPProtectedResourceMetadata, getMCPProviderMetadata, mcp, oAuthDiscoveryMetadata, oAuthProtectedResourceMetadata, withMcpAuth } from \"./mcp/index.mjs\";\nimport { multiSession } from \"./multi-session/index.mjs\";\nimport { oAuthProxy } from \"./oauth-proxy/index.mjs\";\nimport { oneTap } from \"./one-tap/index.mjs\";\nimport { oneTimeToken } from \"./one-time-token/index.mjs\";\nimport { openAPI } from \"./open-api/index.mjs\";\nimport { getOrgAdapter } from \"./organization/adapter.mjs\";\nimport { organization, parseRoles } from \"./organization/organization.mjs\";\nimport \"./organization/index.mjs\";\nimport { phoneNumber } from \"./phone-number/index.mjs\";\nimport { siwe } from \"./siwe/index.mjs\";\nimport { TWO_FACTOR_ERROR_CODES } from \"./two-factor/error-code.mjs\";\nimport { twoFactor } from \"./two-factor/index.mjs\";\nimport { USERNAME_ERROR_CODES } from \"./username/error-codes.mjs\";\nimport { username } from \"./username/index.mjs\";\nimport { createAuthEndpoint, createAuthMiddleware, optionsMiddleware } from \"@better-auth/core/api\";\n\nexport { API_KEY_TABLE_NAME, ERROR_CODES, HIDE_METADATA, TWO_FACTOR_ERROR_CODES, USERNAME_ERROR_CODES, admin, anonymous, apiKey, auth0, bearer, captcha, createAccessControl, createAuthEndpoint, createAuthMiddleware, createJwk, customSession, defaultKeyHasher, deviceAuthorization, deviceAuthorizationOptionsSchema, emailOTP, generateExportedKeyPair, genericOAuth, getClient, getJwtToken, getMCPProtectedResourceMetadata, getMCPProviderMetadata, getMetadata, getOrgAdapter, gumroad, haveIBeenPwned, hubspot, jwt, keycloak, lastLoginMethod, line, magicLink, mcp, microsoftEntraId, multiSession, oAuthDiscoveryMetadata, oAuthProtectedResourceMetadata, oAuthProxy, oidcProvider, okta, oneTap, oneTimeToken, openAPI, optionsMiddleware, organization, parseRoles, patreon, phoneNumber, role, signJWT, siwe, slack, toExpJWT, twoFactor, twoFactorClient, username, verifyJWT, withMcpAuth };"],"names":[],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","ignoreList":[0]}}]
}