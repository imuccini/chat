module.exports = [
"[project]/node_modules/better-auth/dist/plugins/organization/adapter.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "getOrgAdapter",
    ()=>getOrgAdapter
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2f$date$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/utils/date.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$client$2f$parser$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/client/parser.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/context/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/context/transaction.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$db$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/db.mjs [app-route] (ecmascript)");
;
;
;
;
;
//#region src/plugins/organization/adapter.ts
const getOrgAdapter = (context, options)=>{
    const baseAdapter = context.adapter;
    const orgAdditionalFields = options?.schema?.organization?.additionalFields;
    const memberAdditionalFields = options?.schema?.member?.additionalFields;
    const invitationAdditionalFields = options?.schema?.invitation?.additionalFields;
    const teamAdditionalFields = options?.schema?.team?.additionalFields;
    return {
        findOrganizationBySlug: async (slug)=>{
            return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$db$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["filterOutputFields"])(await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter)).findOne({
                model: "organization",
                where: [
                    {
                        field: "slug",
                        value: slug
                    }
                ]
            }), orgAdditionalFields);
        },
        createOrganization: async (data)=>{
            const organization = await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter)).create({
                model: "organization",
                data: {
                    ...data.organization,
                    metadata: data.organization.metadata ? JSON.stringify(data.organization.metadata) : void 0
                },
                forceAllowId: true
            });
            return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$db$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["filterOutputFields"])({
                ...organization,
                metadata: organization.metadata && typeof organization.metadata === "string" ? JSON.parse(organization.metadata) : void 0
            }, orgAdditionalFields);
        },
        findMemberByEmail: async (data)=>{
            const adapter = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter);
            const user = await adapter.findOne({
                model: "user",
                where: [
                    {
                        field: "email",
                        value: data.email.toLowerCase()
                    }
                ]
            });
            if (!user) return null;
            const member = await adapter.findOne({
                model: "member",
                where: [
                    {
                        field: "organizationId",
                        value: data.organizationId
                    },
                    {
                        field: "userId",
                        value: user.id
                    }
                ]
            });
            if (!member) return null;
            return {
                ...member,
                user: {
                    id: user.id,
                    name: user.name,
                    email: user.email,
                    image: user.image
                }
            };
        },
        listMembers: async (data)=>{
            const adapter = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter);
            const members = await Promise.all([
                adapter.findMany({
                    model: "member",
                    where: [
                        {
                            field: "organizationId",
                            value: data.organizationId
                        },
                        ...data.filter?.field ? [
                            {
                                field: data.filter?.field,
                                value: data.filter?.value,
                                ...data.filter.operator ? {
                                    operator: data.filter.operator
                                } : {}
                            }
                        ] : []
                    ],
                    limit: data.limit || options?.membershipLimit || 100,
                    offset: data.offset || 0,
                    sortBy: data.sortBy ? {
                        field: data.sortBy,
                        direction: data.sortOrder || "asc"
                    } : void 0
                }),
                adapter.count({
                    model: "member",
                    where: [
                        {
                            field: "organizationId",
                            value: data.organizationId
                        },
                        ...data.filter?.field ? [
                            {
                                field: data.filter?.field,
                                value: data.filter?.value,
                                ...data.filter.operator ? {
                                    operator: data.filter.operator
                                } : {}
                            }
                        ] : []
                    ]
                })
            ]);
            const users = await adapter.findMany({
                model: "user",
                where: [
                    {
                        field: "id",
                        value: members[0].map((member)=>member.userId),
                        operator: "in"
                    }
                ]
            });
            return {
                members: members[0].map((member)=>{
                    const user = users.find((user$1)=>user$1.id === member.userId);
                    if (!user) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["BetterAuthError"]("Unexpected error: User not found for member");
                    return {
                        ...member,
                        user: {
                            id: user.id,
                            name: user.name,
                            email: user.email,
                            image: user.image
                        }
                    };
                }),
                total: members[1]
            };
        },
        findMemberByOrgId: async (data)=>{
            const result = await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter)).findOne({
                model: "member",
                where: [
                    {
                        field: "userId",
                        value: data.userId
                    },
                    {
                        field: "organizationId",
                        value: data.organizationId
                    }
                ],
                join: {
                    user: true
                }
            });
            if (!result || !result.user) return null;
            const { user, ...member } = result;
            return {
                ...member,
                user: {
                    id: user.id,
                    name: user.name,
                    email: user.email,
                    image: user.image
                }
            };
        },
        findMemberById: async (memberId)=>{
            const result = await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter)).findOne({
                model: "member",
                where: [
                    {
                        field: "id",
                        value: memberId
                    }
                ],
                join: {
                    user: true
                }
            });
            if (!result) return null;
            const { user, ...member } = result;
            return {
                ...member,
                user: {
                    id: user.id,
                    name: user.name,
                    email: user.email,
                    image: user.image
                }
            };
        },
        createMember: async (data)=>{
            return await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter)).create({
                model: "member",
                data: {
                    ...data,
                    createdAt: /* @__PURE__ */ new Date()
                }
            });
        },
        updateMember: async (memberId, role)=>{
            return await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter)).update({
                model: "member",
                where: [
                    {
                        field: "id",
                        value: memberId
                    }
                ],
                update: {
                    role
                }
            });
        },
        deleteMember: async ({ memberId, organizationId, userId: _userId })=>{
            const adapter = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter);
            let userId;
            if (!_userId) {
                const member$1 = await adapter.findOne({
                    model: "member",
                    where: [
                        {
                            field: "id",
                            value: memberId
                        }
                    ]
                });
                if (!member$1) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["BetterAuthError"]("Member not found");
                userId = member$1.userId;
            } else userId = _userId;
            const member = await adapter.delete({
                model: "member",
                where: [
                    {
                        field: "id",
                        value: memberId
                    }
                ]
            });
            if (options?.teams?.enabled) {
                const teams = await adapter.findMany({
                    model: "team",
                    where: [
                        {
                            field: "organizationId",
                            value: organizationId
                        }
                    ]
                });
                await Promise.all(teams.map((team)=>adapter.deleteMany({
                        model: "teamMember",
                        where: [
                            {
                                field: "teamId",
                                value: team.id
                            },
                            {
                                field: "userId",
                                value: userId
                            }
                        ]
                    })));
            }
            return member;
        },
        updateOrganization: async (organizationId, data)=>{
            const organization = await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter)).update({
                model: "organization",
                where: [
                    {
                        field: "id",
                        value: organizationId
                    }
                ],
                update: {
                    ...data,
                    metadata: typeof data.metadata === "object" ? JSON.stringify(data.metadata) : data.metadata
                }
            });
            if (!organization) return null;
            return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$db$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["filterOutputFields"])({
                ...organization,
                metadata: organization.metadata ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$client$2f$parser$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["parseJSON"])(organization.metadata) : void 0
            }, orgAdditionalFields);
        },
        deleteOrganization: async (organizationId)=>{
            const adapter = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter);
            await adapter.deleteMany({
                model: "member",
                where: [
                    {
                        field: "organizationId",
                        value: organizationId
                    }
                ]
            });
            await adapter.deleteMany({
                model: "invitation",
                where: [
                    {
                        field: "organizationId",
                        value: organizationId
                    }
                ]
            });
            await adapter.delete({
                model: "organization",
                where: [
                    {
                        field: "id",
                        value: organizationId
                    }
                ]
            });
            return organizationId;
        },
        setActiveOrganization: async (sessionToken, organizationId, ctx)=>{
            return await context.internalAdapter.updateSession(sessionToken, {
                activeOrganizationId: organizationId
            });
        },
        findOrganizationById: async (organizationId)=>{
            return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$db$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["filterOutputFields"])(await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter)).findOne({
                model: "organization",
                where: [
                    {
                        field: "id",
                        value: organizationId
                    }
                ]
            }), orgAdditionalFields);
        },
        checkMembership: async ({ userId, organizationId })=>{
            return await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter)).findOne({
                model: "member",
                where: [
                    {
                        field: "userId",
                        value: userId
                    },
                    {
                        field: "organizationId",
                        value: organizationId
                    }
                ]
            });
        },
        findFullOrganization: async ({ organizationId, isSlug, includeTeams, membersLimit })=>{
            const adapter = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter);
            const result = await adapter.findOne({
                model: "organization",
                where: [
                    {
                        field: isSlug ? "slug" : "id",
                        value: organizationId
                    }
                ],
                join: {
                    invitation: true,
                    member: membersLimit ? {
                        limit: membersLimit
                    } : true,
                    ...includeTeams ? {
                        team: true
                    } : {}
                }
            });
            if (!result) return null;
            const { invitation: invitations, member: members, team: teams, ...org } = result;
            const userIds = members.map((member)=>member.userId);
            const users = userIds.length > 0 ? await adapter.findMany({
                model: "user",
                where: [
                    {
                        field: "id",
                        value: userIds,
                        operator: "in"
                    }
                ],
                limit: options?.membershipLimit || 100
            }) : [];
            const userMap = new Map(users.map((user)=>[
                    user.id,
                    user
                ]));
            const membersWithUsers = members.map((member)=>{
                const user = userMap.get(member.userId);
                if (!user) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["BetterAuthError"]("Unexpected error: User not found for member");
                return {
                    ...(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$db$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["filterOutputFields"])(member, memberAdditionalFields),
                    user: {
                        id: user.id,
                        name: user.name,
                        email: user.email,
                        image: user.image
                    }
                };
            });
            const filteredOrg = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$db$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["filterOutputFields"])(org, orgAdditionalFields);
            const filteredInvitations = invitations.map((inv)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$db$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["filterOutputFields"])(inv, invitationAdditionalFields));
            const filteredTeams = teams?.map((team)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$db$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["filterOutputFields"])(team, teamAdditionalFields));
            return {
                ...filteredOrg,
                invitations: filteredInvitations,
                members: membersWithUsers,
                teams: filteredTeams
            };
        },
        listOrganizations: async (userId)=>{
            const result = await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter)).findMany({
                model: "member",
                where: [
                    {
                        field: "userId",
                        value: userId
                    }
                ],
                join: {
                    organization: true
                }
            });
            if (!result || result.length === 0) return [];
            return result.map((member)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$db$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["filterOutputFields"])(member.organization, orgAdditionalFields));
        },
        createTeam: async (data)=>{
            return await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter)).create({
                model: "team",
                data
            });
        },
        findTeamById: async ({ teamId, organizationId, includeTeamMembers })=>{
            const result = await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter)).findOne({
                model: "team",
                where: [
                    {
                        field: "id",
                        value: teamId
                    },
                    ...organizationId ? [
                        {
                            field: "organizationId",
                            value: organizationId
                        }
                    ] : []
                ],
                join: {
                    ...includeTeamMembers ? {
                        teamMember: true
                    } : {}
                }
            });
            if (!result) return null;
            const { teamMember, ...team } = result;
            return {
                ...team,
                ...includeTeamMembers ? {
                    members: teamMember
                } : {}
            };
        },
        updateTeam: async (teamId, data)=>{
            const adapter = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter);
            if ("id" in data) data.id = void 0;
            return await adapter.update({
                model: "team",
                where: [
                    {
                        field: "id",
                        value: teamId
                    }
                ],
                update: {
                    ...data
                }
            });
        },
        deleteTeam: async (teamId)=>{
            const adapter = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter);
            await adapter.deleteMany({
                model: "teamMember",
                where: [
                    {
                        field: "teamId",
                        value: teamId
                    }
                ]
            });
            return await adapter.delete({
                model: "team",
                where: [
                    {
                        field: "id",
                        value: teamId
                    }
                ]
            });
        },
        listTeams: async (organizationId)=>{
            return await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter)).findMany({
                model: "team",
                where: [
                    {
                        field: "organizationId",
                        value: organizationId
                    }
                ]
            });
        },
        createTeamInvitation: async ({ email, role, teamId, organizationId, inviterId, expiresIn = 1e3 * 60 * 60 * 48 })=>{
            const adapter = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter);
            const expiresAt = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2f$date$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDate"])(expiresIn);
            return await adapter.create({
                model: "invitation",
                data: {
                    email,
                    role,
                    organizationId,
                    teamId,
                    inviterId,
                    status: "pending",
                    expiresAt
                }
            });
        },
        setActiveTeam: async (sessionToken, teamId, ctx)=>{
            return await context.internalAdapter.updateSession(sessionToken, {
                activeTeamId: teamId
            });
        },
        listTeamMembers: async (data)=>{
            return await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter)).findMany({
                model: "teamMember",
                where: [
                    {
                        field: "teamId",
                        value: data.teamId
                    }
                ]
            });
        },
        countTeamMembers: async (data)=>{
            return await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter)).count({
                model: "teamMember",
                where: [
                    {
                        field: "teamId",
                        value: data.teamId
                    }
                ]
            });
        },
        countMembers: async (data)=>{
            return await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter)).count({
                model: "member",
                where: [
                    {
                        field: "organizationId",
                        value: data.organizationId
                    }
                ]
            });
        },
        listTeamsByUser: async (data)=>{
            return (await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter)).findMany({
                model: "teamMember",
                where: [
                    {
                        field: "userId",
                        value: data.userId
                    }
                ],
                join: {
                    team: true
                }
            })).map((result)=>result.team);
        },
        findTeamMember: async (data)=>{
            return await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter)).findOne({
                model: "teamMember",
                where: [
                    {
                        field: "teamId",
                        value: data.teamId
                    },
                    {
                        field: "userId",
                        value: data.userId
                    }
                ]
            });
        },
        findOrCreateTeamMember: async (data)=>{
            const adapter = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter);
            const member = await adapter.findOne({
                model: "teamMember",
                where: [
                    {
                        field: "teamId",
                        value: data.teamId
                    },
                    {
                        field: "userId",
                        value: data.userId
                    }
                ]
            });
            if (member) return member;
            return await adapter.create({
                model: "teamMember",
                data: {
                    teamId: data.teamId,
                    userId: data.userId,
                    createdAt: /* @__PURE__ */ new Date()
                }
            });
        },
        removeTeamMember: async (data)=>{
            await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter)).deleteMany({
                model: "teamMember",
                where: [
                    {
                        field: "teamId",
                        value: data.teamId
                    },
                    {
                        field: "userId",
                        value: data.userId
                    }
                ]
            });
        },
        findInvitationsByTeamId: async (teamId)=>{
            return await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter)).findMany({
                model: "invitation",
                where: [
                    {
                        field: "teamId",
                        value: teamId
                    }
                ]
            });
        },
        listUserInvitations: async (email)=>{
            return (await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter)).findMany({
                model: "invitation",
                where: [
                    {
                        field: "email",
                        value: email.toLowerCase()
                    }
                ],
                join: {
                    organization: true
                }
            })).map(({ organization, ...inv })=>({
                    ...inv,
                    organizationName: organization.name
                }));
        },
        createInvitation: async ({ invitation, user })=>{
            const adapter = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter);
            const expiresAt = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2f$date$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDate"])(options?.invitationExpiresIn || 3600 * 48, "sec");
            return await adapter.create({
                model: "invitation",
                data: {
                    status: "pending",
                    expiresAt,
                    createdAt: /* @__PURE__ */ new Date(),
                    inviterId: user.id,
                    ...invitation,
                    teamId: invitation.teamIds.length > 0 ? invitation.teamIds.join(",") : null
                }
            });
        },
        findInvitationById: async (id)=>{
            return await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter)).findOne({
                model: "invitation",
                where: [
                    {
                        field: "id",
                        value: id
                    }
                ]
            });
        },
        findPendingInvitation: async (data)=>{
            return (await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter)).findMany({
                model: "invitation",
                where: [
                    {
                        field: "email",
                        value: data.email.toLowerCase()
                    },
                    {
                        field: "organizationId",
                        value: data.organizationId
                    },
                    {
                        field: "status",
                        value: "pending"
                    }
                ]
            })).filter((invite)=>new Date(invite.expiresAt) > /* @__PURE__ */ new Date());
        },
        findPendingInvitations: async (data)=>{
            return (await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter)).findMany({
                model: "invitation",
                where: [
                    {
                        field: "organizationId",
                        value: data.organizationId
                    },
                    {
                        field: "status",
                        value: "pending"
                    }
                ]
            })).filter((invite)=>new Date(invite.expiresAt) > /* @__PURE__ */ new Date());
        },
        listInvitations: async (data)=>{
            return await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter)).findMany({
                model: "invitation",
                where: [
                    {
                        field: "organizationId",
                        value: data.organizationId
                    }
                ]
            });
        },
        updateInvitation: async (data)=>{
            return await (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$context$2f$transaction$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCurrentAdapter"])(baseAdapter)).update({
                model: "invitation",
                where: [
                    {
                        field: "id",
                        value: data.invitationId
                    }
                ],
                update: {
                    status: data.status
                }
            });
        }
    };
};
;
 //# sourceMappingURL=adapter.mjs.map
}),
"[project]/node_modules/better-auth/dist/plugins/organization/access/statement.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "adminAc",
    ()=>adminAc,
    "defaultAc",
    ()=>defaultAc,
    "defaultRoles",
    ()=>defaultRoles,
    "defaultStatements",
    ()=>defaultStatements,
    "memberAc",
    ()=>memberAc,
    "ownerAc",
    ()=>ownerAc
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$access$2f$access$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/access/access.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$access$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/access/index.mjs [app-route] (ecmascript) <locals>");
;
;
//#region src/plugins/organization/access/statement.ts
const defaultStatements = {
    organization: [
        "update",
        "delete"
    ],
    member: [
        "create",
        "update",
        "delete"
    ],
    invitation: [
        "create",
        "cancel"
    ],
    team: [
        "create",
        "update",
        "delete"
    ],
    ac: [
        "create",
        "read",
        "update",
        "delete"
    ]
};
const defaultAc = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$access$2f$access$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAccessControl"])(defaultStatements);
const adminAc = defaultAc.newRole({
    organization: [
        "update"
    ],
    invitation: [
        "create",
        "cancel"
    ],
    member: [
        "create",
        "update",
        "delete"
    ],
    team: [
        "create",
        "update",
        "delete"
    ],
    ac: [
        "create",
        "read",
        "update",
        "delete"
    ]
});
const ownerAc = defaultAc.newRole({
    organization: [
        "update",
        "delete"
    ],
    member: [
        "create",
        "update",
        "delete"
    ],
    invitation: [
        "create",
        "cancel"
    ],
    team: [
        "create",
        "update",
        "delete"
    ],
    ac: [
        "create",
        "read",
        "update",
        "delete"
    ]
});
const memberAc = defaultAc.newRole({
    organization: [],
    member: [],
    invitation: [],
    team: [],
    ac: [
        "read"
    ]
});
const defaultRoles = {
    admin: adminAc,
    owner: ownerAc,
    member: memberAc
};
;
 //# sourceMappingURL=statement.mjs.map
}),
"[project]/node_modules/better-auth/dist/plugins/organization/access/index.mjs [app-route] (ecmascript) <locals>", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$access$2f$statement$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/access/statement.mjs [app-route] (ecmascript)");
;
;
}),
"[project]/node_modules/better-auth/dist/plugins/organization/call.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "orgMiddleware",
    ()=>orgMiddleware,
    "orgSessionMiddleware",
    ()=>orgSessionMiddleware
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$routes$2f$session$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api/routes/session.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
;
;
;
//#region src/plugins/organization/call.ts
const orgMiddleware = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthMiddleware"])(async ()=>{
    return {};
});
/**
* The middleware forces the endpoint to require a valid session by utilizing the `sessionMiddleware`.
* It also appends additional types to the session type regarding organizations.
*/ const orgSessionMiddleware = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthMiddleware"])({
    use: [
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$routes$2f$session$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sessionMiddleware"]
    ]
}, async (ctx)=>{
    return {
        session: ctx.context.session
    };
});
;
 //# sourceMappingURL=call.mjs.map
}),
"[project]/node_modules/better-auth/dist/plugins/organization/error-codes.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "ORGANIZATION_ERROR_CODES",
    ()=>ORGANIZATION_ERROR_CODES
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/error-codes.mjs [app-route] (ecmascript)");
;
//#region src/plugins/organization/error-codes.ts
const ORGANIZATION_ERROR_CODES = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["defineErrorCodes"])({
    YOU_ARE_NOT_ALLOWED_TO_CREATE_A_NEW_ORGANIZATION: "You are not allowed to create a new organization",
    YOU_HAVE_REACHED_THE_MAXIMUM_NUMBER_OF_ORGANIZATIONS: "You have reached the maximum number of organizations",
    ORGANIZATION_ALREADY_EXISTS: "Organization already exists",
    ORGANIZATION_SLUG_ALREADY_TAKEN: "Organization slug already taken",
    ORGANIZATION_NOT_FOUND: "Organization not found",
    USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION: "User is not a member of the organization",
    YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_ORGANIZATION: "You are not allowed to update this organization",
    YOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_ORGANIZATION: "You are not allowed to delete this organization",
    NO_ACTIVE_ORGANIZATION: "No active organization",
    USER_IS_ALREADY_A_MEMBER_OF_THIS_ORGANIZATION: "User is already a member of this organization",
    MEMBER_NOT_FOUND: "Member not found",
    ROLE_NOT_FOUND: "Role not found",
    YOU_ARE_NOT_ALLOWED_TO_CREATE_A_NEW_TEAM: "You are not allowed to create a new team",
    TEAM_ALREADY_EXISTS: "Team already exists",
    TEAM_NOT_FOUND: "Team not found",
    YOU_CANNOT_LEAVE_THE_ORGANIZATION_AS_THE_ONLY_OWNER: "You cannot leave the organization as the only owner",
    YOU_CANNOT_LEAVE_THE_ORGANIZATION_WITHOUT_AN_OWNER: "You cannot leave the organization without an owner",
    YOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_MEMBER: "You are not allowed to delete this member",
    YOU_ARE_NOT_ALLOWED_TO_INVITE_USERS_TO_THIS_ORGANIZATION: "You are not allowed to invite users to this organization",
    USER_IS_ALREADY_INVITED_TO_THIS_ORGANIZATION: "User is already invited to this organization",
    INVITATION_NOT_FOUND: "Invitation not found",
    YOU_ARE_NOT_THE_RECIPIENT_OF_THE_INVITATION: "You are not the recipient of the invitation",
    EMAIL_VERIFICATION_REQUIRED_BEFORE_ACCEPTING_OR_REJECTING_INVITATION: "Email verification required before accepting or rejecting invitation",
    YOU_ARE_NOT_ALLOWED_TO_CANCEL_THIS_INVITATION: "You are not allowed to cancel this invitation",
    INVITER_IS_NO_LONGER_A_MEMBER_OF_THE_ORGANIZATION: "Inviter is no longer a member of the organization",
    YOU_ARE_NOT_ALLOWED_TO_INVITE_USER_WITH_THIS_ROLE: "You are not allowed to invite a user with this role",
    FAILED_TO_RETRIEVE_INVITATION: "Failed to retrieve invitation",
    YOU_HAVE_REACHED_THE_MAXIMUM_NUMBER_OF_TEAMS: "You have reached the maximum number of teams",
    UNABLE_TO_REMOVE_LAST_TEAM: "Unable to remove last team",
    YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_MEMBER: "You are not allowed to update this member",
    ORGANIZATION_MEMBERSHIP_LIMIT_REACHED: "Organization membership limit reached",
    YOU_ARE_NOT_ALLOWED_TO_CREATE_TEAMS_IN_THIS_ORGANIZATION: "You are not allowed to create teams in this organization",
    YOU_ARE_NOT_ALLOWED_TO_DELETE_TEAMS_IN_THIS_ORGANIZATION: "You are not allowed to delete teams in this organization",
    YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_TEAM: "You are not allowed to update this team",
    YOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_TEAM: "You are not allowed to delete this team",
    INVITATION_LIMIT_REACHED: "Invitation limit reached",
    TEAM_MEMBER_LIMIT_REACHED: "Team member limit reached",
    USER_IS_NOT_A_MEMBER_OF_THE_TEAM: "User is not a member of the team",
    YOU_CAN_NOT_ACCESS_THE_MEMBERS_OF_THIS_TEAM: "You are not allowed to list the members of this team",
    YOU_DO_NOT_HAVE_AN_ACTIVE_TEAM: "You do not have an active team",
    YOU_ARE_NOT_ALLOWED_TO_CREATE_A_NEW_TEAM_MEMBER: "You are not allowed to create a new member",
    YOU_ARE_NOT_ALLOWED_TO_REMOVE_A_TEAM_MEMBER: "You are not allowed to remove a team member",
    YOU_ARE_NOT_ALLOWED_TO_ACCESS_THIS_ORGANIZATION: "You are not allowed to access this organization as an owner",
    YOU_ARE_NOT_A_MEMBER_OF_THIS_ORGANIZATION: "You are not a member of this organization",
    MISSING_AC_INSTANCE: "Dynamic Access Control requires a pre-defined ac instance on the server auth plugin. Read server logs for more information",
    YOU_MUST_BE_IN_AN_ORGANIZATION_TO_CREATE_A_ROLE: "You must be in an organization to create a role",
    YOU_ARE_NOT_ALLOWED_TO_CREATE_A_ROLE: "You are not allowed to create a role",
    YOU_ARE_NOT_ALLOWED_TO_UPDATE_A_ROLE: "You are not allowed to update a role",
    YOU_ARE_NOT_ALLOWED_TO_DELETE_A_ROLE: "You are not allowed to delete a role",
    YOU_ARE_NOT_ALLOWED_TO_READ_A_ROLE: "You are not allowed to read a role",
    YOU_ARE_NOT_ALLOWED_TO_LIST_A_ROLE: "You are not allowed to list a role",
    YOU_ARE_NOT_ALLOWED_TO_GET_A_ROLE: "You are not allowed to get a role",
    TOO_MANY_ROLES: "This organization has too many roles",
    INVALID_RESOURCE: "The provided permission includes an invalid resource",
    ROLE_NAME_IS_ALREADY_TAKEN: "That role name is already taken",
    CANNOT_DELETE_A_PRE_DEFINED_ROLE: "Cannot delete a pre-defined role"
});
;
 //# sourceMappingURL=error-codes.mjs.map
}),
"[project]/node_modules/better-auth/dist/plugins/organization/permission.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "cacheAllRoles",
    ()=>cacheAllRoles,
    "hasPermissionFn",
    ()=>hasPermissionFn
]);
//#region src/plugins/organization/permission.ts
const hasPermissionFn = (input, acRoles)=>{
    if (!input.permissions && !input.permission) return false;
    const roles = input.role.split(",");
    const creatorRole = input.options.creatorRole || "owner";
    const isCreator = roles.includes(creatorRole);
    const allowCreatorsAllPermissions = input.allowCreatorAllPermissions || false;
    if (isCreator && allowCreatorsAllPermissions) return true;
    for (const role of roles)if (acRoles[role]?.authorize(input.permissions ?? input.permission)?.success) return true;
    return false;
};
const cacheAllRoles = /* @__PURE__ */ new Map();
;
 //# sourceMappingURL=permission.mjs.map
}),
"[project]/node_modules/better-auth/dist/plugins/organization/has-permission.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "hasPermission",
    ()=>hasPermission
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/error.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$access$2f$statement$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/access/statement.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$access$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/access/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$permission$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/permission.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
;
;
;
;
;
//#region src/plugins/organization/has-permission.ts
const hasPermission = async (input, ctx)=>{
    let acRoles = {
        ...input.options.roles || __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$access$2f$statement$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["defaultRoles"]
    };
    if (ctx && input.organizationId && input.options.dynamicAccessControl?.enabled && input.options.ac && !input.useMemoryCache) {
        const roles = await ctx.context.adapter.findMany({
            model: "organizationRole",
            where: [
                {
                    field: "organizationId",
                    value: input.organizationId
                }
            ]
        });
        for (const { role, permission: permissionsString } of roles){
            if (role in acRoles) continue;
            const result = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["record"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["array"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]())).safeParse(JSON.parse(permissionsString));
            if (!result.success) {
                ctx.context.logger.error("[hasPermission] Invalid permissions for role " + role, {
                    permissions: JSON.parse(permissionsString)
                });
                throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
                    message: "Invalid permissions for role " + role
                });
            }
            acRoles[role] = input.options.ac.newRole(result.data);
        }
    }
    if (input.useMemoryCache) acRoles = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$permission$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["cacheAllRoles"].get(input.organizationId) || acRoles;
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$permission$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["cacheAllRoles"].set(input.organizationId, acRoles);
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$permission$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hasPermissionFn"])(input, acRoles);
};
;
 //# sourceMappingURL=has-permission.mjs.map
}),
"[project]/node_modules/better-auth/dist/plugins/organization/routes/crud-access-control.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "createOrgRole",
    ()=>createOrgRole,
    "deleteOrgRole",
    ()=>deleteOrgRole,
    "getOrgRole",
    ()=>getOrgRole,
    "listOrgRoles",
    ()=>listOrgRoles,
    "updateOrgRole",
    ()=>updateOrgRole
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$db$2f$to$2d$zod$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/db/to-zod.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$db$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/db/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/error.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/call.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/error-codes.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$has$2d$permission$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/has-permission.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
//#region src/plugins/organization/routes/crud-access-control.ts
const normalizeRoleName = (role)=>role.toLowerCase();
const DEFAULT_MAXIMUM_ROLES_PER_ORGANIZATION = Number.POSITIVE_INFINITY;
const getAdditionalFields = (options, shouldBePartial = false)=>{
    const additionalFields = options?.schema?.organizationRole?.additionalFields || {};
    if (shouldBePartial) for(const key in additionalFields)additionalFields[key].required = false;
    return {
        additionalFieldsSchema: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$db$2f$to$2d$zod$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["toZodSchema"])({
            fields: additionalFields,
            isClientSide: true
        }),
        $AdditionalFields: {},
        $ReturnAdditionalFields: {}
    };
};
const baseCreateOrgRoleSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().optional().meta({
        description: "The id of the organization to create the role in. If not provided, the user's active organization will be used."
    }),
    role: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The name of the role to create"
    }),
    permission: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["record"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["array"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]())).meta({
        description: "The permission to assign to the role"
    })
});
const createOrgRole = (options)=>{
    const { additionalFieldsSchema, $AdditionalFields, $ReturnAdditionalFields } = getAdditionalFields(options, false);
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/create-role", {
        method: "POST",
        body: baseCreateOrgRoleSchema.safeExtend({
            additionalFields: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                ...additionalFieldsSchema.shape
            }).optional()
        }),
        metadata: {
            $Infer: {
                body: {}
            }
        },
        requireHeaders: true,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgSessionMiddleware"]
        ]
    }, async (ctx)=>{
        const { session, user } = ctx.context.session;
        let roleName = ctx.body.role;
        const permission = ctx.body.permission;
        const additionalFields = ctx.body.additionalFields;
        const ac = options.ac;
        if (!ac) {
            ctx.context.logger.error(`[Dynamic Access Control] The organization plugin is missing a pre-defined ac instance.`, `\nPlease refer to the documentation here: https://better-auth.com/docs/plugins/organization#dynamic-access-control`);
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("NOT_IMPLEMENTED", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].MISSING_AC_INSTANCE
            });
        }
        const organizationId = ctx.body.organizationId ?? session.activeOrganizationId;
        if (!organizationId) {
            ctx.context.logger.error(`[Dynamic Access Control] The session is missing an active organization id to create a role. Either set an active org id, or pass an organizationId in the request body.`);
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_MUST_BE_IN_AN_ORGANIZATION_TO_CREATE_A_ROLE
            });
        }
        roleName = normalizeRoleName(roleName);
        await checkIfRoleNameIsTakenByPreDefinedRole({
            role: roleName,
            organizationId,
            options,
            ctx
        });
        const member = await ctx.context.adapter.findOne({
            model: "member",
            where: [
                {
                    field: "organizationId",
                    value: organizationId,
                    operator: "eq",
                    connector: "AND"
                },
                {
                    field: "userId",
                    value: user.id,
                    operator: "eq",
                    connector: "AND"
                }
            ]
        });
        if (!member) {
            ctx.context.logger.error(`[Dynamic Access Control] The user is not a member of the organization to create a role.`, {
                userId: user.id,
                organizationId
            });
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_A_MEMBER_OF_THIS_ORGANIZATION
            });
        }
        if (!await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$has$2d$permission$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hasPermission"])({
            options,
            organizationId,
            permissions: {
                ac: [
                    "create"
                ]
            },
            role: member.role
        }, ctx)) {
            ctx.context.logger.error(`[Dynamic Access Control] The user is not permitted to create a role. If this is unexpected, please make sure the role associated to that member has the "ac" resource with the "create" permission.`, {
                userId: user.id,
                organizationId,
                role: member.role
            });
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_ALLOWED_TO_CREATE_A_ROLE
            });
        }
        const maximumRolesPerOrganization = typeof options.dynamicAccessControl?.maximumRolesPerOrganization === "function" ? await options.dynamicAccessControl.maximumRolesPerOrganization(organizationId) : options.dynamicAccessControl?.maximumRolesPerOrganization ?? DEFAULT_MAXIMUM_ROLES_PER_ORGANIZATION;
        const rolesInDB = await ctx.context.adapter.count({
            model: "organizationRole",
            where: [
                {
                    field: "organizationId",
                    value: organizationId,
                    operator: "eq",
                    connector: "AND"
                }
            ]
        });
        if (rolesInDB >= maximumRolesPerOrganization) {
            ctx.context.logger.error(`[Dynamic Access Control] Failed to create a new role, the organization has too many roles. Maximum allowed roles is ${maximumRolesPerOrganization}.`, {
                organizationId,
                maximumRolesPerOrganization,
                rolesInDB
            });
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].TOO_MANY_ROLES
            });
        }
        await checkForInvalidResources({
            ac,
            ctx,
            permission
        });
        await checkIfMemberHasPermission({
            ctx,
            member,
            options,
            organizationId,
            permissionRequired: permission,
            user,
            action: "create"
        });
        await checkIfRoleNameIsTakenByRoleInDB({
            ctx,
            organizationId,
            role: roleName
        });
        const newRole = ac.newRole(permission);
        const data = {
            ...await ctx.context.adapter.create({
                model: "organizationRole",
                data: {
                    createdAt: /* @__PURE__ */ new Date(),
                    organizationId,
                    permission: JSON.stringify(permission),
                    role: roleName,
                    ...additionalFields
                }
            }),
            permission
        };
        return ctx.json({
            success: true,
            roleData: data,
            statements: newRole.statements
        });
    });
};
const deleteOrgRoleBodySchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().optional().meta({
        description: "The id of the organization to create the role in. If not provided, the user's active organization will be used."
    })
}).and(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["union"]([
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
        roleName: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().nonempty().meta({
            description: "The name of the role to delete"
        })
    }),
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
        roleId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().nonempty().meta({
            description: "The id of the role to delete"
        })
    })
]));
const deleteOrgRole = (options)=>{
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/delete-role", {
        method: "POST",
        body: deleteOrgRoleBodySchema,
        requireHeaders: true,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgSessionMiddleware"]
        ],
        metadata: {
            $Infer: {
                body: {}
            }
        }
    }, async (ctx)=>{
        const { session, user } = ctx.context.session;
        const organizationId = ctx.body.organizationId ?? session.activeOrganizationId;
        if (!organizationId) {
            ctx.context.logger.error(`[Dynamic Access Control] The session is missing an active organization id to delete a role. Either set an active org id, or pass an organizationId in the request body.`);
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].NO_ACTIVE_ORGANIZATION
            });
        }
        const member = await ctx.context.adapter.findOne({
            model: "member",
            where: [
                {
                    field: "organizationId",
                    value: organizationId,
                    operator: "eq",
                    connector: "AND"
                },
                {
                    field: "userId",
                    value: user.id,
                    operator: "eq",
                    connector: "AND"
                }
            ]
        });
        if (!member) {
            ctx.context.logger.error(`[Dynamic Access Control] The user is not a member of the organization to delete a role.`, {
                userId: user.id,
                organizationId
            });
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_A_MEMBER_OF_THIS_ORGANIZATION
            });
        }
        if (!await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$has$2d$permission$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hasPermission"])({
            options,
            organizationId,
            permissions: {
                ac: [
                    "delete"
                ]
            },
            role: member.role
        }, ctx)) {
            ctx.context.logger.error(`[Dynamic Access Control] The user is not permitted to delete a role. If this is unexpected, please make sure the role associated to that member has the "ac" resource with the "delete" permission.`, {
                userId: user.id,
                organizationId,
                role: member.role
            });
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_ALLOWED_TO_DELETE_A_ROLE
            });
        }
        if (ctx.body.roleName) {
            const roleName = ctx.body.roleName;
            const defaultRoles = options.roles ? Object.keys(options.roles) : [
                "owner",
                "admin",
                "member"
            ];
            if (defaultRoles.includes(roleName)) {
                ctx.context.logger.error(`[Dynamic Access Control] Cannot delete a pre-defined role.`, {
                    roleName,
                    organizationId,
                    defaultRoles
                });
                throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].CANNOT_DELETE_A_PRE_DEFINED_ROLE
                });
            }
        }
        let condition;
        if (ctx.body.roleName) condition = {
            field: "role",
            value: ctx.body.roleName,
            operator: "eq",
            connector: "AND"
        };
        else if (ctx.body.roleId) condition = {
            field: "id",
            value: ctx.body.roleId,
            operator: "eq",
            connector: "AND"
        };
        else {
            ctx.context.logger.error(`[Dynamic Access Control] The role name/id is not provided in the request body.`);
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ROLE_NOT_FOUND
            });
        }
        const existingRoleInDB = await ctx.context.adapter.findOne({
            model: "organizationRole",
            where: [
                {
                    field: "organizationId",
                    value: organizationId,
                    operator: "eq",
                    connector: "AND"
                },
                condition
            ]
        });
        if (!existingRoleInDB) {
            ctx.context.logger.error(`[Dynamic Access Control] The role name/id does not exist in the database.`, {
                ..."roleName" in ctx.body ? {
                    roleName: ctx.body.roleName
                } : {
                    roleId: ctx.body.roleId
                },
                organizationId
            });
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ROLE_NOT_FOUND
            });
        }
        existingRoleInDB.permission = JSON.parse(existingRoleInDB.permission);
        await ctx.context.adapter.delete({
            model: "organizationRole",
            where: [
                {
                    field: "organizationId",
                    value: organizationId,
                    operator: "eq",
                    connector: "AND"
                },
                condition
            ]
        });
        return ctx.json({
            success: true
        });
    });
};
const listOrgRolesQuerySchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().optional().meta({
        description: "The id of the organization to list roles for. If not provided, the user's active organization will be used."
    })
}).optional();
const listOrgRoles = (options)=>{
    const { $ReturnAdditionalFields } = getAdditionalFields(options, false);
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/list-roles", {
        method: "GET",
        requireHeaders: true,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgSessionMiddleware"]
        ],
        query: listOrgRolesQuerySchema
    }, async (ctx)=>{
        const { session, user } = ctx.context.session;
        const organizationId = ctx.query?.organizationId ?? session.activeOrganizationId;
        if (!organizationId) {
            ctx.context.logger.error(`[Dynamic Access Control] The session is missing an active organization id to list roles. Either set an active org id, or pass an organizationId in the request query.`);
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].NO_ACTIVE_ORGANIZATION
            });
        }
        const member = await ctx.context.adapter.findOne({
            model: "member",
            where: [
                {
                    field: "organizationId",
                    value: organizationId,
                    operator: "eq",
                    connector: "AND"
                },
                {
                    field: "userId",
                    value: user.id,
                    operator: "eq",
                    connector: "AND"
                }
            ]
        });
        if (!member) {
            ctx.context.logger.error(`[Dynamic Access Control] The user is not a member of the organization to list roles.`, {
                userId: user.id,
                organizationId
            });
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_A_MEMBER_OF_THIS_ORGANIZATION
            });
        }
        if (!await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$has$2d$permission$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hasPermission"])({
            options,
            organizationId,
            permissions: {
                ac: [
                    "read"
                ]
            },
            role: member.role
        }, ctx)) {
            ctx.context.logger.error(`[Dynamic Access Control] The user is not permitted to list roles.`, {
                userId: user.id,
                organizationId,
                role: member.role
            });
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_ALLOWED_TO_LIST_A_ROLE
            });
        }
        let roles = await ctx.context.adapter.findMany({
            model: "organizationRole",
            where: [
                {
                    field: "organizationId",
                    value: organizationId,
                    operator: "eq",
                    connector: "AND"
                }
            ]
        });
        roles = roles.map((x)=>({
                ...x,
                permission: JSON.parse(x.permission)
            }));
        return ctx.json(roles);
    });
};
const getOrgRoleQuerySchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().optional().meta({
        description: "The id of the organization to read a role for. If not provided, the user's active organization will be used."
    })
}).and(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["union"]([
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
        roleName: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().nonempty().meta({
            description: "The name of the role to read"
        })
    }),
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
        roleId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().nonempty().meta({
            description: "The id of the role to read"
        })
    })
])).optional();
const getOrgRole = (options)=>{
    const { $ReturnAdditionalFields } = getAdditionalFields(options, false);
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/get-role", {
        method: "GET",
        requireHeaders: true,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgSessionMiddleware"]
        ],
        query: getOrgRoleQuerySchema,
        metadata: {
            $Infer: {
                query: {}
            }
        }
    }, async (ctx)=>{
        const { session, user } = ctx.context.session;
        const organizationId = ctx.query?.organizationId ?? session.activeOrganizationId;
        if (!organizationId) {
            ctx.context.logger.error(`[Dynamic Access Control] The session is missing an active organization id to read a role. Either set an active org id, or pass an organizationId in the request query.`);
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].NO_ACTIVE_ORGANIZATION
            });
        }
        const member = await ctx.context.adapter.findOne({
            model: "member",
            where: [
                {
                    field: "organizationId",
                    value: organizationId,
                    operator: "eq",
                    connector: "AND"
                },
                {
                    field: "userId",
                    value: user.id,
                    operator: "eq",
                    connector: "AND"
                }
            ]
        });
        if (!member) {
            ctx.context.logger.error(`[Dynamic Access Control] The user is not a member of the organization to read a role.`, {
                userId: user.id,
                organizationId
            });
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_A_MEMBER_OF_THIS_ORGANIZATION
            });
        }
        if (!await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$has$2d$permission$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hasPermission"])({
            options,
            organizationId,
            permissions: {
                ac: [
                    "read"
                ]
            },
            role: member.role
        }, ctx)) {
            ctx.context.logger.error(`[Dynamic Access Control] The user is not permitted to read a role.`, {
                userId: user.id,
                organizationId,
                role: member.role
            });
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_ALLOWED_TO_READ_A_ROLE
            });
        }
        let condition;
        if (ctx.query.roleName) condition = {
            field: "role",
            value: ctx.query.roleName,
            operator: "eq",
            connector: "AND"
        };
        else if (ctx.query.roleId) condition = {
            field: "id",
            value: ctx.query.roleId,
            operator: "eq",
            connector: "AND"
        };
        else {
            ctx.context.logger.error(`[Dynamic Access Control] The role name/id is not provided in the request query.`);
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ROLE_NOT_FOUND
            });
        }
        const role = await ctx.context.adapter.findOne({
            model: "organizationRole",
            where: [
                {
                    field: "organizationId",
                    value: organizationId,
                    operator: "eq",
                    connector: "AND"
                },
                condition
            ]
        });
        if (!role) {
            ctx.context.logger.error(`[Dynamic Access Control] The role name/id does not exist in the database.`, {
                ..."roleName" in ctx.query ? {
                    roleName: ctx.query.roleName
                } : {
                    roleId: ctx.query.roleId
                },
                organizationId
            });
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ROLE_NOT_FOUND
            });
        }
        role.permission = JSON.parse(role.permission);
        return ctx.json(role);
    });
};
const roleNameOrIdSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["union"]([
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
        roleName: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().nonempty().meta({
            description: "The name of the role to update"
        })
    }),
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
        roleId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().nonempty().meta({
            description: "The id of the role to update"
        })
    })
]);
const updateOrgRole = (options)=>{
    const { additionalFieldsSchema, $AdditionalFields, $ReturnAdditionalFields } = getAdditionalFields(options, true);
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/update-role", {
        method: "POST",
        body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
            organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().optional().meta({
                description: "The id of the organization to update the role in. If not provided, the user's active organization will be used."
            }),
            data: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                permission: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["record"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["array"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]())).optional().meta({
                    description: "The permission to update the role with"
                }),
                roleName: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().optional().meta({
                    description: "The name of the role to update"
                }),
                ...additionalFieldsSchema.shape
            })
        }).and(roleNameOrIdSchema),
        metadata: {
            $Infer: {
                body: {}
            }
        },
        requireHeaders: true,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgSessionMiddleware"]
        ]
    }, async (ctx)=>{
        const { session, user } = ctx.context.session;
        const ac = options.ac;
        if (!ac) {
            ctx.context.logger.error(`[Dynamic Access Control] The organization plugin is missing a pre-defined ac instance.`, `\nPlease refer to the documentation here: https://better-auth.com/docs/plugins/organization#dynamic-access-control`);
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("NOT_IMPLEMENTED", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].MISSING_AC_INSTANCE
            });
        }
        const organizationId = ctx.body.organizationId ?? session.activeOrganizationId;
        if (!organizationId) {
            ctx.context.logger.error(`[Dynamic Access Control] The session is missing an active organization id to update a role. Either set an active org id, or pass an organizationId in the request body.`);
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].NO_ACTIVE_ORGANIZATION
            });
        }
        const member = await ctx.context.adapter.findOne({
            model: "member",
            where: [
                {
                    field: "organizationId",
                    value: organizationId,
                    operator: "eq",
                    connector: "AND"
                },
                {
                    field: "userId",
                    value: user.id,
                    operator: "eq",
                    connector: "AND"
                }
            ]
        });
        if (!member) {
            ctx.context.logger.error(`[Dynamic Access Control] The user is not a member of the organization to update a role.`, {
                userId: user.id,
                organizationId
            });
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_A_MEMBER_OF_THIS_ORGANIZATION
            });
        }
        if (!await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$has$2d$permission$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hasPermission"])({
            options,
            organizationId,
            role: member.role,
            permissions: {
                ac: [
                    "update"
                ]
            }
        }, ctx)) {
            ctx.context.logger.error(`[Dynamic Access Control] The user is not permitted to update a role.`);
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_ALLOWED_TO_UPDATE_A_ROLE
            });
        }
        let condition;
        if (ctx.body.roleName) condition = {
            field: "role",
            value: ctx.body.roleName,
            operator: "eq",
            connector: "AND"
        };
        else if (ctx.body.roleId) condition = {
            field: "id",
            value: ctx.body.roleId,
            operator: "eq",
            connector: "AND"
        };
        else {
            ctx.context.logger.error(`[Dynamic Access Control] The role name/id is not provided in the request body.`);
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ROLE_NOT_FOUND
            });
        }
        const role = await ctx.context.adapter.findOne({
            model: "organizationRole",
            where: [
                {
                    field: "organizationId",
                    value: organizationId,
                    operator: "eq",
                    connector: "AND"
                },
                condition
            ]
        });
        if (!role) {
            ctx.context.logger.error(`[Dynamic Access Control] The role name/id does not exist in the database.`, {
                ..."roleName" in ctx.body ? {
                    roleName: ctx.body.roleName
                } : {
                    roleId: ctx.body.roleId
                },
                organizationId
            });
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ROLE_NOT_FOUND
            });
        }
        role.permission = role.permission ? JSON.parse(role.permission) : void 0;
        const { permission: _, roleName: __, ...additionalFields } = ctx.body.data;
        const updateData = {
            ...additionalFields
        };
        if (ctx.body.data.permission) {
            const newPermission = ctx.body.data.permission;
            await checkForInvalidResources({
                ac,
                ctx,
                permission: newPermission
            });
            await checkIfMemberHasPermission({
                ctx,
                member,
                options,
                organizationId,
                permissionRequired: newPermission,
                user,
                action: "update"
            });
            updateData.permission = newPermission;
        }
        if (ctx.body.data.roleName) {
            let newRoleName = ctx.body.data.roleName;
            newRoleName = normalizeRoleName(newRoleName);
            await checkIfRoleNameIsTakenByPreDefinedRole({
                role: newRoleName,
                organizationId,
                options,
                ctx
            });
            await checkIfRoleNameIsTakenByRoleInDB({
                role: newRoleName,
                organizationId,
                ctx
            });
            updateData.role = newRoleName;
        }
        const update = {
            ...updateData,
            ...updateData.permission ? {
                permission: JSON.stringify(updateData.permission)
            } : {}
        };
        await ctx.context.adapter.update({
            model: "organizationRole",
            where: [
                {
                    field: "organizationId",
                    value: organizationId,
                    operator: "eq",
                    connector: "AND"
                },
                condition
            ],
            update
        });
        return ctx.json({
            success: true,
            roleData: {
                ...role,
                ...update,
                permission: updateData.permission || role.permission || null
            }
        });
    });
};
async function checkForInvalidResources({ ac, ctx, permission }) {
    const validResources = Object.keys(ac.statements);
    const providedResources = Object.keys(permission);
    if (providedResources.some((r)=>!validResources.includes(r))) {
        ctx.context.logger.error(`[Dynamic Access Control] The provided permission includes an invalid resource.`, {
            providedResources,
            validResources
        });
        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].INVALID_RESOURCE
        });
    }
}
async function checkIfMemberHasPermission({ ctx, permissionRequired: permission, options, organizationId, member, user, action }) {
    const hasNecessaryPermissions = [];
    const permissionEntries = Object.entries(permission);
    for await (const [resource, permissions] of permissionEntries)for await (const perm of permissions)hasNecessaryPermissions.push({
        resource: {
            [resource]: [
                perm
            ]
        },
        hasPermission: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$has$2d$permission$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hasPermission"])({
            options,
            organizationId,
            permissions: {
                [resource]: [
                    perm
                ]
            },
            useMemoryCache: true,
            role: member.role
        }, ctx)
    });
    const missingPermissions = hasNecessaryPermissions.filter((x)=>x.hasPermission === false).map((x)=>{
        const key = Object.keys(x.resource)[0];
        return `${key}:${x.resource[key][0]}`;
    });
    if (missingPermissions.length > 0) {
        ctx.context.logger.error(`[Dynamic Access Control] The user is missing permissions necessary to ${action} a role with those set of permissions.\n`, {
            userId: user.id,
            organizationId,
            role: member.role,
            missingPermissions
        });
        let errorMessage;
        if (action === "create") errorMessage = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_ALLOWED_TO_CREATE_A_ROLE;
        else if (action === "update") errorMessage = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_ALLOWED_TO_UPDATE_A_ROLE;
        else if (action === "delete") errorMessage = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_ALLOWED_TO_DELETE_A_ROLE;
        else if (action === "read") errorMessage = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_ALLOWED_TO_READ_A_ROLE;
        else if (action === "list") errorMessage = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_ALLOWED_TO_LIST_A_ROLE;
        else errorMessage = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_ALLOWED_TO_GET_A_ROLE;
        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: errorMessage,
            missingPermissions
        });
    }
}
async function checkIfRoleNameIsTakenByPreDefinedRole({ options, organizationId, role, ctx }) {
    const defaultRoles = options.roles ? Object.keys(options.roles) : [
        "owner",
        "admin",
        "member"
    ];
    if (defaultRoles.includes(role)) {
        ctx.context.logger.error(`[Dynamic Access Control] The role name "${role}" is already taken by a pre-defined role.`, {
            role,
            organizationId,
            defaultRoles
        });
        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ROLE_NAME_IS_ALREADY_TAKEN
        });
    }
}
async function checkIfRoleNameIsTakenByRoleInDB({ organizationId, role, ctx }) {
    if (await ctx.context.adapter.findOne({
        model: "organizationRole",
        where: [
            {
                field: "organizationId",
                value: organizationId,
                operator: "eq",
                connector: "AND"
            },
            {
                field: "role",
                value: role,
                operator: "eq",
                connector: "AND"
            }
        ]
    })) {
        ctx.context.logger.error(`[Dynamic Access Control] The role name "${role}" is already taken by a role in the database.`, {
            role,
            organizationId
        });
        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ROLE_NAME_IS_ALREADY_TAKEN
        });
    }
}
;
 //# sourceMappingURL=crud-access-control.mjs.map
}),
"[project]/node_modules/better-auth/dist/plugins/organization/routes/crud-invites.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "acceptInvitation",
    ()=>acceptInvitation,
    "cancelInvitation",
    ()=>cancelInvitation,
    "createInvitation",
    ()=>createInvitation,
    "getInvitation",
    ()=>getInvitation,
    "listInvitations",
    ()=>listInvitations,
    "listUserInvitations",
    ()=>listUserInvitations,
    "rejectInvitation",
    ()=>rejectInvitation
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2f$date$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/utils/date.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$db$2f$to$2d$zod$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/db/to-zod.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$db$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/db/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/cookies/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$routes$2f$session$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api/routes/session.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$routes$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api/routes/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$access$2f$statement$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/access/statement.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/adapter.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/call.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/error-codes.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$has$2d$permission$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/has-permission.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$organization$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/organization.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2f$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error/codes.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/error.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
//#region src/plugins/organization/routes/crud-invites.ts
const baseInvitationSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The email address of the user to invite"
    }),
    role: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["union"]([
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
            description: "The role to assign to the user"
        }),
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["array"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
            description: "The roles to assign to the user"
        }))
    ]).meta({
        description: "The role(s) to assign to the user. It can be `admin`, `member`, owner. Eg: \"member\""
    }),
    organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The organization ID to invite the user to"
    }).optional(),
    resend: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["boolean"]().meta({
        description: "Resend the invitation email, if the user is already invited. Eg: true"
    }).optional(),
    teamId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["union"]([
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
            description: "The team ID to invite the user to"
        }).optional(),
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["array"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]()).meta({
            description: "The team IDs to invite the user to"
        }).optional()
    ])
});
const createInvitation = (option)=>{
    const additionalFieldsSchema = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$db$2f$to$2d$zod$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["toZodSchema"])({
        fields: option?.schema?.invitation?.additionalFields || {},
        isClientSide: true
    });
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/invite-member", {
        method: "POST",
        requireHeaders: true,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgMiddleware"],
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgSessionMiddleware"]
        ],
        body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
            ...baseInvitationSchema.shape,
            ...additionalFieldsSchema.shape
        }),
        metadata: {
            $Infer: {
                body: {}
            },
            openapi: {
                operationId: "createOrganizationInvitation",
                description: "Create an invitation to an organization",
                responses: {
                    "200": {
                        description: "Success",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    properties: {
                                        id: {
                                            type: "string"
                                        },
                                        email: {
                                            type: "string"
                                        },
                                        role: {
                                            type: "string"
                                        },
                                        organizationId: {
                                            type: "string"
                                        },
                                        inviterId: {
                                            type: "string"
                                        },
                                        status: {
                                            type: "string"
                                        },
                                        expiresAt: {
                                            type: "string"
                                        },
                                        createdAt: {
                                            type: "string"
                                        }
                                    },
                                    required: [
                                        "id",
                                        "email",
                                        "role",
                                        "organizationId",
                                        "inviterId",
                                        "status",
                                        "expiresAt",
                                        "createdAt"
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (ctx)=>{
        const session = ctx.context.session;
        const organizationId = ctx.body.organizationId || session.session.activeOrganizationId;
        if (!organizationId) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ORGANIZATION_NOT_FOUND
        });
        const email = ctx.body.email.toLowerCase();
        if (!__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["email"]().safeParse(email).success) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2f$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["BASE_ERROR_CODES"].INVALID_EMAIL
        });
        const adapter = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, option);
        const member = await adapter.findMemberByOrgId({
            userId: session.user.id,
            organizationId
        });
        if (!member) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].MEMBER_NOT_FOUND
        });
        if (!await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$has$2d$permission$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hasPermission"])({
            role: member.role,
            options: ctx.context.orgOptions,
            permissions: {
                invitation: [
                    "create"
                ]
            },
            organizationId
        }, ctx)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_ALLOWED_TO_INVITE_USERS_TO_THIS_ORGANIZATION
        });
        const creatorRole = ctx.context.orgOptions.creatorRole || "owner";
        const roles = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$organization$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["parseRoles"])(ctx.body.role);
        const rolesArray = roles.split(",").map((r)=>r.trim()).filter(Boolean);
        const defaults = Object.keys(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$access$2f$statement$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["defaultRoles"]);
        const customRoles = Object.keys(ctx.context.orgOptions.roles || {});
        const validStaticRoles = new Set([
            ...defaults,
            ...customRoles
        ]);
        const unknownRoles = rolesArray.filter((role)=>!validStaticRoles.has(role));
        if (unknownRoles.length > 0) if (ctx.context.orgOptions.dynamicAccessControl?.enabled) {
            const foundRoleNames = (await ctx.context.adapter.findMany({
                model: "organizationRole",
                where: [
                    {
                        field: "organizationId",
                        value: organizationId
                    },
                    {
                        field: "role",
                        value: unknownRoles,
                        operator: "in"
                    }
                ]
            })).map((r)=>r.role);
            const stillInvalid = unknownRoles.filter((r)=>!foundRoleNames.includes(r));
            if (stillInvalid.length > 0) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: `${__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ROLE_NOT_FOUND}: ${stillInvalid.join(", ")}`
            });
        } else throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: `${__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ROLE_NOT_FOUND}: ${unknownRoles.join(", ")}`
        });
        if (member.role !== creatorRole && roles.split(",").includes(creatorRole)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_ALLOWED_TO_INVITE_USER_WITH_THIS_ROLE
        });
        if (await adapter.findMemberByEmail({
            email,
            organizationId
        })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].USER_IS_ALREADY_A_MEMBER_OF_THIS_ORGANIZATION
        });
        const alreadyInvited = await adapter.findPendingInvitation({
            email,
            organizationId
        });
        if (alreadyInvited.length && !ctx.body.resend) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].USER_IS_ALREADY_INVITED_TO_THIS_ORGANIZATION
        });
        const organization = await adapter.findOrganizationById(organizationId);
        if (!organization) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ORGANIZATION_NOT_FOUND
        });
        if (alreadyInvited.length && ctx.body.resend) {
            const existingInvitation = alreadyInvited[0];
            const newExpiresAt = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2f$date$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDate"])(ctx.context.orgOptions.invitationExpiresIn || 3600 * 48, "sec");
            await ctx.context.adapter.update({
                model: "invitation",
                where: [
                    {
                        field: "id",
                        value: existingInvitation.id
                    }
                ],
                update: {
                    expiresAt: newExpiresAt
                }
            });
            const updatedInvitation = {
                ...existingInvitation,
                expiresAt: newExpiresAt
            };
            if (ctx.context.orgOptions.sendInvitationEmail) await ctx.context.runInBackgroundOrAwait(ctx.context.orgOptions.sendInvitationEmail({
                id: updatedInvitation.id,
                role: updatedInvitation.role,
                email: updatedInvitation.email.toLowerCase(),
                organization,
                inviter: {
                    ...member,
                    user: session.user
                },
                invitation: updatedInvitation
            }, ctx.request));
            return ctx.json(updatedInvitation);
        }
        if (alreadyInvited.length && ctx.context.orgOptions.cancelPendingInvitationsOnReInvite) await adapter.updateInvitation({
            invitationId: alreadyInvited[0].id,
            status: "canceled"
        });
        const invitationLimit = typeof ctx.context.orgOptions.invitationLimit === "function" ? await ctx.context.orgOptions.invitationLimit({
            user: session.user,
            organization,
            member
        }, ctx.context) : ctx.context.orgOptions.invitationLimit ?? 100;
        if ((await adapter.findPendingInvitations({
            organizationId
        })).length >= invitationLimit) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].INVITATION_LIMIT_REACHED
        });
        if (ctx.context.orgOptions.teams && ctx.context.orgOptions.teams.enabled && typeof ctx.context.orgOptions.teams.maximumMembersPerTeam !== "undefined" && "teamId" in ctx.body && ctx.body.teamId) {
            const teamIds$1 = typeof ctx.body.teamId === "string" ? [
                ctx.body.teamId
            ] : ctx.body.teamId;
            for (const teamId of teamIds$1){
                const team = await adapter.findTeamById({
                    teamId,
                    organizationId,
                    includeTeamMembers: true
                });
                if (!team) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].TEAM_NOT_FOUND
                });
                const maximumMembersPerTeam = typeof ctx.context.orgOptions.teams.maximumMembersPerTeam === "function" ? await ctx.context.orgOptions.teams.maximumMembersPerTeam({
                    teamId,
                    session,
                    organizationId
                }) : ctx.context.orgOptions.teams.maximumMembersPerTeam;
                if (team.members.length >= maximumMembersPerTeam) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
                    message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].TEAM_MEMBER_LIMIT_REACHED
                });
            }
        }
        const teamIds = "teamId" in ctx.body ? typeof ctx.body.teamId === "string" ? [
            ctx.body.teamId
        ] : ctx.body.teamId ?? [] : [];
        const { email: _, role: __, organizationId: ___, resend: ____, ...additionalFields } = ctx.body;
        let invitationData = {
            role: roles,
            email,
            organizationId,
            teamIds,
            ...additionalFields ? additionalFields : {}
        };
        if (option?.organizationHooks?.beforeCreateInvitation) {
            const response = await option?.organizationHooks.beforeCreateInvitation({
                invitation: {
                    ...invitationData,
                    inviterId: session.user.id,
                    teamId: teamIds.length > 0 ? teamIds[0] : void 0
                },
                inviter: session.user,
                organization
            });
            if (response && typeof response === "object" && "data" in response) invitationData = {
                ...invitationData,
                ...response.data
            };
        }
        const invitation = await adapter.createInvitation({
            invitation: invitationData,
            user: session.user
        });
        if (ctx.context.orgOptions.sendInvitationEmail) await ctx.context.runInBackgroundOrAwait(ctx.context.orgOptions.sendInvitationEmail({
            id: invitation.id,
            role: invitation.role,
            email: invitation.email.toLowerCase(),
            organization,
            inviter: {
                ...member,
                user: session.user
            },
            invitation
        }, ctx.request));
        if (option?.organizationHooks?.afterCreateInvitation) await option?.organizationHooks.afterCreateInvitation({
            invitation,
            inviter: session.user,
            organization
        });
        return ctx.json(invitation);
    });
};
const acceptInvitationBodySchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    invitationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The ID of the invitation to accept"
    })
});
const acceptInvitation = (options)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/accept-invitation", {
        method: "POST",
        body: acceptInvitationBodySchema,
        requireHeaders: true,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgMiddleware"],
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgSessionMiddleware"]
        ],
        metadata: {
            openapi: {
                description: "Accept an invitation to an organization",
                responses: {
                    "200": {
                        description: "Success",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    properties: {
                                        invitation: {
                                            type: "object"
                                        },
                                        member: {
                                            type: "object"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (ctx)=>{
        const session = ctx.context.session;
        const adapter = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, options);
        const invitation = await adapter.findInvitationById(ctx.body.invitationId);
        if (!invitation || invitation.expiresAt < /* @__PURE__ */ new Date() || invitation.status !== "pending") throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].INVITATION_NOT_FOUND
        });
        if (invitation.email.toLowerCase() !== session.user.email.toLowerCase()) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_THE_RECIPIENT_OF_THE_INVITATION
        });
        if (ctx.context.orgOptions.requireEmailVerificationOnInvitation && !session.user.emailVerified) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].EMAIL_VERIFICATION_REQUIRED_BEFORE_ACCEPTING_OR_REJECTING_INVITATION
        });
        const membershipLimit = ctx.context.orgOptions?.membershipLimit || 100;
        if (await adapter.countMembers({
            organizationId: invitation.organizationId
        }) >= membershipLimit) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ORGANIZATION_MEMBERSHIP_LIMIT_REACHED
        });
        const organization = await adapter.findOrganizationById(invitation.organizationId);
        if (!organization) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ORGANIZATION_NOT_FOUND
        });
        if (options?.organizationHooks?.beforeAcceptInvitation) await options?.organizationHooks.beforeAcceptInvitation({
            invitation,
            user: session.user,
            organization
        });
        const acceptedI = await adapter.updateInvitation({
            invitationId: ctx.body.invitationId,
            status: "accepted"
        });
        if (!acceptedI) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].FAILED_TO_RETRIEVE_INVITATION
        });
        if (ctx.context.orgOptions.teams && ctx.context.orgOptions.teams.enabled && "teamId" in acceptedI && acceptedI.teamId) {
            const teamIds = acceptedI.teamId.split(",");
            const onlyOne = teamIds.length === 1;
            for (const teamId of teamIds){
                await adapter.findOrCreateTeamMember({
                    teamId,
                    userId: session.user.id
                });
                if (typeof ctx.context.orgOptions.teams.maximumMembersPerTeam !== "undefined") {
                    if (await adapter.countTeamMembers({
                        teamId
                    }) >= (typeof ctx.context.orgOptions.teams.maximumMembersPerTeam === "function" ? await ctx.context.orgOptions.teams.maximumMembersPerTeam({
                        teamId,
                        session,
                        organizationId: invitation.organizationId
                    }) : ctx.context.orgOptions.teams.maximumMembersPerTeam)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
                        message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].TEAM_MEMBER_LIMIT_REACHED
                    });
                }
            }
            if (onlyOne) {
                const teamId = teamIds[0];
                await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["setSessionCookie"])(ctx, {
                    session: await adapter.setActiveTeam(session.session.token, teamId, ctx),
                    user: session.user
                });
            }
        }
        const member = await adapter.createMember({
            organizationId: invitation.organizationId,
            userId: session.user.id,
            role: invitation.role,
            createdAt: /* @__PURE__ */ new Date()
        });
        await adapter.setActiveOrganization(session.session.token, invitation.organizationId, ctx);
        if (!acceptedI) return ctx.json(null, {
            status: 400,
            body: {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].INVITATION_NOT_FOUND
            }
        });
        if (options?.organizationHooks?.afterAcceptInvitation) await options?.organizationHooks.afterAcceptInvitation({
            invitation: acceptedI,
            member,
            user: session.user,
            organization
        });
        return ctx.json({
            invitation: acceptedI,
            member
        });
    });
const rejectInvitationBodySchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    invitationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The ID of the invitation to reject"
    })
});
const rejectInvitation = (options)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/reject-invitation", {
        method: "POST",
        body: rejectInvitationBodySchema,
        requireHeaders: true,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgMiddleware"],
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgSessionMiddleware"]
        ],
        metadata: {
            openapi: {
                description: "Reject an invitation to an organization",
                responses: {
                    "200": {
                        description: "Success",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    properties: {
                                        invitation: {
                                            type: "object"
                                        },
                                        member: {
                                            type: "object",
                                            nullable: true
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (ctx)=>{
        const session = ctx.context.session;
        const adapter = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, ctx.context.orgOptions);
        const invitation = await adapter.findInvitationById(ctx.body.invitationId);
        if (!invitation || invitation.status !== "pending") throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: "Invitation not found!"
        });
        if (invitation.email.toLowerCase() !== session.user.email.toLowerCase()) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_THE_RECIPIENT_OF_THE_INVITATION
        });
        if (ctx.context.orgOptions.requireEmailVerificationOnInvitation && !session.user.emailVerified) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].EMAIL_VERIFICATION_REQUIRED_BEFORE_ACCEPTING_OR_REJECTING_INVITATION
        });
        const organization = await adapter.findOrganizationById(invitation.organizationId);
        if (!organization) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ORGANIZATION_NOT_FOUND
        });
        if (options?.organizationHooks?.beforeRejectInvitation) await options?.organizationHooks.beforeRejectInvitation({
            invitation,
            user: session.user,
            organization
        });
        const rejectedI = await adapter.updateInvitation({
            invitationId: ctx.body.invitationId,
            status: "rejected"
        });
        if (options?.organizationHooks?.afterRejectInvitation) await options?.organizationHooks.afterRejectInvitation({
            invitation: rejectedI || invitation,
            user: session.user,
            organization
        });
        return ctx.json({
            invitation: rejectedI,
            member: null
        });
    });
const cancelInvitationBodySchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    invitationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The ID of the invitation to cancel"
    })
});
const cancelInvitation = (options)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/cancel-invitation", {
        method: "POST",
        body: cancelInvitationBodySchema,
        requireHeaders: true,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgMiddleware"],
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgSessionMiddleware"]
        ],
        openapi: {
            operationId: "cancelOrganizationInvitation",
            description: "Cancel an invitation to an organization",
            responses: {
                "200": {
                    description: "Success",
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    invitation: {
                                        type: "object"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (ctx)=>{
        const session = ctx.context.session;
        const adapter = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, options);
        const invitation = await adapter.findInvitationById(ctx.body.invitationId);
        if (!invitation) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].INVITATION_NOT_FOUND
        });
        const member = await adapter.findMemberByOrgId({
            userId: session.user.id,
            organizationId: invitation.organizationId
        });
        if (!member) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].MEMBER_NOT_FOUND
        });
        if (!await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$has$2d$permission$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hasPermission"])({
            role: member.role,
            options: ctx.context.orgOptions,
            permissions: {
                invitation: [
                    "cancel"
                ]
            },
            organizationId: invitation.organizationId
        }, ctx)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_ALLOWED_TO_CANCEL_THIS_INVITATION
        });
        const organization = await adapter.findOrganizationById(invitation.organizationId);
        if (!organization) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ORGANIZATION_NOT_FOUND
        });
        if (options?.organizationHooks?.beforeCancelInvitation) await options?.organizationHooks.beforeCancelInvitation({
            invitation,
            cancelledBy: session.user,
            organization
        });
        const canceledI = await adapter.updateInvitation({
            invitationId: ctx.body.invitationId,
            status: "canceled"
        });
        if (options?.organizationHooks?.afterCancelInvitation) await options?.organizationHooks.afterCancelInvitation({
            invitation: canceledI || invitation,
            cancelledBy: session.user,
            organization
        });
        return ctx.json(canceledI);
    });
const getInvitationQuerySchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The ID of the invitation to get"
    })
});
const getInvitation = (options)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/get-invitation", {
        method: "GET",
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgMiddleware"]
        ],
        requireHeaders: true,
        query: getInvitationQuerySchema,
        metadata: {
            openapi: {
                description: "Get an invitation by ID",
                responses: {
                    "200": {
                        description: "Success",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    properties: {
                                        id: {
                                            type: "string"
                                        },
                                        email: {
                                            type: "string"
                                        },
                                        role: {
                                            type: "string"
                                        },
                                        organizationId: {
                                            type: "string"
                                        },
                                        inviterId: {
                                            type: "string"
                                        },
                                        status: {
                                            type: "string"
                                        },
                                        expiresAt: {
                                            type: "string"
                                        },
                                        organizationName: {
                                            type: "string"
                                        },
                                        organizationSlug: {
                                            type: "string"
                                        },
                                        inviterEmail: {
                                            type: "string"
                                        }
                                    },
                                    required: [
                                        "id",
                                        "email",
                                        "role",
                                        "organizationId",
                                        "inviterId",
                                        "status",
                                        "expiresAt",
                                        "organizationName",
                                        "organizationSlug",
                                        "inviterEmail"
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (ctx)=>{
        const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$routes$2f$session$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getSessionFromCtx"])(ctx);
        if (!session) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            message: "Not authenticated"
        });
        const adapter = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, options);
        const invitation = await adapter.findInvitationById(ctx.query.id);
        if (!invitation || invitation.status !== "pending" || invitation.expiresAt < /* @__PURE__ */ new Date()) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: "Invitation not found!"
        });
        if (invitation.email.toLowerCase() !== session.user.email.toLowerCase()) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_THE_RECIPIENT_OF_THE_INVITATION
        });
        const organization = await adapter.findOrganizationById(invitation.organizationId);
        if (!organization) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ORGANIZATION_NOT_FOUND
        });
        const member = await adapter.findMemberByOrgId({
            userId: invitation.inviterId,
            organizationId: invitation.organizationId
        });
        if (!member) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].INVITER_IS_NO_LONGER_A_MEMBER_OF_THE_ORGANIZATION
        });
        return ctx.json({
            ...invitation,
            organizationName: organization.name,
            organizationSlug: organization.slug,
            inviterEmail: member.user.email
        });
    });
const listInvitationQuerySchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The ID of the organization to list invitations for"
    }).optional()
}).optional();
const listInvitations = (options)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/list-invitations", {
        method: "GET",
        requireHeaders: true,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgMiddleware"],
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgSessionMiddleware"]
        ],
        query: listInvitationQuerySchema
    }, async (ctx)=>{
        const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$routes$2f$session$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getSessionFromCtx"])(ctx);
        if (!session) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            message: "Not authenticated"
        });
        const orgId = ctx.query?.organizationId || session.session.activeOrganizationId;
        if (!orgId) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: "Organization ID is required"
        });
        const adapter = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, options);
        if (!await adapter.findMemberByOrgId({
            userId: session.user.id,
            organizationId: orgId
        })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: "You are not a member of this organization"
        });
        const invitations = await adapter.listInvitations({
            organizationId: orgId
        });
        return ctx.json(invitations);
    });
/**
* List all invitations a user has received
*/ const listUserInvitations = (options)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/list-user-invitations", {
        method: "GET",
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgMiddleware"]
        ],
        query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
            email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                description: "The email of the user to list invitations for. This only works for server side API calls."
            }).optional()
        }).optional(),
        metadata: {
            openapi: {
                description: "List all invitations a user has received",
                responses: {
                    "200": {
                        description: "Success",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "array",
                                    items: {
                                        type: "object",
                                        properties: {
                                            id: {
                                                type: "string"
                                            },
                                            email: {
                                                type: "string"
                                            },
                                            role: {
                                                type: "string"
                                            },
                                            organizationId: {
                                                type: "string"
                                            },
                                            organizationName: {
                                                type: "string"
                                            },
                                            inviterId: {
                                                type: "string",
                                                description: "The ID of the user who created the invitation"
                                            },
                                            teamId: {
                                                type: "string",
                                                description: "The ID of the team associated with the invitation",
                                                nullable: true
                                            },
                                            status: {
                                                type: "string"
                                            },
                                            expiresAt: {
                                                type: "string"
                                            },
                                            createdAt: {
                                                type: "string"
                                            }
                                        },
                                        required: [
                                            "id",
                                            "email",
                                            "role",
                                            "organizationId",
                                            "organizationName",
                                            "inviterId",
                                            "status",
                                            "expiresAt",
                                            "createdAt"
                                        ]
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (ctx)=>{
        const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$routes$2f$session$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getSessionFromCtx"])(ctx);
        if (ctx.request && ctx.query?.email) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: "User email cannot be passed for client side API calls."
        });
        const userEmail = session?.user.email || ctx.query?.email;
        if (!userEmail) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: "Missing session headers, or email query parameter."
        });
        const pendingInvitations = (await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, options).listUserInvitations(userEmail)).filter((inv)=>inv.status === "pending");
        return ctx.json(pendingInvitations);
    });
;
 //# sourceMappingURL=crud-invites.mjs.map
}),
"[project]/node_modules/better-auth/dist/plugins/organization/routes/crud-members.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "addMember",
    ()=>addMember,
    "getActiveMember",
    ()=>getActiveMember,
    "getActiveMemberRole",
    ()=>getActiveMemberRole,
    "leaveOrganization",
    ()=>leaveOrganization,
    "listMembers",
    ()=>listMembers,
    "removeMember",
    ()=>removeMember,
    "updateMemberRole",
    ()=>updateMemberRole
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$db$2f$to$2d$zod$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/db/to-zod.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$routes$2f$session$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api/routes/session.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/adapter.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/call.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/error-codes.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$has$2d$permission$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/has-permission.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$organization$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/organization.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2f$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/error/codes.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/error.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/external.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
;
;
;
//#region src/plugins/organization/routes/crud-members.ts
const baseMemberSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["coerce"].string().meta({
        description: "The user Id which represents the user to be added as a member. If `null` is provided, then it's expected to provide session headers. Eg: \"user-id\""
    }),
    role: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["union"]([
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](),
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["array"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]())
    ]).meta({
        description: "The role(s) to assign to the new member. Eg: [\"admin\", \"sale\"]"
    }),
    organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "An optional organization ID to pass. If not provided, will default to the user's active organization. Eg: \"org-id\""
    }).optional(),
    teamId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "An optional team ID to add the member to. Eg: \"team-id\""
    }).optional()
});
const addMember = (option)=>{
    const additionalFieldsSchema = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$db$2f$to$2d$zod$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["toZodSchema"])({
        fields: option?.schema?.member?.additionalFields || {},
        isClientSide: true
    });
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])({
        method: "POST",
        body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
            ...baseMemberSchema.shape,
            ...additionalFieldsSchema.shape
        }),
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgMiddleware"]
        ],
        metadata: {
            $Infer: {
                body: {}
            },
            openapi: {
                operationId: "addOrganizationMember",
                description: "Add a member to an organization"
            }
        }
    }, async (ctx)=>{
        const session = ctx.body.userId ? await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$routes$2f$session$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getSessionFromCtx"])(ctx).catch((e)=>null) : null;
        const orgId = ctx.body.organizationId || session?.session.activeOrganizationId;
        if (!orgId) return ctx.json(null, {
            status: 400,
            body: {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].NO_ACTIVE_ORGANIZATION
            }
        });
        const teamId = "teamId" in ctx.body ? ctx.body.teamId : void 0;
        if (teamId && !ctx.context.orgOptions.teams?.enabled) {
            ctx.context.logger.error("Teams are not enabled");
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: "Teams are not enabled"
            });
        }
        const adapter = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, option);
        const user = await ctx.context.internalAdapter.findUserById(ctx.body.userId);
        if (!user) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$error$2f$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["BASE_ERROR_CODES"].USER_NOT_FOUND
        });
        if (await adapter.findMemberByEmail({
            email: user.email,
            organizationId: orgId
        })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].USER_IS_ALREADY_A_MEMBER_OF_THIS_ORGANIZATION
        });
        if (teamId) {
            const team = await adapter.findTeamById({
                teamId,
                organizationId: orgId
            });
            if (!team || team.organizationId !== orgId) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].TEAM_NOT_FOUND
            });
        }
        const membershipLimit = ctx.context.orgOptions?.membershipLimit || 100;
        if (await adapter.countMembers({
            organizationId: orgId
        }) >= membershipLimit) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ORGANIZATION_MEMBERSHIP_LIMIT_REACHED
        });
        const { role: _, userId: __, organizationId: ___, ...additionalFields } = ctx.body;
        const organization = await adapter.findOrganizationById(orgId);
        if (!organization) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ORGANIZATION_NOT_FOUND
        });
        let memberData = {
            organizationId: orgId,
            userId: user.id,
            role: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$organization$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["parseRoles"])(ctx.body.role),
            createdAt: /* @__PURE__ */ new Date(),
            ...additionalFields ? additionalFields : {}
        };
        if (option?.organizationHooks?.beforeAddMember) {
            const response = await option?.organizationHooks.beforeAddMember({
                member: {
                    userId: user.id,
                    organizationId: orgId,
                    role: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$organization$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["parseRoles"])(ctx.body.role),
                    ...additionalFields
                },
                user,
                organization
            });
            if (response && typeof response === "object" && "data" in response) memberData = {
                ...memberData,
                ...response.data
            };
        }
        const createdMember = await adapter.createMember(memberData);
        if (teamId) await adapter.findOrCreateTeamMember({
            userId: user.id,
            teamId
        });
        if (option?.organizationHooks?.afterAddMember) await option?.organizationHooks.afterAddMember({
            member: createdMember,
            user,
            organization
        });
        return ctx.json(createdMember);
    });
};
const removeMemberBodySchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    memberIdOrEmail: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The ID or email of the member to remove"
    }),
    organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The ID of the organization to remove the member from. If not provided, the active organization will be used. Eg: \"org-id\""
    }).optional()
});
const removeMember = (options)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/remove-member", {
        method: "POST",
        body: removeMemberBodySchema,
        requireHeaders: true,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgMiddleware"],
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgSessionMiddleware"]
        ],
        metadata: {
            openapi: {
                description: "Remove a member from an organization",
                responses: {
                    "200": {
                        description: "Success",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    properties: {
                                        member: {
                                            type: "object",
                                            properties: {
                                                id: {
                                                    type: "string"
                                                },
                                                userId: {
                                                    type: "string"
                                                },
                                                organizationId: {
                                                    type: "string"
                                                },
                                                role: {
                                                    type: "string"
                                                }
                                            },
                                            required: [
                                                "id",
                                                "userId",
                                                "organizationId",
                                                "role"
                                            ]
                                        }
                                    },
                                    required: [
                                        "member"
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (ctx)=>{
        const session = ctx.context.session;
        const organizationId = ctx.body.organizationId || session.session.activeOrganizationId;
        if (!organizationId) return ctx.json(null, {
            status: 400,
            body: {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].NO_ACTIVE_ORGANIZATION
            }
        });
        const adapter = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, options);
        const member = await adapter.findMemberByOrgId({
            userId: session.user.id,
            organizationId
        });
        if (!member) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].MEMBER_NOT_FOUND
        });
        let toBeRemovedMember = null;
        if (ctx.body.memberIdOrEmail.includes("@")) toBeRemovedMember = await adapter.findMemberByEmail({
            email: ctx.body.memberIdOrEmail,
            organizationId
        });
        else {
            const result = await adapter.findMemberById(ctx.body.memberIdOrEmail);
            if (!result) toBeRemovedMember = null;
            else {
                const { user: _user, ...member$1 } = result;
                toBeRemovedMember = member$1;
            }
        }
        if (!toBeRemovedMember) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].MEMBER_NOT_FOUND
        });
        const roles = toBeRemovedMember.role.split(",");
        const creatorRole = ctx.context.orgOptions?.creatorRole || "owner";
        if (roles.includes(creatorRole)) {
            if (member.role !== creatorRole) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_CANNOT_LEAVE_THE_ORGANIZATION_AS_THE_ONLY_OWNER
            });
            const { members } = await adapter.listMembers({
                organizationId
            });
            if (members.filter((member$1)=>{
                return member$1.role.split(",").includes(creatorRole);
            }).length <= 1) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_CANNOT_LEAVE_THE_ORGANIZATION_AS_THE_ONLY_OWNER
            });
        }
        if (!await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$has$2d$permission$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hasPermission"])({
            role: member.role,
            options: ctx.context.orgOptions,
            permissions: {
                member: [
                    "delete"
                ]
            },
            organizationId
        }, ctx)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_MEMBER
        });
        if (toBeRemovedMember?.organizationId !== organizationId) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].MEMBER_NOT_FOUND
        });
        const organization = await adapter.findOrganizationById(organizationId);
        if (!organization) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ORGANIZATION_NOT_FOUND
        });
        const userBeingRemoved = await ctx.context.internalAdapter.findUserById(toBeRemovedMember.userId);
        if (!userBeingRemoved) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: "User not found"
        });
        if (options?.organizationHooks?.beforeRemoveMember) await options?.organizationHooks.beforeRemoveMember({
            member: toBeRemovedMember,
            user: userBeingRemoved,
            organization
        });
        await adapter.deleteMember({
            memberId: toBeRemovedMember.id,
            organizationId,
            userId: toBeRemovedMember.userId
        });
        if (session.user.id === toBeRemovedMember.userId && session.session.activeOrganizationId === toBeRemovedMember.organizationId) await adapter.setActiveOrganization(session.session.token, null, ctx);
        if (options?.organizationHooks?.afterRemoveMember) await options?.organizationHooks.afterRemoveMember({
            member: toBeRemovedMember,
            user: userBeingRemoved,
            organization
        });
        return ctx.json({
            member: toBeRemovedMember
        });
    });
const updateMemberRoleBodySchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    role: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["union"]([
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](),
        __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["array"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]())
    ]).meta({
        description: "The new role to be applied. This can be a string or array of strings representing the roles. Eg: [\"admin\", \"sale\"]"
    }),
    memberId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The member id to apply the role update to. Eg: \"member-id\""
    }),
    organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "An optional organization ID which the member is a part of to apply the role update. If not provided, you must provide session headers to get the active organization. Eg: \"organization-id\""
    }).optional()
});
const updateMemberRole = (option)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/update-member-role", {
        method: "POST",
        body: updateMemberRoleBodySchema,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgMiddleware"],
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgSessionMiddleware"]
        ],
        requireHeaders: true,
        metadata: {
            $Infer: {
                body: {}
            },
            openapi: {
                operationId: "updateOrganizationMemberRole",
                description: "Update the role of a member in an organization",
                responses: {
                    "200": {
                        description: "Success",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    properties: {
                                        member: {
                                            type: "object",
                                            properties: {
                                                id: {
                                                    type: "string"
                                                },
                                                userId: {
                                                    type: "string"
                                                },
                                                organizationId: {
                                                    type: "string"
                                                },
                                                role: {
                                                    type: "string"
                                                }
                                            },
                                            required: [
                                                "id",
                                                "userId",
                                                "organizationId",
                                                "role"
                                            ]
                                        }
                                    },
                                    required: [
                                        "member"
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (ctx)=>{
        const session = ctx.context.session;
        if (!ctx.body.role) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST");
        const organizationId = ctx.body.organizationId || session.session.activeOrganizationId;
        if (!organizationId) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].NO_ACTIVE_ORGANIZATION
        });
        const adapter = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, ctx.context.orgOptions);
        const roleToSet = Array.isArray(ctx.body.role) ? ctx.body.role : ctx.body.role ? [
            ctx.body.role
        ] : [];
        const member = await adapter.findMemberByOrgId({
            userId: session.user.id,
            organizationId
        });
        if (!member) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].MEMBER_NOT_FOUND
        });
        const toBeUpdatedMember = member.id !== ctx.body.memberId ? await adapter.findMemberById(ctx.body.memberId) : member;
        if (!toBeUpdatedMember) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].MEMBER_NOT_FOUND
        });
        if (!(toBeUpdatedMember.organizationId === organizationId)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_MEMBER
        });
        const creatorRole = ctx.context.orgOptions?.creatorRole || "owner";
        const updatingMemberRoles = member.role.split(",");
        const isUpdatingCreator = toBeUpdatedMember.role.split(",").includes(creatorRole);
        const updaterIsCreator = updatingMemberRoles.includes(creatorRole);
        const isSettingCreatorRole = roleToSet.includes(creatorRole);
        const memberIsUpdatingThemselves = member.id === toBeUpdatedMember.id;
        if (isUpdatingCreator && !updaterIsCreator || isSettingCreatorRole && !updaterIsCreator) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_MEMBER
        });
        if (updaterIsCreator && memberIsUpdatingThemselves) {
            if ((await ctx.context.adapter.findMany({
                model: "member",
                where: [
                    {
                        field: "organizationId",
                        value: organizationId
                    }
                ]
            })).filter((member$1)=>{
                return member$1.role.split(",").includes(creatorRole);
            }).length <= 1 && !isSettingCreatorRole) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_CANNOT_LEAVE_THE_ORGANIZATION_WITHOUT_AN_OWNER
            });
        }
        if (!await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$has$2d$permission$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hasPermission"])({
            role: member.role,
            options: ctx.context.orgOptions,
            permissions: {
                member: [
                    "update"
                ]
            },
            allowCreatorAllPermissions: true,
            organizationId
        }, ctx)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_MEMBER
        });
        const organization = await adapter.findOrganizationById(organizationId);
        if (!organization) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ORGANIZATION_NOT_FOUND
        });
        const userBeingUpdated = await ctx.context.internalAdapter.findUserById(toBeUpdatedMember.userId);
        if (!userBeingUpdated) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: "User not found"
        });
        const previousRole = toBeUpdatedMember.role;
        const newRole = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$organization$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["parseRoles"])(ctx.body.role);
        if (option?.organizationHooks?.beforeUpdateMemberRole) {
            const response = await option?.organizationHooks.beforeUpdateMemberRole({
                member: toBeUpdatedMember,
                newRole,
                user: userBeingUpdated,
                organization
            });
            if (response && typeof response === "object" && "data" in response) {
                const updatedMember$1 = await adapter.updateMember(ctx.body.memberId, response.data.role || newRole);
                if (!updatedMember$1) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].MEMBER_NOT_FOUND
                });
                if (option?.organizationHooks?.afterUpdateMemberRole) await option?.organizationHooks.afterUpdateMemberRole({
                    member: updatedMember$1,
                    previousRole,
                    user: userBeingUpdated,
                    organization
                });
                return ctx.json(updatedMember$1);
            }
        }
        const updatedMember = await adapter.updateMember(ctx.body.memberId, newRole);
        if (!updatedMember) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].MEMBER_NOT_FOUND
        });
        if (option?.organizationHooks?.afterUpdateMemberRole) await option?.organizationHooks.afterUpdateMemberRole({
            member: updatedMember,
            previousRole,
            user: userBeingUpdated,
            organization
        });
        return ctx.json(updatedMember);
    });
const getActiveMember = (options)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/get-active-member", {
        method: "GET",
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgMiddleware"],
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgSessionMiddleware"]
        ],
        requireHeaders: true,
        metadata: {
            openapi: {
                description: "Get the member details of the active organization",
                responses: {
                    "200": {
                        description: "Success",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    properties: {
                                        id: {
                                            type: "string"
                                        },
                                        userId: {
                                            type: "string"
                                        },
                                        organizationId: {
                                            type: "string"
                                        },
                                        role: {
                                            type: "string"
                                        }
                                    },
                                    required: [
                                        "id",
                                        "userId",
                                        "organizationId",
                                        "role"
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (ctx)=>{
        const session = ctx.context.session;
        const organizationId = session.session.activeOrganizationId;
        if (!organizationId) return ctx.json(null, {
            status: 400,
            body: {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].NO_ACTIVE_ORGANIZATION
            }
        });
        const member = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, options).findMemberByOrgId({
            userId: session.user.id,
            organizationId
        });
        if (!member) return ctx.json(null, {
            status: 400,
            body: {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].MEMBER_NOT_FOUND
            }
        });
        return ctx.json(member);
    });
const leaveOrganizationBodySchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The organization Id for the member to leave. Eg: \"organization-id\""
    })
});
const leaveOrganization = (options)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/leave", {
        method: "POST",
        body: leaveOrganizationBodySchema,
        requireHeaders: true,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$routes$2f$session$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sessionMiddleware"],
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgMiddleware"]
        ]
    }, async (ctx)=>{
        const session = ctx.context.session;
        const adapter = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, options);
        const member = await adapter.findMemberByOrgId({
            userId: session.user.id,
            organizationId: ctx.body.organizationId
        });
        if (!member) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].MEMBER_NOT_FOUND
        });
        const creatorRole = ctx.context.orgOptions?.creatorRole || "owner";
        if (member.role.split(",").includes(creatorRole)) {
            if ((await ctx.context.adapter.findMany({
                model: "member",
                where: [
                    {
                        field: "organizationId",
                        value: ctx.body.organizationId
                    }
                ]
            })).filter((member$1)=>member$1.role.split(",").includes(creatorRole)).length <= 1) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_CANNOT_LEAVE_THE_ORGANIZATION_AS_THE_ONLY_OWNER
            });
        }
        await adapter.deleteMember({
            memberId: member.id,
            organizationId: ctx.body.organizationId,
            userId: session.user.id
        });
        if (session.session.activeOrganizationId === ctx.body.organizationId) await adapter.setActiveOrganization(session.session.token, null, ctx);
        return ctx.json(member);
    });
const listMembers = (options)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/list-members", {
        method: "GET",
        query: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
            limit: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                description: "The number of users to return"
            }).or(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["number"]()).optional(),
            offset: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                description: "The offset to start from"
            }).or(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["number"]()).optional(),
            sortBy: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                description: "The field to sort by"
            }).optional(),
            sortDirection: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["enum"]([
                "asc",
                "desc"
            ]).meta({
                description: "The direction to sort by"
            }).optional(),
            filterField: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                description: "The field to filter by"
            }).optional(),
            filterValue: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                description: "The value to filter by"
            }).or(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["number"]()).or(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["boolean"]()).optional(),
            filterOperator: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["enum"]([
                "eq",
                "ne",
                "lt",
                "lte",
                "gt",
                "gte",
                "contains"
            ]).meta({
                description: "The operator to use for the filter"
            }).optional(),
            organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                description: "The organization ID to list members for. If not provided, will default to the user's active organization. Eg: \"organization-id\""
            }).optional(),
            organizationSlug: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                description: "The organization slug to list members for. If not provided, will default to the user's active organization. Eg: \"organization-slug\""
            }).optional()
        }).optional(),
        requireHeaders: true,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgMiddleware"],
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgSessionMiddleware"]
        ]
    }, async (ctx)=>{
        const session = ctx.context.session;
        let organizationId = ctx.query?.organizationId || session.session.activeOrganizationId;
        const adapter = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, options);
        if (ctx.query?.organizationSlug) {
            const organization = await adapter.findOrganizationBySlug(ctx.query?.organizationSlug);
            if (!organization) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ORGANIZATION_NOT_FOUND
            });
            organizationId = organization.id;
        }
        if (!organizationId) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].NO_ACTIVE_ORGANIZATION
        });
        if (!await adapter.findMemberByOrgId({
            userId: session.user.id,
            organizationId
        })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_A_MEMBER_OF_THIS_ORGANIZATION
        });
        const { members, total } = await adapter.listMembers({
            organizationId,
            limit: ctx.query?.limit ? Number(ctx.query.limit) : void 0,
            offset: ctx.query?.offset ? Number(ctx.query.offset) : void 0,
            sortBy: ctx.query?.sortBy,
            sortOrder: ctx.query?.sortDirection,
            filter: ctx.query?.filterField ? {
                field: ctx.query?.filterField,
                operator: ctx.query.filterOperator,
                value: ctx.query.filterValue
            } : void 0
        });
        return ctx.json({
            members,
            total
        });
    });
const getActiveMemberRoleQuerySchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The user ID to get the role for. If not provided, will default to the current user's"
    }).optional(),
    organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The organization ID to list members for. If not provided, will default to the user's active organization. Eg: \"organization-id\""
    }).optional(),
    organizationSlug: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The organization slug to list members for. If not provided, will default to the user's active organization. Eg: \"organization-slug\""
    }).optional()
}).optional();
const getActiveMemberRole = (options)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/get-active-member-role", {
        method: "GET",
        query: getActiveMemberRoleQuerySchema,
        requireHeaders: true,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgMiddleware"],
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgSessionMiddleware"]
        ]
    }, async (ctx)=>{
        const session = ctx.context.session;
        let organizationId = ctx.query?.organizationId || session.session.activeOrganizationId;
        const adapter = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, options);
        if (ctx.query?.organizationSlug) {
            const organization = await adapter.findOrganizationBySlug(ctx.query?.organizationSlug);
            if (!organization) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ORGANIZATION_NOT_FOUND
            });
            organizationId = organization.id;
        }
        if (!organizationId) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].NO_ACTIVE_ORGANIZATION
        });
        const isMember = await adapter.findMemberByOrgId({
            userId: session.user.id,
            organizationId
        });
        if (!isMember) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_A_MEMBER_OF_THIS_ORGANIZATION
        });
        if (!ctx.query?.userId) return ctx.json({
            role: isMember.role
        });
        const userIdToGetRole = ctx.query?.userId;
        const member = await adapter.findMemberByOrgId({
            userId: userIdToGetRole,
            organizationId
        });
        if (!member) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_A_MEMBER_OF_THIS_ORGANIZATION
        });
        return ctx.json({
            role: member?.role
        });
    });
;
 //# sourceMappingURL=crud-members.mjs.map
}),
"[project]/node_modules/better-auth/dist/plugins/organization/routes/crud-org.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "checkOrganizationSlug",
    ()=>checkOrganizationSlug,
    "createOrganization",
    ()=>createOrganization,
    "deleteOrganization",
    ()=>deleteOrganization,
    "getFullOrganization",
    ()=>getFullOrganization,
    "listOrganizations",
    ()=>listOrganizations,
    "setActiveOrganization",
    ()=>setActiveOrganization,
    "updateOrganization",
    ()=>updateOrganization
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$db$2f$to$2d$zod$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/db/to-zod.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$db$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/db/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/cookies/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$routes$2f$session$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api/routes/session.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/adapter.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/call.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/error-codes.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$has$2d$permission$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/has-permission.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/error.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/external.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
;
;
;
//#region src/plugins/organization/routes/crud-org.ts
const baseOrganizationSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    name: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().min(1).meta({
        description: "The name of the organization"
    }),
    slug: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().min(1).meta({
        description: "The slug of the organization"
    }),
    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["coerce"].string().meta({
        description: "The user id of the organization creator. If not provided, the current user will be used. Should only be used by admins or when called by the server. server-only. Eg: \"user-id\""
    }).optional(),
    logo: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The logo of the organization"
    }).optional(),
    metadata: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["record"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["any"]()).meta({
        description: "The metadata of the organization"
    }).optional(),
    keepCurrentActiveOrganization: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["boolean"]().meta({
        description: "Whether to keep the current active organization active after creating a new one. Eg: true"
    }).optional()
});
const createOrganization = (options)=>{
    const additionalFieldsSchema = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$db$2f$to$2d$zod$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["toZodSchema"])({
        fields: options?.schema?.organization?.additionalFields || {},
        isClientSide: true
    });
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/create", {
        method: "POST",
        body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
            ...baseOrganizationSchema.shape,
            ...additionalFieldsSchema.shape
        }),
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgMiddleware"]
        ],
        metadata: {
            $Infer: {
                body: {}
            },
            openapi: {
                description: "Create an organization",
                responses: {
                    "200": {
                        description: "Success",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    description: "The organization that was created",
                                    $ref: "#/components/schemas/Organization"
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (ctx)=>{
        const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$routes$2f$session$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getSessionFromCtx"])(ctx);
        if (!session && (ctx.request || ctx.headers)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED");
        let user = session?.user || null;
        if (!user) {
            if (!ctx.body.userId) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED");
            user = await ctx.context.internalAdapter.findUserById(ctx.body.userId);
        }
        if (!user) return ctx.json(null, {
            status: 401
        });
        const options$1 = ctx.context.orgOptions;
        const canCreateOrg = typeof options$1?.allowUserToCreateOrganization === "function" ? await options$1.allowUserToCreateOrganization(user) : options$1?.allowUserToCreateOrganization === void 0 ? true : options$1.allowUserToCreateOrganization;
        const isSystemAction = !session && ctx.body.userId;
        if (!canCreateOrg && !isSystemAction) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_ALLOWED_TO_CREATE_A_NEW_ORGANIZATION
        });
        const adapter = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, options$1);
        const userOrganizations = await adapter.listOrganizations(user.id);
        if (typeof options$1.organizationLimit === "number" ? userOrganizations.length >= options$1.organizationLimit : typeof options$1.organizationLimit === "function" ? await options$1.organizationLimit(user) : false) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_HAVE_REACHED_THE_MAXIMUM_NUMBER_OF_ORGANIZATIONS
        });
        if (await adapter.findOrganizationBySlug(ctx.body.slug)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ORGANIZATION_ALREADY_EXISTS
        });
        let { keepCurrentActiveOrganization: _, userId: __, ...orgData } = ctx.body;
        if (options$1.organizationCreation?.beforeCreate) {
            const response = await options$1.organizationCreation.beforeCreate({
                organization: {
                    ...orgData,
                    createdAt: /* @__PURE__ */ new Date()
                },
                user
            }, ctx.request);
            if (response && typeof response === "object" && "data" in response) orgData = {
                ...ctx.body,
                ...response.data
            };
        }
        if (options$1?.organizationHooks?.beforeCreateOrganization) {
            const response = await options$1?.organizationHooks.beforeCreateOrganization({
                organization: orgData,
                user
            });
            if (response && typeof response === "object" && "data" in response) orgData = {
                ...ctx.body,
                ...response.data
            };
        }
        const organization = await adapter.createOrganization({
            organization: {
                ...orgData,
                createdAt: /* @__PURE__ */ new Date()
            }
        });
        let member;
        let teamMember = null;
        let data = {
            userId: user.id,
            organizationId: organization.id,
            role: ctx.context.orgOptions.creatorRole || "owner"
        };
        if (options$1?.organizationHooks?.beforeAddMember) {
            const response = await options$1?.organizationHooks.beforeAddMember({
                member: {
                    userId: user.id,
                    organizationId: organization.id,
                    role: ctx.context.orgOptions.creatorRole || "owner"
                },
                user,
                organization
            });
            if (response && typeof response === "object" && "data" in response) data = {
                ...data,
                ...response.data
            };
        }
        member = await adapter.createMember(data);
        if (options$1?.organizationHooks?.afterAddMember) await options$1?.organizationHooks.afterAddMember({
            member,
            user,
            organization
        });
        if (options$1?.teams?.enabled && options$1.teams.defaultTeam?.enabled !== false) {
            let teamData = {
                organizationId: organization.id,
                name: `${organization.name}`,
                createdAt: /* @__PURE__ */ new Date()
            };
            if (options$1?.organizationHooks?.beforeCreateTeam) {
                const response = await options$1?.organizationHooks.beforeCreateTeam({
                    team: {
                        organizationId: organization.id,
                        name: `${organization.name}`
                    },
                    user,
                    organization
                });
                if (response && typeof response === "object" && "data" in response) teamData = {
                    ...teamData,
                    ...response.data
                };
            }
            const defaultTeam = await options$1.teams.defaultTeam?.customCreateDefaultTeam?.(organization, ctx) || await adapter.createTeam(teamData);
            teamMember = await adapter.findOrCreateTeamMember({
                teamId: defaultTeam.id,
                userId: user.id
            });
            if (options$1?.organizationHooks?.afterCreateTeam) await options$1?.organizationHooks.afterCreateTeam({
                team: defaultTeam,
                user,
                organization
            });
        }
        if (options$1.organizationCreation?.afterCreate) await options$1.organizationCreation.afterCreate({
            organization,
            user,
            member
        }, ctx.request);
        if (options$1?.organizationHooks?.afterCreateOrganization) await options$1?.organizationHooks.afterCreateOrganization({
            organization,
            user,
            member
        });
        if (ctx.context.session && !ctx.body.keepCurrentActiveOrganization) await adapter.setActiveOrganization(ctx.context.session.session.token, organization.id, ctx);
        if (teamMember && ctx.context.session && !ctx.body.keepCurrentActiveOrganization) await adapter.setActiveTeam(ctx.context.session.session.token, teamMember.teamId, ctx);
        return ctx.json({
            ...organization,
            metadata: organization.metadata && typeof organization.metadata === "string" ? JSON.parse(organization.metadata) : organization.metadata,
            members: [
                member
            ]
        });
    });
};
const checkOrganizationSlugBodySchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    slug: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The organization slug to check. Eg: \"my-org\""
    })
});
const checkOrganizationSlug = (options)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/check-slug", {
        method: "POST",
        body: checkOrganizationSlugBodySchema,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$routes$2f$session$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["requestOnlySessionMiddleware"],
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgMiddleware"]
        ]
    }, async (ctx)=>{
        if (!await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, options).findOrganizationBySlug(ctx.body.slug)) return ctx.json({
            status: true
        });
        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: "slug is taken"
        });
    });
const baseUpdateOrganizationSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    name: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().min(1).meta({
        description: "The name of the organization"
    }).optional(),
    slug: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().min(1).meta({
        description: "The slug of the organization"
    }).optional(),
    logo: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The logo of the organization"
    }).optional(),
    metadata: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["record"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["any"]()).meta({
        description: "The metadata of the organization"
    }).optional()
});
const updateOrganization = (options)=>{
    const additionalFieldsSchema = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$db$2f$to$2d$zod$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["toZodSchema"])({
        fields: options?.schema?.organization?.additionalFields || {},
        isClientSide: true
    });
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/update", {
        method: "POST",
        body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
            data: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                ...additionalFieldsSchema.shape,
                ...baseUpdateOrganizationSchema.shape
            }).partial(),
            organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                description: "The organization ID. Eg: \"org-id\""
            }).optional()
        }),
        requireHeaders: true,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgMiddleware"]
        ],
        metadata: {
            $Infer: {
                body: {}
            },
            openapi: {
                description: "Update an organization",
                responses: {
                    "200": {
                        description: "Success",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    description: "The updated organization",
                                    $ref: "#/components/schemas/Organization"
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (ctx)=>{
        const session = await ctx.context.getSession(ctx);
        if (!session) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            message: "User not found"
        });
        const organizationId = ctx.body.organizationId || session.session.activeOrganizationId;
        if (!organizationId) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ORGANIZATION_NOT_FOUND
        });
        const adapter = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, options);
        const member = await adapter.findMemberByOrgId({
            userId: session.user.id,
            organizationId
        });
        if (!member) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION
        });
        if (!await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$has$2d$permission$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hasPermission"])({
            permissions: {
                organization: [
                    "update"
                ]
            },
            role: member.role,
            options: ctx.context.orgOptions,
            organizationId
        }, ctx)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_ORGANIZATION
        });
        if (typeof ctx.body.data.slug === "string") {
            const existingOrganization = await adapter.findOrganizationBySlug(ctx.body.data.slug);
            if (existingOrganization && existingOrganization.id !== organizationId) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ORGANIZATION_SLUG_ALREADY_TAKEN
            });
        }
        if (options?.organizationHooks?.beforeUpdateOrganization) {
            const response = await options.organizationHooks.beforeUpdateOrganization({
                organization: ctx.body.data,
                user: session.user,
                member
            });
            if (response && typeof response === "object" && "data" in response) ctx.body.data = {
                ...ctx.body.data,
                ...response.data
            };
        }
        const updatedOrg = await adapter.updateOrganization(organizationId, ctx.body.data);
        if (options?.organizationHooks?.afterUpdateOrganization) await options.organizationHooks.afterUpdateOrganization({
            organization: updatedOrg,
            user: session.user,
            member
        });
        return ctx.json(updatedOrg);
    });
};
const deleteOrganizationBodySchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The organization id to delete"
    })
});
const deleteOrganization = (options)=>{
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/delete", {
        method: "POST",
        body: deleteOrganizationBodySchema,
        requireHeaders: true,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgMiddleware"]
        ],
        metadata: {
            openapi: {
                description: "Delete an organization",
                responses: {
                    "200": {
                        description: "Success",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "string",
                                    description: "The organization id that was deleted"
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (ctx)=>{
        if (ctx.context.orgOptions.organizationDeletion?.disabled || ctx.context.orgOptions.disableOrganizationDeletion) {
            if (ctx.context.orgOptions.organizationDeletion?.disabled) ctx.context.logger.info("`organizationDeletion.disabled` is deprecated. Use `disableOrganizationDeletion` instead");
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("NOT_FOUND", {
                message: "Organization deletion is disabled"
            });
        }
        const session = await ctx.context.getSession(ctx);
        if (!session) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            status: 401
        });
        const organizationId = ctx.body.organizationId;
        if (!organizationId) return ctx.json(null, {
            status: 400,
            body: {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ORGANIZATION_NOT_FOUND
            }
        });
        const adapter = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, options);
        const member = await adapter.findMemberByOrgId({
            userId: session.user.id,
            organizationId
        });
        if (!member) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION
        });
        if (!await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$has$2d$permission$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hasPermission"])({
            role: member.role,
            permissions: {
                organization: [
                    "delete"
                ]
            },
            organizationId,
            options: ctx.context.orgOptions
        }, ctx)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_ORGANIZATION
        });
        if (organizationId === session.session.activeOrganizationId) /**
		* If the organization is deleted, we set the active organization to null
		*/ await adapter.setActiveOrganization(session.session.token, null, ctx);
        const org = await adapter.findOrganizationById(organizationId);
        if (!org) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST");
        if (options?.organizationHooks?.beforeDeleteOrganization) await options.organizationHooks.beforeDeleteOrganization({
            organization: org,
            user: session.user
        });
        await adapter.deleteOrganization(organizationId);
        if (options?.organizationHooks?.afterDeleteOrganization) await options.organizationHooks.afterDeleteOrganization({
            organization: org,
            user: session.user
        });
        return ctx.json(org);
    });
};
const getFullOrganizationQuerySchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["optional"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The organization id to get"
    }).optional(),
    organizationSlug: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The organization slug to get"
    }).optional(),
    membersLimit: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["number"]().or(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().transform((val)=>parseInt(val))).meta({
        description: "The limit of members to get. By default, it uses the membershipLimit option which defaults to 100."
    }).optional()
}));
const getFullOrganization = (options)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/get-full-organization", {
        method: "GET",
        query: getFullOrganizationQuerySchema,
        requireHeaders: true,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgMiddleware"],
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgSessionMiddleware"]
        ],
        metadata: {
            openapi: {
                operationId: "getOrganization",
                description: "Get the full organization",
                responses: {
                    "200": {
                        description: "Success",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    description: "The organization",
                                    $ref: "#/components/schemas/Organization"
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (ctx)=>{
        const session = ctx.context.session;
        const organizationId = ctx.query?.organizationSlug || ctx.query?.organizationId || session.session.activeOrganizationId;
        if (!organizationId) return ctx.json(null, {
            status: 200
        });
        const adapter = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, options);
        const organization = await adapter.findFullOrganization({
            organizationId,
            isSlug: !!ctx.query?.organizationSlug,
            includeTeams: ctx.context.orgOptions.teams?.enabled,
            membersLimit: ctx.query?.membersLimit
        });
        if (!organization) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ORGANIZATION_NOT_FOUND
        });
        if (!await adapter.checkMembership({
            userId: session.user.id,
            organizationId: organization.id
        })) {
            await adapter.setActiveOrganization(session.session.token, null, ctx);
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION
            });
        }
        return ctx.json(organization);
    });
const setActiveOrganizationBodySchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The organization id to set as active. It can be null to unset the active organization. Eg: \"org-id\""
    }).nullable().optional(),
    organizationSlug: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The organization slug to set as active. It can be null to unset the active organization if organizationId is not provided. Eg: \"org-slug\""
    }).optional()
});
const setActiveOrganization = (options)=>{
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/set-active", {
        method: "POST",
        body: setActiveOrganizationBodySchema,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgSessionMiddleware"],
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgMiddleware"]
        ],
        requireHeaders: true,
        metadata: {
            openapi: {
                operationId: "setActiveOrganization",
                description: "Set the active organization",
                responses: {
                    "200": {
                        description: "Success",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    description: "The organization",
                                    $ref: "#/components/schemas/Organization"
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (ctx)=>{
        const adapter = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, options);
        const session = ctx.context.session;
        let organizationId = ctx.body.organizationId;
        const organizationSlug = ctx.body.organizationSlug;
        if (organizationId === null) {
            if (!session.session.activeOrganizationId) return ctx.json(null);
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["setSessionCookie"])(ctx, {
                session: await adapter.setActiveOrganization(session.session.token, null, ctx),
                user: session.user
            });
            return ctx.json(null);
        }
        if (!organizationId && !organizationSlug) {
            const sessionOrgId = session.session.activeOrganizationId;
            if (!sessionOrgId) return ctx.json(null);
            organizationId = sessionOrgId;
        }
        if (organizationSlug && !organizationId) {
            const organization$1 = await adapter.findOrganizationBySlug(organizationSlug);
            if (!organization$1) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ORGANIZATION_NOT_FOUND
            });
            organizationId = organization$1.id;
        }
        if (!organizationId) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ORGANIZATION_NOT_FOUND
        });
        if (!await adapter.checkMembership({
            userId: session.user.id,
            organizationId
        })) {
            await adapter.setActiveOrganization(session.session.token, null, ctx);
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION
            });
        }
        const organization = await adapter.findOrganizationById(organizationId);
        if (!organization) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ORGANIZATION_NOT_FOUND
        });
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["setSessionCookie"])(ctx, {
            session: await adapter.setActiveOrganization(session.session.token, organization.id, ctx),
            user: session.user
        });
        return ctx.json(organization);
    });
};
const listOrganizations = (options)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/list", {
        method: "GET",
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgMiddleware"],
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgSessionMiddleware"]
        ],
        requireHeaders: true,
        metadata: {
            openapi: {
                description: "List all organizations",
                responses: {
                    "200": {
                        description: "Success",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "array",
                                    items: {
                                        $ref: "#/components/schemas/Organization"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (ctx)=>{
        const organizations = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, options).listOrganizations(ctx.context.session.user.id);
        return ctx.json(organizations);
    });
;
 //# sourceMappingURL=crud-org.mjs.map
}),
"[project]/node_modules/better-auth/dist/plugins/organization/schema.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "teamSchema",
    ()=>teamSchema
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/utils/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$id$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/id.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/external.js [app-route] (ecmascript)");
;
;
//#region src/plugins/organization/schema.ts
const roleSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]();
const invitationStatus = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["enum"]([
    "pending",
    "accepted",
    "rejected",
    "canceled"
]).default("pending");
const organizationSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().default(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$id$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["generateId"]),
    name: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](),
    slug: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](),
    logo: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().nullish().optional(),
    metadata: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["record"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["unknown"]()).or(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().transform((v)=>JSON.parse(v))).optional(),
    createdAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["date"]()
});
const memberSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().default(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$id$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["generateId"]),
    organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](),
    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["coerce"].string(),
    role: roleSchema,
    createdAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["date"]().default(()=>/* @__PURE__ */ new Date())
});
const invitationSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().default(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$id$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["generateId"]),
    organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](),
    email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](),
    role: roleSchema,
    status: invitationStatus,
    teamId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().nullish(),
    inviterId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](),
    expiresAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["date"](),
    createdAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["date"]().default(()=>/* @__PURE__ */ new Date())
});
const teamSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().default(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$id$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["generateId"]),
    name: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().min(1),
    organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](),
    createdAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["date"](),
    updatedAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["date"]().optional()
});
const teamMemberSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().default(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$id$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["generateId"]),
    teamId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](),
    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](),
    createdAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["date"]().default(()=>/* @__PURE__ */ new Date())
});
const organizationRoleSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().default(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$id$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["generateId"]),
    organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](),
    role: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](),
    permission: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["record"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["array"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]())),
    createdAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["date"]().default(()=>/* @__PURE__ */ new Date()),
    updatedAt: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["date"]().optional()
});
const defaultRoles = [
    "admin",
    "member",
    "owner"
];
const defaultRolesSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["union"]([
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["enum"](defaultRoles),
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["array"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["enum"](defaultRoles))
]);
;
 //# sourceMappingURL=schema.mjs.map
}),
"[project]/node_modules/better-auth/dist/plugins/organization/routes/crud-team.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "addTeamMember",
    ()=>addTeamMember,
    "createTeam",
    ()=>createTeam,
    "listOrganizationTeams",
    ()=>listOrganizationTeams,
    "listTeamMembers",
    ()=>listTeamMembers,
    "listUserTeams",
    ()=>listUserTeams,
    "removeTeam",
    ()=>removeTeam,
    "removeTeamMember",
    ()=>removeTeamMember,
    "setActiveTeam",
    ()=>setActiveTeam,
    "updateTeam",
    ()=>updateTeam
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$db$2f$to$2d$zod$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/db/to-zod.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$db$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/db/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/cookies/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$routes$2f$session$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api/routes/session.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/adapter.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/call.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/error-codes.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$has$2d$permission$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/has-permission.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$schema$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/schema.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/error.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/external.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
;
;
;
;
//#region src/plugins/organization/routes/crud-team.ts
const teamBaseSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    name: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The name of the team. Eg: \"my-team\""
    }),
    organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The organization ID which the team will be created in. Defaults to the active organization. Eg: \"organization-id\""
    }).optional()
});
const createTeam = (options)=>{
    const additionalFieldsSchema = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$db$2f$to$2d$zod$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["toZodSchema"])({
        fields: options?.schema?.team?.additionalFields ?? {},
        isClientSide: true
    });
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/create-team", {
        method: "POST",
        body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
            ...teamBaseSchema.shape,
            ...additionalFieldsSchema.shape
        }),
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgMiddleware"]
        ],
        metadata: {
            $Infer: {
                body: {}
            },
            openapi: {
                description: "Create a new team within an organization",
                responses: {
                    "200": {
                        description: "Team created successfully",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    properties: {
                                        id: {
                                            type: "string",
                                            description: "Unique identifier of the created team"
                                        },
                                        name: {
                                            type: "string",
                                            description: "Name of the team"
                                        },
                                        organizationId: {
                                            type: "string",
                                            description: "ID of the organization the team belongs to"
                                        },
                                        createdAt: {
                                            type: "string",
                                            format: "date-time",
                                            description: "Timestamp when the team was created"
                                        },
                                        updatedAt: {
                                            type: "string",
                                            format: "date-time",
                                            description: "Timestamp when the team was last updated"
                                        }
                                    },
                                    required: [
                                        "id",
                                        "name",
                                        "organizationId",
                                        "createdAt",
                                        "updatedAt"
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (ctx)=>{
        const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$routes$2f$session$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getSessionFromCtx"])(ctx);
        const organizationId = ctx.body.organizationId || session?.session.activeOrganizationId;
        if (!session && (ctx.request || ctx.headers)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED");
        if (!organizationId) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].NO_ACTIVE_ORGANIZATION
        });
        const adapter = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, options);
        if (session) {
            const member = await adapter.findMemberByOrgId({
                userId: session.user.id,
                organizationId
            });
            if (!member) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_ALLOWED_TO_INVITE_USERS_TO_THIS_ORGANIZATION
            });
            if (!await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$has$2d$permission$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hasPermission"])({
                role: member.role,
                options: ctx.context.orgOptions,
                permissions: {
                    team: [
                        "create"
                    ]
                },
                organizationId
            }, ctx)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_ALLOWED_TO_CREATE_TEAMS_IN_THIS_ORGANIZATION
            });
        }
        const existingTeams = await adapter.listTeams(organizationId);
        const maximum = typeof ctx.context.orgOptions.teams?.maximumTeams === "function" ? await ctx.context.orgOptions.teams?.maximumTeams({
            organizationId,
            session
        }, ctx) : ctx.context.orgOptions.teams?.maximumTeams;
        if (maximum ? existingTeams.length >= maximum : false) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_HAVE_REACHED_THE_MAXIMUM_NUMBER_OF_TEAMS
        });
        const { name, organizationId: _, ...additionalFields } = ctx.body;
        const organization = await adapter.findOrganizationById(organizationId);
        if (!organization) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ORGANIZATION_NOT_FOUND
        });
        let teamData = {
            name,
            organizationId,
            createdAt: /* @__PURE__ */ new Date(),
            updatedAt: /* @__PURE__ */ new Date(),
            ...additionalFields
        };
        if (options?.organizationHooks?.beforeCreateTeam) {
            const response = await options?.organizationHooks.beforeCreateTeam({
                team: {
                    name,
                    organizationId,
                    ...additionalFields
                },
                user: session?.user,
                organization
            });
            if (response && typeof response === "object" && "data" in response) teamData = {
                ...teamData,
                ...response.data
            };
        }
        const createdTeam = await adapter.createTeam(teamData);
        if (options?.organizationHooks?.afterCreateTeam) await options?.organizationHooks.afterCreateTeam({
            team: createdTeam,
            user: session?.user,
            organization
        });
        return ctx.json(createdTeam);
    });
};
const removeTeamBodySchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    teamId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: `The team ID of the team to remove. Eg: "team-id"`
    }),
    organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: `The organization ID which the team falls under. If not provided, it will default to the user's active organization. Eg: "organization-id"`
    }).optional()
});
const removeTeam = (options)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/remove-team", {
        method: "POST",
        body: removeTeamBodySchema,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgMiddleware"]
        ],
        metadata: {
            openapi: {
                description: "Remove a team from an organization",
                responses: {
                    "200": {
                        description: "Team removed successfully",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    properties: {
                                        message: {
                                            type: "string",
                                            description: "Confirmation message indicating successful removal",
                                            enum: [
                                                "Team removed successfully."
                                            ]
                                        }
                                    },
                                    required: [
                                        "message"
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (ctx)=>{
        const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$routes$2f$session$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getSessionFromCtx"])(ctx);
        const organizationId = ctx.body.organizationId || session?.session.activeOrganizationId;
        if (!organizationId) return ctx.json(null, {
            status: 400,
            body: {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].NO_ACTIVE_ORGANIZATION
            }
        });
        if (!session && (ctx.request || ctx.headers)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED");
        const adapter = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, options);
        if (session) {
            const member = await adapter.findMemberByOrgId({
                userId: session.user.id,
                organizationId
            });
            if (!member || session.session?.activeTeamId === ctx.body.teamId) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_TEAM
            });
            if (!await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$has$2d$permission$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hasPermission"])({
                role: member.role,
                options: ctx.context.orgOptions,
                permissions: {
                    team: [
                        "delete"
                    ]
                },
                organizationId
            }, ctx)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_ALLOWED_TO_DELETE_TEAMS_IN_THIS_ORGANIZATION
            });
        }
        const team = await adapter.findTeamById({
            teamId: ctx.body.teamId,
            organizationId
        });
        if (!team || team.organizationId !== organizationId) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].TEAM_NOT_FOUND
        });
        if (!ctx.context.orgOptions.teams?.allowRemovingAllTeams) {
            if ((await adapter.listTeams(organizationId)).length <= 1) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].UNABLE_TO_REMOVE_LAST_TEAM
            });
        }
        const organization = await adapter.findOrganizationById(organizationId);
        if (!organization) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ORGANIZATION_NOT_FOUND
        });
        if (options?.organizationHooks?.beforeDeleteTeam) await options?.organizationHooks.beforeDeleteTeam({
            team,
            user: session?.user,
            organization
        });
        await adapter.deleteTeam(team.id);
        if (options?.organizationHooks?.afterDeleteTeam) await options?.organizationHooks.afterDeleteTeam({
            team,
            user: session?.user,
            organization
        });
        return ctx.json({
            message: "Team removed successfully."
        });
    });
const updateTeam = (options)=>{
    const additionalFieldsSchema = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$db$2f$to$2d$zod$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["toZodSchema"])({
        fields: options?.schema?.team?.additionalFields ?? {},
        isClientSide: true
    });
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/update-team", {
        method: "POST",
        body: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
            teamId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
                description: `The ID of the team to be updated. Eg: "team-id"`
            }),
            data: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
                ...__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$schema$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["teamSchema"].shape,
                ...additionalFieldsSchema.shape
            }).partial()
        }),
        requireHeaders: true,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgMiddleware"],
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgSessionMiddleware"]
        ],
        metadata: {
            $Infer: {
                body: {}
            },
            openapi: {
                description: "Update an existing team in an organization",
                responses: {
                    "200": {
                        description: "Team updated successfully",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    properties: {
                                        id: {
                                            type: "string",
                                            description: "Unique identifier of the updated team"
                                        },
                                        name: {
                                            type: "string",
                                            description: "Updated name of the team"
                                        },
                                        organizationId: {
                                            type: "string",
                                            description: "ID of the organization the team belongs to"
                                        },
                                        createdAt: {
                                            type: "string",
                                            format: "date-time",
                                            description: "Timestamp when the team was created"
                                        },
                                        updatedAt: {
                                            type: "string",
                                            format: "date-time",
                                            description: "Timestamp when the team was last updated"
                                        }
                                    },
                                    required: [
                                        "id",
                                        "name",
                                        "organizationId",
                                        "createdAt",
                                        "updatedAt"
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (ctx)=>{
        const session = ctx.context.session;
        const organizationId = ctx.body.data.organizationId || session.session.activeOrganizationId;
        if (!organizationId) return ctx.json(null, {
            status: 400,
            body: {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].NO_ACTIVE_ORGANIZATION
            }
        });
        const adapter = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, options);
        const member = await adapter.findMemberByOrgId({
            userId: session.user.id,
            organizationId
        });
        if (!member) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_TEAM
        });
        if (!await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$has$2d$permission$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hasPermission"])({
            role: member.role,
            options: ctx.context.orgOptions,
            permissions: {
                team: [
                    "update"
                ]
            },
            organizationId
        }, ctx)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_TEAM
        });
        const team = await adapter.findTeamById({
            teamId: ctx.body.teamId,
            organizationId
        });
        if (!team || team.organizationId !== organizationId) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].TEAM_NOT_FOUND
        });
        const { name, organizationId: __, ...additionalFields } = ctx.body.data;
        const organization = await adapter.findOrganizationById(organizationId);
        if (!organization) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ORGANIZATION_NOT_FOUND
        });
        const updates = {
            name,
            ...additionalFields
        };
        if (options?.organizationHooks?.beforeUpdateTeam) {
            const response = await options?.organizationHooks.beforeUpdateTeam({
                team,
                updates,
                user: session.user,
                organization
            });
            if (response && typeof response === "object" && "data" in response) {
                const modifiedUpdates = response.data;
                const updatedTeam$1 = await adapter.updateTeam(team.id, modifiedUpdates);
                if (options?.organizationHooks?.afterUpdateTeam) await options?.organizationHooks.afterUpdateTeam({
                    team: updatedTeam$1,
                    user: session.user,
                    organization
                });
                return ctx.json(updatedTeam$1);
            }
        }
        const updatedTeam = await adapter.updateTeam(team.id, updates);
        if (options?.organizationHooks?.afterUpdateTeam) await options?.organizationHooks.afterUpdateTeam({
            team: updatedTeam,
            user: session.user,
            organization
        });
        return ctx.json(updatedTeam);
    });
};
const listOrganizationTeamsQuerySchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["optional"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: `The organization ID which the teams are under to list. Defaults to the users active organization. Eg: "organization-id"`
    }).optional()
}));
const listOrganizationTeams = (options)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/list-teams", {
        method: "GET",
        query: listOrganizationTeamsQuerySchema,
        metadata: {
            openapi: {
                description: "List all teams in an organization",
                responses: {
                    "200": {
                        description: "Teams retrieved successfully",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "array",
                                    items: {
                                        type: "object",
                                        properties: {
                                            id: {
                                                type: "string",
                                                description: "Unique identifier of the team"
                                            },
                                            name: {
                                                type: "string",
                                                description: "Name of the team"
                                            },
                                            organizationId: {
                                                type: "string",
                                                description: "ID of the organization the team belongs to"
                                            },
                                            createdAt: {
                                                type: "string",
                                                format: "date-time",
                                                description: "Timestamp when the team was created"
                                            },
                                            updatedAt: {
                                                type: "string",
                                                format: "date-time",
                                                description: "Timestamp when the team was last updated"
                                            }
                                        },
                                        required: [
                                            "id",
                                            "name",
                                            "organizationId",
                                            "createdAt",
                                            "updatedAt"
                                        ]
                                    },
                                    description: "Array of team objects within the organization"
                                }
                            }
                        }
                    }
                }
            }
        },
        requireHeaders: true,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgMiddleware"],
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgSessionMiddleware"]
        ]
    }, async (ctx)=>{
        const session = ctx.context.session;
        const organizationId = ctx.query?.organizationId || session?.session.activeOrganizationId;
        if (!organizationId) throw ctx.error("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].NO_ACTIVE_ORGANIZATION
        });
        const adapter = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, options);
        if (!await adapter.findMemberByOrgId({
            userId: session.user.id,
            organizationId: organizationId || ""
        })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_ALLOWED_TO_ACCESS_THIS_ORGANIZATION
        });
        const teams = await adapter.listTeams(organizationId);
        return ctx.json(teams);
    });
const setActiveTeamBodySchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    teamId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The team id to set as active. It can be null to unset the active team"
    }).nullable().optional()
});
const setActiveTeam = (options)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/set-active-team", {
        method: "POST",
        body: setActiveTeamBodySchema,
        requireHeaders: true,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgSessionMiddleware"],
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgMiddleware"]
        ],
        metadata: {
            openapi: {
                description: "Set the active team",
                responses: {
                    "200": {
                        description: "Success",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    description: "The team",
                                    $ref: "#/components/schemas/Team"
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (ctx)=>{
        const adapter = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, ctx.context.orgOptions);
        const session = ctx.context.session;
        if (ctx.body.teamId === null) {
            if (!session.session.activeTeamId) return ctx.json(null);
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["setSessionCookie"])(ctx, {
                session: await adapter.setActiveTeam(session.session.token, null, ctx),
                user: session.user
            });
            return ctx.json(null);
        }
        let teamId;
        if (!ctx.body.teamId) {
            const sessionTeamId = session.session.activeTeamId;
            if (!sessionTeamId) return ctx.json(null);
            else teamId = sessionTeamId;
        } else teamId = ctx.body.teamId;
        const team = await adapter.findTeamById({
            teamId
        });
        if (!team) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].TEAM_NOT_FOUND
        });
        if (!await adapter.findTeamMember({
            teamId,
            userId: session.user.id
        })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].USER_IS_NOT_A_MEMBER_OF_THE_TEAM
        });
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$cookies$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["setSessionCookie"])(ctx, {
            session: await adapter.setActiveTeam(session.session.token, team.id, ctx),
            user: session.user
        });
        return ctx.json(team);
    });
const listUserTeams = (options)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/list-user-teams", {
        method: "GET",
        metadata: {
            openapi: {
                description: "List all teams that the current user is a part of.",
                responses: {
                    "200": {
                        description: "Teams retrieved successfully",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "array",
                                    items: {
                                        type: "object",
                                        description: "The team",
                                        $ref: "#/components/schemas/Team"
                                    },
                                    description: "Array of team objects within the organization"
                                }
                            }
                        }
                    }
                }
            }
        },
        requireHeaders: true,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgMiddleware"],
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgSessionMiddleware"]
        ]
    }, async (ctx)=>{
        const session = ctx.context.session;
        const teams = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, ctx.context.orgOptions).listTeamsByUser({
            userId: session.user.id
        });
        return ctx.json(teams);
    });
const listTeamMembersQuerySchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["optional"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    teamId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().optional().meta({
        description: "The team whose members we should return. If this is not provided the members of the current active team get returned."
    })
}));
const listTeamMembers = (options)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/list-team-members", {
        method: "GET",
        query: listTeamMembersQuerySchema,
        metadata: {
            openapi: {
                description: "List the members of the given team.",
                responses: {
                    "200": {
                        description: "Teams retrieved successfully",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "array",
                                    items: {
                                        type: "object",
                                        description: "The team member",
                                        properties: {
                                            id: {
                                                type: "string",
                                                description: "Unique identifier of the team member"
                                            },
                                            userId: {
                                                type: "string",
                                                description: "The user ID of the team member"
                                            },
                                            teamId: {
                                                type: "string",
                                                description: "The team ID of the team the team member is in"
                                            },
                                            createdAt: {
                                                type: "string",
                                                format: "date-time",
                                                description: "Timestamp when the team member was created"
                                            }
                                        },
                                        required: [
                                            "id",
                                            "userId",
                                            "teamId",
                                            "createdAt"
                                        ]
                                    },
                                    description: "Array of team member objects within the team"
                                }
                            }
                        }
                    }
                }
            }
        },
        requireHeaders: true,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgMiddleware"],
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgSessionMiddleware"]
        ]
    }, async (ctx)=>{
        const session = ctx.context.session;
        const adapter = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, ctx.context.orgOptions);
        const teamId = ctx.query?.teamId || session?.session.activeTeamId;
        if (!teamId) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_DO_NOT_HAVE_AN_ACTIVE_TEAM
        });
        if (!await adapter.findTeamMember({
            userId: session.user.id,
            teamId
        })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].USER_IS_NOT_A_MEMBER_OF_THE_TEAM
        });
        const members = await adapter.listTeamMembers({
            teamId
        });
        return ctx.json(members);
    });
const addTeamMemberBodySchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    teamId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The team the user should be a member of."
    }),
    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["coerce"].string().meta({
        description: "The user Id which represents the user to be added as a member."
    })
});
const addTeamMember = (options)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/add-team-member", {
        method: "POST",
        body: addTeamMemberBodySchema,
        metadata: {
            openapi: {
                description: "The newly created member",
                responses: {
                    "200": {
                        description: "Team member created successfully",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    description: "The team member",
                                    properties: {
                                        id: {
                                            type: "string",
                                            description: "Unique identifier of the team member"
                                        },
                                        userId: {
                                            type: "string",
                                            description: "The user ID of the team member"
                                        },
                                        teamId: {
                                            type: "string",
                                            description: "The team ID of the team the team member is in"
                                        },
                                        createdAt: {
                                            type: "string",
                                            format: "date-time",
                                            description: "Timestamp when the team member was created"
                                        }
                                    },
                                    required: [
                                        "id",
                                        "userId",
                                        "teamId",
                                        "createdAt"
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        },
        requireHeaders: true,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgMiddleware"],
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgSessionMiddleware"]
        ]
    }, async (ctx)=>{
        const session = ctx.context.session;
        const adapter = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, ctx.context.orgOptions);
        if (!session.session.activeOrganizationId) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].NO_ACTIVE_ORGANIZATION
        });
        const currentMember = await adapter.findMemberByOrgId({
            userId: session.user.id,
            organizationId: session.session.activeOrganizationId
        });
        if (!currentMember) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION
        });
        if (!await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$has$2d$permission$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hasPermission"])({
            role: currentMember.role,
            options: ctx.context.orgOptions,
            permissions: {
                member: [
                    "update"
                ]
            },
            organizationId: session.session.activeOrganizationId
        }, ctx)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_ALLOWED_TO_CREATE_A_NEW_TEAM_MEMBER
        });
        if (!await adapter.findMemberByOrgId({
            userId: ctx.body.userId,
            organizationId: session.session.activeOrganizationId
        })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION
        });
        const team = await adapter.findTeamById({
            teamId: ctx.body.teamId,
            organizationId: session.session.activeOrganizationId
        });
        if (!team) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].TEAM_NOT_FOUND
        });
        const organization = await adapter.findOrganizationById(session.session.activeOrganizationId);
        if (!organization) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ORGANIZATION_NOT_FOUND
        });
        const userBeingAdded = await ctx.context.internalAdapter.findUserById(ctx.body.userId);
        if (!userBeingAdded) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: "User not found"
        });
        if (options?.organizationHooks?.beforeAddTeamMember) {
            const response = await options?.organizationHooks.beforeAddTeamMember({
                teamMember: {
                    teamId: ctx.body.teamId,
                    userId: ctx.body.userId
                },
                team,
                user: userBeingAdded,
                organization
            });
            if (response && typeof response === "object" && "data" in response) {}
        }
        const teamMember = await adapter.findOrCreateTeamMember({
            teamId: ctx.body.teamId,
            userId: ctx.body.userId
        });
        if (options?.organizationHooks?.afterAddTeamMember) await options?.organizationHooks.afterAddTeamMember({
            teamMember,
            team,
            user: userBeingAdded,
            organization
        });
        return ctx.json(teamMember);
    });
const removeTeamMemberBodySchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    teamId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The team the user should be removed from."
    }),
    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["coerce"].string().meta({
        description: "The user which should be removed from the team."
    })
});
const removeTeamMember = (options)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/remove-team-member", {
        method: "POST",
        body: removeTeamMemberBodySchema,
        metadata: {
            openapi: {
                description: "Remove a member from a team",
                responses: {
                    "200": {
                        description: "Team member removed successfully",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    properties: {
                                        message: {
                                            type: "string",
                                            description: "Confirmation message indicating successful removal",
                                            enum: [
                                                "Team member removed successfully."
                                            ]
                                        }
                                    },
                                    required: [
                                        "message"
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        },
        requireHeaders: true,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgMiddleware"],
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgSessionMiddleware"]
        ]
    }, async (ctx)=>{
        const session = ctx.context.session;
        const adapter = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, ctx.context.orgOptions);
        if (!session.session.activeOrganizationId) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].NO_ACTIVE_ORGANIZATION
        });
        const currentMember = await adapter.findMemberByOrgId({
            userId: session.user.id,
            organizationId: session.session.activeOrganizationId
        });
        if (!currentMember) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION
        });
        if (!await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$has$2d$permission$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hasPermission"])({
            role: currentMember.role,
            options: ctx.context.orgOptions,
            permissions: {
                member: [
                    "delete"
                ]
            },
            organizationId: session.session.activeOrganizationId
        }, ctx)) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].YOU_ARE_NOT_ALLOWED_TO_REMOVE_A_TEAM_MEMBER
        });
        if (!await adapter.findMemberByOrgId({
            userId: ctx.body.userId,
            organizationId: session.session.activeOrganizationId
        })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION
        });
        const team = await adapter.findTeamById({
            teamId: ctx.body.teamId,
            organizationId: session.session.activeOrganizationId
        });
        if (!team) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].TEAM_NOT_FOUND
        });
        const organization = await adapter.findOrganizationById(session.session.activeOrganizationId);
        if (!organization) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].ORGANIZATION_NOT_FOUND
        });
        const userBeingRemoved = await ctx.context.internalAdapter.findUserById(ctx.body.userId);
        if (!userBeingRemoved) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: "User not found"
        });
        const teamMember = await adapter.findTeamMember({
            teamId: ctx.body.teamId,
            userId: ctx.body.userId
        });
        if (!teamMember) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].USER_IS_NOT_A_MEMBER_OF_THE_TEAM
        });
        if (options?.organizationHooks?.beforeRemoveTeamMember) await options?.organizationHooks.beforeRemoveTeamMember({
            teamMember,
            team,
            user: userBeingRemoved,
            organization
        });
        await adapter.removeTeamMember({
            teamId: ctx.body.teamId,
            userId: ctx.body.userId
        });
        if (options?.organizationHooks?.afterRemoveTeamMember) await options?.organizationHooks.afterRemoveTeamMember({
            teamMember,
            team,
            user: userBeingRemoved,
            organization
        });
        return ctx.json({
            message: "Team member removed successfully."
        });
    });
;
 //# sourceMappingURL=crud-team.mjs.map
}),
"[project]/node_modules/better-auth/dist/plugins/organization/organization.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "organization",
    ()=>organization,
    "parseRoles",
    ()=>parseRoles
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$routes$2f$session$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api/routes/session.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$access$2f$statement$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/access/statement.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$access$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/access/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/adapter.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2f$shim$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/utils/shim.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/call.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/error-codes.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$has$2d$permission$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/has-permission.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$access$2d$control$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/routes/crud-access-control.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$invites$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/routes/crud-invites.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$members$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/routes/crud-members.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$org$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/routes/crud-org.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$team$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/routes/crud-team.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/error.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
;
//#region src/plugins/organization/organization.ts
function parseRoles(roles) {
    return Array.isArray(roles) ? roles.join(",") : roles;
}
const createHasPermissionBodySchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    organizationId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().optional()
}).and(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["union"]([
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
        permission: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["record"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["array"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]())),
        permissions: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["undefined"]()
    }),
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
        permission: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["undefined"](),
        permissions: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["record"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["array"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]()))
    })
]));
const createHasPermission = (options)=>{
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/organization/has-permission", {
        method: "POST",
        requireHeaders: true,
        body: createHasPermissionBodySchema,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$call$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orgSessionMiddleware"]
        ],
        metadata: {
            $Infer: {
                body: {}
            },
            openapi: {
                description: "Check if the user has permission",
                requestBody: {
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    permission: {
                                        type: "object",
                                        description: "The permission to check",
                                        deprecated: true
                                    },
                                    permissions: {
                                        type: "object",
                                        description: "The permission to check"
                                    }
                                },
                                required: [
                                    "permissions"
                                ]
                            }
                        }
                    }
                },
                responses: {
                    "200": {
                        description: "Success",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    properties: {
                                        error: {
                                            type: "string"
                                        },
                                        success: {
                                            type: "boolean"
                                        }
                                    },
                                    required: [
                                        "success"
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (ctx)=>{
        const activeOrganizationId = ctx.body.organizationId || ctx.context.session.session.activeOrganizationId;
        if (!activeOrganizationId) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].NO_ACTIVE_ORGANIZATION
        });
        const member = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgAdapter"])(ctx.context, options).findMemberByOrgId({
            userId: ctx.context.session.user.id,
            organizationId: activeOrganizationId
        });
        if (!member) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"].USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION
        });
        const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$has$2d$permission$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hasPermission"])({
            role: member.role,
            options,
            permissions: ctx.body.permissions ?? ctx.body.permission,
            organizationId: activeOrganizationId
        }, ctx);
        return ctx.json({
            error: null,
            success: result
        });
    });
};
function organization(options) {
    const opts = options || {};
    let endpoints = {
        createOrganization: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$org$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createOrganization"])(opts),
        updateOrganization: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$org$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["updateOrganization"])(opts),
        deleteOrganization: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$org$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["deleteOrganization"])(opts),
        setActiveOrganization: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$org$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["setActiveOrganization"])(opts),
        getFullOrganization: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$org$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getFullOrganization"])(opts),
        listOrganizations: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$org$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["listOrganizations"])(opts),
        createInvitation: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$invites$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createInvitation"])(opts),
        cancelInvitation: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$invites$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["cancelInvitation"])(opts),
        acceptInvitation: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$invites$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["acceptInvitation"])(opts),
        getInvitation: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$invites$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getInvitation"])(opts),
        rejectInvitation: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$invites$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["rejectInvitation"])(opts),
        listInvitations: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$invites$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["listInvitations"])(opts),
        getActiveMember: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$members$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getActiveMember"])(opts),
        checkOrganizationSlug: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$org$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["checkOrganizationSlug"])(opts),
        addMember: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$members$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["addMember"])(opts),
        removeMember: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$members$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["removeMember"])(opts),
        updateMemberRole: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$members$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["updateMemberRole"])(opts),
        leaveOrganization: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$members$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["leaveOrganization"])(opts),
        listUserInvitations: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$invites$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["listUserInvitations"])(opts),
        listMembers: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$members$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["listMembers"])(opts),
        getActiveMemberRole: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$members$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getActiveMemberRole"])(opts)
    };
    const teamSupport = opts.teams?.enabled;
    const teamEndpoints = {
        createTeam: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$team$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createTeam"])(opts),
        listOrganizationTeams: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$team$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["listOrganizationTeams"])(opts),
        removeTeam: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$team$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["removeTeam"])(opts),
        updateTeam: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$team$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["updateTeam"])(opts),
        setActiveTeam: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$team$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["setActiveTeam"])(opts),
        listUserTeams: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$team$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["listUserTeams"])(opts),
        listTeamMembers: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$team$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["listTeamMembers"])(opts),
        addTeamMember: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$team$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["addTeamMember"])(opts),
        removeTeamMember: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$team$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["removeTeamMember"])(opts)
    };
    if (teamSupport) endpoints = {
        ...endpoints,
        ...teamEndpoints
    };
    const dynamicAccessControlEndpoints = {
        createOrgRole: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$access$2d$control$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createOrgRole"])(opts),
        deleteOrgRole: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$access$2d$control$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["deleteOrgRole"])(opts),
        listOrgRoles: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$access$2d$control$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["listOrgRoles"])(opts),
        getOrgRole: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$access$2d$control$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getOrgRole"])(opts),
        updateOrgRole: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$routes$2f$crud$2d$access$2d$control$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["updateOrgRole"])(opts)
    };
    if (opts.dynamicAccessControl?.enabled) endpoints = {
        ...endpoints,
        ...dynamicAccessControlEndpoints
    };
    const roles = {
        ...__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$access$2f$statement$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["defaultRoles"],
        ...opts.roles
    };
    const teamSchema = teamSupport ? {
        team: {
            modelName: opts.schema?.team?.modelName,
            fields: {
                name: {
                    type: "string",
                    required: true,
                    fieldName: opts.schema?.team?.fields?.name
                },
                organizationId: {
                    type: "string",
                    required: true,
                    references: {
                        model: "organization",
                        field: "id"
                    },
                    fieldName: opts.schema?.team?.fields?.organizationId,
                    index: true
                },
                createdAt: {
                    type: "date",
                    required: true,
                    fieldName: opts.schema?.team?.fields?.createdAt
                },
                updatedAt: {
                    type: "date",
                    required: false,
                    fieldName: opts.schema?.team?.fields?.updatedAt,
                    onUpdate: ()=>/* @__PURE__ */ new Date()
                },
                ...opts.schema?.team?.additionalFields || {}
            }
        },
        teamMember: {
            modelName: opts.schema?.teamMember?.modelName,
            fields: {
                teamId: {
                    type: "string",
                    required: true,
                    references: {
                        model: "team",
                        field: "id"
                    },
                    fieldName: opts.schema?.teamMember?.fields?.teamId,
                    index: true
                },
                userId: {
                    type: "string",
                    required: true,
                    references: {
                        model: "user",
                        field: "id"
                    },
                    fieldName: opts.schema?.teamMember?.fields?.userId,
                    index: true
                },
                createdAt: {
                    type: "date",
                    required: false,
                    fieldName: opts.schema?.teamMember?.fields?.createdAt
                }
            }
        }
    } : {};
    const organizationRoleSchema = opts.dynamicAccessControl?.enabled ? {
        organizationRole: {
            fields: {
                organizationId: {
                    type: "string",
                    required: true,
                    references: {
                        model: "organization",
                        field: "id"
                    },
                    fieldName: opts.schema?.organizationRole?.fields?.organizationId,
                    index: true
                },
                role: {
                    type: "string",
                    required: true,
                    fieldName: opts.schema?.organizationRole?.fields?.role,
                    index: true
                },
                permission: {
                    type: "string",
                    required: true,
                    fieldName: opts.schema?.organizationRole?.fields?.permission
                },
                createdAt: {
                    type: "date",
                    required: true,
                    defaultValue: ()=>/* @__PURE__ */ new Date(),
                    fieldName: opts.schema?.organizationRole?.fields?.createdAt
                },
                updatedAt: {
                    type: "date",
                    required: false,
                    fieldName: opts.schema?.organizationRole?.fields?.updatedAt,
                    onUpdate: ()=>/* @__PURE__ */ new Date()
                },
                ...opts.schema?.organizationRole?.additionalFields || {}
            },
            modelName: opts.schema?.organizationRole?.modelName
        }
    } : {};
    const schema = {
        organization: {
            modelName: opts.schema?.organization?.modelName,
            fields: {
                name: {
                    type: "string",
                    required: true,
                    sortable: true,
                    fieldName: opts.schema?.organization?.fields?.name
                },
                slug: {
                    type: "string",
                    required: true,
                    unique: true,
                    sortable: true,
                    fieldName: opts.schema?.organization?.fields?.slug,
                    index: true
                },
                logo: {
                    type: "string",
                    required: false,
                    fieldName: opts.schema?.organization?.fields?.logo
                },
                createdAt: {
                    type: "date",
                    required: true,
                    fieldName: opts.schema?.organization?.fields?.createdAt
                },
                metadata: {
                    type: "string",
                    required: false,
                    fieldName: opts.schema?.organization?.fields?.metadata
                },
                ...opts.schema?.organization?.additionalFields || {}
            }
        },
        ...organizationRoleSchema,
        ...teamSchema,
        member: {
            modelName: opts.schema?.member?.modelName,
            fields: {
                organizationId: {
                    type: "string",
                    required: true,
                    references: {
                        model: "organization",
                        field: "id"
                    },
                    fieldName: opts.schema?.member?.fields?.organizationId,
                    index: true
                },
                userId: {
                    type: "string",
                    required: true,
                    fieldName: opts.schema?.member?.fields?.userId,
                    references: {
                        model: "user",
                        field: "id"
                    },
                    index: true
                },
                role: {
                    type: "string",
                    required: true,
                    sortable: true,
                    defaultValue: "member",
                    fieldName: opts.schema?.member?.fields?.role
                },
                createdAt: {
                    type: "date",
                    required: true,
                    fieldName: opts.schema?.member?.fields?.createdAt
                },
                ...opts.schema?.member?.additionalFields || {}
            }
        },
        invitation: {
            modelName: opts.schema?.invitation?.modelName,
            fields: {
                organizationId: {
                    type: "string",
                    required: true,
                    references: {
                        model: "organization",
                        field: "id"
                    },
                    fieldName: opts.schema?.invitation?.fields?.organizationId,
                    index: true
                },
                email: {
                    type: "string",
                    required: true,
                    sortable: true,
                    fieldName: opts.schema?.invitation?.fields?.email,
                    index: true
                },
                role: {
                    type: "string",
                    required: false,
                    sortable: true,
                    fieldName: opts.schema?.invitation?.fields?.role
                },
                ...teamSupport ? {
                    teamId: {
                        type: "string",
                        required: false,
                        sortable: true,
                        fieldName: opts.schema?.invitation?.fields?.teamId
                    }
                } : {},
                status: {
                    type: "string",
                    required: true,
                    sortable: true,
                    defaultValue: "pending",
                    fieldName: opts.schema?.invitation?.fields?.status
                },
                expiresAt: {
                    type: "date",
                    required: true,
                    fieldName: opts.schema?.invitation?.fields?.expiresAt
                },
                createdAt: {
                    type: "date",
                    required: true,
                    fieldName: opts.schema?.invitation?.fields?.createdAt,
                    defaultValue: ()=>/* @__PURE__ */ new Date()
                },
                inviterId: {
                    type: "string",
                    references: {
                        model: "user",
                        field: "id"
                    },
                    fieldName: opts.schema?.invitation?.fields?.inviterId,
                    required: true
                },
                ...opts.schema?.invitation?.additionalFields || {}
            }
        }
    };
    return {
        id: "organization",
        endpoints: {
            ...(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2f$shim$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["shimContext"])(endpoints, {
                orgOptions: opts,
                roles,
                getSession: async (context)=>{
                    return await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$routes$2f$session$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getSessionFromCtx"])(context);
                }
            }),
            hasPermission: createHasPermission(opts)
        },
        schema: {
            ...schema,
            session: {
                fields: {
                    activeOrganizationId: {
                        type: "string",
                        required: false,
                        fieldName: opts.schema?.session?.fields?.activeOrganizationId
                    },
                    ...teamSupport ? {
                        activeTeamId: {
                            type: "string",
                            required: false,
                            fieldName: opts.schema?.session?.fields?.activeTeamId
                        }
                    } : {}
                }
            }
        },
        $Infer: {
            Organization: {},
            Invitation: {},
            Member: {},
            Team: teamSupport ? {} : {},
            TeamMember: teamSupport ? {} : {},
            ActiveOrganization: {}
        },
        $ERROR_CODES: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ORGANIZATION_ERROR_CODES"],
        options: opts
    };
}
;
 //# sourceMappingURL=organization.mjs.map
}),
"[project]/node_modules/better-auth/dist/plugins/organization/index.mjs [app-route] (ecmascript) <locals>", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/adapter.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$organization$2f$organization$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/organization/organization.mjs [app-route] (ecmascript)");
;
;
;
}),
];

//# sourceMappingURL=node_modules_better-auth_dist_plugins_organization_56c5f47e._.js.map