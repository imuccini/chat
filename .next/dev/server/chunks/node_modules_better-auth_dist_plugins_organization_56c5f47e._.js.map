{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/organization/adapter.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/organization/adapter.ts"],"sourcesContent":["import type { AuthContext, GenericEndpointContext } from \"@better-auth/core\";\nimport { getCurrentAdapter } from \"@better-auth/core/context\";\nimport { BetterAuthError } from \"@better-auth/core/error\";\nimport { filterOutputFields } from \"@better-auth/core/utils\";\nimport { parseJSON } from \"../../client/parser\";\nimport type { InferAdditionalFieldsFromPluginOptions } from \"../../db\";\nimport type { Session, User } from \"../../types\";\nimport { getDate } from \"../../utils/date\";\nimport type {\n\tInferInvitation,\n\tInferMember,\n\tInferOrganization,\n\tInferTeam,\n\tInvitationInput,\n\tMember,\n\tMemberInput,\n\tOrganizationInput,\n\tTeam,\n\tTeamInput,\n\tTeamMember,\n} from \"./schema\";\nimport type { OrganizationOptions } from \"./types\";\n\nexport const getOrgAdapter = <O extends OrganizationOptions>(\n\tcontext: AuthContext,\n\toptions?: O | undefined,\n) => {\n\tconst baseAdapter = context.adapter;\n\tconst orgAdditionalFields = options?.schema?.organization?.additionalFields;\n\tconst memberAdditionalFields = options?.schema?.member?.additionalFields;\n\tconst invitationAdditionalFields =\n\t\toptions?.schema?.invitation?.additionalFields;\n\tconst teamAdditionalFields = options?.schema?.team?.additionalFields;\n\treturn {\n\t\tfindOrganizationBySlug: async (\n\t\t\tslug: string,\n\t\t): Promise<InferOrganization<O> | null> => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst organization = await adapter.findOne<InferOrganization<O, false>>({\n\t\t\t\tmodel: \"organization\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"slug\",\n\t\t\t\t\t\tvalue: slug,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\treturn filterOutputFields(\n\t\t\t\torganization,\n\t\t\t\torgAdditionalFields,\n\t\t\t) as InferOrganization<O> | null;\n\t\t},\n\t\tcreateOrganization: async (data: {\n\t\t\torganization: OrganizationInput &\n\t\t\t\t// This represents the additional fields from the plugin options\n\t\t\t\tRecord<string, any>;\n\t\t}): Promise<InferOrganization<O>> => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst organization = await adapter.create<\n\t\t\t\tOrganizationInput,\n\t\t\t\tInferOrganization<O, false>\n\t\t\t>({\n\t\t\t\tmodel: \"organization\",\n\t\t\t\tdata: {\n\t\t\t\t\t...data.organization,\n\t\t\t\t\tmetadata: data.organization.metadata\n\t\t\t\t\t\t? JSON.stringify(data.organization.metadata)\n\t\t\t\t\t\t: undefined,\n\t\t\t\t},\n\t\t\t\tforceAllowId: true,\n\t\t\t});\n\n\t\t\tconst result = {\n\t\t\t\t...organization,\n\t\t\t\tmetadata:\n\t\t\t\t\torganization.metadata && typeof organization.metadata === \"string\"\n\t\t\t\t\t\t? JSON.parse(organization.metadata)\n\t\t\t\t\t\t: undefined,\n\t\t\t};\n\t\t\treturn filterOutputFields(\n\t\t\t\tresult,\n\t\t\t\torgAdditionalFields,\n\t\t\t) as InferOrganization<O>;\n\t\t},\n\t\tfindMemberByEmail: async (data: {\n\t\t\temail: string;\n\t\t\torganizationId: string;\n\t\t}) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst user = await adapter.findOne<User>({\n\t\t\t\tmodel: \"user\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"email\",\n\t\t\t\t\t\tvalue: data.email.toLowerCase(),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\tif (!user) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tconst member = await adapter.findOne<InferMember<O, false>>({\n\t\t\t\tmodel: \"member\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\t\tvalue: data.organizationId,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: user.id,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\tif (!member) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\treturn {\n\t\t\t\t...member,\n\t\t\t\tuser: {\n\t\t\t\t\tid: user.id,\n\t\t\t\t\tname: user.name,\n\t\t\t\t\temail: user.email,\n\t\t\t\t\timage: user.image,\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tlistMembers: async (data: {\n\t\t\torganizationId?: string | undefined;\n\t\t\tlimit?: number | undefined;\n\t\t\toffset?: number | undefined;\n\t\t\tsortBy?: string | undefined;\n\t\t\tsortOrder?: (\"asc\" | \"desc\") | undefined;\n\t\t\tfilter?:\n\t\t\t\t| {\n\t\t\t\t\t\tfield: string;\n\t\t\t\t\t\toperator?: \"eq\" | \"ne\" | \"lt\" | \"lte\" | \"gt\" | \"gte\" | \"contains\";\n\t\t\t\t\t\tvalue: any;\n\t\t\t\t  }\n\t\t\t\t| undefined;\n\t\t}) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst members = await Promise.all([\n\t\t\t\tadapter.findMany<InferMember<O, false>>({\n\t\t\t\t\tmodel: \"member\",\n\t\t\t\t\twhere: [\n\t\t\t\t\t\t{ field: \"organizationId\", value: data.organizationId },\n\t\t\t\t\t\t...(data.filter?.field\n\t\t\t\t\t\t\t? [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tfield: data.filter?.field,\n\t\t\t\t\t\t\t\t\t\tvalue: data.filter?.value,\n\t\t\t\t\t\t\t\t\t\t...(data.filter.operator\n\t\t\t\t\t\t\t\t\t\t\t? { operator: data.filter.operator }\n\t\t\t\t\t\t\t\t\t\t\t: {}),\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t: []),\n\t\t\t\t\t],\n\t\t\t\t\tlimit: data.limit || options?.membershipLimit || 100,\n\t\t\t\t\toffset: data.offset || 0,\n\t\t\t\t\tsortBy: data.sortBy\n\t\t\t\t\t\t? { field: data.sortBy, direction: data.sortOrder || \"asc\" }\n\t\t\t\t\t\t: undefined,\n\t\t\t\t}),\n\t\t\t\tadapter.count({\n\t\t\t\t\tmodel: \"member\",\n\t\t\t\t\twhere: [\n\t\t\t\t\t\t{ field: \"organizationId\", value: data.organizationId },\n\t\t\t\t\t\t...(data.filter?.field\n\t\t\t\t\t\t\t? [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tfield: data.filter?.field,\n\t\t\t\t\t\t\t\t\t\tvalue: data.filter?.value,\n\t\t\t\t\t\t\t\t\t\t...(data.filter.operator\n\t\t\t\t\t\t\t\t\t\t\t? { operator: data.filter.operator }\n\t\t\t\t\t\t\t\t\t\t\t: {}),\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t: []),\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t]);\n\t\t\tconst users = await adapter.findMany<User>({\n\t\t\t\tmodel: \"user\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\tvalue: members[0].map((member) => member.userId),\n\t\t\t\t\t\toperator: \"in\",\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\treturn {\n\t\t\t\tmembers: members[0].map((member) => {\n\t\t\t\t\tconst user = users.find((user) => user.id === member.userId);\n\t\t\t\t\tif (!user) {\n\t\t\t\t\t\tthrow new BetterAuthError(\n\t\t\t\t\t\t\t\"Unexpected error: User not found for member\",\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...member,\n\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\tid: user.id,\n\t\t\t\t\t\t\tname: user.name,\n\t\t\t\t\t\t\temail: user.email,\n\t\t\t\t\t\t\timage: user.image,\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\t\ttotal: members[1],\n\t\t\t};\n\t\t},\n\t\tfindMemberByOrgId: async (data: {\n\t\t\tuserId: string;\n\t\t\torganizationId: string;\n\t\t}) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst result = await adapter.findOne<\n\t\t\t\tInferMember<O, false> & { user: User }\n\t\t\t>({\n\t\t\t\tmodel: \"member\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: data.userId,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\t\tvalue: data.organizationId,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tjoin: {\n\t\t\t\t\tuser: true,\n\t\t\t\t},\n\t\t\t});\n\t\t\tif (!result || !result.user) return null;\n\t\t\tconst { user, ...member } = result;\n\n\t\t\treturn {\n\t\t\t\t...member,\n\t\t\t\tuser: {\n\t\t\t\t\tid: user.id,\n\t\t\t\t\tname: user.name,\n\t\t\t\t\temail: user.email,\n\t\t\t\t\timage: user.image,\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tfindMemberById: async (memberId: string) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst result = await adapter.findOne<\n\t\t\t\tInferMember<O, false> & { user: User }\n\t\t\t>({\n\t\t\t\tmodel: \"member\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\tvalue: memberId,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tjoin: {\n\t\t\t\t\tuser: true,\n\t\t\t\t},\n\t\t\t});\n\t\t\tif (!result) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tconst { user, ...member } = result;\n\n\t\t\treturn {\n\t\t\t\t...(member as unknown as InferMember<O, false>),\n\t\t\t\tuser: {\n\t\t\t\t\tid: user.id,\n\t\t\t\t\tname: user.name,\n\t\t\t\t\temail: user.email,\n\t\t\t\t\timage: user.image,\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tcreateMember: async (\n\t\t\tdata: Omit<MemberInput, \"id\"> &\n\t\t\t\t// Additional fields from the plugin options\n\t\t\t\tRecord<string, any>,\n\t\t) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst member = await adapter.create<\n\t\t\t\ttypeof data,\n\t\t\t\tMember & InferAdditionalFieldsFromPluginOptions<\"member\", O, false>\n\t\t\t>({\n\t\t\t\tmodel: \"member\",\n\t\t\t\tdata: {\n\t\t\t\t\t...data,\n\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t},\n\t\t\t});\n\t\t\treturn member;\n\t\t},\n\t\tupdateMember: async (memberId: string, role: string) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst member = await adapter.update<InferMember<O, false>>({\n\t\t\t\tmodel: \"member\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\tvalue: memberId,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tupdate: {\n\t\t\t\t\trole,\n\t\t\t\t},\n\t\t\t});\n\t\t\treturn member;\n\t\t},\n\t\tdeleteMember: async ({\n\t\t\tmemberId,\n\t\t\torganizationId,\n\t\t\tuserId: _userId,\n\t\t}: {\n\t\t\tmemberId: string;\n\t\t\torganizationId: string;\n\t\t\tuserId?: string;\n\t\t}) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tlet userId: string;\n\t\t\tif (!_userId) {\n\t\t\t\tconst member = await adapter.findOne<Member>({\n\t\t\t\t\tmodel: \"member\",\n\t\t\t\t\twhere: [{ field: \"id\", value: memberId }],\n\t\t\t\t});\n\t\t\t\tif (!member) {\n\t\t\t\t\tthrow new BetterAuthError(\"Member not found\");\n\t\t\t\t}\n\t\t\t\tuserId = member.userId;\n\t\t\t} else {\n\t\t\t\tuserId = _userId;\n\t\t\t}\n\t\t\tconst member = await adapter.delete<InferMember<O, false>>({\n\t\t\t\tmodel: \"member\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\tvalue: memberId,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\t// remove member from all teams they're part of\n\t\t\tif (options?.teams?.enabled) {\n\t\t\t\tconst teams = await adapter.findMany<Team>({\n\t\t\t\t\tmodel: \"team\",\n\t\t\t\t\twhere: [{ field: \"organizationId\", value: organizationId }],\n\t\t\t\t});\n\t\t\t\tawait Promise.all(\n\t\t\t\t\tteams.map((team) =>\n\t\t\t\t\t\tadapter.deleteMany({\n\t\t\t\t\t\t\tmodel: \"teamMember\",\n\t\t\t\t\t\t\twhere: [\n\t\t\t\t\t\t\t\t{ field: \"teamId\", value: team.id },\n\t\t\t\t\t\t\t\t{ field: \"userId\", value: userId },\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t}),\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn member;\n\t\t},\n\t\tupdateOrganization: async (\n\t\t\torganizationId: string,\n\t\t\tdata: Partial<OrganizationInput>,\n\t\t): Promise<InferOrganization<O> | null> => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst organization = await adapter.update<InferOrganization<O, false>>({\n\t\t\t\tmodel: \"organization\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\tvalue: organizationId,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tupdate: {\n\t\t\t\t\t...data,\n\t\t\t\t\tmetadata:\n\t\t\t\t\t\ttypeof data.metadata === \"object\"\n\t\t\t\t\t\t\t? JSON.stringify(data.metadata)\n\t\t\t\t\t\t\t: data.metadata,\n\t\t\t\t},\n\t\t\t});\n\t\t\tif (!organization) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tconst result = {\n\t\t\t\t...organization,\n\t\t\t\tmetadata: organization.metadata\n\t\t\t\t\t? parseJSON<Record<string, any>>(organization.metadata)\n\t\t\t\t\t: undefined,\n\t\t\t};\n\t\t\treturn filterOutputFields(\n\t\t\t\tresult,\n\t\t\t\torgAdditionalFields,\n\t\t\t) as InferOrganization<O>;\n\t\t},\n\t\tdeleteOrganization: async (organizationId: string) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tawait adapter.deleteMany({\n\t\t\t\tmodel: \"member\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\t\tvalue: organizationId,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\tawait adapter.deleteMany({\n\t\t\t\tmodel: \"invitation\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\t\tvalue: organizationId,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\tawait adapter.delete<InferOrganization<O, false>>({\n\t\t\t\tmodel: \"organization\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\tvalue: organizationId,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\treturn organizationId;\n\t\t},\n\t\tsetActiveOrganization: async (\n\t\t\tsessionToken: string,\n\t\t\torganizationId: string | null,\n\t\t\tctx: GenericEndpointContext,\n\t\t) => {\n\t\t\tconst session = await context.internalAdapter.updateSession(\n\t\t\t\tsessionToken,\n\t\t\t\t{\n\t\t\t\t\tactiveOrganizationId: organizationId,\n\t\t\t\t},\n\t\t\t);\n\t\t\treturn session as Session;\n\t\t},\n\t\tfindOrganizationById: async (\n\t\t\torganizationId: string,\n\t\t): Promise<InferOrganization<O> | null> => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst organization = await adapter.findOne<InferOrganization<O, false>>({\n\t\t\t\tmodel: \"organization\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\tvalue: organizationId,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\treturn filterOutputFields(\n\t\t\t\torganization,\n\t\t\t\torgAdditionalFields,\n\t\t\t) as InferOrganization<O> | null;\n\t\t},\n\t\tcheckMembership: async ({\n\t\t\tuserId,\n\t\t\torganizationId,\n\t\t}: {\n\t\t\tuserId: string;\n\t\t\torganizationId: string;\n\t\t}) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst member = await adapter.findOne<InferMember<O, false>>({\n\t\t\t\tmodel: \"member\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: userId,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\t\tvalue: organizationId,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\treturn member;\n\t\t},\n\t\t/**\n\t\t * @requires db\n\t\t */\n\t\tfindFullOrganization: async ({\n\t\t\torganizationId,\n\t\t\tisSlug,\n\t\t\tincludeTeams,\n\t\t\tmembersLimit,\n\t\t}: {\n\t\t\torganizationId: string;\n\t\t\tisSlug?: boolean | undefined;\n\t\t\tincludeTeams?: boolean | undefined;\n\t\t\tmembersLimit?: number | undefined;\n\t\t}) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst result = await adapter.findOne<\n\t\t\t\tInferOrganization<O, false> & {\n\t\t\t\t\tinvitation: InferInvitation<O>[];\n\t\t\t\t\tmember: InferMember<O>[];\n\t\t\t\t\tteam: InferTeam<O>[] | undefined;\n\t\t\t\t}\n\t\t\t>({\n\t\t\t\tmodel: \"organization\",\n\t\t\t\twhere: [{ field: isSlug ? \"slug\" : \"id\", value: organizationId }],\n\t\t\t\tjoin: {\n\t\t\t\t\tinvitation: true,\n\t\t\t\t\tmember: membersLimit ? { limit: membersLimit } : true,\n\t\t\t\t\t...(includeTeams ? { team: true } : {}),\n\t\t\t\t},\n\t\t\t});\n\t\t\tif (!result) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst {\n\t\t\t\tinvitation: invitations,\n\t\t\t\tmember: members,\n\t\t\t\tteam: teams,\n\t\t\t\t...org\n\t\t\t} = result;\n\t\t\tconst userIds = members.map((member) => member.userId);\n\t\t\tconst users =\n\t\t\t\tuserIds.length > 0\n\t\t\t\t\t? await adapter.findMany<User>({\n\t\t\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\t\t\twhere: [{ field: \"id\", value: userIds, operator: \"in\" }],\n\t\t\t\t\t\t\tlimit: options?.membershipLimit || 100,\n\t\t\t\t\t\t})\n\t\t\t\t\t: [];\n\n\t\t\tconst userMap = new Map(users.map((user) => [user.id, user]));\n\t\t\tconst membersWithUsers = members.map((member) => {\n\t\t\t\tconst user = userMap.get(member.userId);\n\t\t\t\tif (!user) {\n\t\t\t\t\tthrow new BetterAuthError(\n\t\t\t\t\t\t\"Unexpected error: User not found for member\",\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tconst filteredMember = filterOutputFields(\n\t\t\t\t\tmember,\n\t\t\t\t\tmemberAdditionalFields,\n\t\t\t\t);\n\t\t\t\treturn {\n\t\t\t\t\t...filteredMember,\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tid: user.id,\n\t\t\t\t\t\tname: user.name,\n\t\t\t\t\t\temail: user.email,\n\t\t\t\t\t\timage: user.image,\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t});\n\n\t\t\tconst filteredOrg = filterOutputFields(org, orgAdditionalFields);\n\t\t\tconst filteredInvitations = invitations.map((inv) =>\n\t\t\t\tfilterOutputFields(inv, invitationAdditionalFields),\n\t\t\t);\n\t\t\tconst filteredTeams = teams?.map((team) =>\n\t\t\t\tfilterOutputFields(team, teamAdditionalFields),\n\t\t\t);\n\n\t\t\treturn {\n\t\t\t\t...filteredOrg,\n\t\t\t\tinvitations: filteredInvitations,\n\t\t\t\tmembers: membersWithUsers,\n\t\t\t\tteams: filteredTeams,\n\t\t\t};\n\t\t},\n\t\tlistOrganizations: async (\n\t\t\tuserId: string,\n\t\t): Promise<InferOrganization<O>[]> => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst result = await adapter.findMany<\n\t\t\t\tInferMember<O, false> & { organization: InferOrganization<O, false> }\n\t\t\t>({\n\t\t\t\tmodel: \"member\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: userId,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tjoin: {\n\t\t\t\t\torganization: true,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (!result || result.length === 0) {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tconst organizations = result.map(\n\t\t\t\t(member) =>\n\t\t\t\t\tfilterOutputFields(\n\t\t\t\t\t\tmember.organization,\n\t\t\t\t\t\torgAdditionalFields,\n\t\t\t\t\t) as InferOrganization<O>,\n\t\t\t);\n\n\t\t\treturn organizations;\n\t\t},\n\t\tcreateTeam: async (data: Omit<TeamInput, \"id\">) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst team = await adapter.create<\n\t\t\t\tOmit<TeamInput, \"id\">,\n\t\t\t\tInferTeam<O, false>\n\t\t\t>({\n\t\t\t\tmodel: \"team\",\n\t\t\t\tdata,\n\t\t\t});\n\t\t\treturn team;\n\t\t},\n\t\tfindTeamById: async <IncludeMembers extends boolean>({\n\t\t\tteamId,\n\t\t\torganizationId,\n\t\t\tincludeTeamMembers,\n\t\t}: {\n\t\t\tteamId: string;\n\t\t\torganizationId?: string | undefined;\n\t\t\tincludeTeamMembers?: IncludeMembers | undefined;\n\t\t}): Promise<\n\t\t\t| (InferTeam<O> &\n\t\t\t\t\t(IncludeMembers extends true ? { members: TeamMember[] } : {}))\n\t\t\t| null\n\t\t> => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst result = await adapter.findOne<\n\t\t\t\tInferTeam<O> & { teamMember: TeamMember[] }\n\t\t\t>({\n\t\t\t\tmodel: \"team\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\tvalue: teamId,\n\t\t\t\t\t},\n\t\t\t\t\t...(organizationId\n\t\t\t\t\t\t? [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\t\t\t\t\tvalue: organizationId,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t: []),\n\t\t\t\t],\n\t\t\t\tjoin: {\n\t\t\t\t\t// In the future when `join` support is better, we can apply the `membershipLimit` here. Right now we're just querying 100.\n\t\t\t\t\t...(includeTeamMembers ? { teamMember: true } : {}),\n\t\t\t\t},\n\t\t\t});\n\t\t\tif (!result) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tconst { teamMember, ...team } = result;\n\n\t\t\treturn {\n\t\t\t\t...team,\n\t\t\t\t...(includeTeamMembers ? { members: teamMember } : {}),\n\t\t\t} as any;\n\t\t},\n\t\tupdateTeam: async (\n\t\t\tteamId: string,\n\t\t\tdata: {\n\t\t\t\tname?: string | undefined;\n\t\t\t\tdescription?: string | undefined;\n\t\t\t\tstatus?: string | undefined;\n\t\t\t},\n\t\t) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tif (\"id\" in data) data.id = undefined;\n\t\t\tconst team = await adapter.update<\n\t\t\t\tInferTeam<O, false> & InferAdditionalFieldsFromPluginOptions<\"team\", O>\n\t\t\t>({\n\t\t\t\tmodel: \"team\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\tvalue: teamId,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tupdate: {\n\t\t\t\t\t...data,\n\t\t\t\t},\n\t\t\t});\n\t\t\treturn team;\n\t\t},\n\n\t\tdeleteTeam: async (teamId: string) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tawait adapter.deleteMany({\n\t\t\t\tmodel: \"teamMember\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"teamId\",\n\t\t\t\t\t\tvalue: teamId,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\n\t\t\tconst team = await adapter.delete<InferTeam<O, false>>({\n\t\t\t\tmodel: \"team\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\tvalue: teamId,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\treturn team;\n\t\t},\n\n\t\tlistTeams: async (organizationId: string) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst teams = await adapter.findMany<InferTeam<O, false>>({\n\t\t\t\tmodel: \"team\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\t\tvalue: organizationId,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\treturn teams;\n\t\t},\n\n\t\tcreateTeamInvitation: async ({\n\t\t\temail,\n\t\t\trole,\n\t\t\tteamId,\n\t\t\torganizationId,\n\t\t\tinviterId,\n\t\t\texpiresIn = 1000 * 60 * 60 * 48, // Default expiration: 48 hours\n\t\t}: {\n\t\t\temail: string;\n\t\t\trole: string;\n\t\t\tteamId: string;\n\t\t\torganizationId: string;\n\t\t\tinviterId: string;\n\t\t\texpiresIn?: number | undefined;\n\t\t}) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst expiresAt = getDate(expiresIn); // Get expiration date\n\n\t\t\tconst invitation = await adapter.create<\n\t\t\t\tInvitationInput,\n\t\t\t\tInferInvitation<O>\n\t\t\t>({\n\t\t\t\tmodel: \"invitation\",\n\t\t\t\tdata: {\n\t\t\t\t\temail,\n\t\t\t\t\trole,\n\t\t\t\t\torganizationId,\n\t\t\t\t\tteamId,\n\t\t\t\t\tinviterId,\n\t\t\t\t\tstatus: \"pending\",\n\t\t\t\t\texpiresAt,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn invitation;\n\t\t},\n\n\t\tsetActiveTeam: async (\n\t\t\tsessionToken: string,\n\t\t\tteamId: string | null,\n\t\t\tctx: GenericEndpointContext,\n\t\t) => {\n\t\t\tconst session = await context.internalAdapter.updateSession(\n\t\t\t\tsessionToken,\n\t\t\t\t{\n\t\t\t\t\tactiveTeamId: teamId,\n\t\t\t\t},\n\t\t\t);\n\t\t\treturn session as Session;\n\t\t},\n\n\t\tlistTeamMembers: async (data: { teamId: string }) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst members = await adapter.findMany<TeamMember>({\n\t\t\t\tmodel: \"teamMember\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"teamId\",\n\t\t\t\t\t\tvalue: data.teamId,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\n\t\t\treturn members;\n\t\t},\n\t\tcountTeamMembers: async (data: { teamId: string }) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst count = await adapter.count({\n\t\t\t\tmodel: \"teamMember\",\n\t\t\t\twhere: [{ field: \"teamId\", value: data.teamId }],\n\t\t\t});\n\t\t\treturn count;\n\t\t},\n\t\tcountMembers: async (data: { organizationId: string }) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst count = await adapter.count({\n\t\t\t\tmodel: \"member\",\n\t\t\t\twhere: [{ field: \"organizationId\", value: data.organizationId }],\n\t\t\t});\n\t\t\treturn count;\n\t\t},\n\t\tlistTeamsByUser: async (data: { userId: string }) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst results = await adapter.findMany<TeamMember & { team: Team }>({\n\t\t\t\tmodel: \"teamMember\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: data.userId,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tjoin: {\n\t\t\t\t\tteam: true,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn results.map((result) => result.team);\n\t\t},\n\n\t\tfindTeamMember: async (data: { teamId: string; userId: string }) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst member = await adapter.findOne<TeamMember>({\n\t\t\t\tmodel: \"teamMember\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"teamId\",\n\t\t\t\t\t\tvalue: data.teamId,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: data.userId,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\n\t\t\treturn member;\n\t\t},\n\n\t\tfindOrCreateTeamMember: async (data: {\n\t\t\tteamId: string;\n\t\t\tuserId: string;\n\t\t}) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst member = await adapter.findOne<TeamMember>({\n\t\t\t\tmodel: \"teamMember\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"teamId\",\n\t\t\t\t\t\tvalue: data.teamId,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: data.userId,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\n\t\t\tif (member) return member;\n\n\t\t\treturn await adapter.create<Omit<TeamMember, \"id\">, TeamMember>({\n\t\t\t\tmodel: \"teamMember\",\n\t\t\t\tdata: {\n\t\t\t\t\tteamId: data.teamId,\n\t\t\t\t\tuserId: data.userId,\n\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\tremoveTeamMember: async (data: { teamId: string; userId: string }) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\t// use `deleteMany` instead of `delete` since Prisma requires 1 unique field for normal `delete` operations\n\t\t\t// FKs do not count thus breaking the operation. As a solution, we'll use `deleteMany` instead.\n\t\t\tawait adapter.deleteMany({\n\t\t\t\tmodel: \"teamMember\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"teamId\",\n\t\t\t\t\t\tvalue: data.teamId,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: data.userId,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t},\n\t\tfindInvitationsByTeamId: async (teamId: string) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst invitations = await adapter.findMany<InferInvitation<O, false>>({\n\t\t\t\tmodel: \"invitation\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"teamId\",\n\t\t\t\t\t\tvalue: teamId,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\treturn invitations;\n\t\t},\n\t\tlistUserInvitations: async (email: string) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst invitations = await adapter.findMany<\n\t\t\t\tInferInvitation<O, false> & {\n\t\t\t\t\torganization: InferOrganization<O, false>;\n\t\t\t\t}\n\t\t\t>({\n\t\t\t\tmodel: \"invitation\",\n\t\t\t\twhere: [{ field: \"email\", value: email.toLowerCase() }],\n\t\t\t\tjoin: {\n\t\t\t\t\torganization: true,\n\t\t\t\t},\n\t\t\t});\n\t\t\treturn invitations.map(({ organization, ...inv }) => ({\n\t\t\t\t...inv,\n\t\t\t\torganizationName: organization.name,\n\t\t\t}));\n\t\t},\n\t\tcreateInvitation: async ({\n\t\t\tinvitation,\n\t\t\tuser,\n\t\t}: {\n\t\t\tinvitation: {\n\t\t\t\temail: string;\n\t\t\t\trole: string;\n\t\t\t\torganizationId: string;\n\t\t\t\tteamIds: string[];\n\t\t\t} & Record<string, any>; // This represents the additionalFields for the invitation\n\t\t\tuser: User;\n\t\t}) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst defaultExpiration = 60 * 60 * 48;\n\t\t\tconst expiresAt = getDate(\n\t\t\t\toptions?.invitationExpiresIn || defaultExpiration,\n\t\t\t\t\"sec\",\n\t\t\t);\n\t\t\tconst invite = await adapter.create<\n\t\t\t\tOmit<InvitationInput, \"id\">,\n\t\t\t\tInferInvitation<O, false>\n\t\t\t>({\n\t\t\t\tmodel: \"invitation\",\n\t\t\t\tdata: {\n\t\t\t\t\tstatus: \"pending\",\n\t\t\t\t\texpiresAt,\n\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t\tinviterId: user.id,\n\t\t\t\t\t...invitation,\n\t\t\t\t\tteamId:\n\t\t\t\t\t\tinvitation.teamIds.length > 0 ? invitation.teamIds.join(\",\") : null,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn invite;\n\t\t},\n\t\tfindInvitationById: async (id: string) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst invitation = await adapter.findOne<InferInvitation<O, false>>({\n\t\t\t\tmodel: \"invitation\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\tvalue: id,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\treturn invitation;\n\t\t},\n\t\tfindPendingInvitation: async (data: {\n\t\t\temail: string;\n\t\t\torganizationId: string;\n\t\t}) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst invitation = await adapter.findMany<InferInvitation<O, false>>({\n\t\t\t\tmodel: \"invitation\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"email\",\n\t\t\t\t\t\tvalue: data.email.toLowerCase(),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\t\tvalue: data.organizationId,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"status\",\n\t\t\t\t\t\tvalue: \"pending\",\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\treturn invitation.filter(\n\t\t\t\t(invite) => new Date(invite.expiresAt) > new Date(),\n\t\t\t);\n\t\t},\n\t\tfindPendingInvitations: async (data: { organizationId: string }) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst invitations = await adapter.findMany<InferInvitation<O, false>>({\n\t\t\t\tmodel: \"invitation\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\t\tvalue: data.organizationId,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"status\",\n\t\t\t\t\t\tvalue: \"pending\",\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\treturn invitations.filter(\n\t\t\t\t(invite) => new Date(invite.expiresAt) > new Date(),\n\t\t\t);\n\t\t},\n\t\tlistInvitations: async (data: { organizationId: string }) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst invitations = await adapter.findMany<InferInvitation<O, false>>({\n\t\t\t\tmodel: \"invitation\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\t\tvalue: data.organizationId,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\treturn invitations;\n\t\t},\n\t\tupdateInvitation: async (data: {\n\t\t\tinvitationId: string;\n\t\t\tstatus: \"accepted\" | \"canceled\" | \"rejected\";\n\t\t}) => {\n\t\t\tconst adapter = await getCurrentAdapter(baseAdapter);\n\t\t\tconst invitation = await adapter.update<InferInvitation<O, false>>({\n\t\t\t\tmodel: \"invitation\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\tvalue: data.invitationId,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tupdate: {\n\t\t\t\t\tstatus: data.status,\n\t\t\t\t},\n\t\t\t});\n\t\t\treturn invitation;\n\t\t},\n\t};\n};\n"],"names":["user","userId: string","member"],"mappings":"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"}},
    {"offset": {"line": 777, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/organization/access/statement.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/organization/access/statement.ts"],"sourcesContent":["import { createAccessControl } from \"../../access\";\n\nexport const defaultStatements = {\n\torganization: [\"update\", \"delete\"],\n\tmember: [\"create\", \"update\", \"delete\"],\n\tinvitation: [\"create\", \"cancel\"],\n\tteam: [\"create\", \"update\", \"delete\"],\n\tac: [\"create\", \"read\", \"update\", \"delete\"],\n} as const;\n\nexport const defaultAc = createAccessControl(defaultStatements);\n\nexport const adminAc = defaultAc.newRole({\n\torganization: [\"update\"],\n\tinvitation: [\"create\", \"cancel\"],\n\tmember: [\"create\", \"update\", \"delete\"],\n\tteam: [\"create\", \"update\", \"delete\"],\n\tac: [\"create\", \"read\", \"update\", \"delete\"],\n});\n\nexport const ownerAc = defaultAc.newRole({\n\torganization: [\"update\", \"delete\"],\n\tmember: [\"create\", \"update\", \"delete\"],\n\tinvitation: [\"create\", \"cancel\"],\n\tteam: [\"create\", \"update\", \"delete\"],\n\tac: [\"create\", \"read\", \"update\", \"delete\"],\n});\n\nexport const memberAc = defaultAc.newRole({\n\torganization: [],\n\tmember: [],\n\tinvitation: [],\n\tteam: [],\n\tac: [\"read\"], // Allow members to see all roles for their org.\n});\n\nexport const defaultRoles = {\n\tadmin: adminAc,\n\towner: ownerAc,\n\tmember: memberAc,\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAEA,MAAa,oBAAoB;IAChC,cAAc;QAAC;QAAU;KAAS;IAClC,QAAQ;QAAC;QAAU;QAAU;KAAS;IACtC,YAAY;QAAC;QAAU;KAAS;IAChC,MAAM;QAAC;QAAU;QAAU;KAAS;IACpC,IAAI;QAAC;QAAU;QAAQ;QAAU;KAAS;CAC1C;AAED,MAAa,gBAAY,+LAAA,EAAoB,kBAAkB;AAE/D,MAAa,UAAU,UAAU,OAAA,CAAQ;IACxC,cAAc;QAAC;KAAS;IACxB,YAAY;QAAC;QAAU;KAAS;IAChC,QAAQ;QAAC;QAAU;QAAU;KAAS;IACtC,MAAM;QAAC;QAAU;QAAU;KAAS;IACpC,IAAI;QAAC;QAAU;QAAQ;QAAU;KAAS;CAC1C,CAAC;AAEF,MAAa,UAAU,UAAU,OAAA,CAAQ;IACxC,cAAc;QAAC;QAAU;KAAS;IAClC,QAAQ;QAAC;QAAU;QAAU;KAAS;IACtC,YAAY;QAAC;QAAU;KAAS;IAChC,MAAM;QAAC;QAAU;QAAU;KAAS;IACpC,IAAI;QAAC;QAAU;QAAQ;QAAU;KAAS;CAC1C,CAAC;AAEF,MAAa,WAAW,UAAU,OAAA,CAAQ;IACzC,cAAc,EAAE;IAChB,QAAQ,EAAE;IACV,YAAY,EAAE;IACd,MAAM,EAAE;IACR,IAAI;QAAC;KAAO;CACZ,CAAC;AAEF,MAAa,eAAe;IAC3B,OAAO;IACP,OAAO;IACP,QAAQ;CACR"}},
    {"offset": {"line": 894, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/dist/plugins/organization/access/index.mjs"],"sourcesContent":["import { adminAc, defaultAc, defaultRoles, defaultStatements, memberAc, ownerAc } from \"./statement.mjs\";\n\nexport { adminAc, defaultAc, defaultRoles, defaultStatements, memberAc, ownerAc };"],"names":[],"mappings":";AAAA","ignoreList":[0]}},
    {"offset": {"line": 902, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/organization/call.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/organization/call.ts"],"sourcesContent":["import type { GenericEndpointContext } from \"@better-auth/core\";\nimport { createAuthMiddleware } from \"@better-auth/core/api\";\nimport { sessionMiddleware } from \"../../api\";\nimport type { Session, User } from \"../../types\";\nimport type { Role } from \"../access\";\nimport type { defaultRoles } from \"./access/statement\";\nimport type { OrganizationOptions } from \"./types\";\n\nexport const orgMiddleware = createAuthMiddleware(async () => {\n\treturn {} as {\n\t\torgOptions: OrganizationOptions;\n\t\troles: typeof defaultRoles & {\n\t\t\t[key: string]: Role<{}>;\n\t\t};\n\t\tgetSession: (context: GenericEndpointContext) => Promise<{\n\t\t\tsession: Session & {\n\t\t\t\tactiveTeamId?: string | undefined;\n\t\t\t\tactiveOrganizationId?: string | undefined;\n\t\t\t};\n\t\t\tuser: User;\n\t\t}>;\n\t};\n});\n\n/**\n * The middleware forces the endpoint to require a valid session by utilizing the `sessionMiddleware`.\n * It also appends additional types to the session type regarding organizations.\n */\nexport const orgSessionMiddleware = createAuthMiddleware(\n\t{\n\t\tuse: [sessionMiddleware],\n\t},\n\tasync (ctx) => {\n\t\tconst session = ctx.context.session as {\n\t\t\tsession: Session & {\n\t\t\t\tactiveTeamId?: string | undefined;\n\t\t\t\tactiveOrganizationId?: string | undefined;\n\t\t\t};\n\t\t\tuser: User;\n\t\t};\n\t\treturn {\n\t\t\tsession,\n\t\t};\n\t},\n);\n"],"names":[],"mappings":";;;;;;;;;;;;;AAQA,MAAa,oBAAgB,2LAAA,EAAqB,YAAY;IAC7D,OAAO,CAAA,CAAE;EAaR;;;;GAMF,MAAa,2BAAuB,2LAAA,EACnC;IACC,KAAK;QAAC,0LAAA;KAAkB;AAAA,CACxB,EACD,OAAO,QAAQ;IAQd,OAAO;QACN,SARe,IAAI,OAAA,CAAQ,OAAA;IAAA,CAS3B;EAEF"}},
    {"offset": {"line": 936, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/organization/error-codes.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/organization/error-codes.ts"],"sourcesContent":["import { defineErrorCodes } from \"@better-auth/core/utils\";\n\nexport const ORGANIZATION_ERROR_CODES = defineErrorCodes({\n\tYOU_ARE_NOT_ALLOWED_TO_CREATE_A_NEW_ORGANIZATION:\n\t\t\"You are not allowed to create a new organization\",\n\tYOU_HAVE_REACHED_THE_MAXIMUM_NUMBER_OF_ORGANIZATIONS:\n\t\t\"You have reached the maximum number of organizations\",\n\tORGANIZATION_ALREADY_EXISTS: \"Organization already exists\",\n\tORGANIZATION_SLUG_ALREADY_TAKEN: \"Organization slug already taken\",\n\tORGANIZATION_NOT_FOUND: \"Organization not found\",\n\tUSER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION:\n\t\t\"User is not a member of the organization\",\n\tYOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_ORGANIZATION:\n\t\t\"You are not allowed to update this organization\",\n\tYOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_ORGANIZATION:\n\t\t\"You are not allowed to delete this organization\",\n\tNO_ACTIVE_ORGANIZATION: \"No active organization\",\n\tUSER_IS_ALREADY_A_MEMBER_OF_THIS_ORGANIZATION:\n\t\t\"User is already a member of this organization\",\n\tMEMBER_NOT_FOUND: \"Member not found\",\n\tROLE_NOT_FOUND: \"Role not found\",\n\tYOU_ARE_NOT_ALLOWED_TO_CREATE_A_NEW_TEAM:\n\t\t\"You are not allowed to create a new team\",\n\tTEAM_ALREADY_EXISTS: \"Team already exists\",\n\tTEAM_NOT_FOUND: \"Team not found\",\n\tYOU_CANNOT_LEAVE_THE_ORGANIZATION_AS_THE_ONLY_OWNER:\n\t\t\"You cannot leave the organization as the only owner\",\n\tYOU_CANNOT_LEAVE_THE_ORGANIZATION_WITHOUT_AN_OWNER:\n\t\t\"You cannot leave the organization without an owner\",\n\tYOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_MEMBER:\n\t\t\"You are not allowed to delete this member\",\n\tYOU_ARE_NOT_ALLOWED_TO_INVITE_USERS_TO_THIS_ORGANIZATION:\n\t\t\"You are not allowed to invite users to this organization\",\n\tUSER_IS_ALREADY_INVITED_TO_THIS_ORGANIZATION:\n\t\t\"User is already invited to this organization\",\n\tINVITATION_NOT_FOUND: \"Invitation not found\",\n\tYOU_ARE_NOT_THE_RECIPIENT_OF_THE_INVITATION:\n\t\t\"You are not the recipient of the invitation\",\n\tEMAIL_VERIFICATION_REQUIRED_BEFORE_ACCEPTING_OR_REJECTING_INVITATION:\n\t\t\"Email verification required before accepting or rejecting invitation\",\n\tYOU_ARE_NOT_ALLOWED_TO_CANCEL_THIS_INVITATION:\n\t\t\"You are not allowed to cancel this invitation\",\n\tINVITER_IS_NO_LONGER_A_MEMBER_OF_THE_ORGANIZATION:\n\t\t\"Inviter is no longer a member of the organization\",\n\tYOU_ARE_NOT_ALLOWED_TO_INVITE_USER_WITH_THIS_ROLE:\n\t\t\"You are not allowed to invite a user with this role\",\n\tFAILED_TO_RETRIEVE_INVITATION: \"Failed to retrieve invitation\",\n\tYOU_HAVE_REACHED_THE_MAXIMUM_NUMBER_OF_TEAMS:\n\t\t\"You have reached the maximum number of teams\",\n\tUNABLE_TO_REMOVE_LAST_TEAM: \"Unable to remove last team\",\n\tYOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_MEMBER:\n\t\t\"You are not allowed to update this member\",\n\tORGANIZATION_MEMBERSHIP_LIMIT_REACHED:\n\t\t\"Organization membership limit reached\",\n\tYOU_ARE_NOT_ALLOWED_TO_CREATE_TEAMS_IN_THIS_ORGANIZATION:\n\t\t\"You are not allowed to create teams in this organization\",\n\tYOU_ARE_NOT_ALLOWED_TO_DELETE_TEAMS_IN_THIS_ORGANIZATION:\n\t\t\"You are not allowed to delete teams in this organization\",\n\tYOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_TEAM:\n\t\t\"You are not allowed to update this team\",\n\tYOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_TEAM:\n\t\t\"You are not allowed to delete this team\",\n\tINVITATION_LIMIT_REACHED: \"Invitation limit reached\",\n\tTEAM_MEMBER_LIMIT_REACHED: \"Team member limit reached\",\n\tUSER_IS_NOT_A_MEMBER_OF_THE_TEAM: \"User is not a member of the team\",\n\tYOU_CAN_NOT_ACCESS_THE_MEMBERS_OF_THIS_TEAM:\n\t\t\"You are not allowed to list the members of this team\",\n\tYOU_DO_NOT_HAVE_AN_ACTIVE_TEAM: \"You do not have an active team\",\n\tYOU_ARE_NOT_ALLOWED_TO_CREATE_A_NEW_TEAM_MEMBER:\n\t\t\"You are not allowed to create a new member\",\n\tYOU_ARE_NOT_ALLOWED_TO_REMOVE_A_TEAM_MEMBER:\n\t\t\"You are not allowed to remove a team member\",\n\tYOU_ARE_NOT_ALLOWED_TO_ACCESS_THIS_ORGANIZATION:\n\t\t\"You are not allowed to access this organization as an owner\",\n\tYOU_ARE_NOT_A_MEMBER_OF_THIS_ORGANIZATION:\n\t\t\"You are not a member of this organization\",\n\tMISSING_AC_INSTANCE:\n\t\t\"Dynamic Access Control requires a pre-defined ac instance on the server auth plugin. Read server logs for more information\",\n\tYOU_MUST_BE_IN_AN_ORGANIZATION_TO_CREATE_A_ROLE:\n\t\t\"You must be in an organization to create a role\",\n\tYOU_ARE_NOT_ALLOWED_TO_CREATE_A_ROLE: \"You are not allowed to create a role\",\n\tYOU_ARE_NOT_ALLOWED_TO_UPDATE_A_ROLE: \"You are not allowed to update a role\",\n\tYOU_ARE_NOT_ALLOWED_TO_DELETE_A_ROLE: \"You are not allowed to delete a role\",\n\tYOU_ARE_NOT_ALLOWED_TO_READ_A_ROLE: \"You are not allowed to read a role\",\n\tYOU_ARE_NOT_ALLOWED_TO_LIST_A_ROLE: \"You are not allowed to list a role\",\n\tYOU_ARE_NOT_ALLOWED_TO_GET_A_ROLE: \"You are not allowed to get a role\",\n\tTOO_MANY_ROLES: \"This organization has too many roles\",\n\tINVALID_RESOURCE: \"The provided permission includes an invalid resource\",\n\tROLE_NAME_IS_ALREADY_TAKEN: \"That role name is already taken\",\n\tCANNOT_DELETE_A_PRE_DEFINED_ROLE: \"Cannot delete a pre-defined role\",\n});\n"],"names":[],"mappings":";;;;;;;;AAEA,MAAa,+BAA2B,kMAAA,EAAiB;IACxD,kDACC;IACD,sDACC;IACD,6BAA6B;IAC7B,iCAAiC;IACjC,wBAAwB;IACxB,0CACC;IACD,iDACC;IACD,iDACC;IACD,wBAAwB;IACxB,+CACC;IACD,kBAAkB;IAClB,gBAAgB;IAChB,0CACC;IACD,qBAAqB;IACrB,gBAAgB;IAChB,qDACC;IACD,oDACC;IACD,2CACC;IACD,0DACC;IACD,8CACC;IACD,sBAAsB;IACtB,6CACC;IACD,sEACC;IACD,+CACC;IACD,mDACC;IACD,mDACC;IACD,+BAA+B;IAC/B,8CACC;IACD,4BAA4B;IAC5B,2CACC;IACD,uCACC;IACD,0DACC;IACD,0DACC;IACD,yCACC;IACD,yCACC;IACD,0BAA0B;IAC1B,2BAA2B;IAC3B,kCAAkC;IAClC,6CACC;IACD,gCAAgC;IAChC,iDACC;IACD,6CACC;IACD,iDACC;IACD,2CACC;IACD,qBACC;IACD,iDACC;IACD,sCAAsC;IACtC,sCAAsC;IACtC,sCAAsC;IACtC,oCAAoC;IACpC,oCAAoC;IACpC,mCAAmC;IACnC,gBAAgB;IAChB,kBAAkB;IAClB,4BAA4B;IAC5B,kCAAkC;CAClC,CAAC"}},
    {"offset": {"line": 1008, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/organization/permission.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/organization/permission.ts"],"sourcesContent":["import type { Role } from \"../access\";\nimport type { OrganizationOptions } from \"./types\";\n\nexport const hasPermissionFn = (\n\tinput: HasPermissionBaseInput,\n\tacRoles: {\n\t\t[x: string]: Role<any> | undefined;\n\t},\n) => {\n\tif (!input.permissions && !input.permission) return false;\n\n\tconst roles = input.role.split(\",\");\n\tconst creatorRole = input.options.creatorRole || \"owner\";\n\tconst isCreator = roles.includes(creatorRole);\n\n\tconst allowCreatorsAllPermissions = input.allowCreatorAllPermissions || false;\n\tif (isCreator && allowCreatorsAllPermissions) return true;\n\n\tfor (const role of roles) {\n\t\tconst _role = acRoles[role as keyof typeof acRoles];\n\t\tconst result = _role?.authorize(input.permissions ?? input.permission);\n\t\tif (result?.success) {\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n};\n\nexport type PermissionExclusive =\n\t| {\n\t\t\t/**\n\t\t\t * @deprecated Use `permissions` instead\n\t\t\t */\n\t\t\tpermission: { [key: string]: string[] };\n\t\t\tpermissions?: never | undefined;\n\t  }\n\t| {\n\t\t\tpermissions: { [key: string]: string[] };\n\t\t\tpermission?: never | undefined;\n\t  };\n\nexport const cacheAllRoles = new Map<\n\tstring,\n\t{\n\t\t[x: string]: Role<any> | undefined;\n\t}\n>();\n\nexport type HasPermissionBaseInput = {\n\trole: string;\n\toptions: OrganizationOptions;\n\tallowCreatorAllPermissions?: boolean | undefined;\n} & PermissionExclusive;\n"],"names":[],"mappings":";;;;;;;AAGA,MAAa,kBAAA,CACZ,OACA,YAGI;IACJ,IAAI,CAAC,MAAM,WAAA,IAAe,CAAC,MAAM,UAAA,CAAY,CAAA,OAAO;IAEpD,MAAM,QAAQ,MAAM,IAAA,CAAK,KAAA,CAAM,IAAI;IACnC,MAAM,cAAc,MAAM,OAAA,CAAQ,WAAA,IAAe;IACjD,MAAM,YAAY,MAAM,QAAA,CAAS,YAAY;IAE7C,MAAM,8BAA8B,MAAM,0BAAA,IAA8B;IACxE,IAAI,aAAa,4BAA6B,CAAA,OAAO;IAErD,KAAK,MAAM,QAAQ,MAGlB,IAFc,OAAA,CAAQ,KAAA,EACA,UAAU,MAAM,WAAA,IAAe,MAAM,UAAA,CAAW,EAC1D,QACX,CAAA,OAAO;IAGT,OAAO;;AAgBR,MAAa,gBAAA,aAAA,GAAgB,IAAI,KAK9B"}},
    {"offset": {"line": 1032, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/organization/has-permission.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/organization/has-permission.ts"],"sourcesContent":["import type { GenericEndpointContext } from \"@better-auth/core\";\nimport * as z from \"zod\";\nimport { APIError } from \"../../api\";\nimport type { Role } from \"../access\";\nimport { defaultRoles } from \"./access\";\nimport type { HasPermissionBaseInput } from \"./permission\";\nimport { cacheAllRoles, hasPermissionFn } from \"./permission\";\nimport type { OrganizationRole } from \"./schema\";\n\nexport const hasPermission = async (\n\tinput: {\n\t\torganizationId: string;\n\t\t/**\n\t\t * If true, will use the in-memory cache of the roles.\n\t\t * Keep in mind to use this in a stateless mindset, the purpose of this is to avoid unnecessary database calls when running multiple\n\t\t * hasPermission calls in a row.\n\t\t *\n\t\t * @default false\n\t\t */\n\t\tuseMemoryCache?: boolean | undefined;\n\t} & HasPermissionBaseInput,\n\tctx: GenericEndpointContext,\n) => {\n\tlet acRoles: {\n\t\t[x: string]: Role<any> | undefined;\n\t} = { ...(input.options.roles || defaultRoles) };\n\n\tif (\n\t\tctx &&\n\t\tinput.organizationId &&\n\t\tinput.options.dynamicAccessControl?.enabled &&\n\t\tinput.options.ac &&\n\t\t!input.useMemoryCache\n\t) {\n\t\t// Load roles from database\n\t\tconst roles = await ctx.context.adapter.findMany<\n\t\t\tOrganizationRole & { permission: string }\n\t\t>({\n\t\t\tmodel: \"organizationRole\",\n\t\t\twhere: [\n\t\t\t\t{\n\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\tvalue: input.organizationId,\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\n\t\tfor (const { role, permission: permissionsString } of roles) {\n\t\t\t// If it's for an existing role, skip as we shouldn't override hard-coded roles.\n\t\t\tif (role in acRoles) continue;\n\n\t\t\tconst result = z\n\t\t\t\t.record(z.string(), z.array(z.string()))\n\t\t\t\t.safeParse(JSON.parse(permissionsString));\n\n\t\t\tif (!result.success) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t\"[hasPermission] Invalid permissions for role \" + role,\n\t\t\t\t\t{\n\t\t\t\t\t\tpermissions: JSON.parse(permissionsString),\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"INTERNAL_SERVER_ERROR\", {\n\t\t\t\t\tmessage: \"Invalid permissions for role \" + role,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tacRoles[role] = input.options.ac.newRole(result.data);\n\t\t}\n\t}\n\n\tif (input.useMemoryCache) {\n\t\tacRoles = cacheAllRoles.get(input.organizationId) || acRoles;\n\t}\n\tcacheAllRoles.set(input.organizationId, acRoles);\n\n\treturn hasPermissionFn(input, acRoles);\n};\n"],"names":["acRoles: {\n\t\t[x: string]: Role<any> | undefined;\n\t}"],"mappings":";;;;;;;;;;;;;;;;AASA,MAAa,gBAAgB,OAC5B,OAWA,QACI;IACJ,IAAIA,UAEA;QAAE,GAAI,MAAM,OAAA,CAAQ,KAAA,IAAS,2MAAA;IAAA,CAAe;IAEhD,IACC,OACA,MAAM,cAAA,IACN,MAAM,OAAA,CAAQ,oBAAA,EAAsB,WACpC,MAAM,OAAA,CAAQ,EAAA,IACd,CAAC,MAAM,cAAA,EACN;QAED,MAAM,QAAQ,MAAM,IAAI,OAAA,CAAQ,OAAA,CAAQ,QAAA,CAEtC;YACD,OAAO;YACP,OAAO;gBACN;oBACC,OAAO;oBACP,OAAO,MAAM,cAAA;iBACb;aACD;SACD,CAAC;QAEF,KAAK,MAAM,EAAE,IAAA,EAAM,YAAY,iBAAA,EAAA,IAAuB,MAAO;YAE5D,IAAI,QAAQ,QAAS,CAAA;YAErB,MAAM,SAAS,EACb,yJAAA,CAAO,EAAE,yJAAA,EAAQ,EAAE,EAAE,wJAAA,CAAM,EAAE,yJAAA,EAAQ,CAAC,CAAC,CACvC,SAAA,CAAU,KAAK,KAAA,CAAM,kBAAkB,CAAC;YAE1C,IAAI,CAAC,OAAO,OAAA,EAAS;gBACpB,IAAI,OAAA,CAAQ,MAAA,CAAO,KAAA,CAClB,kDAAkD,MAClD;oBACC,aAAa,KAAK,KAAA,CAAM,kBAAkB;gBAAA,CAC1C,CACD;gBACD,MAAM,IAAI,8JAAA,CAAS,yBAAyB;oBAC3C,SAAS,kCAAkC;gBAAA,CAC3C,CAAC;;YAGH,OAAA,CAAQ,KAAA,GAAQ,MAAM,OAAA,CAAQ,EAAA,CAAG,OAAA,CAAQ,OAAO,IAAA,CAAK;;;IAIvD,IAAI,MAAM,cAAA,CACT,CAAA,UAAU,mMAAA,CAAc,GAAA,CAAI,MAAM,cAAA,CAAe,IAAI;IAEtD,mMAAA,CAAc,GAAA,CAAI,MAAM,cAAA,EAAgB,QAAQ;IAEhD,WAAO,qMAAA,EAAgB,OAAO,QAAQ"}},
    {"offset": {"line": 1086, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/organization/routes/crud-access-control.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/organization/routes/crud-access-control.ts"],"sourcesContent":["import type { GenericEndpointContext } from \"@better-auth/core\";\nimport { createAuthEndpoint } from \"@better-auth/core/api\";\nimport type { Where } from \"@better-auth/core/db/adapter\";\nimport * as z from \"zod\";\nimport { APIError } from \"../../../api\";\nimport type { InferAdditionalFieldsFromPluginOptions } from \"../../../db\";\nimport { toZodSchema } from \"../../../db\";\nimport type { User } from \"../../../types\";\nimport type { AccessControl } from \"../../access\";\nimport { orgSessionMiddleware } from \"../call\";\nimport { ORGANIZATION_ERROR_CODES } from \"../error-codes\";\nimport { hasPermission } from \"../has-permission\";\nimport type { Member, OrganizationRole } from \"../schema\";\nimport type { OrganizationOptions } from \"../types\";\n\ntype IsExactlyEmptyObject<T> = keyof T extends never // no keys\n\t? T extends {} // is assignable to {}\n\t\t? {} extends T\n\t\t\t? true\n\t\t\t: false // and {} is assignable to it\n\t\t: false\n\t: false;\n\nconst normalizeRoleName = (role: string) => role.toLowerCase();\nconst DEFAULT_MAXIMUM_ROLES_PER_ORGANIZATION = Number.POSITIVE_INFINITY;\n\nconst getAdditionalFields = <\n\tO extends OrganizationOptions,\n\tAllPartial extends boolean = false,\n>(\n\toptions: O,\n\tshouldBePartial: AllPartial = false as AllPartial,\n) => {\n\tconst additionalFields =\n\t\toptions?.schema?.organizationRole?.additionalFields || {};\n\tif (shouldBePartial) {\n\t\tfor (const key in additionalFields) {\n\t\t\tadditionalFields[key]!.required = false;\n\t\t}\n\t}\n\tconst additionalFieldsSchema = toZodSchema({\n\t\tfields: additionalFields,\n\t\tisClientSide: true,\n\t});\n\ttype AdditionalFields = AllPartial extends true\n\t\t? Partial<InferAdditionalFieldsFromPluginOptions<\"organizationRole\", O>>\n\t\t: InferAdditionalFieldsFromPluginOptions<\"organizationRole\", O>;\n\ttype ReturnAdditionalFields = InferAdditionalFieldsFromPluginOptions<\n\t\t\"organizationRole\",\n\t\tO,\n\t\tfalse\n\t>;\n\n\treturn {\n\t\tadditionalFieldsSchema,\n\t\t$AdditionalFields: {} as AdditionalFields,\n\t\t$ReturnAdditionalFields: {} as ReturnAdditionalFields,\n\t};\n};\n\nconst baseCreateOrgRoleSchema = z.object({\n\torganizationId: z.string().optional().meta({\n\t\tdescription:\n\t\t\t\"The id of the organization to create the role in. If not provided, the user's active organization will be used.\",\n\t}),\n\trole: z.string().meta({\n\t\tdescription: \"The name of the role to create\",\n\t}),\n\tpermission: z.record(z.string(), z.array(z.string())).meta({\n\t\tdescription: \"The permission to assign to the role\",\n\t}),\n});\n\nexport const createOrgRole = <O extends OrganizationOptions>(options: O) => {\n\tconst { additionalFieldsSchema, $AdditionalFields, $ReturnAdditionalFields } =\n\t\tgetAdditionalFields<O>(options, false);\n\ttype AdditionalFields = typeof $AdditionalFields;\n\ttype ReturnAdditionalFields = typeof $ReturnAdditionalFields;\n\n\treturn createAuthEndpoint(\n\t\t\"/organization/create-role\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: baseCreateOrgRoleSchema.safeExtend({\n\t\t\t\tadditionalFields: z\n\t\t\t\t\t.object({ ...additionalFieldsSchema.shape })\n\t\t\t\t\t.optional(),\n\t\t\t}),\n\t\t\tmetadata: {\n\t\t\t\t$Infer: {\n\t\t\t\t\tbody: {} as {\n\t\t\t\t\t\torganizationId?: string | undefined;\n\t\t\t\t\t\trole: string;\n\t\t\t\t\t\tpermission: Record<string, string[]>;\n\t\t\t\t\t} & (IsExactlyEmptyObject<AdditionalFields> extends true\n\t\t\t\t\t\t? { additionalFields?: {} | undefined }\n\t\t\t\t\t\t: { additionalFields: AdditionalFields }),\n\t\t\t\t},\n\t\t\t},\n\t\t\trequireHeaders: true,\n\t\t\tuse: [orgSessionMiddleware],\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst { session, user } = ctx.context.session;\n\t\t\tlet roleName = ctx.body.role;\n\t\t\tconst permission = ctx.body.permission;\n\t\t\tconst additionalFields = ctx.body.additionalFields;\n\n\t\t\tconst ac = options.ac;\n\t\t\tif (!ac) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t`[Dynamic Access Control] The organization plugin is missing a pre-defined ac instance.`,\n\t\t\t\t\t`\\nPlease refer to the documentation here: https://better-auth.com/docs/plugins/organization#dynamic-access-control`,\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"NOT_IMPLEMENTED\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.MISSING_AC_INSTANCE,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Get the organization id where the role will be created.\n\t\t\t// We can verify if the org id is valid and associated with the user in the next step when we try to find the member.\n\t\t\tconst organizationId =\n\t\t\t\tctx.body.organizationId ?? session.activeOrganizationId;\n\t\t\tif (!organizationId) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t`[Dynamic Access Control] The session is missing an active organization id to create a role. Either set an active org id, or pass an organizationId in the request body.`,\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_MUST_BE_IN_AN_ORGANIZATION_TO_CREATE_A_ROLE,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\troleName = normalizeRoleName(roleName);\n\n\t\t\tawait checkIfRoleNameIsTakenByPreDefinedRole({\n\t\t\t\trole: roleName,\n\t\t\t\torganizationId,\n\t\t\t\toptions,\n\t\t\t\tctx,\n\t\t\t});\n\n\t\t\t// Get the user's role associated with the organization.\n\t\t\t// This also serves as a check to ensure the org id is valid.\n\t\t\tconst member = await ctx.context.adapter.findOne<Member>({\n\t\t\t\tmodel: \"member\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\t\tvalue: organizationId,\n\t\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\t\tconnector: \"AND\",\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: user.id,\n\t\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\t\tconnector: \"AND\",\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\tif (!member) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t`[Dynamic Access Control] The user is not a member of the organization to create a role.`,\n\t\t\t\t\t{\n\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\torganizationId,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_A_MEMBER_OF_THIS_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst canCreateRole = await hasPermission(\n\t\t\t\t{\n\t\t\t\t\toptions,\n\t\t\t\t\torganizationId,\n\t\t\t\t\tpermissions: {\n\t\t\t\t\t\tac: [\"create\"],\n\t\t\t\t\t},\n\t\t\t\t\trole: member.role,\n\t\t\t\t},\n\t\t\t\tctx,\n\t\t\t);\n\t\t\tif (!canCreateRole) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t`[Dynamic Access Control] The user is not permitted to create a role. If this is unexpected, please make sure the role associated to that member has the \"ac\" resource with the \"create\" permission.`,\n\t\t\t\t\t{\n\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\torganizationId,\n\t\t\t\t\t\trole: member.role,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_CREATE_A_ROLE,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst maximumRolesPerOrganization =\n\t\t\t\ttypeof options.dynamicAccessControl?.maximumRolesPerOrganization ===\n\t\t\t\t\"function\"\n\t\t\t\t\t? await options.dynamicAccessControl.maximumRolesPerOrganization(\n\t\t\t\t\t\t\torganizationId,\n\t\t\t\t\t\t)\n\t\t\t\t\t: (options.dynamicAccessControl?.maximumRolesPerOrganization ??\n\t\t\t\t\t\tDEFAULT_MAXIMUM_ROLES_PER_ORGANIZATION);\n\t\t\tconst rolesInDB = await ctx.context.adapter.count({\n\t\t\t\tmodel: \"organizationRole\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\t\tvalue: organizationId,\n\t\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\t\tconnector: \"AND\",\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\tif (rolesInDB >= maximumRolesPerOrganization) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t`[Dynamic Access Control] Failed to create a new role, the organization has too many roles. Maximum allowed roles is ${maximumRolesPerOrganization}.`,\n\t\t\t\t\t{\n\t\t\t\t\t\torganizationId,\n\t\t\t\t\t\tmaximumRolesPerOrganization,\n\t\t\t\t\t\trolesInDB,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.TOO_MANY_ROLES,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tawait checkForInvalidResources({ ac, ctx, permission });\n\n\t\t\tawait checkIfMemberHasPermission({\n\t\t\t\tctx,\n\t\t\t\tmember,\n\t\t\t\toptions,\n\t\t\t\torganizationId,\n\t\t\t\tpermissionRequired: permission,\n\t\t\t\tuser,\n\t\t\t\taction: \"create\",\n\t\t\t});\n\n\t\t\tawait checkIfRoleNameIsTakenByRoleInDB({\n\t\t\t\tctx,\n\t\t\t\torganizationId,\n\t\t\t\trole: roleName,\n\t\t\t});\n\n\t\t\tconst newRole = ac.newRole(permission);\n\n\t\t\tconst newRoleInDB = await ctx.context.adapter.create<\n\t\t\t\tOmit<OrganizationRole, \"permission\"> & { permission: string }\n\t\t\t>({\n\t\t\t\tmodel: \"organizationRole\",\n\t\t\t\tdata: {\n\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t\torganizationId,\n\t\t\t\t\tpermission: JSON.stringify(permission),\n\t\t\t\t\trole: roleName,\n\t\t\t\t\t...additionalFields,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tconst data = {\n\t\t\t\t...newRoleInDB,\n\t\t\t\tpermission,\n\t\t\t} as OrganizationRole & ReturnAdditionalFields;\n\t\t\treturn ctx.json({\n\t\t\t\tsuccess: true,\n\t\t\t\troleData: data,\n\t\t\t\tstatements: newRole.statements,\n\t\t\t});\n\t\t},\n\t);\n};\n\nconst deleteOrgRoleBodySchema = z\n\t.object({\n\t\torganizationId: z.string().optional().meta({\n\t\t\tdescription:\n\t\t\t\t\"The id of the organization to create the role in. If not provided, the user's active organization will be used.\",\n\t\t}),\n\t})\n\t.and(\n\t\tz.union([\n\t\t\tz.object({\n\t\t\t\troleName: z.string().nonempty().meta({\n\t\t\t\t\tdescription: \"The name of the role to delete\",\n\t\t\t\t}),\n\t\t\t}),\n\t\t\tz.object({\n\t\t\t\troleId: z.string().nonempty().meta({\n\t\t\t\t\tdescription: \"The id of the role to delete\",\n\t\t\t\t}),\n\t\t\t}),\n\t\t]),\n\t);\n\nexport const deleteOrgRole = <O extends OrganizationOptions>(options: O) => {\n\treturn createAuthEndpoint(\n\t\t\"/organization/delete-role\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: deleteOrgRoleBodySchema,\n\t\t\trequireHeaders: true,\n\t\t\tuse: [orgSessionMiddleware],\n\t\t\tmetadata: {\n\t\t\t\t$Infer: {\n\t\t\t\t\tbody: {} as {\n\t\t\t\t\t\troleName?: string | undefined;\n\t\t\t\t\t\troleId?: string | undefined;\n\t\t\t\t\t\torganizationId?: string | undefined;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst { session, user } = ctx.context.session;\n\n\t\t\tconst organizationId =\n\t\t\t\tctx.body.organizationId ?? session.activeOrganizationId;\n\t\t\tif (!organizationId) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t`[Dynamic Access Control] The session is missing an active organization id to delete a role. Either set an active org id, or pass an organizationId in the request body.`,\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst member = await ctx.context.adapter.findOne<Member>({\n\t\t\t\tmodel: \"member\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\t\tvalue: organizationId,\n\t\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\t\tconnector: \"AND\",\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: user.id,\n\t\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\t\tconnector: \"AND\",\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\tif (!member) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t`[Dynamic Access Control] The user is not a member of the organization to delete a role.`,\n\t\t\t\t\t{\n\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\torganizationId,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_A_MEMBER_OF_THIS_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst canDeleteRole = await hasPermission(\n\t\t\t\t{\n\t\t\t\t\toptions,\n\t\t\t\t\torganizationId,\n\t\t\t\t\tpermissions: {\n\t\t\t\t\t\tac: [\"delete\"],\n\t\t\t\t\t},\n\t\t\t\t\trole: member.role,\n\t\t\t\t},\n\t\t\t\tctx,\n\t\t\t);\n\t\t\tif (!canDeleteRole) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t`[Dynamic Access Control] The user is not permitted to delete a role. If this is unexpected, please make sure the role associated to that member has the \"ac\" resource with the \"delete\" permission.`,\n\t\t\t\t\t{\n\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\torganizationId,\n\t\t\t\t\t\trole: member.role,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_DELETE_A_ROLE,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (ctx.body.roleName) {\n\t\t\t\tconst roleName = ctx.body.roleName;\n\t\t\t\tconst defaultRoles = options.roles\n\t\t\t\t\t? Object.keys(options.roles)\n\t\t\t\t\t: [\"owner\", \"admin\", \"member\"];\n\t\t\t\tif (defaultRoles.includes(roleName)) {\n\t\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t\t`[Dynamic Access Control] Cannot delete a pre-defined role.`,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\troleName,\n\t\t\t\t\t\t\torganizationId,\n\t\t\t\t\t\t\tdefaultRoles,\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.CANNOT_DELETE_A_PRE_DEFINED_ROLE,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet condition: Where;\n\t\t\tif (ctx.body.roleName) {\n\t\t\t\tcondition = {\n\t\t\t\t\tfield: \"role\",\n\t\t\t\t\tvalue: ctx.body.roleName,\n\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\tconnector: \"AND\",\n\t\t\t\t};\n\t\t\t} else if (ctx.body.roleId) {\n\t\t\t\tcondition = {\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tvalue: ctx.body.roleId,\n\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\tconnector: \"AND\",\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\t// shouldn't be able to reach here given the schema validation.\n\t\t\t\t// But just in case, throw an error.\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t`[Dynamic Access Control] The role name/id is not provided in the request body.`,\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ROLE_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst existingRoleInDB =\n\t\t\t\tawait ctx.context.adapter.findOne<OrganizationRole>({\n\t\t\t\t\tmodel: \"organizationRole\",\n\t\t\t\t\twhere: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\t\t\tvalue: organizationId,\n\t\t\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\t\t\tconnector: \"AND\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcondition,\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\tif (!existingRoleInDB) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t`[Dynamic Access Control] The role name/id does not exist in the database.`,\n\t\t\t\t\t{\n\t\t\t\t\t\t...(\"roleName\" in ctx.body\n\t\t\t\t\t\t\t? { roleName: ctx.body.roleName }\n\t\t\t\t\t\t\t: { roleId: ctx.body.roleId }),\n\t\t\t\t\t\torganizationId,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ROLE_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\texistingRoleInDB.permission = JSON.parse(\n\t\t\t\texistingRoleInDB.permission as never as string,\n\t\t\t);\n\n\t\t\tawait ctx.context.adapter.delete({\n\t\t\t\tmodel: \"organizationRole\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\t\tvalue: organizationId,\n\t\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\t\tconnector: \"AND\",\n\t\t\t\t\t},\n\t\t\t\t\tcondition,\n\t\t\t\t],\n\t\t\t});\n\n\t\t\treturn ctx.json({\n\t\t\t\tsuccess: true,\n\t\t\t});\n\t\t},\n\t);\n};\n\nconst listOrgRolesQuerySchema = z\n\t.object({\n\t\torganizationId: z.string().optional().meta({\n\t\t\tdescription:\n\t\t\t\t\"The id of the organization to list roles for. If not provided, the user's active organization will be used.\",\n\t\t}),\n\t})\n\t.optional();\n\nexport const listOrgRoles = <O extends OrganizationOptions>(options: O) => {\n\tconst { $ReturnAdditionalFields } = getAdditionalFields<O>(options, false);\n\ttype ReturnAdditionalFields = typeof $ReturnAdditionalFields;\n\n\treturn createAuthEndpoint(\n\t\t\"/organization/list-roles\",\n\t\t{\n\t\t\tmethod: \"GET\",\n\t\t\trequireHeaders: true,\n\t\t\tuse: [orgSessionMiddleware],\n\t\t\tquery: listOrgRolesQuerySchema,\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst { session, user } = ctx.context.session;\n\n\t\t\tconst organizationId =\n\t\t\t\tctx.query?.organizationId ?? session.activeOrganizationId;\n\t\t\tif (!organizationId) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t`[Dynamic Access Control] The session is missing an active organization id to list roles. Either set an active org id, or pass an organizationId in the request query.`,\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst member = await ctx.context.adapter.findOne<Member>({\n\t\t\t\tmodel: \"member\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\t\tvalue: organizationId,\n\t\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\t\tconnector: \"AND\",\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: user.id,\n\t\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\t\tconnector: \"AND\",\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\tif (!member) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t`[Dynamic Access Control] The user is not a member of the organization to list roles.`,\n\t\t\t\t\t{\n\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\torganizationId,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_A_MEMBER_OF_THIS_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst canListRoles = await hasPermission(\n\t\t\t\t{\n\t\t\t\t\toptions,\n\t\t\t\t\torganizationId,\n\t\t\t\t\tpermissions: {\n\t\t\t\t\t\tac: [\"read\"],\n\t\t\t\t\t},\n\t\t\t\t\trole: member.role,\n\t\t\t\t},\n\t\t\t\tctx,\n\t\t\t);\n\t\t\tif (!canListRoles) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t`[Dynamic Access Control] The user is not permitted to list roles.`,\n\t\t\t\t\t{\n\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\torganizationId,\n\t\t\t\t\t\trole: member.role,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_LIST_A_ROLE,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tlet roles = await ctx.context.adapter.findMany<\n\t\t\t\tOrganizationRole & ReturnAdditionalFields\n\t\t\t>({\n\t\t\t\tmodel: \"organizationRole\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\t\tvalue: organizationId,\n\t\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\t\tconnector: \"AND\",\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\n\t\t\troles = roles.map((x) => ({\n\t\t\t\t...x,\n\t\t\t\tpermission: JSON.parse(x.permission as never as string),\n\t\t\t}));\n\n\t\t\treturn ctx.json(roles);\n\t\t},\n\t);\n};\n\nconst getOrgRoleQuerySchema = z\n\t.object({\n\t\torganizationId: z.string().optional().meta({\n\t\t\tdescription:\n\t\t\t\t\"The id of the organization to read a role for. If not provided, the user's active organization will be used.\",\n\t\t}),\n\t})\n\t.and(\n\t\tz.union([\n\t\t\tz.object({\n\t\t\t\troleName: z.string().nonempty().meta({\n\t\t\t\t\tdescription: \"The name of the role to read\",\n\t\t\t\t}),\n\t\t\t}),\n\t\t\tz.object({\n\t\t\t\troleId: z.string().nonempty().meta({\n\t\t\t\t\tdescription: \"The id of the role to read\",\n\t\t\t\t}),\n\t\t\t}),\n\t\t]),\n\t)\n\t.optional();\n\nexport const getOrgRole = <O extends OrganizationOptions>(options: O) => {\n\tconst { $ReturnAdditionalFields } = getAdditionalFields<O>(options, false);\n\ttype ReturnAdditionalFields = typeof $ReturnAdditionalFields;\n\treturn createAuthEndpoint(\n\t\t\"/organization/get-role\",\n\t\t{\n\t\t\tmethod: \"GET\",\n\t\t\trequireHeaders: true,\n\t\t\tuse: [orgSessionMiddleware],\n\t\t\tquery: getOrgRoleQuerySchema,\n\t\t\tmetadata: {\n\t\t\t\t$Infer: {\n\t\t\t\t\tquery: {} as {\n\t\t\t\t\t\torganizationId?: string | undefined;\n\t\t\t\t\t\troleName?: string | undefined;\n\t\t\t\t\t\troleId?: string | undefined;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst { session, user } = ctx.context.session;\n\n\t\t\tconst organizationId =\n\t\t\t\tctx.query?.organizationId ?? session.activeOrganizationId;\n\t\t\tif (!organizationId) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t`[Dynamic Access Control] The session is missing an active organization id to read a role. Either set an active org id, or pass an organizationId in the request query.`,\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst member = await ctx.context.adapter.findOne<Member>({\n\t\t\t\tmodel: \"member\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\t\tvalue: organizationId,\n\t\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\t\tconnector: \"AND\",\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: user.id,\n\t\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\t\tconnector: \"AND\",\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\tif (!member) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t`[Dynamic Access Control] The user is not a member of the organization to read a role.`,\n\t\t\t\t\t{\n\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\torganizationId,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_A_MEMBER_OF_THIS_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst canListRoles = await hasPermission(\n\t\t\t\t{\n\t\t\t\t\toptions,\n\t\t\t\t\torganizationId,\n\t\t\t\t\tpermissions: {\n\t\t\t\t\t\tac: [\"read\"],\n\t\t\t\t\t},\n\t\t\t\t\trole: member.role,\n\t\t\t\t},\n\t\t\t\tctx,\n\t\t\t);\n\t\t\tif (!canListRoles) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t`[Dynamic Access Control] The user is not permitted to read a role.`,\n\t\t\t\t\t{\n\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\torganizationId,\n\t\t\t\t\t\trole: member.role,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_READ_A_ROLE,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tlet condition: Where;\n\t\t\tif (ctx.query.roleName) {\n\t\t\t\tcondition = {\n\t\t\t\t\tfield: \"role\",\n\t\t\t\t\tvalue: ctx.query.roleName,\n\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\tconnector: \"AND\",\n\t\t\t\t};\n\t\t\t} else if (ctx.query.roleId) {\n\t\t\t\tcondition = {\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tvalue: ctx.query.roleId,\n\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\tconnector: \"AND\",\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\t// shouldn't be able to reach here given the schema validation.\n\t\t\t\t// But just in case, throw an error.\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t`[Dynamic Access Control] The role name/id is not provided in the request query.`,\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ROLE_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst role = await ctx.context.adapter.findOne<OrganizationRole>({\n\t\t\t\tmodel: \"organizationRole\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\t\tvalue: organizationId,\n\t\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\t\tconnector: \"AND\",\n\t\t\t\t\t},\n\t\t\t\t\tcondition,\n\t\t\t\t],\n\t\t\t});\n\t\t\tif (!role) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t`[Dynamic Access Control] The role name/id does not exist in the database.`,\n\t\t\t\t\t{\n\t\t\t\t\t\t...(\"roleName\" in ctx.query\n\t\t\t\t\t\t\t? { roleName: ctx.query.roleName }\n\t\t\t\t\t\t\t: { roleId: ctx.query.roleId }),\n\t\t\t\t\t\torganizationId,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ROLE_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\trole.permission = JSON.parse(role.permission as never as string);\n\n\t\t\treturn ctx.json(role as OrganizationRole & ReturnAdditionalFields);\n\t\t},\n\t);\n};\n\nconst roleNameOrIdSchema = z.union([\n\tz.object({\n\t\troleName: z.string().nonempty().meta({\n\t\t\tdescription: \"The name of the role to update\",\n\t\t}),\n\t}),\n\tz.object({\n\t\troleId: z.string().nonempty().meta({\n\t\t\tdescription: \"The id of the role to update\",\n\t\t}),\n\t}),\n]);\n\nexport const updateOrgRole = <O extends OrganizationOptions>(options: O) => {\n\tconst { additionalFieldsSchema, $AdditionalFields, $ReturnAdditionalFields } =\n\t\tgetAdditionalFields<O, true>(options, true);\n\ttype AdditionalFields = typeof $AdditionalFields;\n\ttype ReturnAdditionalFields = typeof $ReturnAdditionalFields;\n\n\treturn createAuthEndpoint(\n\t\t\"/organization/update-role\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: z\n\t\t\t\t.object({\n\t\t\t\t\torganizationId: z.string().optional().meta({\n\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\"The id of the organization to update the role in. If not provided, the user's active organization will be used.\",\n\t\t\t\t\t}),\n\t\t\t\t\tdata: z.object({\n\t\t\t\t\t\tpermission: z\n\t\t\t\t\t\t\t.record(z.string(), z.array(z.string()))\n\t\t\t\t\t\t\t.optional()\n\t\t\t\t\t\t\t.meta({\n\t\t\t\t\t\t\t\tdescription: \"The permission to update the role with\",\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\troleName: z.string().optional().meta({\n\t\t\t\t\t\t\tdescription: \"The name of the role to update\",\n\t\t\t\t\t\t}),\n\t\t\t\t\t\t...additionalFieldsSchema.shape,\n\t\t\t\t\t}),\n\t\t\t\t})\n\t\t\t\t.and(roleNameOrIdSchema),\n\t\t\tmetadata: {\n\t\t\t\t$Infer: {\n\t\t\t\t\tbody: {} as {\n\t\t\t\t\t\torganizationId?: string | undefined;\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tpermission?: Record<string, string[]> | undefined;\n\t\t\t\t\t\t\troleName?: string | undefined;\n\t\t\t\t\t\t} & AdditionalFields;\n\t\t\t\t\t\troleName?: string | undefined;\n\t\t\t\t\t\troleId?: string | undefined;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\trequireHeaders: true,\n\t\t\tuse: [orgSessionMiddleware],\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst { session, user } = ctx.context.session;\n\n\t\t\tconst ac = options.ac;\n\t\t\tif (!ac) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t`[Dynamic Access Control] The organization plugin is missing a pre-defined ac instance.`,\n\t\t\t\t\t`\\nPlease refer to the documentation here: https://better-auth.com/docs/plugins/organization#dynamic-access-control`,\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"NOT_IMPLEMENTED\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.MISSING_AC_INSTANCE,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst organizationId =\n\t\t\t\tctx.body.organizationId ?? session.activeOrganizationId;\n\t\t\tif (!organizationId) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t`[Dynamic Access Control] The session is missing an active organization id to update a role. Either set an active org id, or pass an organizationId in the request body.`,\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst member = await ctx.context.adapter.findOne<Member>({\n\t\t\t\tmodel: \"member\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\t\tvalue: organizationId,\n\t\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\t\tconnector: \"AND\",\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"userId\",\n\t\t\t\t\t\tvalue: user.id,\n\t\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\t\tconnector: \"AND\",\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\t\t\tif (!member) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t`[Dynamic Access Control] The user is not a member of the organization to update a role.`,\n\t\t\t\t\t{\n\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\torganizationId,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_A_MEMBER_OF_THIS_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst canUpdateRole = await hasPermission(\n\t\t\t\t{\n\t\t\t\t\toptions,\n\t\t\t\t\torganizationId,\n\t\t\t\t\trole: member.role,\n\t\t\t\t\tpermissions: {\n\t\t\t\t\t\tac: [\"update\"],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tctx,\n\t\t\t);\n\t\t\tif (!canUpdateRole) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t`[Dynamic Access Control] The user is not permitted to update a role.`,\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_UPDATE_A_ROLE,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tlet condition: Where;\n\t\t\tif (ctx.body.roleName) {\n\t\t\t\tcondition = {\n\t\t\t\t\tfield: \"role\",\n\t\t\t\t\tvalue: ctx.body.roleName,\n\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\tconnector: \"AND\",\n\t\t\t\t};\n\t\t\t} else if (ctx.body.roleId) {\n\t\t\t\tcondition = {\n\t\t\t\t\tfield: \"id\",\n\t\t\t\t\tvalue: ctx.body.roleId,\n\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\tconnector: \"AND\",\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\t// shouldn't be able to reach here given the schema validation.\n\t\t\t\t// But just in case, throw an error.\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t`[Dynamic Access Control] The role name/id is not provided in the request body.`,\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ROLE_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst role = await ctx.context.adapter.findOne<OrganizationRole>({\n\t\t\t\tmodel: \"organizationRole\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\t\tvalue: organizationId,\n\t\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\t\tconnector: \"AND\",\n\t\t\t\t\t},\n\t\t\t\t\tcondition,\n\t\t\t\t],\n\t\t\t});\n\t\t\tif (!role) {\n\t\t\t\tctx.context.logger.error(\n\t\t\t\t\t`[Dynamic Access Control] The role name/id does not exist in the database.`,\n\t\t\t\t\t{\n\t\t\t\t\t\t...(\"roleName\" in ctx.body\n\t\t\t\t\t\t\t? { roleName: ctx.body.roleName }\n\t\t\t\t\t\t\t: { roleId: ctx.body.roleId }),\n\t\t\t\t\t\torganizationId,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ROLE_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\t\t\trole.permission = role.permission\n\t\t\t\t? JSON.parse(role.permission as never as string)\n\t\t\t\t: undefined;\n\n\t\t\tconst {\n\t\t\t\tpermission: _,\n\t\t\t\troleName: __,\n\t\t\t\t...additionalFields\n\t\t\t} = ctx.body.data;\n\n\t\t\tconst updateData: Partial<OrganizationRole> = {\n\t\t\t\t...additionalFields,\n\t\t\t};\n\n\t\t\tif (ctx.body.data.permission) {\n\t\t\t\tconst newPermission = ctx.body.data.permission;\n\n\t\t\t\tawait checkForInvalidResources({ ac, ctx, permission: newPermission });\n\n\t\t\t\tawait checkIfMemberHasPermission({\n\t\t\t\t\tctx,\n\t\t\t\t\tmember,\n\t\t\t\t\toptions,\n\t\t\t\t\torganizationId,\n\t\t\t\t\tpermissionRequired: newPermission,\n\t\t\t\t\tuser,\n\t\t\t\t\taction: \"update\",\n\t\t\t\t});\n\n\t\t\t\tupdateData.permission = newPermission;\n\t\t\t}\n\t\t\tif (ctx.body.data.roleName) {\n\t\t\t\tlet newRoleName = ctx.body.data.roleName;\n\n\t\t\t\tnewRoleName = normalizeRoleName(newRoleName);\n\n\t\t\t\tawait checkIfRoleNameIsTakenByPreDefinedRole({\n\t\t\t\t\trole: newRoleName,\n\t\t\t\t\torganizationId,\n\t\t\t\t\toptions,\n\t\t\t\t\tctx,\n\t\t\t\t});\n\t\t\t\tawait checkIfRoleNameIsTakenByRoleInDB({\n\t\t\t\t\trole: newRoleName,\n\t\t\t\t\torganizationId,\n\t\t\t\t\tctx,\n\t\t\t\t});\n\n\t\t\t\tupdateData.role = newRoleName;\n\t\t\t}\n\n\t\t\t// -----\n\t\t\t// Apply the updates\n\t\t\tconst update = {\n\t\t\t\t...updateData,\n\t\t\t\t...(updateData.permission\n\t\t\t\t\t? { permission: JSON.stringify(updateData.permission) }\n\t\t\t\t\t: {}),\n\t\t\t};\n\t\t\tawait ctx.context.adapter.update<OrganizationRole>({\n\t\t\t\tmodel: \"organizationRole\",\n\t\t\t\twhere: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\t\tvalue: organizationId,\n\t\t\t\t\t\toperator: \"eq\",\n\t\t\t\t\t\tconnector: \"AND\",\n\t\t\t\t\t},\n\t\t\t\t\tcondition,\n\t\t\t\t],\n\t\t\t\tupdate,\n\t\t\t});\n\n\t\t\t// -----\n\t\t\t// Return the updated role\n\t\t\treturn ctx.json({\n\t\t\t\tsuccess: true,\n\t\t\t\troleData: {\n\t\t\t\t\t...role,\n\t\t\t\t\t...update,\n\t\t\t\t\tpermission: updateData.permission || role.permission || null,\n\t\t\t\t} as OrganizationRole & ReturnAdditionalFields,\n\t\t\t});\n\t\t},\n\t);\n};\n\nasync function checkForInvalidResources({\n\tac,\n\tctx,\n\tpermission,\n}: {\n\tac: AccessControl;\n\tctx: GenericEndpointContext;\n\tpermission: Record<string, string[]>;\n}) {\n\tconst validResources = Object.keys(ac.statements);\n\tconst providedResources = Object.keys(permission);\n\tconst hasInvalidResource = providedResources.some(\n\t\t(r) => !validResources.includes(r),\n\t);\n\tif (hasInvalidResource) {\n\t\tctx.context.logger.error(\n\t\t\t`[Dynamic Access Control] The provided permission includes an invalid resource.`,\n\t\t\t{\n\t\t\t\tprovidedResources,\n\t\t\t\tvalidResources,\n\t\t\t},\n\t\t);\n\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\tmessage: ORGANIZATION_ERROR_CODES.INVALID_RESOURCE,\n\t\t});\n\t}\n}\n\nasync function checkIfMemberHasPermission({\n\tctx,\n\tpermissionRequired: permission,\n\toptions,\n\torganizationId,\n\tmember,\n\tuser,\n\taction,\n}: {\n\tctx: GenericEndpointContext;\n\tpermissionRequired: Record<string, string[]>;\n\toptions: OrganizationOptions;\n\torganizationId: string;\n\tmember: Member;\n\tuser: User;\n\taction: \"create\" | \"update\" | \"delete\" | \"read\" | \"list\" | \"get\";\n}) {\n\tconst hasNecessaryPermissions: {\n\t\tresource: { [x: string]: string[] };\n\t\thasPermission: boolean;\n\t}[] = [];\n\tconst permissionEntries = Object.entries(permission);\n\tfor await (const [resource, permissions] of permissionEntries) {\n\t\tfor await (const perm of permissions) {\n\t\t\thasNecessaryPermissions.push({\n\t\t\t\tresource: { [resource]: [perm] },\n\t\t\t\thasPermission: await hasPermission(\n\t\t\t\t\t{\n\t\t\t\t\t\toptions,\n\t\t\t\t\t\torganizationId,\n\t\t\t\t\t\tpermissions: { [resource]: [perm] },\n\t\t\t\t\t\tuseMemoryCache: true,\n\t\t\t\t\t\trole: member.role,\n\t\t\t\t\t},\n\t\t\t\t\tctx,\n\t\t\t\t),\n\t\t\t});\n\t\t}\n\t}\n\tconst missingPermissions = hasNecessaryPermissions\n\t\t.filter((x) => x.hasPermission === false)\n\t\t.map((x) => {\n\t\t\tconst key = Object.keys(x.resource)[0]!;\n\t\t\treturn `${key}:${x.resource[key]![0]}` as const;\n\t\t});\n\tif (missingPermissions.length > 0) {\n\t\tctx.context.logger.error(\n\t\t\t`[Dynamic Access Control] The user is missing permissions necessary to ${action} a role with those set of permissions.\\n`,\n\t\t\t{\n\t\t\t\tuserId: user.id,\n\t\t\t\torganizationId,\n\t\t\t\trole: member.role,\n\t\t\t\tmissingPermissions,\n\t\t\t},\n\t\t);\n\t\tlet errorMessage: string;\n\t\tif (action === \"create\")\n\t\t\terrorMessage =\n\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_CREATE_A_ROLE;\n\t\telse if (action === \"update\")\n\t\t\terrorMessage =\n\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_UPDATE_A_ROLE;\n\t\telse if (action === \"delete\")\n\t\t\terrorMessage =\n\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_DELETE_A_ROLE;\n\t\telse if (action === \"read\")\n\t\t\terrorMessage =\n\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_READ_A_ROLE;\n\t\telse if (action === \"list\")\n\t\t\terrorMessage =\n\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_LIST_A_ROLE;\n\t\telse\n\t\t\terrorMessage = ORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_GET_A_ROLE;\n\n\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\tmessage: errorMessage,\n\t\t\tmissingPermissions,\n\t\t});\n\t}\n}\n\nasync function checkIfRoleNameIsTakenByPreDefinedRole({\n\toptions,\n\torganizationId,\n\trole,\n\tctx,\n}: {\n\toptions: OrganizationOptions;\n\torganizationId: string;\n\trole: string;\n\tctx: GenericEndpointContext;\n}) {\n\tconst defaultRoles = options.roles\n\t\t? Object.keys(options.roles)\n\t\t: [\"owner\", \"admin\", \"member\"];\n\tif (defaultRoles.includes(role)) {\n\t\tctx.context.logger.error(\n\t\t\t`[Dynamic Access Control] The role name \"${role}\" is already taken by a pre-defined role.`,\n\t\t\t{\n\t\t\t\trole,\n\t\t\t\torganizationId,\n\t\t\t\tdefaultRoles,\n\t\t\t},\n\t\t);\n\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\tmessage: ORGANIZATION_ERROR_CODES.ROLE_NAME_IS_ALREADY_TAKEN,\n\t\t});\n\t}\n}\n\nasync function checkIfRoleNameIsTakenByRoleInDB({\n\torganizationId,\n\trole,\n\tctx,\n}: {\n\tctx: GenericEndpointContext;\n\torganizationId: string;\n\trole: string;\n}) {\n\tconst existingRoleInDB = await ctx.context.adapter.findOne<OrganizationRole>({\n\t\tmodel: \"organizationRole\",\n\t\twhere: [\n\t\t\t{\n\t\t\t\tfield: \"organizationId\",\n\t\t\t\tvalue: organizationId,\n\t\t\t\toperator: \"eq\",\n\t\t\t\tconnector: \"AND\",\n\t\t\t},\n\t\t\t{\n\t\t\t\tfield: \"role\",\n\t\t\t\tvalue: role,\n\t\t\t\toperator: \"eq\",\n\t\t\t\tconnector: \"AND\",\n\t\t\t},\n\t\t],\n\t});\n\tif (existingRoleInDB) {\n\t\tctx.context.logger.error(\n\t\t\t`[Dynamic Access Control] The role name \"${role}\" is already taken by a role in the database.`,\n\t\t\t{\n\t\t\t\trole,\n\t\t\t\torganizationId,\n\t\t\t},\n\t\t);\n\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\tmessage: ORGANIZATION_ERROR_CODES.ROLE_NAME_IS_ALREADY_TAKEN,\n\t\t});\n\t}\n}\n"],"names":["condition: Where","updateData: Partial<OrganizationRole>","hasNecessaryPermissions: {\n\t\tresource: { [x: string]: string[] };\n\t\thasPermission: boolean;\n\t}[]","errorMessage: string"],"mappings":"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"}},
    {"offset": {"line": 1989, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/organization/routes/crud-invites.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/organization/routes/crud-invites.ts"],"sourcesContent":["import { createAuthEndpoint } from \"@better-auth/core/api\";\nimport { BASE_ERROR_CODES } from \"@better-auth/core/error\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { getSessionFromCtx } from \"../../../api/routes\";\nimport { setSessionCookie } from \"../../../cookies\";\nimport type { InferAdditionalFieldsFromPluginOptions } from \"../../../db\";\nimport { toZodSchema } from \"../../../db\";\nimport { getDate } from \"../../../utils/date\";\nimport { defaultRoles } from \"../access/statement\";\nimport { getOrgAdapter } from \"../adapter\";\nimport { orgMiddleware, orgSessionMiddleware } from \"../call\";\nimport { ORGANIZATION_ERROR_CODES } from \"../error-codes\";\nimport { hasPermission } from \"../has-permission\";\nimport { parseRoles } from \"../organization\";\nimport type {\n\tInferInvitation,\n\tInferOrganizationRolesFromOption,\n\tInvitation,\n\tMember,\n} from \"../schema\";\nimport type { OrganizationOptions } from \"../types\";\n\nconst baseInvitationSchema = z.object({\n\temail: z.string().meta({\n\t\tdescription: \"The email address of the user to invite\",\n\t}),\n\trole: z\n\t\t.union([\n\t\t\tz.string().meta({\n\t\t\t\tdescription: \"The role to assign to the user\",\n\t\t\t}),\n\t\t\tz.array(\n\t\t\t\tz.string().meta({\n\t\t\t\t\tdescription: \"The roles to assign to the user\",\n\t\t\t\t}),\n\t\t\t),\n\t\t])\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The role(s) to assign to the user. It can be `admin`, `member`, owner. Eg: \"member\"',\n\t\t}),\n\torganizationId: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: \"The organization ID to invite the user to\",\n\t\t})\n\t\t.optional(),\n\tresend: z\n\t\t.boolean()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t\"Resend the invitation email, if the user is already invited. Eg: true\",\n\t\t})\n\t\t.optional(),\n\tteamId: z.union([\n\t\tz\n\t\t\t.string()\n\t\t\t.meta({\n\t\t\t\tdescription: \"The team ID to invite the user to\",\n\t\t\t})\n\t\t\t.optional(),\n\t\tz\n\t\t\t.array(z.string())\n\t\t\t.meta({\n\t\t\t\tdescription: \"The team IDs to invite the user to\",\n\t\t\t})\n\t\t\t.optional(),\n\t]),\n});\n\nexport const createInvitation = <O extends OrganizationOptions>(option: O) => {\n\tconst additionalFieldsSchema = toZodSchema({\n\t\tfields: option?.schema?.invitation?.additionalFields || {},\n\t\tisClientSide: true,\n\t});\n\n\treturn createAuthEndpoint(\n\t\t\"/organization/invite-member\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\trequireHeaders: true,\n\t\t\tuse: [orgMiddleware, orgSessionMiddleware],\n\t\t\tbody: z.object({\n\t\t\t\t...baseInvitationSchema.shape,\n\t\t\t\t...additionalFieldsSchema.shape,\n\t\t\t}),\n\t\t\tmetadata: {\n\t\t\t\t$Infer: {\n\t\t\t\t\tbody: {} as {\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * The email address of the user\n\t\t\t\t\t\t * to invite\n\t\t\t\t\t\t */\n\t\t\t\t\t\temail: string;\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * The role to assign to the user\n\t\t\t\t\t\t */\n\t\t\t\t\t\trole:\n\t\t\t\t\t\t\t| InferOrganizationRolesFromOption<O>\n\t\t\t\t\t\t\t| InferOrganizationRolesFromOption<O>[];\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * The organization ID to invite\n\t\t\t\t\t\t * the user to\n\t\t\t\t\t\t */\n\t\t\t\t\t\torganizationId?: string | undefined;\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * Resend the invitation email, if\n\t\t\t\t\t\t * the user is already invited\n\t\t\t\t\t\t */\n\t\t\t\t\t\tresend?: boolean | undefined;\n\t\t\t\t\t} & (O extends { teams: { enabled: true } }\n\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t\t * The team the user is\n\t\t\t\t\t\t\t\t * being invited to.\n\t\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\t\tteamId?: (string | string[]) | undefined;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t: {}) &\n\t\t\t\t\t\tInferAdditionalFieldsFromPluginOptions<\"invitation\", O, false>,\n\t\t\t\t},\n\t\t\t\topenapi: {\n\t\t\t\t\toperationId: \"createOrganizationInvitation\",\n\t\t\t\t\tdescription: \"Create an invitation to an organization\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\temail: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\trole: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\torganizationId: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tinviterId: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tstatus: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\texpiresAt: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\t\t\t\t\t\"email\",\n\t\t\t\t\t\t\t\t\t\t\t\"role\",\n\t\t\t\t\t\t\t\t\t\t\t\"organizationId\",\n\t\t\t\t\t\t\t\t\t\t\t\"inviterId\",\n\t\t\t\t\t\t\t\t\t\t\t\"status\",\n\t\t\t\t\t\t\t\t\t\t\t\"expiresAt\",\n\t\t\t\t\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = ctx.context.session;\n\t\t\tconst organizationId =\n\t\t\t\tctx.body.organizationId || session.session.activeOrganizationId;\n\t\t\tif (!organizationId) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst email = ctx.body.email.toLowerCase();\n\t\t\tconst isValidEmail = z.email().safeParse(email);\n\t\t\tif (!isValidEmail.success) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: BASE_ERROR_CODES.INVALID_EMAIL,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst adapter = getOrgAdapter<O>(ctx.context, option as O);\n\t\t\tconst member = await adapter.findMemberByOrgId({\n\t\t\t\tuserId: session.user.id,\n\t\t\t\torganizationId: organizationId,\n\t\t\t});\n\t\t\tif (!member) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.MEMBER_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst canInvite = await hasPermission(\n\t\t\t\t{\n\t\t\t\t\trole: member.role,\n\t\t\t\t\toptions: ctx.context.orgOptions,\n\t\t\t\t\tpermissions: {\n\t\t\t\t\t\tinvitation: [\"create\"],\n\t\t\t\t\t},\n\t\t\t\t\torganizationId,\n\t\t\t\t},\n\t\t\t\tctx,\n\t\t\t);\n\n\t\t\tif (!canInvite) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_INVITE_USERS_TO_THIS_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst creatorRole = ctx.context.orgOptions.creatorRole || \"owner\";\n\n\t\t\tconst roles = parseRoles(ctx.body.role);\n\n\t\t\tconst rolesArray = roles\n\t\t\t\t.split(\",\")\n\t\t\t\t.map((r) => r.trim())\n\t\t\t\t.filter(Boolean);\n\t\t\tconst defaults = Object.keys(defaultRoles);\n\t\t\tconst customRoles = Object.keys(ctx.context.orgOptions.roles || {});\n\t\t\tconst validStaticRoles = new Set([...defaults, ...customRoles]);\n\n\t\t\tconst unknownRoles = rolesArray.filter(\n\t\t\t\t(role) => !validStaticRoles.has(role),\n\t\t\t);\n\n\t\t\tif (unknownRoles.length > 0) {\n\t\t\t\tif (ctx.context.orgOptions.dynamicAccessControl?.enabled) {\n\t\t\t\t\tconst foundRoles = await ctx.context.adapter.findMany({\n\t\t\t\t\t\tmodel: \"organizationRole\",\n\t\t\t\t\t\twhere: [\n\t\t\t\t\t\t\t{ field: \"organizationId\", value: organizationId },\n\t\t\t\t\t\t\t{ field: \"role\", value: unknownRoles, operator: \"in\" },\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\t\t\t\t\tconst foundRoleNames = foundRoles.map((r: any) => r.role);\n\t\t\t\t\tconst stillInvalid = unknownRoles.filter(\n\t\t\t\t\t\t(r) => !foundRoleNames.includes(r),\n\t\t\t\t\t);\n\n\t\t\t\t\tif (stillInvalid.length > 0) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage: `${ORGANIZATION_ERROR_CODES.ROLE_NOT_FOUND}: ${stillInvalid.join(\", \")}`,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\tmessage: `${ORGANIZATION_ERROR_CODES.ROLE_NOT_FOUND}: ${unknownRoles.join(\", \")}`,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tmember.role !== creatorRole &&\n\t\t\t\troles.split(\",\").includes(creatorRole)\n\t\t\t) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_INVITE_USER_WITH_THIS_ROLE,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst alreadyMember = await adapter.findMemberByEmail({\n\t\t\t\temail: email,\n\t\t\t\torganizationId: organizationId,\n\t\t\t});\n\t\t\tif (alreadyMember) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.USER_IS_ALREADY_A_MEMBER_OF_THIS_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst alreadyInvited = await adapter.findPendingInvitation({\n\t\t\t\temail: email,\n\t\t\t\torganizationId: organizationId,\n\t\t\t});\n\t\t\tif (alreadyInvited.length && !ctx.body.resend) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.USER_IS_ALREADY_INVITED_TO_THIS_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst organization = await adapter.findOrganizationById(organizationId);\n\t\t\tif (!organization) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// If resend is true and there's an existing invitation, reuse it\n\t\t\tif (alreadyInvited.length && ctx.body.resend) {\n\t\t\t\tconst existingInvitation = alreadyInvited[0];\n\n\t\t\t\t// Update the invitation's expiration date using the same logic as createInvitation\n\t\t\t\tconst defaultExpiration = 60 * 60 * 48; // 48 hours in seconds\n\t\t\t\tconst newExpiresAt = getDate(\n\t\t\t\t\tctx.context.orgOptions.invitationExpiresIn || defaultExpiration,\n\t\t\t\t\t\"sec\",\n\t\t\t\t);\n\n\t\t\t\tawait ctx.context.adapter.update({\n\t\t\t\t\tmodel: \"invitation\",\n\t\t\t\t\twhere: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\t\tvalue: existingInvitation!.id,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t\tupdate: {\n\t\t\t\t\t\texpiresAt: newExpiresAt,\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tconst updatedInvitation = {\n\t\t\t\t\t...existingInvitation,\n\t\t\t\t\texpiresAt: newExpiresAt,\n\t\t\t\t};\n\n\t\t\t\tif (ctx.context.orgOptions.sendInvitationEmail) {\n\t\t\t\t\tawait ctx.context.runInBackgroundOrAwait(\n\t\t\t\t\t\tctx.context.orgOptions.sendInvitationEmail(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tid: updatedInvitation.id!,\n\t\t\t\t\t\t\t\trole: updatedInvitation.role! as string,\n\t\t\t\t\t\t\t\temail: updatedInvitation.email!.toLowerCase(),\n\t\t\t\t\t\t\t\torganization: organization,\n\t\t\t\t\t\t\t\tinviter: {\n\t\t\t\t\t\t\t\t\t...member,\n\t\t\t\t\t\t\t\t\tuser: session.user,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tinvitation: updatedInvitation as unknown as Invitation,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tctx.request,\n\t\t\t\t\t\t),\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\treturn ctx.json(updatedInvitation as unknown as InferInvitation<O>);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\talreadyInvited.length &&\n\t\t\t\tctx.context.orgOptions.cancelPendingInvitationsOnReInvite\n\t\t\t) {\n\t\t\t\tawait adapter.updateInvitation({\n\t\t\t\t\tinvitationId: alreadyInvited[0]!.id,\n\t\t\t\t\tstatus: \"canceled\",\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst invitationLimit =\n\t\t\t\ttypeof ctx.context.orgOptions.invitationLimit === \"function\"\n\t\t\t\t\t? await ctx.context.orgOptions.invitationLimit(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tuser: session.user,\n\t\t\t\t\t\t\t\torganization,\n\t\t\t\t\t\t\t\tmember: member as Member,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tctx.context,\n\t\t\t\t\t\t)\n\t\t\t\t\t: (ctx.context.orgOptions.invitationLimit ?? 100);\n\n\t\t\tconst pendingInvitations = await adapter.findPendingInvitations({\n\t\t\t\torganizationId: organizationId,\n\t\t\t});\n\n\t\t\tif (pendingInvitations.length >= invitationLimit) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.INVITATION_LIMIT_REACHED,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tctx.context.orgOptions.teams &&\n\t\t\t\tctx.context.orgOptions.teams.enabled &&\n\t\t\t\ttypeof ctx.context.orgOptions.teams.maximumMembersPerTeam !==\n\t\t\t\t\t\"undefined\" &&\n\t\t\t\t\"teamId\" in ctx.body &&\n\t\t\t\tctx.body.teamId\n\t\t\t) {\n\t\t\t\tconst teamIds =\n\t\t\t\t\ttypeof ctx.body.teamId === \"string\"\n\t\t\t\t\t\t? [ctx.body.teamId as string]\n\t\t\t\t\t\t: (ctx.body.teamId as string[]);\n\n\t\t\t\tfor (const teamId of teamIds) {\n\t\t\t\t\tconst team = await adapter.findTeamById({\n\t\t\t\t\t\tteamId,\n\t\t\t\t\t\torganizationId: organizationId,\n\t\t\t\t\t\tincludeTeamMembers: true,\n\t\t\t\t\t});\n\n\t\t\t\t\tif (!team) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.TEAM_NOT_FOUND,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tconst maximumMembersPerTeam =\n\t\t\t\t\t\ttypeof ctx.context.orgOptions.teams.maximumMembersPerTeam ===\n\t\t\t\t\t\t\"function\"\n\t\t\t\t\t\t\t? await ctx.context.orgOptions.teams.maximumMembersPerTeam({\n\t\t\t\t\t\t\t\t\tteamId,\n\t\t\t\t\t\t\t\t\tsession: session,\n\t\t\t\t\t\t\t\t\torganizationId: organizationId,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t: ctx.context.orgOptions.teams.maximumMembersPerTeam;\n\t\t\t\t\tif (team.members.length >= maximumMembersPerTeam) {\n\t\t\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.TEAM_MEMBER_LIMIT_REACHED,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst teamIds: string[] =\n\t\t\t\t\"teamId\" in ctx.body\n\t\t\t\t\t? typeof ctx.body.teamId === \"string\"\n\t\t\t\t\t\t? [ctx.body.teamId as string]\n\t\t\t\t\t\t: ((ctx.body.teamId as string[]) ?? [])\n\t\t\t\t\t: [];\n\n\t\t\tconst {\n\t\t\t\temail: _,\n\t\t\t\trole: __,\n\t\t\t\torganizationId: ___,\n\t\t\t\tresend: ____,\n\t\t\t\t...additionalFields\n\t\t\t} = ctx.body;\n\n\t\t\tlet invitationData = {\n\t\t\t\trole: roles,\n\t\t\t\temail: email,\n\t\t\t\torganizationId: organizationId,\n\t\t\t\tteamIds,\n\t\t\t\t...(additionalFields ? additionalFields : {}),\n\t\t\t};\n\n\t\t\t// Run beforeCreateInvitation hook\n\t\t\tif (option?.organizationHooks?.beforeCreateInvitation) {\n\t\t\t\tconst response = await option?.organizationHooks.beforeCreateInvitation(\n\t\t\t\t\t{\n\t\t\t\t\t\tinvitation: {\n\t\t\t\t\t\t\t...invitationData,\n\t\t\t\t\t\t\tinviterId: session.user.id,\n\t\t\t\t\t\t\tteamId: teamIds.length > 0 ? teamIds[0] : undefined,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tinviter: session.user,\n\t\t\t\t\t\torganization,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tif (response && typeof response === \"object\" && \"data\" in response) {\n\t\t\t\t\tinvitationData = {\n\t\t\t\t\t\t...invitationData,\n\t\t\t\t\t\t...response.data,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst invitation = await adapter.createInvitation({\n\t\t\t\tinvitation: invitationData,\n\t\t\t\tuser: session.user,\n\t\t\t});\n\n\t\t\tif (ctx.context.orgOptions.sendInvitationEmail) {\n\t\t\t\tawait ctx.context.runInBackgroundOrAwait(\n\t\t\t\t\tctx.context.orgOptions.sendInvitationEmail(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: invitation.id,\n\t\t\t\t\t\t\trole: invitation.role,\n\t\t\t\t\t\t\temail: invitation.email.toLowerCase(),\n\t\t\t\t\t\t\torganization: organization,\n\t\t\t\t\t\t\tinviter: {\n\t\t\t\t\t\t\t\t...(member as Member),\n\t\t\t\t\t\t\t\tuser: session.user,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tinvitation,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tctx.request,\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Run afterCreateInvitation hook\n\t\t\tif (option?.organizationHooks?.afterCreateInvitation) {\n\t\t\t\tawait option?.organizationHooks.afterCreateInvitation({\n\t\t\t\t\tinvitation: invitation as unknown as Invitation,\n\t\t\t\t\tinviter: session.user,\n\t\t\t\t\torganization,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn ctx.json(invitation);\n\t\t},\n\t);\n};\n\nconst acceptInvitationBodySchema = z.object({\n\tinvitationId: z.string().meta({\n\t\tdescription: \"The ID of the invitation to accept\",\n\t}),\n});\n\nexport const acceptInvitation = <O extends OrganizationOptions>(options: O) =>\n\tcreateAuthEndpoint(\n\t\t\"/organization/accept-invitation\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: acceptInvitationBodySchema,\n\t\t\trequireHeaders: true,\n\t\t\tuse: [orgMiddleware, orgSessionMiddleware],\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"Accept an invitation to an organization\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tinvitation: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tmember: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = ctx.context.session;\n\t\t\tconst adapter = getOrgAdapter<O>(ctx.context, options);\n\t\t\tconst invitation = await adapter.findInvitationById(\n\t\t\t\tctx.body.invitationId,\n\t\t\t);\n\n\t\t\tif (\n\t\t\t\t!invitation ||\n\t\t\t\tinvitation.expiresAt < new Date() ||\n\t\t\t\tinvitation.status !== \"pending\"\n\t\t\t) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.INVITATION_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (invitation.email.toLowerCase() !== session.user.email.toLowerCase()) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_THE_RECIPIENT_OF_THE_INVITATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tctx.context.orgOptions.requireEmailVerificationOnInvitation &&\n\t\t\t\t!session.user.emailVerified\n\t\t\t) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.EMAIL_VERIFICATION_REQUIRED_BEFORE_ACCEPTING_OR_REJECTING_INVITATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst membershipLimit = ctx.context.orgOptions?.membershipLimit || 100;\n\t\t\tconst membersCount = await adapter.countMembers({\n\t\t\t\torganizationId: invitation.organizationId,\n\t\t\t});\n\n\t\t\tif (membersCount >= membershipLimit) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.ORGANIZATION_MEMBERSHIP_LIMIT_REACHED,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst organization = await adapter.findOrganizationById(\n\t\t\t\tinvitation.organizationId,\n\t\t\t);\n\t\t\tif (!organization) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Run beforeAcceptInvitation hook\n\t\t\tif (options?.organizationHooks?.beforeAcceptInvitation) {\n\t\t\t\tawait options?.organizationHooks.beforeAcceptInvitation({\n\t\t\t\t\tinvitation: invitation as unknown as Invitation,\n\t\t\t\t\tuser: session.user,\n\t\t\t\t\torganization,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst acceptedI = await adapter.updateInvitation({\n\t\t\t\tinvitationId: ctx.body.invitationId,\n\t\t\t\tstatus: \"accepted\",\n\t\t\t});\n\t\t\tif (!acceptedI) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.FAILED_TO_RETRIEVE_INVITATION,\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (\n\t\t\t\tctx.context.orgOptions.teams &&\n\t\t\t\tctx.context.orgOptions.teams.enabled &&\n\t\t\t\t\"teamId\" in acceptedI &&\n\t\t\t\tacceptedI.teamId\n\t\t\t) {\n\t\t\t\tconst teamIds = (acceptedI.teamId as string).split(\",\");\n\t\t\t\tconst onlyOne = teamIds.length === 1;\n\n\t\t\t\tfor (const teamId of teamIds) {\n\t\t\t\t\tawait adapter.findOrCreateTeamMember({\n\t\t\t\t\t\tteamId: teamId,\n\t\t\t\t\t\tuserId: session.user.id,\n\t\t\t\t\t});\n\n\t\t\t\t\tif (\n\t\t\t\t\t\ttypeof ctx.context.orgOptions.teams.maximumMembersPerTeam !==\n\t\t\t\t\t\t\"undefined\"\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst members = await adapter.countTeamMembers({ teamId });\n\n\t\t\t\t\t\tconst maximumMembersPerTeam =\n\t\t\t\t\t\t\ttypeof ctx.context.orgOptions.teams.maximumMembersPerTeam ===\n\t\t\t\t\t\t\t\"function\"\n\t\t\t\t\t\t\t\t? await ctx.context.orgOptions.teams.maximumMembersPerTeam({\n\t\t\t\t\t\t\t\t\t\tteamId,\n\t\t\t\t\t\t\t\t\t\tsession: session,\n\t\t\t\t\t\t\t\t\t\torganizationId: invitation.organizationId,\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t: ctx.context.orgOptions.teams.maximumMembersPerTeam;\n\n\t\t\t\t\t\tif (members >= maximumMembersPerTeam) {\n\t\t\t\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.TEAM_MEMBER_LIMIT_REACHED,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (onlyOne) {\n\t\t\t\t\tconst teamId = teamIds[0]!;\n\t\t\t\t\tconst updatedSession = await adapter.setActiveTeam(\n\t\t\t\t\t\tsession.session.token,\n\t\t\t\t\t\tteamId,\n\t\t\t\t\t\tctx,\n\t\t\t\t\t);\n\n\t\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\t\tsession: updatedSession,\n\t\t\t\t\t\tuser: session.user,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst member = await adapter.createMember({\n\t\t\t\torganizationId: invitation.organizationId,\n\t\t\t\tuserId: session.user.id,\n\t\t\t\trole: invitation.role,\n\t\t\t\tcreatedAt: new Date(),\n\t\t\t});\n\n\t\t\tawait adapter.setActiveOrganization(\n\t\t\t\tsession.session.token,\n\t\t\t\tinvitation.organizationId,\n\t\t\t\tctx,\n\t\t\t);\n\t\t\tif (!acceptedI) {\n\t\t\t\treturn ctx.json(null, {\n\t\t\t\t\tstatus: 400,\n\t\t\t\t\tbody: {\n\t\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.INVITATION_NOT_FOUND,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (options?.organizationHooks?.afterAcceptInvitation) {\n\t\t\t\tawait options?.organizationHooks.afterAcceptInvitation({\n\t\t\t\t\tinvitation: acceptedI as unknown as Invitation,\n\t\t\t\t\tmember,\n\t\t\t\t\tuser: session.user,\n\t\t\t\t\torganization,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn ctx.json({\n\t\t\t\tinvitation: acceptedI,\n\t\t\t\tmember,\n\t\t\t});\n\t\t},\n\t);\n\nconst rejectInvitationBodySchema = z.object({\n\tinvitationId: z.string().meta({\n\t\tdescription: \"The ID of the invitation to reject\",\n\t}),\n});\n\nexport const rejectInvitation = <O extends OrganizationOptions>(options: O) =>\n\tcreateAuthEndpoint(\n\t\t\"/organization/reject-invitation\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: rejectInvitationBodySchema,\n\t\t\trequireHeaders: true,\n\t\t\tuse: [orgMiddleware, orgSessionMiddleware],\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"Reject an invitation to an organization\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tinvitation: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tmember: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = ctx.context.session;\n\t\t\tconst adapter = getOrgAdapter(ctx.context, ctx.context.orgOptions);\n\t\t\tconst invitation = await adapter.findInvitationById(\n\t\t\t\tctx.body.invitationId,\n\t\t\t);\n\t\t\tif (!invitation || invitation.status !== \"pending\") {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: \"Invitation not found!\",\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (invitation.email.toLowerCase() !== session.user.email.toLowerCase()) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_THE_RECIPIENT_OF_THE_INVITATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tctx.context.orgOptions.requireEmailVerificationOnInvitation &&\n\t\t\t\t!session.user.emailVerified\n\t\t\t) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.EMAIL_VERIFICATION_REQUIRED_BEFORE_ACCEPTING_OR_REJECTING_INVITATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst organization = await adapter.findOrganizationById(\n\t\t\t\tinvitation.organizationId,\n\t\t\t);\n\t\t\tif (!organization) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Run beforeRejectInvitation hook\n\t\t\tif (options?.organizationHooks?.beforeRejectInvitation) {\n\t\t\t\tawait options?.organizationHooks.beforeRejectInvitation({\n\t\t\t\t\tinvitation: invitation as unknown as Invitation,\n\t\t\t\t\tuser: session.user,\n\t\t\t\t\torganization,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst rejectedI = await adapter.updateInvitation({\n\t\t\t\tinvitationId: ctx.body.invitationId,\n\t\t\t\tstatus: \"rejected\",\n\t\t\t});\n\n\t\t\t// Run afterRejectInvitation hook\n\t\t\tif (options?.organizationHooks?.afterRejectInvitation) {\n\t\t\t\tawait options?.organizationHooks.afterRejectInvitation({\n\t\t\t\t\tinvitation: rejectedI || (invitation as unknown as Invitation),\n\t\t\t\t\tuser: session.user,\n\t\t\t\t\torganization,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn ctx.json({\n\t\t\t\tinvitation: rejectedI,\n\t\t\t\tmember: null,\n\t\t\t});\n\t\t},\n\t);\n\nconst cancelInvitationBodySchema = z.object({\n\tinvitationId: z.string().meta({\n\t\tdescription: \"The ID of the invitation to cancel\",\n\t}),\n});\n\nexport const cancelInvitation = <O extends OrganizationOptions>(options: O) =>\n\tcreateAuthEndpoint(\n\t\t\"/organization/cancel-invitation\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: cancelInvitationBodySchema,\n\t\t\trequireHeaders: true,\n\t\t\tuse: [orgMiddleware, orgSessionMiddleware],\n\t\t\topenapi: {\n\t\t\t\toperationId: \"cancelOrganizationInvitation\",\n\t\t\t\tdescription: \"Cancel an invitation to an organization\",\n\t\t\t\tresponses: {\n\t\t\t\t\t\"200\": {\n\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\tinvitation: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = ctx.context.session;\n\t\t\tconst adapter = getOrgAdapter<O>(ctx.context, options);\n\t\t\tconst invitation = await adapter.findInvitationById(\n\t\t\t\tctx.body.invitationId,\n\t\t\t);\n\t\t\tif (!invitation) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.INVITATION_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst member = await adapter.findMemberByOrgId({\n\t\t\t\tuserId: session.user.id,\n\t\t\t\torganizationId: invitation.organizationId,\n\t\t\t});\n\t\t\tif (!member) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.MEMBER_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst canCancel = await hasPermission(\n\t\t\t\t{\n\t\t\t\t\trole: member.role,\n\t\t\t\t\toptions: ctx.context.orgOptions,\n\t\t\t\t\tpermissions: {\n\t\t\t\t\t\tinvitation: [\"cancel\"],\n\t\t\t\t\t},\n\t\t\t\t\torganizationId: invitation.organizationId,\n\t\t\t\t},\n\t\t\t\tctx,\n\t\t\t);\n\n\t\t\tif (!canCancel) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_CANCEL_THIS_INVITATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst organization = await adapter.findOrganizationById(\n\t\t\t\tinvitation.organizationId,\n\t\t\t);\n\t\t\tif (!organization) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Run beforeCancelInvitation hook\n\t\t\tif (options?.organizationHooks?.beforeCancelInvitation) {\n\t\t\t\tawait options?.organizationHooks.beforeCancelInvitation({\n\t\t\t\t\tinvitation: invitation as unknown as Invitation,\n\t\t\t\t\tcancelledBy: session.user,\n\t\t\t\t\torganization,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst canceledI = await adapter.updateInvitation({\n\t\t\t\tinvitationId: ctx.body.invitationId,\n\t\t\t\tstatus: \"canceled\",\n\t\t\t});\n\n\t\t\t// Run afterCancelInvitation hook\n\t\t\tif (options?.organizationHooks?.afterCancelInvitation) {\n\t\t\t\tawait options?.organizationHooks.afterCancelInvitation({\n\t\t\t\t\tinvitation: (canceledI as unknown as Invitation) || invitation,\n\t\t\t\t\tcancelledBy: session.user,\n\t\t\t\t\torganization,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn ctx.json(canceledI);\n\t\t},\n\t);\n\nconst getInvitationQuerySchema = z.object({\n\tid: z.string().meta({\n\t\tdescription: \"The ID of the invitation to get\",\n\t}),\n});\n\nexport const getInvitation = <O extends OrganizationOptions>(options: O) =>\n\tcreateAuthEndpoint(\n\t\t\"/organization/get-invitation\",\n\t\t{\n\t\t\tmethod: \"GET\",\n\t\t\tuse: [orgMiddleware],\n\t\t\trequireHeaders: true,\n\t\t\tquery: getInvitationQuerySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"Get an invitation by ID\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\temail: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\trole: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\torganizationId: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tinviterId: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tstatus: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\texpiresAt: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\torganizationName: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\torganizationSlug: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tinviterEmail: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\t\t\t\t\t\"email\",\n\t\t\t\t\t\t\t\t\t\t\t\"role\",\n\t\t\t\t\t\t\t\t\t\t\t\"organizationId\",\n\t\t\t\t\t\t\t\t\t\t\t\"inviterId\",\n\t\t\t\t\t\t\t\t\t\t\t\"status\",\n\t\t\t\t\t\t\t\t\t\t\t\"expiresAt\",\n\t\t\t\t\t\t\t\t\t\t\t\"organizationName\",\n\t\t\t\t\t\t\t\t\t\t\t\"organizationSlug\",\n\t\t\t\t\t\t\t\t\t\t\t\"inviterEmail\",\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = await getSessionFromCtx(ctx);\n\t\t\tif (!session) {\n\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\tmessage: \"Not authenticated\",\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst adapter = getOrgAdapter<O>(ctx.context, options);\n\t\t\tconst invitation = await adapter.findInvitationById(ctx.query.id);\n\t\t\tif (\n\t\t\t\t!invitation ||\n\t\t\t\tinvitation.status !== \"pending\" ||\n\t\t\t\tinvitation.expiresAt < new Date()\n\t\t\t) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: \"Invitation not found!\",\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (invitation.email.toLowerCase() !== session.user.email.toLowerCase()) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_THE_RECIPIENT_OF_THE_INVITATION,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst organization = await adapter.findOrganizationById(\n\t\t\t\tinvitation.organizationId,\n\t\t\t);\n\t\t\tif (!organization) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst member = await adapter.findMemberByOrgId({\n\t\t\t\tuserId: invitation.inviterId,\n\t\t\t\torganizationId: invitation.organizationId,\n\t\t\t});\n\t\t\tif (!member) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.INVITER_IS_NO_LONGER_A_MEMBER_OF_THE_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn ctx.json({\n\t\t\t\t...invitation,\n\t\t\t\torganizationName: organization.name,\n\t\t\t\torganizationSlug: organization.slug,\n\t\t\t\tinviterEmail: member.user.email,\n\t\t\t});\n\t\t},\n\t);\n\nconst listInvitationQuerySchema = z\n\t.object({\n\t\torganizationId: z\n\t\t\t.string()\n\t\t\t.meta({\n\t\t\t\tdescription: \"The ID of the organization to list invitations for\",\n\t\t\t})\n\t\t\t.optional(),\n\t})\n\t.optional();\n\nexport const listInvitations = <O extends OrganizationOptions>(options: O) =>\n\tcreateAuthEndpoint(\n\t\t\"/organization/list-invitations\",\n\t\t{\n\t\t\tmethod: \"GET\",\n\t\t\trequireHeaders: true,\n\t\t\tuse: [orgMiddleware, orgSessionMiddleware],\n\t\t\tquery: listInvitationQuerySchema,\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = await getSessionFromCtx(ctx);\n\t\t\tif (!session) {\n\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\tmessage: \"Not authenticated\",\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst orgId =\n\t\t\t\tctx.query?.organizationId || session.session.activeOrganizationId;\n\t\t\tif (!orgId) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: \"Organization ID is required\",\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst adapter = getOrgAdapter<O>(ctx.context, options);\n\t\t\tconst isMember = await adapter.findMemberByOrgId({\n\t\t\t\tuserId: session.user.id,\n\t\t\t\torganizationId: orgId,\n\t\t\t});\n\t\t\tif (!isMember) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage: \"You are not a member of this organization\",\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst invitations = await adapter.listInvitations({\n\t\t\t\torganizationId: orgId,\n\t\t\t});\n\t\t\treturn ctx.json(invitations);\n\t\t},\n\t);\n\n/**\n * List all invitations a user has received\n */\nexport const listUserInvitations = <O extends OrganizationOptions>(\n\toptions: O,\n) =>\n\tcreateAuthEndpoint(\n\t\t\"/organization/list-user-invitations\",\n\t\t{\n\t\t\tmethod: \"GET\",\n\t\t\tuse: [orgMiddleware],\n\t\t\tquery: z\n\t\t\t\t.object({\n\t\t\t\t\temail: z\n\t\t\t\t\t\t.string()\n\t\t\t\t\t\t.meta({\n\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\"The email of the user to list invitations for. This only works for server side API calls.\",\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.optional(),\n\t\t\t\t})\n\t\t\t\t.optional(),\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"List all invitations a user has received\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\temail: {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\trole: {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\torganizationId: {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\torganizationName: {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\tinviterId: {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"The ID of the user who created the invitation\",\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\tteamId: {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"The ID of the team associated with the invitation\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tnullable: true,\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\tstatus: {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\texpiresAt: {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\t\t\t\t\t\t\"email\",\n\t\t\t\t\t\t\t\t\t\t\t\t\"role\",\n\t\t\t\t\t\t\t\t\t\t\t\t\"organizationId\",\n\t\t\t\t\t\t\t\t\t\t\t\t\"organizationName\",\n\t\t\t\t\t\t\t\t\t\t\t\t\"inviterId\",\n\t\t\t\t\t\t\t\t\t\t\t\t\"status\",\n\t\t\t\t\t\t\t\t\t\t\t\t\"expiresAt\",\n\t\t\t\t\t\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = await getSessionFromCtx(ctx);\n\n\t\t\tif (ctx.request && ctx.query?.email) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: \"User email cannot be passed for client side API calls.\",\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst userEmail = session?.user.email || ctx.query?.email;\n\t\t\tif (!userEmail) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: \"Missing session headers, or email query parameter.\",\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst adapter = getOrgAdapter<O>(ctx.context, options);\n\n\t\t\tconst invitations = await adapter.listUserInvitations(userEmail);\n\t\t\tconst pendingInvitations = invitations.filter(\n\t\t\t\t(inv) => inv.status === \"pending\",\n\t\t\t);\n\t\t\treturn ctx.json(pendingInvitations);\n\t\t},\n\t);\n"],"names":["teamIds","teamIds: string[]"],"mappings":"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"}},
    {"offset": {"line": 2856, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/organization/routes/crud-members.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/organization/routes/crud-members.ts"],"sourcesContent":["import type { LiteralString } from \"@better-auth/core\";\nimport { createAuthEndpoint } from \"@better-auth/core/api\";\nimport { BASE_ERROR_CODES } from \"@better-auth/core/error\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { getSessionFromCtx, sessionMiddleware } from \"../../../api\";\nimport type { InferAdditionalFieldsFromPluginOptions } from \"../../../db\";\nimport { toZodSchema } from \"../../../db/to-zod\";\nimport { getOrgAdapter } from \"../adapter\";\nimport { orgMiddleware, orgSessionMiddleware } from \"../call\";\nimport { ORGANIZATION_ERROR_CODES } from \"../error-codes\";\nimport { hasPermission } from \"../has-permission\";\nimport { parseRoles } from \"../organization\";\nimport type {\n\tInferMember,\n\tInferOrganizationRolesFromOption,\n\tMember,\n} from \"../schema\";\nimport type { OrganizationOptions } from \"../types\";\n\nconst baseMemberSchema = z.object({\n\tuserId: z.coerce.string().meta({\n\t\tdescription:\n\t\t\t'The user Id which represents the user to be added as a member. If `null` is provided, then it\\'s expected to provide session headers. Eg: \"user-id\"',\n\t}),\n\trole: z.union([z.string(), z.array(z.string())]).meta({\n\t\tdescription:\n\t\t\t'The role(s) to assign to the new member. Eg: [\"admin\", \"sale\"]',\n\t}),\n\torganizationId: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'An optional organization ID to pass. If not provided, will default to the user\\'s active organization. Eg: \"org-id\"',\n\t\t})\n\t\t.optional(),\n\tteamId: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: 'An optional team ID to add the member to. Eg: \"team-id\"',\n\t\t})\n\t\t.optional(),\n});\n\nexport const addMember = <O extends OrganizationOptions>(option: O) => {\n\tconst additionalFieldsSchema = toZodSchema({\n\t\tfields: option?.schema?.member?.additionalFields || {},\n\t\tisClientSide: true,\n\t});\n\treturn createAuthEndpoint(\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: z.object({\n\t\t\t\t...baseMemberSchema.shape,\n\t\t\t\t...additionalFieldsSchema.shape,\n\t\t\t}),\n\t\t\tuse: [orgMiddleware],\n\t\t\tmetadata: {\n\t\t\t\t$Infer: {\n\t\t\t\t\tbody: {} as {\n\t\t\t\t\t\tuserId: string;\n\t\t\t\t\t\trole:\n\t\t\t\t\t\t\t| InferOrganizationRolesFromOption<O>\n\t\t\t\t\t\t\t| InferOrganizationRolesFromOption<O>[];\n\t\t\t\t\t\torganizationId?: string | undefined;\n\t\t\t\t\t} & (O extends { teams: { enabled: true } }\n\t\t\t\t\t\t? { teamId?: string | undefined }\n\t\t\t\t\t\t: {}) &\n\t\t\t\t\t\tInferAdditionalFieldsFromPluginOptions<\"member\", O>,\n\t\t\t\t},\n\t\t\t\topenapi: {\n\t\t\t\t\toperationId: \"addOrganizationMember\",\n\t\t\t\t\tdescription: \"Add a member to an organization\",\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = ctx.body.userId\n\t\t\t\t? await getSessionFromCtx<{\n\t\t\t\t\t\tsession: {\n\t\t\t\t\t\t\tactiveOrganizationId?: string | undefined;\n\t\t\t\t\t\t};\n\t\t\t\t\t}>(ctx).catch((e) => null)\n\t\t\t\t: null;\n\t\t\tconst orgId =\n\t\t\t\tctx.body.organizationId || session?.session.activeOrganizationId;\n\t\t\tif (!orgId) {\n\t\t\t\treturn ctx.json(null, {\n\t\t\t\t\tstatus: 400,\n\t\t\t\t\tbody: {\n\t\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst teamId =\n\t\t\t\t\"teamId\" in ctx.body ? (ctx.body.teamId as string) : undefined;\n\t\t\tif (teamId && !ctx.context.orgOptions.teams?.enabled) {\n\t\t\t\tctx.context.logger.error(\"Teams are not enabled\");\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: \"Teams are not enabled\",\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst adapter = getOrgAdapter<O>(ctx.context, option);\n\n\t\t\tconst user = await ctx.context.internalAdapter.findUserById(\n\t\t\t\tctx.body.userId,\n\t\t\t);\n\n\t\t\tif (!user) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: BASE_ERROR_CODES.USER_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst alreadyMember = await adapter.findMemberByEmail({\n\t\t\t\temail: user.email,\n\t\t\t\torganizationId: orgId,\n\t\t\t});\n\n\t\t\tif (alreadyMember) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.USER_IS_ALREADY_A_MEMBER_OF_THIS_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (teamId) {\n\t\t\t\tconst team = await adapter.findTeamById({\n\t\t\t\t\tteamId,\n\t\t\t\t\torganizationId: orgId,\n\t\t\t\t});\n\t\t\t\tif (!team || team.organizationId !== orgId) {\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.TEAM_NOT_FOUND,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst membershipLimit = ctx.context.orgOptions?.membershipLimit || 100;\n\t\t\tconst count = await adapter.countMembers({ organizationId: orgId });\n\n\t\t\tif (count >= membershipLimit) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.ORGANIZATION_MEMBERSHIP_LIMIT_REACHED,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst {\n\t\t\t\trole: _,\n\t\t\t\tuserId: __,\n\t\t\t\torganizationId: ___,\n\t\t\t\t...additionalFields\n\t\t\t} = ctx.body;\n\n\t\t\tconst organization = await adapter.findOrganizationById(orgId);\n\t\t\tif (!organization) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tlet memberData = {\n\t\t\t\torganizationId: orgId,\n\t\t\t\tuserId: user.id,\n\t\t\t\trole: parseRoles(ctx.body.role),\n\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t...(additionalFields ? additionalFields : {}),\n\t\t\t};\n\n\t\t\t// Run beforeAddMember hook\n\t\t\tif (option?.organizationHooks?.beforeAddMember) {\n\t\t\t\tconst response = await option?.organizationHooks.beforeAddMember({\n\t\t\t\t\tmember: {\n\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\torganizationId: orgId,\n\t\t\t\t\t\trole: parseRoles(ctx.body.role as string | string[]),\n\t\t\t\t\t\t...additionalFields,\n\t\t\t\t\t},\n\t\t\t\t\tuser,\n\t\t\t\t\torganization,\n\t\t\t\t});\n\t\t\t\tif (response && typeof response === \"object\" && \"data\" in response) {\n\t\t\t\t\tmemberData = {\n\t\t\t\t\t\t...memberData,\n\t\t\t\t\t\t...response.data,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst createdMember = await adapter.createMember(memberData);\n\n\t\t\tif (teamId) {\n\t\t\t\tawait adapter.findOrCreateTeamMember({\n\t\t\t\t\tuserId: user.id,\n\t\t\t\t\tteamId,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Run afterAddMember hook\n\t\t\tif (option?.organizationHooks?.afterAddMember) {\n\t\t\t\tawait option?.organizationHooks.afterAddMember({\n\t\t\t\t\tmember: createdMember,\n\t\t\t\t\tuser,\n\t\t\t\t\torganization,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn ctx.json(createdMember);\n\t\t},\n\t);\n};\n\nconst removeMemberBodySchema = z.object({\n\tmemberIdOrEmail: z.string().meta({\n\t\tdescription: \"The ID or email of the member to remove\",\n\t}),\n\t/**\n\t * If not provided, the active organization will be used\n\t */\n\torganizationId: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The ID of the organization to remove the member from. If not provided, the active organization will be used. Eg: \"org-id\"',\n\t\t})\n\t\t.optional(),\n});\n\nexport const removeMember = <O extends OrganizationOptions>(options: O) =>\n\tcreateAuthEndpoint(\n\t\t\"/organization/remove-member\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: removeMemberBodySchema,\n\t\t\trequireHeaders: true,\n\t\t\tuse: [orgMiddleware, orgSessionMiddleware],\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"Remove a member from an organization\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tmember: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tuserId: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\torganizationId: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\trole: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\trequired: [\"id\", \"userId\", \"organizationId\", \"role\"],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\trequired: [\"member\"],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = ctx.context.session;\n\t\t\tconst organizationId =\n\t\t\t\tctx.body.organizationId || session.session.activeOrganizationId;\n\t\t\tif (!organizationId) {\n\t\t\t\treturn ctx.json(null, {\n\t\t\t\t\tstatus: 400,\n\t\t\t\t\tbody: {\n\t\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst adapter = getOrgAdapter<O>(ctx.context, options);\n\t\t\tconst member = await adapter.findMemberByOrgId({\n\t\t\t\tuserId: session.user.id,\n\t\t\t\torganizationId: organizationId,\n\t\t\t});\n\t\t\tif (!member) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.MEMBER_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\t\t\tlet toBeRemovedMember: InferMember<O> | null = null;\n\t\t\tif (ctx.body.memberIdOrEmail.includes(\"@\")) {\n\t\t\t\ttoBeRemovedMember = await adapter.findMemberByEmail({\n\t\t\t\t\temail: ctx.body.memberIdOrEmail,\n\t\t\t\t\torganizationId: organizationId,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconst result = await adapter.findMemberById(ctx.body.memberIdOrEmail);\n\t\t\t\tif (!result) toBeRemovedMember = null;\n\t\t\t\telse {\n\t\t\t\t\tconst { user: _user, ...member } = result;\n\t\t\t\t\ttoBeRemovedMember = member as unknown as InferMember<O>;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!toBeRemovedMember) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.MEMBER_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst roles = toBeRemovedMember.role.split(\",\");\n\t\t\tconst creatorRole = ctx.context.orgOptions?.creatorRole || \"owner\";\n\t\t\tconst isOwner = roles.includes(creatorRole);\n\t\t\tif (isOwner) {\n\t\t\t\tif (member.role !== creatorRole) {\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\tmessage:\n\t\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_CANNOT_LEAVE_THE_ORGANIZATION_AS_THE_ONLY_OWNER,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst { members } = await adapter.listMembers({\n\t\t\t\t\torganizationId: organizationId,\n\t\t\t\t});\n\t\t\t\tconst owners = members.filter((member) => {\n\t\t\t\t\tconst roles = member.role.split(\",\");\n\t\t\t\t\treturn roles.includes(creatorRole);\n\t\t\t\t});\n\t\t\t\tif (owners.length <= 1) {\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\tmessage:\n\t\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_CANNOT_LEAVE_THE_ORGANIZATION_AS_THE_ONLY_OWNER,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst canDeleteMember = await hasPermission(\n\t\t\t\t{\n\t\t\t\t\trole: member.role,\n\t\t\t\t\toptions: ctx.context.orgOptions,\n\t\t\t\t\tpermissions: {\n\t\t\t\t\t\tmember: [\"delete\"],\n\t\t\t\t\t},\n\t\t\t\t\torganizationId,\n\t\t\t\t},\n\t\t\t\tctx,\n\t\t\t);\n\n\t\t\tif (!canDeleteMember) {\n\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_MEMBER,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (toBeRemovedMember?.organizationId !== organizationId) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.MEMBER_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst organization = await adapter.findOrganizationById(organizationId);\n\t\t\tif (!organization) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst userBeingRemoved = await ctx.context.internalAdapter.findUserById(\n\t\t\t\ttoBeRemovedMember.userId,\n\t\t\t);\n\t\t\tif (!userBeingRemoved) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: \"User not found\",\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Run beforeRemoveMember hook\n\t\t\tif (options?.organizationHooks?.beforeRemoveMember) {\n\t\t\t\tawait options?.organizationHooks.beforeRemoveMember({\n\t\t\t\t\tmember: toBeRemovedMember,\n\t\t\t\t\tuser: userBeingRemoved,\n\t\t\t\t\torganization,\n\t\t\t\t});\n\t\t\t}\n\t\t\tawait adapter.deleteMember({\n\t\t\t\tmemberId: toBeRemovedMember.id,\n\t\t\t\torganizationId: organizationId,\n\t\t\t\tuserId: toBeRemovedMember.userId,\n\t\t\t});\n\t\t\tif (\n\t\t\t\tsession.user.id === toBeRemovedMember.userId &&\n\t\t\t\tsession.session.activeOrganizationId ===\n\t\t\t\t\ttoBeRemovedMember.organizationId\n\t\t\t) {\n\t\t\t\tawait adapter.setActiveOrganization(session.session.token, null, ctx);\n\t\t\t}\n\n\t\t\t// Run afterRemoveMember hook\n\t\t\tif (options?.organizationHooks?.afterRemoveMember) {\n\t\t\t\tawait options?.organizationHooks.afterRemoveMember({\n\t\t\t\t\tmember: toBeRemovedMember,\n\t\t\t\t\tuser: userBeingRemoved,\n\t\t\t\t\torganization,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn ctx.json({\n\t\t\t\tmember: toBeRemovedMember,\n\t\t\t});\n\t\t},\n\t);\n\nconst updateMemberRoleBodySchema = z.object({\n\trole: z.union([z.string(), z.array(z.string())]).meta({\n\t\tdescription:\n\t\t\t'The new role to be applied. This can be a string or array of strings representing the roles. Eg: [\"admin\", \"sale\"]',\n\t}),\n\tmemberId: z.string().meta({\n\t\tdescription: 'The member id to apply the role update to. Eg: \"member-id\"',\n\t}),\n\torganizationId: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'An optional organization ID which the member is a part of to apply the role update. If not provided, you must provide session headers to get the active organization. Eg: \"organization-id\"',\n\t\t})\n\t\t.optional(),\n});\n\nexport const updateMemberRole = <O extends OrganizationOptions>(option: O) =>\n\tcreateAuthEndpoint(\n\t\t\"/organization/update-member-role\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: updateMemberRoleBodySchema,\n\t\t\tuse: [orgMiddleware, orgSessionMiddleware],\n\t\t\trequireHeaders: true,\n\t\t\tmetadata: {\n\t\t\t\t$Infer: {\n\t\t\t\t\tbody: {} as {\n\t\t\t\t\t\trole:\n\t\t\t\t\t\t\t| InferOrganizationRolesFromOption<O>\n\t\t\t\t\t\t\t| InferOrganizationRolesFromOption<O>[]\n\t\t\t\t\t\t\t| LiteralString\n\t\t\t\t\t\t\t| LiteralString[];\n\t\t\t\t\t\tmemberId: string;\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * If not provided, the active organization will be used\n\t\t\t\t\t\t */\n\t\t\t\t\t\torganizationId?: string | undefined;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\topenapi: {\n\t\t\t\t\toperationId: \"updateOrganizationMemberRole\",\n\t\t\t\t\tdescription: \"Update the role of a member in an organization\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tmember: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tuserId: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\torganizationId: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\trole: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\trequired: [\"id\", \"userId\", \"organizationId\", \"role\"],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\trequired: [\"member\"],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = ctx.context.session;\n\n\t\t\tif (!ctx.body.role) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\");\n\t\t\t}\n\n\t\t\tconst organizationId =\n\t\t\t\tctx.body.organizationId || session.session.activeOrganizationId;\n\n\t\t\tif (!organizationId) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst adapter = getOrgAdapter(ctx.context, ctx.context.orgOptions);\n\t\t\tconst roleToSet: string[] = Array.isArray(ctx.body.role)\n\t\t\t\t? ctx.body.role\n\t\t\t\t: ctx.body.role\n\t\t\t\t\t? [ctx.body.role]\n\t\t\t\t\t: [];\n\n\t\t\tconst member = await adapter.findMemberByOrgId({\n\t\t\t\tuserId: session.user.id,\n\t\t\t\torganizationId: organizationId,\n\t\t\t});\n\n\t\t\tif (!member) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.MEMBER_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst toBeUpdatedMember =\n\t\t\t\tmember.id !== ctx.body.memberId\n\t\t\t\t\t? await adapter.findMemberById(ctx.body.memberId)\n\t\t\t\t\t: member;\n\n\t\t\tif (!toBeUpdatedMember) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.MEMBER_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst memberBelongsToOrganization =\n\t\t\t\ttoBeUpdatedMember.organizationId === organizationId;\n\n\t\t\tif (!memberBelongsToOrganization) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_MEMBER,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst creatorRole = ctx.context.orgOptions?.creatorRole || \"owner\";\n\n\t\t\tconst updatingMemberRoles = member.role.split(\",\");\n\t\t\tconst toBeUpdatedMemberRoles = toBeUpdatedMember.role.split(\",\");\n\n\t\t\tconst isUpdatingCreator = toBeUpdatedMemberRoles.includes(creatorRole);\n\t\t\tconst updaterIsCreator = updatingMemberRoles.includes(creatorRole);\n\n\t\t\tconst isSettingCreatorRole = roleToSet.includes(creatorRole);\n\n\t\t\tconst memberIsUpdatingThemselves = member.id === toBeUpdatedMember.id;\n\n\t\t\tif (\n\t\t\t\t(isUpdatingCreator && !updaterIsCreator) ||\n\t\t\t\t(isSettingCreatorRole && !updaterIsCreator)\n\t\t\t) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_MEMBER,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (updaterIsCreator && memberIsUpdatingThemselves) {\n\t\t\t\tconst members = await ctx.context.adapter.findMany<Member>({\n\t\t\t\t\tmodel: \"member\",\n\t\t\t\t\twhere: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\t\t\tvalue: organizationId,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\t\tconst owners = members.filter((member: Member) => {\n\t\t\t\t\tconst roles = member.role.split(\",\");\n\t\t\t\t\treturn roles.includes(creatorRole);\n\t\t\t\t});\n\t\t\t\tif (owners.length <= 1 && !isSettingCreatorRole) {\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\tmessage:\n\t\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_CANNOT_LEAVE_THE_ORGANIZATION_WITHOUT_AN_OWNER,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst canUpdateMember = await hasPermission(\n\t\t\t\t{\n\t\t\t\t\trole: member.role,\n\t\t\t\t\toptions: ctx.context.orgOptions,\n\t\t\t\t\tpermissions: {\n\t\t\t\t\t\tmember: [\"update\"],\n\t\t\t\t\t},\n\t\t\t\t\tallowCreatorAllPermissions: true,\n\t\t\t\t\torganizationId,\n\t\t\t\t},\n\t\t\t\tctx,\n\t\t\t);\n\n\t\t\tif (!canUpdateMember) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_MEMBER,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst organization = await adapter.findOrganizationById(organizationId);\n\t\t\tif (!organization) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst userBeingUpdated = await ctx.context.internalAdapter.findUserById(\n\t\t\t\ttoBeUpdatedMember.userId,\n\t\t\t);\n\t\t\tif (!userBeingUpdated) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: \"User not found\",\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst previousRole = toBeUpdatedMember.role;\n\t\t\tconst newRole = parseRoles(ctx.body.role as string | string[]);\n\n\t\t\t// Run beforeUpdateMemberRole hook\n\t\t\tif (option?.organizationHooks?.beforeUpdateMemberRole) {\n\t\t\t\tconst response = await option?.organizationHooks.beforeUpdateMemberRole(\n\t\t\t\t\t{\n\t\t\t\t\t\tmember: toBeUpdatedMember,\n\t\t\t\t\t\tnewRole,\n\t\t\t\t\t\tuser: userBeingUpdated,\n\t\t\t\t\t\torganization,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tif (response && typeof response === \"object\" && \"data\" in response) {\n\t\t\t\t\t// Allow the hook to modify the role\n\t\t\t\t\tconst updatedMember = await adapter.updateMember(\n\t\t\t\t\t\tctx.body.memberId,\n\t\t\t\t\t\tresponse.data.role || newRole,\n\t\t\t\t\t);\n\t\t\t\t\tif (!updatedMember) {\n\t\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.MEMBER_NOT_FOUND,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// Run afterUpdateMemberRole hook\n\t\t\t\t\tif (option?.organizationHooks?.afterUpdateMemberRole) {\n\t\t\t\t\t\tawait option?.organizationHooks.afterUpdateMemberRole({\n\t\t\t\t\t\t\tmember: updatedMember,\n\t\t\t\t\t\t\tpreviousRole,\n\t\t\t\t\t\t\tuser: userBeingUpdated,\n\t\t\t\t\t\t\torganization,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn ctx.json(updatedMember);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst updatedMember = await adapter.updateMember(\n\t\t\t\tctx.body.memberId,\n\t\t\t\tnewRole,\n\t\t\t);\n\t\t\tif (!updatedMember) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.MEMBER_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Run afterUpdateMemberRole hook\n\t\t\tif (option?.organizationHooks?.afterUpdateMemberRole) {\n\t\t\t\tawait option?.organizationHooks.afterUpdateMemberRole({\n\t\t\t\t\tmember: updatedMember,\n\t\t\t\t\tpreviousRole,\n\t\t\t\t\tuser: userBeingUpdated,\n\t\t\t\t\torganization,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn ctx.json(updatedMember);\n\t\t},\n\t);\n\nexport const getActiveMember = <O extends OrganizationOptions>(options: O) =>\n\tcreateAuthEndpoint(\n\t\t\"/organization/get-active-member\",\n\t\t{\n\t\t\tmethod: \"GET\",\n\t\t\tuse: [orgMiddleware, orgSessionMiddleware],\n\t\t\trequireHeaders: true,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"Get the member details of the active organization\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tuserId: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\torganizationId: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\trole: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\trequired: [\"id\", \"userId\", \"organizationId\", \"role\"],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = ctx.context.session;\n\t\t\tconst organizationId = session.session.activeOrganizationId;\n\t\t\tif (!organizationId) {\n\t\t\t\treturn ctx.json(null, {\n\t\t\t\t\tstatus: 400,\n\t\t\t\t\tbody: {\n\t\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst adapter = getOrgAdapter<O>(ctx.context, options);\n\t\t\tconst member = await adapter.findMemberByOrgId({\n\t\t\t\tuserId: session.user.id,\n\t\t\t\torganizationId: organizationId,\n\t\t\t});\n\t\t\tif (!member) {\n\t\t\t\treturn ctx.json(null, {\n\t\t\t\t\tstatus: 400,\n\t\t\t\t\tbody: {\n\t\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.MEMBER_NOT_FOUND,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn ctx.json(member);\n\t\t},\n\t);\n\nconst leaveOrganizationBodySchema = z.object({\n\torganizationId: z.string().meta({\n\t\tdescription:\n\t\t\t'The organization Id for the member to leave. Eg: \"organization-id\"',\n\t}),\n});\n\nexport const leaveOrganization = <O extends OrganizationOptions>(options: O) =>\n\tcreateAuthEndpoint(\n\t\t\"/organization/leave\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: leaveOrganizationBodySchema,\n\t\t\trequireHeaders: true,\n\t\t\tuse: [sessionMiddleware, orgMiddleware],\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = ctx.context.session;\n\t\t\tconst adapter = getOrgAdapter<O>(ctx.context, options);\n\t\t\tconst member = await adapter.findMemberByOrgId({\n\t\t\t\tuserId: session.user.id,\n\t\t\t\torganizationId: ctx.body.organizationId,\n\t\t\t});\n\n\t\t\tif (!member) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.MEMBER_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst creatorRole = ctx.context.orgOptions?.creatorRole || \"owner\";\n\t\t\tconst isOwnerLeaving = member.role.split(\",\").includes(creatorRole);\n\t\t\tif (isOwnerLeaving) {\n\t\t\t\tconst members = await ctx.context.adapter.findMany<Member>({\n\t\t\t\t\tmodel: \"member\",\n\t\t\t\t\twhere: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfield: \"organizationId\",\n\t\t\t\t\t\t\tvalue: ctx.body.organizationId,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\t\tconst owners = members.filter((member) =>\n\t\t\t\t\tmember.role.split(\",\").includes(creatorRole),\n\t\t\t\t);\n\t\t\t\tif (owners.length <= 1) {\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\tmessage:\n\t\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_CANNOT_LEAVE_THE_ORGANIZATION_AS_THE_ONLY_OWNER,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tawait adapter.deleteMember({\n\t\t\t\tmemberId: member.id,\n\t\t\t\torganizationId: ctx.body.organizationId,\n\t\t\t\tuserId: session.user.id,\n\t\t\t});\n\t\t\tif (session.session.activeOrganizationId === ctx.body.organizationId) {\n\t\t\t\tawait adapter.setActiveOrganization(session.session.token, null, ctx);\n\t\t\t}\n\t\t\treturn ctx.json(member);\n\t\t},\n\t);\n\nexport const listMembers = <O extends OrganizationOptions>(options: O) =>\n\tcreateAuthEndpoint(\n\t\t\"/organization/list-members\",\n\t\t{\n\t\t\tmethod: \"GET\",\n\t\t\tquery: z\n\t\t\t\t.object({\n\t\t\t\t\tlimit: z\n\t\t\t\t\t\t.string()\n\t\t\t\t\t\t.meta({\n\t\t\t\t\t\t\tdescription: \"The number of users to return\",\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.or(z.number())\n\t\t\t\t\t\t.optional(),\n\t\t\t\t\toffset: z\n\t\t\t\t\t\t.string()\n\t\t\t\t\t\t.meta({\n\t\t\t\t\t\t\tdescription: \"The offset to start from\",\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.or(z.number())\n\t\t\t\t\t\t.optional(),\n\t\t\t\t\tsortBy: z\n\t\t\t\t\t\t.string()\n\t\t\t\t\t\t.meta({\n\t\t\t\t\t\t\tdescription: \"The field to sort by\",\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.optional(),\n\t\t\t\t\tsortDirection: z\n\t\t\t\t\t\t.enum([\"asc\", \"desc\"])\n\t\t\t\t\t\t.meta({\n\t\t\t\t\t\t\tdescription: \"The direction to sort by\",\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.optional(),\n\t\t\t\t\tfilterField: z\n\t\t\t\t\t\t.string()\n\t\t\t\t\t\t.meta({\n\t\t\t\t\t\t\tdescription: \"The field to filter by\",\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.optional(),\n\t\t\t\t\tfilterValue: z\n\t\t\t\t\t\t.string()\n\t\t\t\t\t\t.meta({\n\t\t\t\t\t\t\tdescription: \"The value to filter by\",\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.or(z.number())\n\t\t\t\t\t\t.or(z.boolean())\n\t\t\t\t\t\t.optional(),\n\t\t\t\t\tfilterOperator: z\n\t\t\t\t\t\t.enum([\"eq\", \"ne\", \"lt\", \"lte\", \"gt\", \"gte\", \"contains\"])\n\t\t\t\t\t\t.meta({\n\t\t\t\t\t\t\tdescription: \"The operator to use for the filter\",\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.optional(),\n\t\t\t\t\torganizationId: z\n\t\t\t\t\t\t.string()\n\t\t\t\t\t\t.meta({\n\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t'The organization ID to list members for. If not provided, will default to the user\\'s active organization. Eg: \"organization-id\"',\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.optional(),\n\t\t\t\t\torganizationSlug: z\n\t\t\t\t\t\t.string()\n\t\t\t\t\t\t.meta({\n\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t'The organization slug to list members for. If not provided, will default to the user\\'s active organization. Eg: \"organization-slug\"',\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.optional(),\n\t\t\t\t})\n\t\t\t\t.optional(),\n\t\t\trequireHeaders: true,\n\t\t\tuse: [orgMiddleware, orgSessionMiddleware],\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = ctx.context.session;\n\t\t\tlet organizationId =\n\t\t\t\tctx.query?.organizationId || session.session.activeOrganizationId;\n\t\t\tconst adapter = getOrgAdapter<O>(ctx.context, options);\n\t\t\tif (ctx.query?.organizationSlug) {\n\t\t\t\tconst organization = await adapter.findOrganizationBySlug(\n\t\t\t\t\tctx.query?.organizationSlug,\n\t\t\t\t);\n\t\t\t\tif (!organization) {\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\torganizationId = organization.id;\n\t\t\t}\n\t\t\tif (!organizationId) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst isMember = await adapter.findMemberByOrgId({\n\t\t\t\tuserId: session.user.id,\n\t\t\t\torganizationId,\n\t\t\t});\n\t\t\tif (!isMember) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_A_MEMBER_OF_THIS_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst { members, total } = await adapter.listMembers({\n\t\t\t\torganizationId,\n\t\t\t\tlimit: ctx.query?.limit ? Number(ctx.query.limit) : undefined,\n\t\t\t\toffset: ctx.query?.offset ? Number(ctx.query.offset) : undefined,\n\t\t\t\tsortBy: ctx.query?.sortBy,\n\t\t\t\tsortOrder: ctx.query?.sortDirection,\n\t\t\t\tfilter: ctx.query?.filterField\n\t\t\t\t\t? {\n\t\t\t\t\t\t\tfield: ctx.query?.filterField,\n\t\t\t\t\t\t\toperator: ctx.query.filterOperator,\n\t\t\t\t\t\t\tvalue: ctx.query.filterValue,\n\t\t\t\t\t\t}\n\t\t\t\t\t: undefined,\n\t\t\t});\n\t\t\treturn ctx.json({\n\t\t\t\tmembers,\n\t\t\t\ttotal,\n\t\t\t});\n\t\t},\n\t);\n\nconst getActiveMemberRoleQuerySchema = z\n\t.object({\n\t\tuserId: z\n\t\t\t.string()\n\t\t\t.meta({\n\t\t\t\tdescription:\n\t\t\t\t\t\"The user ID to get the role for. If not provided, will default to the current user's\",\n\t\t\t})\n\t\t\t.optional(),\n\t\torganizationId: z\n\t\t\t.string()\n\t\t\t.meta({\n\t\t\t\tdescription:\n\t\t\t\t\t'The organization ID to list members for. If not provided, will default to the user\\'s active organization. Eg: \"organization-id\"',\n\t\t\t})\n\t\t\t.optional(),\n\t\torganizationSlug: z\n\t\t\t.string()\n\t\t\t.meta({\n\t\t\t\tdescription:\n\t\t\t\t\t'The organization slug to list members for. If not provided, will default to the user\\'s active organization. Eg: \"organization-slug\"',\n\t\t\t})\n\t\t\t.optional(),\n\t})\n\t.optional();\n\nexport const getActiveMemberRole = <O extends OrganizationOptions>(\n\toptions: O,\n) =>\n\tcreateAuthEndpoint(\n\t\t\"/organization/get-active-member-role\",\n\t\t{\n\t\t\tmethod: \"GET\",\n\t\t\tquery: getActiveMemberRoleQuerySchema,\n\t\t\trequireHeaders: true,\n\t\t\tuse: [orgMiddleware, orgSessionMiddleware],\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = ctx.context.session;\n\t\t\tlet organizationId =\n\t\t\t\tctx.query?.organizationId || session.session.activeOrganizationId;\n\t\t\tconst adapter = getOrgAdapter<O>(ctx.context, options);\n\t\t\tif (ctx.query?.organizationSlug) {\n\t\t\t\tconst organization = await adapter.findOrganizationBySlug(\n\t\t\t\t\tctx.query?.organizationSlug,\n\t\t\t\t);\n\t\t\t\tif (!organization) {\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\torganizationId = organization.id;\n\t\t\t}\n\t\t\tif (!organizationId) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst isMember = await adapter.findMemberByOrgId({\n\t\t\t\tuserId: session.user.id,\n\t\t\t\torganizationId,\n\t\t\t});\n\t\t\tif (!isMember) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_A_MEMBER_OF_THIS_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (!ctx.query?.userId) {\n\t\t\t\treturn ctx.json({\n\t\t\t\t\trole: isMember.role,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst userIdToGetRole = ctx.query?.userId;\n\t\t\tconst member = await adapter.findMemberByOrgId({\n\t\t\t\tuserId: userIdToGetRole,\n\t\t\t\torganizationId,\n\t\t\t});\n\t\t\tif (!member) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_A_MEMBER_OF_THIS_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn ctx.json({\n\t\t\t\trole: member?.role,\n\t\t\t});\n\t\t},\n\t);\n"],"names":["toBeRemovedMember: InferMember<O> | null","member","roleToSet: string[]","updatedMember"],"mappings":"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"}},
    {"offset": {"line": 3606, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/organization/routes/crud-org.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/organization/routes/crud-org.ts"],"sourcesContent":["import { createAuthEndpoint } from \"@better-auth/core/api\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { getSessionFromCtx, requestOnlySessionMiddleware } from \"../../../api\";\nimport { setSessionCookie } from \"../../../cookies\";\nimport type { InferAdditionalFieldsFromPluginOptions } from \"../../../db\";\nimport { toZodSchema } from \"../../../db\";\nimport { getOrgAdapter } from \"../adapter\";\nimport { orgMiddleware, orgSessionMiddleware } from \"../call\";\nimport { ORGANIZATION_ERROR_CODES } from \"../error-codes\";\nimport { hasPermission } from \"../has-permission\";\nimport type {\n\tInferInvitation,\n\tInferMember,\n\tInferOrganization,\n\tInferTeam,\n\tMember,\n\tTeamMember,\n} from \"../schema\";\nimport type { OrganizationOptions } from \"../types\";\n\nconst baseOrganizationSchema = z.object({\n\tname: z.string().min(1).meta({\n\t\tdescription: \"The name of the organization\",\n\t}),\n\tslug: z.string().min(1).meta({\n\t\tdescription: \"The slug of the organization\",\n\t}),\n\tuserId: z.coerce\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The user id of the organization creator. If not provided, the current user will be used. Should only be used by admins or when called by the server. server-only. Eg: \"user-id\"',\n\t\t})\n\t\t.optional(),\n\tlogo: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: \"The logo of the organization\",\n\t\t})\n\t\t.optional(),\n\tmetadata: z\n\t\t.record(z.string(), z.any())\n\t\t.meta({\n\t\t\tdescription: \"The metadata of the organization\",\n\t\t})\n\t\t.optional(),\n\tkeepCurrentActiveOrganization: z\n\t\t.boolean()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t\"Whether to keep the current active organization active after creating a new one. Eg: true\",\n\t\t})\n\t\t.optional(),\n});\n\nexport const createOrganization = <O extends OrganizationOptions>(\n\toptions?: O | undefined,\n) => {\n\tconst additionalFieldsSchema = toZodSchema({\n\t\tfields: options?.schema?.organization?.additionalFields || {},\n\t\tisClientSide: true,\n\t});\n\n\ttype Body = InferAdditionalFieldsFromPluginOptions<\"organization\", O> &\n\t\tz.infer<typeof baseOrganizationSchema>;\n\n\treturn createAuthEndpoint(\n\t\t\"/organization/create\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: z.object({\n\t\t\t\t...baseOrganizationSchema.shape,\n\t\t\t\t...additionalFieldsSchema.shape,\n\t\t\t}),\n\t\t\tuse: [orgMiddleware],\n\t\t\tmetadata: {\n\t\t\t\t$Infer: {\n\t\t\t\t\tbody: {} as Body,\n\t\t\t\t},\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"Create an organization\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"The organization that was created\",\n\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/Organization\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = await getSessionFromCtx(ctx);\n\n\t\t\tif (!session && (ctx.request || ctx.headers)) {\n\t\t\t\tthrow new APIError(\"UNAUTHORIZED\");\n\t\t\t}\n\t\t\tlet user = session?.user || null;\n\t\t\tif (!user) {\n\t\t\t\tif (!ctx.body.userId) {\n\t\t\t\t\tthrow new APIError(\"UNAUTHORIZED\");\n\t\t\t\t}\n\t\t\t\tuser = await ctx.context.internalAdapter.findUserById(ctx.body.userId);\n\t\t\t}\n\t\t\tif (!user) {\n\t\t\t\treturn ctx.json(null, {\n\t\t\t\t\tstatus: 401,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst options = ctx.context.orgOptions;\n\t\t\tconst canCreateOrg =\n\t\t\t\ttypeof options?.allowUserToCreateOrganization === \"function\"\n\t\t\t\t\t? await options.allowUserToCreateOrganization(user)\n\t\t\t\t\t: options?.allowUserToCreateOrganization === undefined\n\t\t\t\t\t\t? true\n\t\t\t\t\t\t: options.allowUserToCreateOrganization;\n\n\t\t\tconst isSystemAction = !session && ctx.body.userId;\n\n\t\t\tif (!canCreateOrg && !isSystemAction) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_CREATE_A_NEW_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst adapter = getOrgAdapter<O>(ctx.context, options as O);\n\n\t\t\tconst userOrganizations = await adapter.listOrganizations(user.id);\n\t\t\tconst hasReachedOrgLimit =\n\t\t\t\ttypeof options.organizationLimit === \"number\"\n\t\t\t\t\t? userOrganizations.length >= options.organizationLimit\n\t\t\t\t\t: typeof options.organizationLimit === \"function\"\n\t\t\t\t\t\t? await options.organizationLimit(user)\n\t\t\t\t\t\t: false;\n\n\t\t\tif (hasReachedOrgLimit) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_HAVE_REACHED_THE_MAXIMUM_NUMBER_OF_ORGANIZATIONS,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst existingOrganization = await adapter.findOrganizationBySlug(\n\t\t\t\tctx.body.slug,\n\t\t\t);\n\t\t\tif (existingOrganization) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_ALREADY_EXISTS,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tlet {\n\t\t\t\tkeepCurrentActiveOrganization: _,\n\t\t\t\tuserId: __,\n\t\t\t\t...orgData\n\t\t\t} = ctx.body;\n\n\t\t\tif (options.organizationCreation?.beforeCreate) {\n\t\t\t\tconst response = await options.organizationCreation.beforeCreate(\n\t\t\t\t\t{\n\t\t\t\t\t\torganization: {\n\t\t\t\t\t\t\t...orgData,\n\t\t\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tuser,\n\t\t\t\t\t},\n\t\t\t\t\tctx.request,\n\t\t\t\t);\n\t\t\t\tif (response && typeof response === \"object\" && \"data\" in response) {\n\t\t\t\t\torgData = {\n\t\t\t\t\t\t...ctx.body,\n\t\t\t\t\t\t...response.data,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (options?.organizationHooks?.beforeCreateOrganization) {\n\t\t\t\tconst response =\n\t\t\t\t\tawait options?.organizationHooks.beforeCreateOrganization({\n\t\t\t\t\t\torganization: orgData,\n\t\t\t\t\t\tuser,\n\t\t\t\t\t});\n\t\t\t\tif (response && typeof response === \"object\" && \"data\" in response) {\n\t\t\t\t\torgData = {\n\t\t\t\t\t\t...ctx.body,\n\t\t\t\t\t\t...response.data,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst organization = await adapter.createOrganization({\n\t\t\t\torganization: {\n\t\t\t\t\t...orgData,\n\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tlet member:\n\t\t\t\t| (Member & InferAdditionalFieldsFromPluginOptions<\"member\", O, false>)\n\t\t\t\t| undefined;\n\t\t\tlet teamMember: TeamMember | null = null;\n\t\t\tlet data = {\n\t\t\t\tuserId: user.id,\n\t\t\t\torganizationId: organization.id,\n\t\t\t\trole: ctx.context.orgOptions.creatorRole || \"owner\",\n\t\t\t};\n\t\t\tif (options?.organizationHooks?.beforeAddMember) {\n\t\t\t\tconst response = await options?.organizationHooks.beforeAddMember({\n\t\t\t\t\tmember: {\n\t\t\t\t\t\tuserId: user.id,\n\t\t\t\t\t\torganizationId: organization.id,\n\t\t\t\t\t\trole: ctx.context.orgOptions.creatorRole || \"owner\",\n\t\t\t\t\t},\n\t\t\t\t\tuser,\n\t\t\t\t\torganization,\n\t\t\t\t});\n\t\t\t\tif (response && typeof response === \"object\" && \"data\" in response) {\n\t\t\t\t\tdata = {\n\t\t\t\t\t\t...data,\n\t\t\t\t\t\t...response.data,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t\tmember = await adapter.createMember(data);\n\t\t\tif (options?.organizationHooks?.afterAddMember) {\n\t\t\t\tawait options?.organizationHooks.afterAddMember({\n\t\t\t\t\tmember,\n\t\t\t\t\tuser,\n\t\t\t\t\torganization,\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (\n\t\t\t\toptions?.teams?.enabled &&\n\t\t\t\toptions.teams.defaultTeam?.enabled !== false\n\t\t\t) {\n\t\t\t\tlet teamData = {\n\t\t\t\t\torganizationId: organization.id,\n\t\t\t\t\tname: `${organization.name}`,\n\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t};\n\t\t\t\tif (options?.organizationHooks?.beforeCreateTeam) {\n\t\t\t\t\tconst response = await options?.organizationHooks.beforeCreateTeam({\n\t\t\t\t\t\tteam: {\n\t\t\t\t\t\t\torganizationId: organization.id,\n\t\t\t\t\t\t\tname: `${organization.name}`,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tuser,\n\t\t\t\t\t\torganization,\n\t\t\t\t\t});\n\t\t\t\t\tif (response && typeof response === \"object\" && \"data\" in response) {\n\t\t\t\t\t\tteamData = {\n\t\t\t\t\t\t\t...teamData,\n\t\t\t\t\t\t\t...response.data,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconst defaultTeam =\n\t\t\t\t\t(await options.teams.defaultTeam?.customCreateDefaultTeam?.(\n\t\t\t\t\t\torganization,\n\t\t\t\t\t\tctx,\n\t\t\t\t\t)) || (await adapter.createTeam(teamData));\n\n\t\t\t\tteamMember = await adapter.findOrCreateTeamMember({\n\t\t\t\t\tteamId: defaultTeam.id,\n\t\t\t\t\tuserId: user.id,\n\t\t\t\t});\n\n\t\t\t\tif (options?.organizationHooks?.afterCreateTeam) {\n\t\t\t\t\tawait options?.organizationHooks.afterCreateTeam({\n\t\t\t\t\t\tteam: defaultTeam,\n\t\t\t\t\t\tuser,\n\t\t\t\t\t\torganization,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (options.organizationCreation?.afterCreate) {\n\t\t\t\tawait options.organizationCreation.afterCreate(\n\t\t\t\t\t{\n\t\t\t\t\t\torganization,\n\t\t\t\t\t\tuser,\n\t\t\t\t\t\tmember,\n\t\t\t\t\t},\n\t\t\t\t\tctx.request,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (options?.organizationHooks?.afterCreateOrganization) {\n\t\t\t\tawait options?.organizationHooks.afterCreateOrganization({\n\t\t\t\t\torganization,\n\t\t\t\t\tuser,\n\t\t\t\t\tmember,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (ctx.context.session && !ctx.body.keepCurrentActiveOrganization) {\n\t\t\t\tawait adapter.setActiveOrganization(\n\t\t\t\t\tctx.context.session.session.token,\n\t\t\t\t\torganization.id,\n\t\t\t\t\tctx,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tteamMember &&\n\t\t\t\tctx.context.session &&\n\t\t\t\t!ctx.body.keepCurrentActiveOrganization\n\t\t\t) {\n\t\t\t\tawait adapter.setActiveTeam(\n\t\t\t\t\tctx.context.session.session.token,\n\t\t\t\t\tteamMember.teamId,\n\t\t\t\t\tctx,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn ctx.json({\n\t\t\t\t...organization,\n\t\t\t\tmetadata:\n\t\t\t\t\torganization.metadata && typeof organization.metadata === \"string\"\n\t\t\t\t\t\t? JSON.parse(organization.metadata)\n\t\t\t\t\t\t: organization.metadata,\n\t\t\t\tmembers: [member],\n\t\t\t});\n\t\t},\n\t);\n};\n\nconst checkOrganizationSlugBodySchema = z.object({\n\tslug: z.string().meta({\n\t\tdescription: 'The organization slug to check. Eg: \"my-org\"',\n\t}),\n});\n\nexport const checkOrganizationSlug = <O extends OrganizationOptions>(\n\toptions: O,\n) =>\n\tcreateAuthEndpoint(\n\t\t\"/organization/check-slug\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: checkOrganizationSlugBodySchema,\n\t\t\tuse: [requestOnlySessionMiddleware, orgMiddleware],\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst orgAdapter = getOrgAdapter<O>(ctx.context, options);\n\t\t\tconst org = await orgAdapter.findOrganizationBySlug(ctx.body.slug);\n\t\t\tif (!org) {\n\t\t\t\treturn ctx.json({\n\t\t\t\t\tstatus: true,\n\t\t\t\t});\n\t\t\t}\n\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\tmessage: \"slug is taken\",\n\t\t\t});\n\t\t},\n\t);\n\nconst baseUpdateOrganizationSchema = z.object({\n\tname: z\n\t\t.string()\n\t\t.min(1)\n\t\t.meta({\n\t\t\tdescription: \"The name of the organization\",\n\t\t})\n\t\t.optional(),\n\tslug: z\n\t\t.string()\n\t\t.min(1)\n\t\t.meta({\n\t\t\tdescription: \"The slug of the organization\",\n\t\t})\n\t\t.optional(),\n\tlogo: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: \"The logo of the organization\",\n\t\t})\n\t\t.optional(),\n\tmetadata: z\n\t\t.record(z.string(), z.any())\n\t\t.meta({\n\t\t\tdescription: \"The metadata of the organization\",\n\t\t})\n\t\t.optional(),\n});\n\nexport const updateOrganization = <O extends OrganizationOptions>(\n\toptions?: O | undefined,\n) => {\n\tconst additionalFieldsSchema = toZodSchema({\n\t\tfields: options?.schema?.organization?.additionalFields || {},\n\t\tisClientSide: true,\n\t});\n\ttype Body = {\n\t\tdata: {\n\t\t\tname?: string | undefined;\n\t\t\tslug?: string | undefined;\n\t\t\tlogo?: string | undefined;\n\t\t\tmetadata?: Record<string, any> | undefined;\n\t\t} & Partial<InferAdditionalFieldsFromPluginOptions<\"organization\", O>>;\n\t\torganizationId?: string | undefined;\n\t};\n\treturn createAuthEndpoint(\n\t\t\"/organization/update\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: z.object({\n\t\t\t\tdata: z\n\t\t\t\t\t.object({\n\t\t\t\t\t\t...additionalFieldsSchema.shape,\n\t\t\t\t\t\t...baseUpdateOrganizationSchema.shape,\n\t\t\t\t\t})\n\t\t\t\t\t.partial(),\n\t\t\t\torganizationId: z\n\t\t\t\t\t.string()\n\t\t\t\t\t.meta({\n\t\t\t\t\t\tdescription: 'The organization ID. Eg: \"org-id\"',\n\t\t\t\t\t})\n\t\t\t\t\t.optional(),\n\t\t\t}),\n\t\t\trequireHeaders: true,\n\t\t\tuse: [orgMiddleware],\n\t\t\tmetadata: {\n\t\t\t\t$Infer: {\n\t\t\t\t\tbody: {} as Body,\n\t\t\t\t},\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"Update an organization\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"The updated organization\",\n\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/Organization\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = await ctx.context.getSession(ctx);\n\t\t\tif (!session) {\n\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\tmessage: \"User not found\",\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst organizationId =\n\t\t\t\tctx.body.organizationId || session.session.activeOrganizationId;\n\t\t\tif (!organizationId) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst adapter = getOrgAdapter<O>(ctx.context, options);\n\t\t\tconst member = await adapter.findMemberByOrgId({\n\t\t\t\tuserId: session.user.id,\n\t\t\t\torganizationId: organizationId,\n\t\t\t});\n\t\t\tif (!member) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst canUpdateOrg = await hasPermission(\n\t\t\t\t{\n\t\t\t\t\tpermissions: {\n\t\t\t\t\t\torganization: [\"update\"],\n\t\t\t\t\t},\n\t\t\t\t\trole: member.role,\n\t\t\t\t\toptions: ctx.context.orgOptions,\n\t\t\t\t\torganizationId,\n\t\t\t\t},\n\t\t\t\tctx,\n\t\t\t);\n\t\t\tif (!canUpdateOrg) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\t\t\t// Check if slug is being updated and validate uniqueness\n\t\t\tif (typeof ctx.body.data.slug === \"string\") {\n\t\t\t\tconst existingOrganization = await adapter.findOrganizationBySlug(\n\t\t\t\t\tctx.body.data.slug,\n\t\t\t\t);\n\t\t\t\tif (\n\t\t\t\t\texistingOrganization &&\n\t\t\t\t\texistingOrganization.id !== organizationId\n\t\t\t\t) {\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_SLUG_ALREADY_TAKEN,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (options?.organizationHooks?.beforeUpdateOrganization) {\n\t\t\t\tconst response =\n\t\t\t\t\tawait options.organizationHooks.beforeUpdateOrganization({\n\t\t\t\t\t\torganization: ctx.body.data,\n\t\t\t\t\t\tuser: session.user,\n\t\t\t\t\t\tmember,\n\t\t\t\t\t});\n\t\t\t\tif (response && typeof response === \"object\" && \"data\" in response) {\n\t\t\t\t\tctx.body.data = {\n\t\t\t\t\t\t...ctx.body.data,\n\t\t\t\t\t\t...response.data,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst updatedOrg = await adapter.updateOrganization(\n\t\t\t\torganizationId,\n\t\t\t\tctx.body.data,\n\t\t\t);\n\t\t\tif (options?.organizationHooks?.afterUpdateOrganization) {\n\t\t\t\tawait options.organizationHooks.afterUpdateOrganization({\n\t\t\t\t\torganization: updatedOrg,\n\t\t\t\t\tuser: session.user,\n\t\t\t\t\tmember,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn ctx.json(updatedOrg);\n\t\t},\n\t);\n};\n\nconst deleteOrganizationBodySchema = z.object({\n\torganizationId: z.string().meta({\n\t\tdescription: \"The organization id to delete\",\n\t}),\n});\n\nexport const deleteOrganization = <O extends OrganizationOptions>(\n\toptions: O,\n) => {\n\treturn createAuthEndpoint(\n\t\t\"/organization/delete\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: deleteOrganizationBodySchema,\n\t\t\trequireHeaders: true,\n\t\t\tuse: [orgMiddleware],\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"Delete an organization\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"The organization id that was deleted\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst disableOrganizationDeletion =\n\t\t\t\tctx.context.orgOptions.organizationDeletion?.disabled ||\n\t\t\t\tctx.context.orgOptions.disableOrganizationDeletion;\n\t\t\tif (disableOrganizationDeletion) {\n\t\t\t\tif (ctx.context.orgOptions.organizationDeletion?.disabled) {\n\t\t\t\t\tctx.context.logger.info(\n\t\t\t\t\t\t\"`organizationDeletion.disabled` is deprecated. Use `disableOrganizationDeletion` instead\",\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tthrow new APIError(\"NOT_FOUND\", {\n\t\t\t\t\tmessage: \"Organization deletion is disabled\",\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst session = await ctx.context.getSession(ctx);\n\t\t\tif (!session) {\n\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", { status: 401 });\n\t\t\t}\n\n\t\t\tconst organizationId = ctx.body.organizationId;\n\t\t\tif (!organizationId) {\n\t\t\t\treturn ctx.json(null, {\n\t\t\t\t\tstatus: 400,\n\t\t\t\t\tbody: {\n\t\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst adapter = getOrgAdapter<O>(ctx.context, options);\n\t\t\tconst member = await adapter.findMemberByOrgId({\n\t\t\t\tuserId: session.user.id,\n\t\t\t\torganizationId: organizationId,\n\t\t\t});\n\t\t\tif (!member) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst canDeleteOrg = await hasPermission(\n\t\t\t\t{\n\t\t\t\t\trole: member.role,\n\t\t\t\t\tpermissions: {\n\t\t\t\t\t\torganization: [\"delete\"],\n\t\t\t\t\t},\n\t\t\t\t\torganizationId,\n\t\t\t\t\toptions: ctx.context.orgOptions,\n\t\t\t\t},\n\t\t\t\tctx,\n\t\t\t);\n\t\t\tif (!canDeleteOrg) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (organizationId === session.session.activeOrganizationId) {\n\t\t\t\t/**\n\t\t\t\t * If the organization is deleted, we set the active organization to null\n\t\t\t\t */\n\t\t\t\tawait adapter.setActiveOrganization(session.session.token, null, ctx);\n\t\t\t}\n\n\t\t\tconst org = await adapter.findOrganizationById(organizationId);\n\t\t\tif (!org) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\");\n\t\t\t}\n\t\t\tif (options?.organizationHooks?.beforeDeleteOrganization) {\n\t\t\t\tawait options.organizationHooks.beforeDeleteOrganization({\n\t\t\t\t\torganization: org,\n\t\t\t\t\tuser: session.user,\n\t\t\t\t});\n\t\t\t}\n\t\t\tawait adapter.deleteOrganization(organizationId);\n\t\t\tif (options?.organizationHooks?.afterDeleteOrganization) {\n\t\t\t\tawait options.organizationHooks.afterDeleteOrganization({\n\t\t\t\t\torganization: org,\n\t\t\t\t\tuser: session.user,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn ctx.json(org);\n\t\t},\n\t);\n};\n\nconst getFullOrganizationQuerySchema = z.optional(\n\tz.object({\n\t\torganizationId: z\n\t\t\t.string()\n\t\t\t.meta({\n\t\t\t\tdescription: \"The organization id to get\",\n\t\t\t})\n\t\t\t.optional(),\n\t\torganizationSlug: z\n\t\t\t.string()\n\t\t\t.meta({\n\t\t\t\tdescription: \"The organization slug to get\",\n\t\t\t})\n\t\t\t.optional(),\n\t\tmembersLimit: z\n\t\t\t.number()\n\t\t\t.or(z.string().transform((val) => parseInt(val)))\n\t\t\t.meta({\n\t\t\t\tdescription:\n\t\t\t\t\t\"The limit of members to get. By default, it uses the membershipLimit option which defaults to 100.\",\n\t\t\t})\n\t\t\t.optional(),\n\t}),\n);\n\nexport const getFullOrganization = <O extends OrganizationOptions>(\n\toptions: O,\n) =>\n\tcreateAuthEndpoint(\n\t\t\"/organization/get-full-organization\",\n\t\t{\n\t\t\tmethod: \"GET\",\n\t\t\tquery: getFullOrganizationQuerySchema,\n\t\t\trequireHeaders: true,\n\t\t\tuse: [orgMiddleware, orgSessionMiddleware],\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\toperationId: \"getOrganization\",\n\t\t\t\t\tdescription: \"Get the full organization\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"The organization\",\n\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/Organization\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = ctx.context.session;\n\t\t\tconst organizationId =\n\t\t\t\tctx.query?.organizationSlug ||\n\t\t\t\tctx.query?.organizationId ||\n\t\t\t\tsession.session.activeOrganizationId;\n\t\t\t// return null if no organization is found to avoid erroring since this is a usual scenario\n\t\t\tif (!organizationId) {\n\t\t\t\treturn ctx.json(null, {\n\t\t\t\t\tstatus: 200,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst adapter = getOrgAdapter<O>(ctx.context, options);\n\t\t\tconst organization = await adapter.findFullOrganization({\n\t\t\t\torganizationId,\n\t\t\t\tisSlug: !!ctx.query?.organizationSlug,\n\t\t\t\tincludeTeams: ctx.context.orgOptions.teams?.enabled,\n\t\t\t\tmembersLimit: ctx.query?.membersLimit,\n\t\t\t});\n\t\t\tif (!organization) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst isMember = await adapter.checkMembership({\n\t\t\t\tuserId: session.user.id,\n\t\t\t\torganizationId: organization.id,\n\t\t\t});\n\t\t\tif (!isMember) {\n\t\t\t\tawait adapter.setActiveOrganization(session.session.token, null, ctx);\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\ttype OrganizationReturn = O[\"teams\"] extends { enabled: true }\n\t\t\t\t? {\n\t\t\t\t\t\tmembers: InferMember<O>[];\n\t\t\t\t\t\tinvitations: InferInvitation<O>[];\n\t\t\t\t\t\tteams: InferTeam<O>[];\n\t\t\t\t\t} & InferOrganization<O>\n\t\t\t\t: {\n\t\t\t\t\t\tmembers: InferMember<O>[];\n\t\t\t\t\t\tinvitations: InferInvitation<O>[];\n\t\t\t\t\t} & InferOrganization<O>;\n\t\t\treturn ctx.json(organization as unknown as OrganizationReturn);\n\t\t},\n\t);\n\nconst setActiveOrganizationBodySchema = z.object({\n\torganizationId: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The organization id to set as active. It can be null to unset the active organization. Eg: \"org-id\"',\n\t\t})\n\t\t.nullable()\n\t\t.optional(),\n\torganizationSlug: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The organization slug to set as active. It can be null to unset the active organization if organizationId is not provided. Eg: \"org-slug\"',\n\t\t})\n\t\t.optional(),\n});\n\nexport const setActiveOrganization = <O extends OrganizationOptions>(\n\toptions: O,\n) => {\n\treturn createAuthEndpoint(\n\t\t\"/organization/set-active\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: setActiveOrganizationBodySchema,\n\t\t\tuse: [orgSessionMiddleware, orgMiddleware],\n\t\t\trequireHeaders: true,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\toperationId: \"setActiveOrganization\",\n\t\t\t\t\tdescription: \"Set the active organization\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"The organization\",\n\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/Organization\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst adapter = getOrgAdapter<O>(ctx.context, options);\n\t\t\tconst session = ctx.context.session;\n\t\t\tlet organizationId = ctx.body.organizationId;\n\t\t\tconst organizationSlug = ctx.body.organizationSlug;\n\n\t\t\tif (organizationId === null) {\n\t\t\t\tconst sessionOrgId = session.session.activeOrganizationId;\n\t\t\t\tif (!sessionOrgId) {\n\t\t\t\t\treturn ctx.json(null);\n\t\t\t\t}\n\t\t\t\tconst updatedSession = await adapter.setActiveOrganization(\n\t\t\t\t\tsession.session.token,\n\t\t\t\t\tnull,\n\t\t\t\t\tctx,\n\t\t\t\t);\n\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\tsession: updatedSession,\n\t\t\t\t\tuser: session.user,\n\t\t\t\t});\n\t\t\t\treturn ctx.json(null);\n\t\t\t}\n\n\t\t\tif (!organizationId && !organizationSlug) {\n\t\t\t\tconst sessionOrgId = session.session.activeOrganizationId;\n\t\t\t\tif (!sessionOrgId) {\n\t\t\t\t\treturn ctx.json(null);\n\t\t\t\t}\n\t\t\t\torganizationId = sessionOrgId;\n\t\t\t}\n\n\t\t\tif (organizationSlug && !organizationId) {\n\t\t\t\tconst organization =\n\t\t\t\t\tawait adapter.findOrganizationBySlug(organizationSlug);\n\t\t\t\tif (!organization) {\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\torganizationId = organization.id;\n\t\t\t}\n\n\t\t\tif (!organizationId) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst isMember = await adapter.checkMembership({\n\t\t\t\tuserId: session.user.id,\n\t\t\t\torganizationId,\n\t\t\t});\n\t\t\tif (!isMember) {\n\t\t\t\tawait adapter.setActiveOrganization(session.session.token, null, ctx);\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst organization = await adapter.findOrganizationById(organizationId);\n\t\t\tif (!organization) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst updatedSession = await adapter.setActiveOrganization(\n\t\t\t\tsession.session.token,\n\t\t\t\torganization.id,\n\t\t\t\tctx,\n\t\t\t);\n\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\tsession: updatedSession,\n\t\t\t\tuser: session.user,\n\t\t\t});\n\t\t\ttype OrganizationReturn = O[\"teams\"] extends { enabled: true }\n\t\t\t\t? {\n\t\t\t\t\t\tmembers: InferMember<O>[];\n\t\t\t\t\t\tinvitations: InferInvitation<O>[];\n\t\t\t\t\t\tteams: InferTeam<O>[];\n\t\t\t\t\t} & InferOrganization<O>\n\t\t\t\t: {\n\t\t\t\t\t\tmembers: InferMember<O>[];\n\t\t\t\t\t\tinvitations: InferInvitation<O>[];\n\t\t\t\t\t} & InferOrganization<O>;\n\t\t\treturn ctx.json(organization as unknown as OrganizationReturn);\n\t\t},\n\t);\n};\n\nexport const listOrganizations = <O extends OrganizationOptions>(options: O) =>\n\tcreateAuthEndpoint(\n\t\t\"/organization/list\",\n\t\t{\n\t\t\tmethod: \"GET\",\n\t\t\tuse: [orgMiddleware, orgSessionMiddleware],\n\t\t\trequireHeaders: true,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"List all organizations\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/Organization\",\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst adapter = getOrgAdapter<O>(ctx.context, options);\n\t\t\tconst organizations = await adapter.listOrganizations(\n\t\t\t\tctx.context.session.user.id,\n\t\t\t);\n\t\t\treturn ctx.json(organizations);\n\t\t},\n\t);\n"],"names":["options","member:\n\t\t\t\t| (Member & InferAdditionalFieldsFromPluginOptions<\"member\", O, false>)\n\t\t\t\t| undefined","teamMember: TeamMember | null","organization"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqBA,MAAM,yBAAyB,EAAE,yJAAA,CAAO;IACvC,MAAM,EAAE,yJAAA,EAAQ,CAAC,GAAA,CAAI,EAAE,CAAC,IAAA,CAAK;QAC5B,aAAa;IAAA,CACb,CAAC;IACF,MAAM,EAAE,yJAAA,EAAQ,CAAC,GAAA,CAAI,EAAE,CAAC,IAAA,CAAK;QAC5B,aAAa;IAAA,CACb,CAAC;IACF,QAAQ,EAAE,0JAAA,CACR,MAAA,EAAQ,CACR,IAAA,CAAK;QACL,aACC;IAAA,CACD,CAAC,CACD,QAAA,EAAU;IACZ,MAAM,EACJ,yJAAA,EAAQ,CACR,IAAA,CAAK;QACL,aAAa;IAAA,CACb,CAAC,CACD,QAAA,EAAU;IACZ,UAAU,EACR,yJAAA,CAAO,EAAE,yJAAA,EAAQ,EAAE,EAAE,sJAAA,EAAK,CAAC,CAC3B,IAAA,CAAK;QACL,aAAa;IAAA,CACb,CAAC,CACD,QAAA,EAAU;IACZ,+BAA+B,EAC7B,0JAAA,EAAS,CACT,IAAA,CAAK;QACL,aACC;IAAA,CACD,CAAC,CACD,QAAA,EAAU;CACZ,CAAC;AAEF,MAAa,qBAAA,CACZ,YACI;IACJ,MAAM,6BAAyB,2KAAA,EAAY;QAC1C,QAAQ,SAAS,QAAQ,cAAc,oBAAoB,CAAA,CAAE;QAC7D,cAAc;KACd,CAAC;IAKF,WAAO,yLAAA,EACN,wBACA;QACC,QAAQ;QACR,MAAM,EAAE,yJAAA,CAAO;YACd,GAAG,uBAAuB,KAAA;YAC1B,GAAG,uBAAuB,KAAA;SAC1B,CAAC;QACF,KAAK;YAAC,6LAAA;SAAc;QACpB,UAAU;YACT,QAAQ;gBACP,MAAM,CAAA,CAAE;YAAA,CACR;YACD,SAAS;gBACR,aAAa;gBACb,WAAW;oBACV,OAAO;wBACN,aAAa;wBACb,SAAS;4BACR,oBAAoB;gCACnB,QAAQ;oCACP,MAAM;oCACN,aAAa;oCACb,MAAM;iCACN;4BAAA,CACD;wBAAA,CACD;qBACD;gBAAA,CACD;aACD;SACD;KACD,EACD,OAAO,QAAQ;QACd,MAAM,UAAU,UAAM,0LAAA,EAAkB,IAAI;QAE5C,IAAI,CAAC,WAAA,CAAY,IAAI,OAAA,IAAW,IAAI,OAAA,EACnC,CAAA,MAAM,IAAI,8JAAA,CAAS,eAAe;QAEnC,IAAI,OAAO,SAAS,QAAQ;QAC5B,IAAI,CAAC,MAAM;YACV,IAAI,CAAC,IAAI,IAAA,CAAK,MAAA,CACb,CAAA,MAAM,IAAI,8JAAA,CAAS,eAAe;YAEnC,OAAO,MAAM,IAAI,OAAA,CAAQ,eAAA,CAAgB,YAAA,CAAa,IAAI,IAAA,CAAK,MAAA,CAAO;;QAEvE,IAAI,CAAC,KACJ,CAAA,OAAO,IAAI,IAAA,CAAK,MAAM;YACrB,QAAQ;QAAA,CACR,CAAC;QAEH,MAAMA,YAAU,IAAI,OAAA,CAAQ,UAAA;QAC5B,MAAM,eACL,OAAOA,WAAS,kCAAkC,aAC/C,MAAMA,UAAQ,6BAAA,CAA8B,KAAK,GACjDA,WAAS,kCAAkC,KAAA,IAC1C,OACAA,UAAQ,6BAAA;QAEb,MAAM,iBAAiB,CAAC,WAAW,IAAI,IAAA,CAAK,MAAA;QAE5C,IAAI,CAAC,gBAAgB,CAAC,eACrB,CAAA,MAAM,IAAI,8JAAA,CAAS,aAAa;YAC/B,SACC,kNAAA,CAAyB,gDAAA;QAAA,CAC1B,CAAC;QAEH,MAAM,cAAU,gMAAA,EAAiB,IAAI,OAAA,EAASA,UAAa;QAE3D,MAAM,oBAAoB,MAAM,QAAQ,iBAAA,CAAkB,KAAK,EAAA,CAAG;QAQlE,IANC,OAAOA,UAAQ,iBAAA,KAAsB,WAClC,kBAAkB,MAAA,IAAUA,UAAQ,iBAAA,GACpC,OAAOA,UAAQ,iBAAA,KAAsB,aACpC,MAAMA,UAAQ,iBAAA,CAAkB,KAAK,GACrC,MAGJ,CAAA,MAAM,IAAI,8JAAA,CAAS,aAAa;YAC/B,SACC,kNAAA,CAAyB,oDAAA;QAAA,CAC1B,CAAC;QAMH,IAH6B,MAAM,QAAQ,sBAAA,CAC1C,IAAI,IAAA,CAAK,IAAA,CACT,CAEA,CAAA,MAAM,IAAI,8JAAA,CAAS,eAAe;YACjC,SAAS,kNAAA,CAAyB,2BAAA;QAAA,CAClC,CAAC;QAGH,IAAI,EACH,+BAA+B,CAAA,EAC/B,QAAQ,EAAA,EACR,GAAG,SAAA,GACA,IAAI,IAAA;QAER,IAAIA,UAAQ,oBAAA,EAAsB,cAAc;YAC/C,MAAM,WAAW,MAAMA,UAAQ,oBAAA,CAAqB,YAAA,CACnD;gBACC,cAAc;oBACb,GAAG,OAAA;oBACH,WAAA,aAAA,GAAW,IAAI,MAAM;iBACrB;gBACD;aACA,EACD,IAAI,OAAA,CACJ;YACD,IAAI,YAAY,OAAO,aAAa,YAAY,UAAU,SACzD,CAAA,UAAU;gBACT,GAAG,IAAI,IAAA;gBACP,GAAG,SAAS,IAAA;aACZ;;QAIH,IAAIA,WAAS,mBAAmB,0BAA0B;YACzD,MAAM,WACL,MAAMA,WAAS,kBAAkB,yBAAyB;gBACzD,cAAc;gBACd;aACA,CAAC;YACH,IAAI,YAAY,OAAO,aAAa,YAAY,UAAU,SACzD,CAAA,UAAU;gBACT,GAAG,IAAI,IAAA;gBACP,GAAG,SAAS,IAAA;aACZ;;QAIH,MAAM,eAAe,MAAM,QAAQ,kBAAA,CAAmB;YACrD,cAAc;gBACb,GAAG,OAAA;gBACH,WAAA,aAAA,GAAW,IAAI,MAAM;aACrB;QAAA,CACD,CAAC;QAEF,IAAIC;QAGJ,IAAIC,aAAgC;QACpC,IAAI,OAAO;YACV,QAAQ,KAAK,EAAA;YACb,gBAAgB,aAAa,EAAA;YAC7B,MAAM,IAAI,OAAA,CAAQ,UAAA,CAAW,WAAA,IAAe;SAC5C;QACD,IAAIF,WAAS,mBAAmB,iBAAiB;YAChD,MAAM,WAAW,MAAMA,WAAS,kBAAkB,gBAAgB;gBACjE,QAAQ;oBACP,QAAQ,KAAK,EAAA;oBACb,gBAAgB,aAAa,EAAA;oBAC7B,MAAM,IAAI,OAAA,CAAQ,UAAA,CAAW,WAAA,IAAe;iBAC5C;gBACD;gBACA;aACA,CAAC;YACF,IAAI,YAAY,OAAO,aAAa,YAAY,UAAU,SACzD,CAAA,OAAO;gBACN,GAAG,IAAA;gBACH,GAAG,SAAS,IAAA;aACZ;;QAGH,SAAS,MAAM,QAAQ,YAAA,CAAa,KAAK;QACzC,IAAIA,WAAS,mBAAmB,eAC/B,CAAA,MAAMA,WAAS,kBAAkB,eAAe;YAC/C;YACA;YACA;SACA,CAAC;QAEH,IACCA,WAAS,OAAO,WAChBA,UAAQ,KAAA,CAAM,WAAA,EAAa,YAAY,OACtC;YACD,IAAI,WAAW;gBACd,gBAAgB,aAAa,EAAA;gBAC7B,MAAM,GAAG,aAAa,IAAA,EAAA;gBACtB,WAAA,aAAA,GAAW,IAAI,MAAM;aACrB;YACD,IAAIA,WAAS,mBAAmB,kBAAkB;gBACjD,MAAM,WAAW,MAAMA,WAAS,kBAAkB,iBAAiB;oBAClE,MAAM;wBACL,gBAAgB,aAAa,EAAA;wBAC7B,MAAM,GAAG,aAAa,IAAA,EAAA;qBACtB;oBACD;oBACA;iBACA,CAAC;gBACF,IAAI,YAAY,OAAO,aAAa,YAAY,UAAU,SACzD,CAAA,WAAW;oBACV,GAAG,QAAA;oBACH,GAAG,SAAS,IAAA;iBACZ;;YAGH,MAAM,cACJ,MAAMA,UAAQ,KAAA,CAAM,WAAA,EAAa,0BACjC,cACA,IACA,IAAM,MAAM,QAAQ,UAAA,CAAW,SAAS;YAE1C,aAAa,MAAM,QAAQ,sBAAA,CAAuB;gBACjD,QAAQ,YAAY,EAAA;gBACpB,QAAQ,KAAK,EAAA;aACb,CAAC;YAEF,IAAIA,WAAS,mBAAmB,gBAC/B,CAAA,MAAMA,WAAS,kBAAkB,gBAAgB;gBAChD,MAAM;gBACN;gBACA;aACA,CAAC;;QAIJ,IAAIA,UAAQ,oBAAA,EAAsB,YACjC,CAAA,MAAMA,UAAQ,oBAAA,CAAqB,WAAA,CAClC;YACC;YACA;YACA;SACA,EACD,IAAI,OAAA,CACJ;QAGF,IAAIA,WAAS,mBAAmB,wBAC/B,CAAA,MAAMA,WAAS,kBAAkB,wBAAwB;YACxD;YACA;YACA;SACA,CAAC;QAGH,IAAI,IAAI,OAAA,CAAQ,OAAA,IAAW,CAAC,IAAI,IAAA,CAAK,6BAAA,CACpC,CAAA,MAAM,QAAQ,qBAAA,CACb,IAAI,OAAA,CAAQ,OAAA,CAAQ,OAAA,CAAQ,KAAA,EAC5B,aAAa,EAAA,EACb,IACA;QAGF,IACC,cACA,IAAI,OAAA,CAAQ,OAAA,IACZ,CAAC,IAAI,IAAA,CAAK,6BAAA,CAEV,CAAA,MAAM,QAAQ,aAAA,CACb,IAAI,OAAA,CAAQ,OAAA,CAAQ,OAAA,CAAQ,KAAA,EAC5B,WAAW,MAAA,EACX,IACA;QAGF,OAAO,IAAI,IAAA,CAAK;YACf,GAAG,YAAA;YACH,UACC,aAAa,QAAA,IAAY,OAAO,aAAa,QAAA,KAAa,WACvD,KAAK,KAAA,CAAM,aAAa,QAAA,CAAS,GACjC,aAAa,QAAA;YACjB,SAAS;gBAAC;aAAO;SACjB,CAAC;MAEH;;AAGF,MAAM,kCAAkC,EAAE,yJAAA,CAAO;IAChD,MAAM,EAAE,yJAAA,EAAQ,CAAC,IAAA,CAAK;QACrB,aAAa;IAAA,CACb,CAAC;AAAA,CACF,CAAC;AAEF,MAAa,wBAAA,CACZ,cAEA,yLAAA,EACC,4BACA;QACC,QAAQ;QACR,MAAM;QACN,KAAK;YAAC,qMAAA;YAA8B,6LAAA;SAAc;KAClD,EACD,OAAO,QAAQ;QAGd,IAAI,CADQ,UADO,gMAAA,EAAiB,IAAI,OAAA,EAAS,QAAQ,CAC5B,sBAAA,CAAuB,IAAI,IAAA,CAAK,IAAA,CAAK,CAEjE,CAAA,OAAO,IAAI,IAAA,CAAK;YACf,QAAQ;QAAA,CACR,CAAC;QAEH,MAAM,IAAI,8JAAA,CAAS,eAAe;YACjC,SAAS;QAAA,CACT,CAAC;MAEH;AAEF,MAAM,+BAA+B,EAAE,yJAAA,CAAO;IAC7C,MAAM,EACJ,yJAAA,EAAQ,CACR,GAAA,CAAI,EAAE,CACN,IAAA,CAAK;QACL,aAAa;IAAA,CACb,CAAC,CACD,QAAA,EAAU;IACZ,MAAM,EACJ,yJAAA,EAAQ,CACR,GAAA,CAAI,EAAE,CACN,IAAA,CAAK;QACL,aAAa;IAAA,CACb,CAAC,CACD,QAAA,EAAU;IACZ,MAAM,EACJ,yJAAA,EAAQ,CACR,IAAA,CAAK;QACL,aAAa;IAAA,CACb,CAAC,CACD,QAAA,EAAU;IACZ,UAAU,EACR,yJAAA,CAAO,EAAE,yJAAA,EAAQ,EAAE,EAAE,sJAAA,EAAK,CAAC,CAC3B,IAAA,CAAK;QACL,aAAa;IAAA,CACb,CAAC,CACD,QAAA,EAAU;CACZ,CAAC;AAEF,MAAa,qBAAA,CACZ,YACI;IACJ,MAAM,6BAAyB,2KAAA,EAAY;QAC1C,QAAQ,SAAS,QAAQ,cAAc,oBAAoB,CAAA,CAAE;QAC7D,cAAc;KACd,CAAC;IAUF,WAAO,yLAAA,EACN,wBACA;QACC,QAAQ;QACR,MAAM,EAAE,yJAAA,CAAO;YACd,MAAM,EACJ,yJAAA,CAAO;gBACP,GAAG,uBAAuB,KAAA;gBAC1B,GAAG,6BAA6B,KAAA;aAChC,CAAC,CACD,OAAA,EAAS;YACX,gBAAgB,EACd,yJAAA,EAAQ,CACR,IAAA,CAAK;gBACL,aAAa;YAAA,CACb,CAAC,CACD,QAAA,EAAU;SACZ,CAAC;QACF,gBAAgB;QAChB,KAAK;YAAC,6LAAA;SAAc;QACpB,UAAU;YACT,QAAQ;gBACP,MAAM,CAAA,CAAE;YAAA,CACR;YACD,SAAS;gBACR,aAAa;gBACb,WAAW;oBACV,OAAO;wBACN,aAAa;wBACb,SAAS;4BACR,oBAAoB;gCACnB,QAAQ;oCACP,MAAM;oCACN,aAAa;oCACb,MAAM;iCACN;4BAAA,CACD;wBAAA,CACD;qBACD;gBAAA,CACD;aACD;SACD;KACD,EACD,OAAO,QAAQ;QACd,MAAM,UAAU,MAAM,IAAI,OAAA,CAAQ,UAAA,CAAW,IAAI;QACjD,IAAI,CAAC,QACJ,CAAA,MAAM,IAAI,8JAAA,CAAS,gBAAgB;YAClC,SAAS;QAAA,CACT,CAAC;QAEH,MAAM,iBACL,IAAI,IAAA,CAAK,cAAA,IAAkB,QAAQ,OAAA,CAAQ,oBAAA;QAC5C,IAAI,CAAC,eACJ,CAAA,MAAM,IAAI,8JAAA,CAAS,eAAe;YACjC,SAAS,kNAAA,CAAyB,sBAAA;QAAA,CAClC,CAAC;QAEH,MAAM,cAAU,gMAAA,EAAiB,IAAI,OAAA,EAAS,QAAQ;QACtD,MAAM,SAAS,MAAM,QAAQ,iBAAA,CAAkB;YAC9C,QAAQ,QAAQ,IAAA,CAAK,EAAA;YACL;SAChB,CAAC;QACF,IAAI,CAAC,OACJ,CAAA,MAAM,IAAI,8JAAA,CAAS,eAAe;YACjC,SACC,kNAAA,CAAyB,wCAAA;QAAA,CAC1B,CAAC;QAaH,IAAI,CAXiB,UAAM,0MAAA,EAC1B;YACC,aAAa;gBACZ,cAAc;oBAAC;iBAAS;YAAA,CACxB;YACD,MAAM,OAAO,IAAA;YACb,SAAS,IAAI,OAAA,CAAQ,UAAA;YACrB;SACA,EACD,IACA,CAEA,CAAA,MAAM,IAAI,8JAAA,CAAS,aAAa;YAC/B,SACC,kNAAA,CAAyB,+CAAA;QAAA,CAC1B,CAAC;QAGH,IAAI,OAAO,IAAI,IAAA,CAAK,IAAA,CAAK,IAAA,KAAS,UAAU;YAC3C,MAAM,uBAAuB,MAAM,QAAQ,sBAAA,CAC1C,IAAI,IAAA,CAAK,IAAA,CAAK,IAAA,CACd;YACD,IACC,wBACA,qBAAqB,EAAA,KAAO,eAE5B,CAAA,MAAM,IAAI,8JAAA,CAAS,eAAe;gBACjC,SAAS,kNAAA,CAAyB,+BAAA;YAAA,CAClC,CAAC;;QAGJ,IAAI,SAAS,mBAAmB,0BAA0B;YACzD,MAAM,WACL,MAAM,QAAQ,iBAAA,CAAkB,wBAAA,CAAyB;gBACxD,cAAc,IAAI,IAAA,CAAK,IAAA;gBACvB,MAAM,QAAQ,IAAA;gBACd;aACA,CAAC;YACH,IAAI,YAAY,OAAO,aAAa,YAAY,UAAU,SACzD,CAAA,IAAI,IAAA,CAAK,IAAA,GAAO;gBACf,GAAG,IAAI,IAAA,CAAK,IAAA;gBACZ,GAAG,SAAS,IAAA;aACZ;;QAGH,MAAM,aAAa,MAAM,QAAQ,kBAAA,CAChC,gBACA,IAAI,IAAA,CAAK,IAAA,CACT;QACD,IAAI,SAAS,mBAAmB,wBAC/B,CAAA,MAAM,QAAQ,iBAAA,CAAkB,uBAAA,CAAwB;YACvD,cAAc;YACd,MAAM,QAAQ,IAAA;YACd;SACA,CAAC;QAEH,OAAO,IAAI,IAAA,CAAK,WAAW;MAE5B;;AAGF,MAAM,+BAA+B,EAAE,yJAAA,CAAO;IAC7C,gBAAgB,EAAE,yJAAA,EAAQ,CAAC,IAAA,CAAK;QAC/B,aAAa;IAAA,CACb,CAAC;AAAA,CACF,CAAC;AAEF,MAAa,qBAAA,CACZ,YACI;IACJ,WAAO,yLAAA,EACN,wBACA;QACC,QAAQ;QACR,MAAM;QACN,gBAAgB;QAChB,KAAK;YAAC,6LAAA;SAAc;QACpB,UAAU;YACT,SAAS;gBACR,aAAa;gBACb,WAAW;oBACV,OAAO;wBACN,aAAa;wBACb,SAAS;4BACR,oBAAoB;gCACnB,QAAQ;oCACP,MAAM;oCACN,aAAa;iCACb;4BAAA,CACD;wBAAA,CACD;qBACD;gBAAA,CACD;aACD;QAAA,CACD;KACD,EACD,OAAO,QAAQ;QAId,IAFC,IAAI,OAAA,CAAQ,UAAA,CAAW,oBAAA,EAAsB,YAC7C,IAAI,OAAA,CAAQ,UAAA,CAAW,2BAAA,EACS;YAChC,IAAI,IAAI,OAAA,CAAQ,UAAA,CAAW,oBAAA,EAAsB,SAChD,CAAA,IAAI,OAAA,CAAQ,MAAA,CAAO,IAAA,CAClB,2FACA;YAEF,MAAM,IAAI,8JAAA,CAAS,aAAa;gBAC/B,SAAS;YAAA,CACT,CAAC;;QAEH,MAAM,UAAU,MAAM,IAAI,OAAA,CAAQ,UAAA,CAAW,IAAI;QACjD,IAAI,CAAC,QACJ,CAAA,MAAM,IAAI,8JAAA,CAAS,gBAAgB;YAAE,QAAQ;QAAA,CAAK,CAAC;QAGpD,MAAM,iBAAiB,IAAI,IAAA,CAAK,cAAA;QAChC,IAAI,CAAC,eACJ,CAAA,OAAO,IAAI,IAAA,CAAK,MAAM;YACrB,QAAQ;YACR,MAAM;gBACL,SAAS,kNAAA,CAAyB,sBAAA;YAAA,CAClC;SACD,CAAC;QAEH,MAAM,cAAU,gMAAA,EAAiB,IAAI,OAAA,EAAS,QAAQ;QACtD,MAAM,SAAS,MAAM,QAAQ,iBAAA,CAAkB;YAC9C,QAAQ,QAAQ,IAAA,CAAK,EAAA;YACL;SAChB,CAAC;QACF,IAAI,CAAC,OACJ,CAAA,MAAM,IAAI,8JAAA,CAAS,eAAe;YACjC,SACC,kNAAA,CAAyB,wCAAA;QAAA,CAC1B,CAAC;QAaH,IAAI,CAXiB,UAAM,0MAAA,EAC1B;YACC,MAAM,OAAO,IAAA;YACb,aAAa;gBACZ,cAAc;oBAAC;iBAAS;YAAA,CACxB;YACD;YACA,SAAS,IAAI,OAAA,CAAQ,UAAA;SACrB,EACD,IACA,CAEA,CAAA,MAAM,IAAI,8JAAA,CAAS,aAAa;YAC/B,SACC,kNAAA,CAAyB,+CAAA;QAAA,CAC1B,CAAC;QAEH,IAAI,mBAAmB,QAAQ,OAAA,CAAQ,oBAAA;;KAItC,MAAM,QAAQ,qBAAA,CAAsB,QAAQ,OAAA,CAAQ,KAAA,EAAO,MAAM,IAAI;QAGtE,MAAM,MAAM,MAAM,QAAQ,oBAAA,CAAqB,eAAe;QAC9D,IAAI,CAAC,IACJ,CAAA,MAAM,IAAI,8JAAA,CAAS,cAAc;QAElC,IAAI,SAAS,mBAAmB,yBAC/B,CAAA,MAAM,QAAQ,iBAAA,CAAkB,wBAAA,CAAyB;YACxD,cAAc;YACd,MAAM,QAAQ,IAAA;SACd,CAAC;QAEH,MAAM,QAAQ,kBAAA,CAAmB,eAAe;QAChD,IAAI,SAAS,mBAAmB,wBAC/B,CAAA,MAAM,QAAQ,iBAAA,CAAkB,uBAAA,CAAwB;YACvD,cAAc;YACd,MAAM,QAAQ,IAAA;SACd,CAAC;QAEH,OAAO,IAAI,IAAA,CAAK,IAAI;MAErB;;AAGF,MAAM,iCAAiC,EAAE,2JAAA,CACxC,EAAE,yJAAA,CAAO;IACR,gBAAgB,EACd,yJAAA,EAAQ,CACR,IAAA,CAAK;QACL,aAAa;IAAA,CACb,CAAC,CACD,QAAA,EAAU;IACZ,kBAAkB,EAChB,yJAAA,EAAQ,CACR,IAAA,CAAK;QACL,aAAa;IAAA,CACb,CAAC,CACD,QAAA,EAAU;IACZ,cAAc,EACZ,yJAAA,EAAQ,CACR,EAAA,CAAG,EAAE,yJAAA,EAAQ,CAAC,SAAA,CAAA,CAAW,MAAQ,SAAS,IAAI,CAAC,CAAC,CAChD,IAAA,CAAK;QACL,aACC;IAAA,CACD,CAAC,CACD,QAAA,EAAU;CACZ,CAAC,CACF;AAED,MAAa,sBAAA,CACZ,cAEA,yLAAA,EACC,uCACA;QACC,QAAQ;QACR,OAAO;QACP,gBAAgB;QAChB,KAAK;YAAC,6LAAA;YAAe,oMAAA;SAAqB;QAC1C,UAAU;YACT,SAAS;gBACR,aAAa;gBACb,aAAa;gBACb,WAAW;oBACV,OAAO;wBACN,aAAa;wBACb,SAAS;4BACR,oBAAoB;gCACnB,QAAQ;oCACP,MAAM;oCACN,aAAa;oCACb,MAAM;iCACN;4BAAA,CACD;wBAAA,CACD;qBACD;gBAAA,CACD;aACD;QAAA,CACD;KACD,EACD,OAAO,QAAQ;QACd,MAAM,UAAU,IAAI,OAAA,CAAQ,OAAA;QAC5B,MAAM,iBACL,IAAI,KAAA,EAAO,oBACX,IAAI,KAAA,EAAO,kBACX,QAAQ,OAAA,CAAQ,oBAAA;QAEjB,IAAI,CAAC,eACJ,CAAA,OAAO,IAAI,IAAA,CAAK,MAAM;YACrB,QAAQ;QAAA,CACR,CAAC;QAEH,MAAM,cAAU,gMAAA,EAAiB,IAAI,OAAA,EAAS,QAAQ;QACtD,MAAM,eAAe,MAAM,QAAQ,oBAAA,CAAqB;YACvD;YACA,QAAQ,CAAC,CAAC,IAAI,KAAA,EAAO;YACrB,cAAc,IAAI,OAAA,CAAQ,UAAA,CAAW,KAAA,EAAO;YAC5C,cAAc,IAAI,KAAA,EAAO;SACzB,CAAC;QACF,IAAI,CAAC,aACJ,CAAA,MAAM,IAAI,8JAAA,CAAS,eAAe;YACjC,SAAS,kNAAA,CAAyB,sBAAA;QAAA,CAClC,CAAC;QAMH,IAAI,CAJa,MAAM,QAAQ,eAAA,CAAgB;YAC9C,QAAQ,QAAQ,IAAA,CAAK,EAAA;YACrB,gBAAgB,aAAa,EAAA;SAC7B,CAAC,EACa;YACd,MAAM,QAAQ,qBAAA,CAAsB,QAAQ,OAAA,CAAQ,KAAA,EAAO,MAAM,IAAI;YACrE,MAAM,IAAI,8JAAA,CAAS,aAAa;gBAC/B,SACC,kNAAA,CAAyB,wCAAA;YAAA,CAC1B,CAAC;;QAaH,OAAO,IAAI,IAAA,CAAK,aAA8C;MAE/D;AAEF,MAAM,kCAAkC,EAAE,yJAAA,CAAO;IAChD,gBAAgB,EACd,yJAAA,EAAQ,CACR,IAAA,CAAK;QACL,aACC;IAAA,CACD,CAAC,CACD,QAAA,EAAU,CACV,QAAA,EAAU;IACZ,kBAAkB,EAChB,yJAAA,EAAQ,CACR,IAAA,CAAK;QACL,aACC;IAAA,CACD,CAAC,CACD,QAAA,EAAU;CACZ,CAAC;AAEF,MAAa,wBAAA,CACZ,YACI;IACJ,WAAO,yLAAA,EACN,4BACA;QACC,QAAQ;QACR,MAAM;QACN,KAAK;YAAC,oMAAA;YAAsB,6LAAA;SAAc;QAC1C,gBAAgB;QAChB,UAAU;YACT,SAAS;gBACR,aAAa;gBACb,aAAa;gBACb,WAAW;oBACV,OAAO;wBACN,aAAa;wBACb,SAAS;4BACR,oBAAoB;gCACnB,QAAQ;oCACP,MAAM;oCACN,aAAa;oCACb,MAAM;iCACN;4BAAA,CACD;wBAAA,CACD;qBACD;gBAAA,CACD;aACD;QAAA,CACD;KACD,EACD,OAAO,QAAQ;QACd,MAAM,cAAU,gMAAA,EAAiB,IAAI,OAAA,EAAS,QAAQ;QACtD,MAAM,UAAU,IAAI,OAAA,CAAQ,OAAA;QAC5B,IAAI,iBAAiB,IAAI,IAAA,CAAK,cAAA;QAC9B,MAAM,mBAAmB,IAAI,IAAA,CAAK,gBAAA;QAElC,IAAI,mBAAmB,MAAM;YAE5B,IAAI,CADiB,QAAQ,OAAA,CAAQ,oBAAA,CAEpC,CAAA,OAAO,IAAI,IAAA,CAAK,KAAK;YAOtB,UAAM,iMAAA,EAAiB,KAAK;gBAC3B,SANsB,MAAM,QAAQ,qBAAA,CACpC,QAAQ,OAAA,CAAQ,KAAA,EAChB,MACA,IACA;gBAGA,MAAM,QAAQ,IAAA;aACd,CAAC;YACF,OAAO,IAAI,IAAA,CAAK,KAAK;;QAGtB,IAAI,CAAC,kBAAkB,CAAC,kBAAkB;YACzC,MAAM,eAAe,QAAQ,OAAA,CAAQ,oBAAA;YACrC,IAAI,CAAC,aACJ,CAAA,OAAO,IAAI,IAAA,CAAK,KAAK;YAEtB,iBAAiB;;QAGlB,IAAI,oBAAoB,CAAC,gBAAgB;YACxC,MAAMG,iBACL,MAAM,QAAQ,sBAAA,CAAuB,iBAAiB;YACvD,IAAI,CAACA,eACJ,CAAA,MAAM,IAAI,8JAAA,CAAS,eAAe;gBACjC,SAAS,kNAAA,CAAyB,sBAAA;YAAA,CAClC,CAAC;YAEH,iBAAiBA,eAAa,EAAA;;QAG/B,IAAI,CAAC,eACJ,CAAA,MAAM,IAAI,8JAAA,CAAS,eAAe;YACjC,SAAS,kNAAA,CAAyB,sBAAA;QAAA,CAClC,CAAC;QAOH,IAAI,CAJa,MAAM,QAAQ,eAAA,CAAgB;YAC9C,QAAQ,QAAQ,IAAA,CAAK,EAAA;YACrB;SACA,CAAC,EACa;YACd,MAAM,QAAQ,qBAAA,CAAsB,QAAQ,OAAA,CAAQ,KAAA,EAAO,MAAM,IAAI;YACrE,MAAM,IAAI,8JAAA,CAAS,aAAa;gBAC/B,SACC,kNAAA,CAAyB,wCAAA;YAAA,CAC1B,CAAC;;QAGH,MAAM,eAAe,MAAM,QAAQ,oBAAA,CAAqB,eAAe;QACvE,IAAI,CAAC,aACJ,CAAA,MAAM,IAAI,8JAAA,CAAS,eAAe;YACjC,SAAS,kNAAA,CAAyB,sBAAA;QAAA,CAClC,CAAC;QAOH,UAAM,iMAAA,EAAiB,KAAK;YAC3B,SANsB,MAAM,QAAQ,qBAAA,CACpC,QAAQ,OAAA,CAAQ,KAAA,EAChB,aAAa,EAAA,EACb,IACA;YAGA,MAAM,QAAQ,IAAA;SACd,CAAC;QAWF,OAAO,IAAI,IAAA,CAAK,aAA8C;MAE/D;;AAGF,MAAa,oBAAA,CAAoD,cAChE,yLAAA,EACC,sBACA;QACC,QAAQ;QACR,KAAK;YAAC,6LAAA;YAAe,oMAAA;SAAqB;QAC1C,gBAAgB;QAChB,UAAU;YACT,SAAS;gBACR,aAAa;gBACb,WAAW;oBACV,OAAO;wBACN,aAAa;wBACb,SAAS;4BACR,oBAAoB;gCACnB,QAAQ;oCACP,MAAM;oCACN,OAAO;wCACN,MAAM;oCAAA,CACN;iCACD;4BAAA,CACD;wBAAA,CACD;qBACD;gBAAA,CACD;aACD;QAAA,CACD;KACD,EACD,OAAO,QAAQ;QAEd,MAAM,gBAAgB,UADN,gMAAA,EAAiB,IAAI,OAAA,EAAS,QAAQ,CAClB,iBAAA,CACnC,IAAI,OAAA,CAAQ,OAAA,CAAQ,IAAA,CAAK,EAAA,CACzB;QACD,OAAO,IAAI,IAAA,CAAK,cAAc;MAE/B"}},
    {"offset": {"line": 4245, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/organization/schema.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/organization/schema.ts"],"sourcesContent":["import type { BetterAuthPluginDBSchema } from \"@better-auth/core/db\";\nimport type { Prettify } from \"better-call\";\nimport * as z from \"zod\";\nimport type {\n\tFieldAttributeToObject,\n\tRemoveFieldsWithReturnedFalse,\n} from \"../../db\";\nimport { generateId } from \"../../utils\";\nimport type { OrganizationOptions } from \"./types\";\n\ntype InferSchema<\n\tSchema extends BetterAuthPluginDBSchema,\n\tTableName extends string,\n\tDefaultFields,\n> = {\n\tmodelName: Schema[TableName] extends { modelName: infer M }\n\t\t? M extends string\n\t\t\t? M\n\t\t\t: string\n\t\t: string;\n\tfields: {\n\t\t[K in keyof DefaultFields]: DefaultFields[K];\n\t} & (Schema[TableName] extends { additionalFields: infer F } ? F : {});\n};\n\ninterface OrganizationRoleDefaultFields {\n\torganizationId: {\n\t\ttype: \"string\";\n\t\trequired: true;\n\t\treferences: {\n\t\t\tmodel: \"organization\";\n\t\t\tfield: \"id\";\n\t\t};\n\t};\n\trole: {\n\t\ttype: \"string\";\n\t\trequired: true;\n\t};\n\tpermission: {\n\t\ttype: \"string\";\n\t\trequired: true;\n\t};\n\tcreatedAt: {\n\t\ttype: \"date\";\n\t\trequired: true;\n\t\tdefaultValue: Date;\n\t};\n\tupdatedAt: {\n\t\ttype: \"date\";\n\t\trequired: false;\n\t};\n}\n\ninterface TeamDefaultFields {\n\tname: {\n\t\ttype: \"string\";\n\t\trequired: true;\n\t};\n\torganizationId: {\n\t\ttype: \"string\";\n\t\trequired: true;\n\t\treferences: {\n\t\t\tmodel: \"organization\";\n\t\t\tfield: \"id\";\n\t\t};\n\t};\n\tcreatedAt: {\n\t\ttype: \"date\";\n\t\trequired: true;\n\t};\n\tupdatedAt: {\n\t\ttype: \"date\";\n\t\trequired: false;\n\t};\n}\n\ninterface TeamMemberDefaultFields {\n\tteamId: {\n\t\ttype: \"string\";\n\t\trequired: true;\n\t\treferences: {\n\t\t\tmodel: \"team\";\n\t\t\tfield: \"id\";\n\t\t};\n\t};\n\tuserId: {\n\t\ttype: \"string\";\n\t\trequired: true;\n\t\treferences: {\n\t\t\tmodel: \"user\";\n\t\t\tfield: \"id\";\n\t\t};\n\t};\n\tcreatedAt: {\n\t\ttype: \"date\";\n\t\trequired: false;\n\t};\n}\n\ninterface OrganizationDefaultFields {\n\tname: {\n\t\ttype: \"string\";\n\t\trequired: true;\n\t\tsortable: true;\n\t};\n\tslug: {\n\t\ttype: \"string\";\n\t\trequired: true;\n\t\tunique: true;\n\t\tsortable: true;\n\t};\n\tlogo: {\n\t\ttype: \"string\";\n\t\trequired: false;\n\t};\n\tcreatedAt: {\n\t\ttype: \"date\";\n\t\trequired: true;\n\t};\n\tupdatedAt: {\n\t\ttype: \"date\";\n\t\trequired: false;\n\t};\n}\n\ninterface MemberDefaultFields {\n\torganizationId: {\n\t\ttype: \"string\";\n\t\trequired: true;\n\t\treferences: {\n\t\t\tmodel: \"organization\";\n\t\t\tfield: \"id\";\n\t\t};\n\t};\n\tuserId: {\n\t\ttype: \"string\";\n\t\trequired: true;\n\t\treferences: {\n\t\t\tmodel: \"user\";\n\t\t\tfield: \"id\";\n\t\t};\n\t};\n\trole: {\n\t\ttype: \"string\";\n\t\trequired: true;\n\t\tdefaultValue: \"member\";\n\t};\n\tcreatedAt: {\n\t\ttype: \"date\";\n\t\trequired: true;\n\t};\n}\n\ninterface InvitationDefaultFields {\n\torganizationId: {\n\t\ttype: \"string\";\n\t\trequired: true;\n\t\treferences: {\n\t\t\tmodel: \"organization\";\n\t\t\tfield: \"id\";\n\t\t};\n\t};\n\temail: {\n\t\ttype: \"string\";\n\t\trequired: true;\n\t\tsortable: true;\n\t};\n\trole: {\n\t\ttype: \"string\";\n\t\trequired: true;\n\t\tsortable: true;\n\t};\n\tstatus: {\n\t\ttype: \"string\";\n\t\trequired: true;\n\t\tsortable: true;\n\t\tdefaultValue: \"pending\";\n\t};\n\texpiresAt: {\n\t\ttype: \"date\";\n\t\trequired: false;\n\t};\n\tcreatedAt: {\n\t\ttype: \"date\";\n\t\trequired: true;\n\t\tdefaultValue: Date;\n\t};\n\tinviterId: {\n\t\ttype: \"string\";\n\t\trequired: true;\n\t\treferences: {\n\t\t\tmodel: \"user\";\n\t\t\tfield: \"id\";\n\t\t};\n\t};\n}\n\ninterface SessionDefaultFields {\n\tactiveOrganizationId: {\n\t\ttype: \"string\";\n\t\trequired: false;\n\t};\n}\n\nexport type OrganizationSchema<O extends OrganizationOptions> =\n\t(O[\"dynamicAccessControl\"] extends { enabled: true }\n\t\t? {\n\t\t\t\torganizationRole: InferSchema<\n\t\t\t\t\tO[\"schema\"] extends BetterAuthPluginDBSchema ? O[\"schema\"] : {},\n\t\t\t\t\t\"organizationRole\",\n\t\t\t\t\tOrganizationRoleDefaultFields\n\t\t\t\t>;\n\t\t\t} & {\n\t\t\t\tsession: {\n\t\t\t\t\tfields: InferSchema<\n\t\t\t\t\t\tO[\"schema\"] extends BetterAuthPluginDBSchema ? O[\"schema\"] : {},\n\t\t\t\t\t\t\"session\",\n\t\t\t\t\t\tSessionDefaultFields\n\t\t\t\t\t>[\"fields\"];\n\t\t\t\t};\n\t\t\t}\n\t\t: {}) &\n\t\t(O[\"teams\"] extends { enabled: true }\n\t\t\t? {\n\t\t\t\t\tteam: InferSchema<\n\t\t\t\t\t\tO[\"schema\"] extends BetterAuthPluginDBSchema ? O[\"schema\"] : {},\n\t\t\t\t\t\t\"team\",\n\t\t\t\t\t\tTeamDefaultFields\n\t\t\t\t\t>;\n\t\t\t\t\tteamMember: InferSchema<\n\t\t\t\t\t\tO[\"schema\"] extends BetterAuthPluginDBSchema ? O[\"schema\"] : {},\n\t\t\t\t\t\t\"teamMember\",\n\t\t\t\t\t\tTeamMemberDefaultFields\n\t\t\t\t\t>;\n\t\t\t\t}\n\t\t\t: {}) & {\n\t\t\torganization: InferSchema<\n\t\t\t\tO[\"schema\"] extends BetterAuthPluginDBSchema ? O[\"schema\"] : {},\n\t\t\t\t\"organization\",\n\t\t\t\tOrganizationDefaultFields\n\t\t\t>;\n\t\t\tmember: InferSchema<\n\t\t\t\tO[\"schema\"] extends BetterAuthPluginDBSchema ? O[\"schema\"] : {},\n\t\t\t\t\"member\",\n\t\t\t\tMemberDefaultFields\n\t\t\t>;\n\t\t\tinvitation: {\n\t\t\t\tmodelName: O[\"schema\"] extends BetterAuthPluginDBSchema\n\t\t\t\t\t? InferSchema<\n\t\t\t\t\t\t\tO[\"schema\"],\n\t\t\t\t\t\t\t\"invitation\",\n\t\t\t\t\t\t\tInvitationDefaultFields\n\t\t\t\t\t\t>[\"modelName\"]\n\t\t\t\t\t: string;\n\t\t\t\tfields: InferSchema<\n\t\t\t\t\tO[\"schema\"] extends BetterAuthPluginDBSchema ? O[\"schema\"] : {},\n\t\t\t\t\t\"invitation\",\n\t\t\t\t\tInvitationDefaultFields\n\t\t\t\t>[\"fields\"] &\n\t\t\t\t\t(O extends { teams: { enabled: true } }\n\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\tteamId: {\n\t\t\t\t\t\t\t\t\ttype: \"string\";\n\t\t\t\t\t\t\t\t\trequired: false;\n\t\t\t\t\t\t\t\t\tsortable: true;\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t: {});\n\t\t\t};\n\t\t\tsession: {\n\t\t\t\tfields: InferSchema<\n\t\t\t\t\tO[\"schema\"] extends BetterAuthPluginDBSchema ? O[\"schema\"] : {},\n\t\t\t\t\t\"session\",\n\t\t\t\t\tSessionDefaultFields\n\t\t\t\t>[\"fields\"] &\n\t\t\t\t\t(O[\"teams\"] extends { enabled: true }\n\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\tactiveTeamId: {\n\t\t\t\t\t\t\t\t\ttype: \"string\";\n\t\t\t\t\t\t\t\t\trequired: false;\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t: {});\n\t\t\t};\n\t\t};\n\nexport const roleSchema = z.string();\nexport const invitationStatus = z\n\t.enum([\"pending\", \"accepted\", \"rejected\", \"canceled\"])\n\t.default(\"pending\");\n\nexport const organizationSchema = z.object({\n\tid: z.string().default(generateId),\n\tname: z.string(),\n\tslug: z.string(),\n\tlogo: z.string().nullish().optional(),\n\tmetadata: z\n\t\t.record(z.string(), z.unknown())\n\t\t.or(z.string().transform((v) => JSON.parse(v)))\n\t\t.optional(),\n\tcreatedAt: z.date(),\n});\n\nexport const memberSchema = z.object({\n\tid: z.string().default(generateId),\n\torganizationId: z.string(),\n\tuserId: z.coerce.string(),\n\trole: roleSchema,\n\tcreatedAt: z.date().default(() => new Date()),\n});\n\nexport const invitationSchema = z.object({\n\tid: z.string().default(generateId),\n\torganizationId: z.string(),\n\temail: z.string(),\n\trole: roleSchema,\n\tstatus: invitationStatus,\n\tteamId: z.string().nullish(),\n\tinviterId: z.string(),\n\texpiresAt: z.date(),\n\tcreatedAt: z.date().default(() => new Date()),\n});\n\nexport const teamSchema = z.object({\n\tid: z.string().default(generateId),\n\tname: z.string().min(1),\n\torganizationId: z.string(),\n\tcreatedAt: z.date(),\n\tupdatedAt: z.date().optional(),\n});\n\nexport const teamMemberSchema = z.object({\n\tid: z.string().default(generateId),\n\tteamId: z.string(),\n\tuserId: z.string(),\n\tcreatedAt: z.date().default(() => new Date()),\n});\n\nexport const organizationRoleSchema = z.object({\n\tid: z.string().default(generateId),\n\torganizationId: z.string(),\n\trole: z.string(),\n\tpermission: z.record(z.string(), z.array(z.string())),\n\tcreatedAt: z.date().default(() => new Date()),\n\tupdatedAt: z.date().optional(),\n});\n\nexport type Organization = z.infer<typeof organizationSchema>;\nexport type Member = z.infer<typeof memberSchema>;\nexport type TeamMember = z.infer<typeof teamMemberSchema>;\nexport type Team = z.infer<typeof teamSchema>;\nexport type Invitation = z.infer<typeof invitationSchema>;\nexport type InvitationInput = z.input<typeof invitationSchema>;\nexport type MemberInput = z.input<typeof memberSchema>;\nexport type TeamMemberInput = z.input<typeof teamMemberSchema>;\nexport type OrganizationInput = z.input<typeof organizationSchema>;\nexport type TeamInput = z.infer<typeof teamSchema>;\nexport type OrganizationRole = z.infer<typeof organizationRoleSchema>;\n\nconst defaultRoles = [\"admin\", \"member\", \"owner\"] as const;\nexport const defaultRolesSchema = z.union([\n\tz.enum(defaultRoles),\n\tz.array(z.enum(defaultRoles)),\n]);\n\ntype CustomRolesSchema<O> = O extends { roles: { [key: string]: any } }\n\t? z.ZodType<keyof O[\"roles\"] | Array<keyof O[\"roles\"]>>\n\t: typeof defaultRolesSchema;\n\nexport type InferOrganizationZodRolesFromOption<\n\tO extends OrganizationOptions | undefined,\n> = CustomRolesSchema<O>;\n\nexport type InferOrganizationRolesFromOption<\n\tO extends OrganizationOptions | undefined,\n> = O extends { roles: any }\n\t? keyof O[\"roles\"] extends infer K extends string\n\t\t? K\n\t\t: \"admin\" | \"member\" | \"owner\"\n\t: \"admin\" | \"member\" | \"owner\";\n\nexport type InvitationStatus = \"pending\" | \"accepted\" | \"rejected\" | \"canceled\";\n\nimport type { DBFieldAttribute } from \"@better-auth/core/db\";\n\ntype InferAdditionalFieldsOutput<\n\tSchemaName extends string,\n\tOptions extends OrganizationOptions,\n\tisClientSide extends boolean,\n> = Options[\"schema\"] extends {\n\t[key in SchemaName]?: {\n\t\tadditionalFields: infer Field extends Record<string, DBFieldAttribute>;\n\t};\n}\n\t? isClientSide extends true\n\t\t? FieldAttributeToObject<RemoveFieldsWithReturnedFalse<Field>>\n\t\t: FieldAttributeToObject<Field>\n\t: {};\n\nexport type InferMember<\n\tO extends OrganizationOptions,\n\tisClientSide extends boolean = true,\n> = Prettify<\n\t(O[\"teams\"] extends {\n\t\tenabled: true;\n\t}\n\t\t? {\n\t\t\t\tid: string;\n\t\t\t\torganizationId: string;\n\t\t\t\trole: InferOrganizationRolesFromOption<O>;\n\t\t\t\tcreatedAt: Date;\n\t\t\t\tuserId: string;\n\t\t\t\tteamId?: string | undefined;\n\t\t\t\tuser: {\n\t\t\t\t\tid: string;\n\t\t\t\t\temail: string;\n\t\t\t\t\tname: string;\n\t\t\t\t\timage?: string | undefined;\n\t\t\t\t};\n\t\t\t}\n\t\t: {\n\t\t\t\tid: string;\n\t\t\t\torganizationId: string;\n\t\t\t\trole: InferOrganizationRolesFromOption<O>;\n\t\t\t\tcreatedAt: Date;\n\t\t\t\tuserId: string;\n\t\t\t\tuser: {\n\t\t\t\t\tid: string;\n\t\t\t\t\temail: string;\n\t\t\t\t\tname: string;\n\t\t\t\t\timage?: string | undefined;\n\t\t\t\t};\n\t\t\t}) &\n\t\tInferAdditionalFieldsOutput<\"member\", O, isClientSide>\n>;\n\nexport type InferOrganization<\n\tO extends OrganizationOptions,\n\tisClientSide extends boolean = true,\n> = Prettify<\n\tOrganization & InferAdditionalFieldsOutput<\"organization\", O, isClientSide>\n>;\n\nexport type InferTeam<\n\tO extends OrganizationOptions,\n\tisClientSide extends boolean = true,\n> = Prettify<Team & InferAdditionalFieldsOutput<\"team\", O, isClientSide>>;\n\nexport type InferInvitation<\n\tO extends OrganizationOptions,\n\tisClientSide extends boolean = true,\n> = Prettify<\n\t(O[\"teams\"] extends {\n\t\tenabled: true;\n\t}\n\t\t? {\n\t\t\t\tid: string;\n\t\t\t\torganizationId: string;\n\t\t\t\temail: string;\n\t\t\t\trole: InferOrganizationRolesFromOption<O>;\n\t\t\t\tstatus: InvitationStatus;\n\t\t\t\tinviterId: string;\n\t\t\t\texpiresAt: Date;\n\t\t\t\tcreatedAt: Date;\n\t\t\t\tteamId?: string | undefined;\n\t\t\t}\n\t\t: {\n\t\t\t\tid: string;\n\t\t\t\torganizationId: string;\n\t\t\t\temail: string;\n\t\t\t\trole: InferOrganizationRolesFromOption<O>;\n\t\t\t\tstatus: InvitationStatus;\n\t\t\t\tinviterId: string;\n\t\t\t\texpiresAt: Date;\n\t\t\t\tcreatedAt: Date;\n\t\t\t}) &\n\t\tInferAdditionalFieldsOutput<\"invitation\", O, isClientSide>\n>;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4325, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/organization/routes/crud-team.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/organization/routes/crud-team.ts"],"sourcesContent":["import { createAuthEndpoint } from \"@better-auth/core/api\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { getSessionFromCtx } from \"../../../api\";\nimport { setSessionCookie } from \"../../../cookies\";\nimport type { InferAdditionalFieldsFromPluginOptions } from \"../../../db\";\nimport { toZodSchema } from \"../../../db\";\nimport type { PrettifyDeep } from \"../../../types/helper\";\nimport { getOrgAdapter } from \"../adapter\";\nimport { orgMiddleware, orgSessionMiddleware } from \"../call\";\nimport { ORGANIZATION_ERROR_CODES } from \"../error-codes\";\nimport { hasPermission } from \"../has-permission\";\nimport { teamSchema } from \"../schema\";\nimport type { OrganizationOptions } from \"../types\";\n\nconst teamBaseSchema = z.object({\n\tname: z.string().meta({\n\t\tdescription: 'The name of the team. Eg: \"my-team\"',\n\t}),\n\torganizationId: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t'The organization ID which the team will be created in. Defaults to the active organization. Eg: \"organization-id\"',\n\t\t})\n\t\t.optional(),\n});\n\nexport const createTeam = <O extends OrganizationOptions>(options: O) => {\n\tconst additionalFieldsSchema = toZodSchema({\n\t\tfields: options?.schema?.team?.additionalFields ?? {},\n\t\tisClientSide: true,\n\t});\n\treturn createAuthEndpoint(\n\t\t\"/organization/create-team\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: z.object({\n\t\t\t\t...teamBaseSchema.shape,\n\t\t\t\t...additionalFieldsSchema.shape,\n\t\t\t}),\n\t\t\tuse: [orgMiddleware],\n\t\t\tmetadata: {\n\t\t\t\t$Infer: {\n\t\t\t\t\tbody: {} as z.infer<typeof teamBaseSchema> &\n\t\t\t\t\t\tInferAdditionalFieldsFromPluginOptions<\"team\", O>,\n\t\t\t\t},\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"Create a new team within an organization\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Team created successfully\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Unique identifier of the created team\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Name of the team\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\torganizationId: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"ID of the organization the team belongs to\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Timestamp when the team was created\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Timestamp when the team was last updated\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\t\t\t\t\t\"name\",\n\t\t\t\t\t\t\t\t\t\t\t\"organizationId\",\n\t\t\t\t\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\t\t\t\t\"updatedAt\",\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = await getSessionFromCtx(ctx);\n\t\t\tconst organizationId =\n\t\t\t\tctx.body.organizationId || session?.session.activeOrganizationId;\n\t\t\tif (!session && (ctx.request || ctx.headers)) {\n\t\t\t\tthrow new APIError(\"UNAUTHORIZED\");\n\t\t\t}\n\n\t\t\tif (!organizationId) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst adapter = getOrgAdapter<O>(ctx.context, options as O);\n\t\t\tif (session) {\n\t\t\t\tconst member = await adapter.findMemberByOrgId({\n\t\t\t\t\tuserId: session.user.id,\n\t\t\t\t\torganizationId,\n\t\t\t\t});\n\t\t\t\tif (!member) {\n\t\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\t\tmessage:\n\t\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_INVITE_USERS_TO_THIS_ORGANIZATION,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tconst canCreate = await hasPermission(\n\t\t\t\t\t{\n\t\t\t\t\t\trole: member.role,\n\t\t\t\t\t\toptions: ctx.context.orgOptions,\n\t\t\t\t\t\tpermissions: {\n\t\t\t\t\t\t\tteam: [\"create\"],\n\t\t\t\t\t\t},\n\t\t\t\t\t\torganizationId,\n\t\t\t\t\t},\n\t\t\t\t\tctx,\n\t\t\t\t);\n\n\t\t\t\tif (!canCreate) {\n\t\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\t\tmessage:\n\t\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_CREATE_TEAMS_IN_THIS_ORGANIZATION,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst existingTeams = await adapter.listTeams(organizationId);\n\t\t\tconst maximum =\n\t\t\t\ttypeof ctx.context.orgOptions.teams?.maximumTeams === \"function\"\n\t\t\t\t\t? await ctx.context.orgOptions.teams?.maximumTeams(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\torganizationId,\n\t\t\t\t\t\t\t\tsession,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tctx,\n\t\t\t\t\t\t)\n\t\t\t\t\t: ctx.context.orgOptions.teams?.maximumTeams;\n\n\t\t\tconst maxTeamsReached = maximum ? existingTeams.length >= maximum : false;\n\t\t\tif (maxTeamsReached) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_HAVE_REACHED_THE_MAXIMUM_NUMBER_OF_TEAMS,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst { name, organizationId: _, ...additionalFields } = ctx.body;\n\n\t\t\tconst organization = await adapter.findOrganizationById(organizationId);\n\t\t\tif (!organization) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tlet teamData = {\n\t\t\t\tname,\n\t\t\t\torganizationId,\n\t\t\t\tcreatedAt: new Date(),\n\t\t\t\tupdatedAt: new Date(),\n\t\t\t\t...additionalFields,\n\t\t\t};\n\n\t\t\t// Run beforeCreateTeam hook\n\t\t\tif (options?.organizationHooks?.beforeCreateTeam) {\n\t\t\t\tconst response = await options?.organizationHooks.beforeCreateTeam({\n\t\t\t\t\tteam: {\n\t\t\t\t\t\tname,\n\t\t\t\t\t\torganizationId,\n\t\t\t\t\t\t...additionalFields,\n\t\t\t\t\t},\n\t\t\t\t\tuser: session?.user,\n\t\t\t\t\torganization,\n\t\t\t\t});\n\t\t\t\tif (response && typeof response === \"object\" && \"data\" in response) {\n\t\t\t\t\tteamData = {\n\t\t\t\t\t\t...teamData,\n\t\t\t\t\t\t...response.data,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst createdTeam = await adapter.createTeam(teamData);\n\n\t\t\t// Run afterCreateTeam hook\n\t\t\tif (options?.organizationHooks?.afterCreateTeam) {\n\t\t\t\tawait options?.organizationHooks.afterCreateTeam({\n\t\t\t\t\tteam: createdTeam,\n\t\t\t\t\tuser: session?.user,\n\t\t\t\t\torganization,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn ctx.json(createdTeam);\n\t\t},\n\t);\n};\n\nconst removeTeamBodySchema = z.object({\n\tteamId: z.string().meta({\n\t\tdescription: `The team ID of the team to remove. Eg: \"team-id\"`,\n\t}),\n\torganizationId: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription: `The organization ID which the team falls under. If not provided, it will default to the user's active organization. Eg: \"organization-id\"`,\n\t\t})\n\t\t.optional(),\n});\n\nexport const removeTeam = <O extends OrganizationOptions>(options: O) =>\n\tcreateAuthEndpoint(\n\t\t\"/organization/remove-team\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: removeTeamBodySchema,\n\t\t\tuse: [orgMiddleware],\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"Remove a team from an organization\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Team removed successfully\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tmessage: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Confirmation message indicating successful removal\",\n\t\t\t\t\t\t\t\t\t\t\t\tenum: [\"Team removed successfully.\"],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\trequired: [\"message\"],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = await getSessionFromCtx(ctx);\n\t\t\tconst organizationId =\n\t\t\t\tctx.body.organizationId || session?.session.activeOrganizationId;\n\t\t\tif (!organizationId) {\n\t\t\t\treturn ctx.json(null, {\n\t\t\t\t\tstatus: 400,\n\t\t\t\t\tbody: {\n\t\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (!session && (ctx.request || ctx.headers)) {\n\t\t\t\tthrow new APIError(\"UNAUTHORIZED\");\n\t\t\t}\n\t\t\tconst adapter = getOrgAdapter<O>(ctx.context, options);\n\t\t\tif (session) {\n\t\t\t\tconst member = await adapter.findMemberByOrgId({\n\t\t\t\t\tuserId: session.user.id,\n\t\t\t\t\torganizationId,\n\t\t\t\t});\n\n\t\t\t\tif (!member || session.session?.activeTeamId === ctx.body.teamId) {\n\t\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\t\tmessage:\n\t\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_TEAM,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tconst canRemove = await hasPermission(\n\t\t\t\t\t{\n\t\t\t\t\t\trole: member.role,\n\t\t\t\t\t\toptions: ctx.context.orgOptions,\n\t\t\t\t\t\tpermissions: {\n\t\t\t\t\t\t\tteam: [\"delete\"],\n\t\t\t\t\t\t},\n\t\t\t\t\t\torganizationId,\n\t\t\t\t\t},\n\t\t\t\t\tctx,\n\t\t\t\t);\n\n\t\t\t\tif (!canRemove) {\n\t\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\t\tmessage:\n\t\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_DELETE_TEAMS_IN_THIS_ORGANIZATION,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst team = await adapter.findTeamById({\n\t\t\t\tteamId: ctx.body.teamId,\n\t\t\t\torganizationId,\n\t\t\t});\n\t\t\tif (!team || team.organizationId !== organizationId) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.TEAM_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!ctx.context.orgOptions.teams?.allowRemovingAllTeams) {\n\t\t\t\tconst teams = await adapter.listTeams(organizationId);\n\t\t\t\tif (teams.length <= 1) {\n\t\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.UNABLE_TO_REMOVE_LAST_TEAM,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst organization = await adapter.findOrganizationById(organizationId);\n\t\t\tif (!organization) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Run beforeDeleteTeam hook\n\t\t\tif (options?.organizationHooks?.beforeDeleteTeam) {\n\t\t\t\tawait options?.organizationHooks.beforeDeleteTeam({\n\t\t\t\t\tteam,\n\t\t\t\t\tuser: session?.user,\n\t\t\t\t\torganization,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tawait adapter.deleteTeam(team.id);\n\n\t\t\t// Run afterDeleteTeam hook\n\t\t\tif (options?.organizationHooks?.afterDeleteTeam) {\n\t\t\t\tawait options?.organizationHooks.afterDeleteTeam({\n\t\t\t\t\tteam,\n\t\t\t\t\tuser: session?.user,\n\t\t\t\t\torganization,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn ctx.json({ message: \"Team removed successfully.\" });\n\t\t},\n\t);\n\nexport const updateTeam = <O extends OrganizationOptions>(options: O) => {\n\tconst additionalFieldsSchema = toZodSchema({\n\t\tfields: options?.schema?.team?.additionalFields ?? {},\n\t\tisClientSide: true,\n\t});\n\n\ttype Body = {\n\t\tteamId: string;\n\t\tdata: Partial<\n\t\t\tPrettifyDeep<\n\t\t\t\tOmit<z.infer<typeof teamSchema>, \"id\" | \"createdAt\" | \"updatedAt\">\n\t\t\t> &\n\t\t\t\tInferAdditionalFieldsFromPluginOptions<\"team\", O>\n\t\t>;\n\t};\n\n\treturn createAuthEndpoint(\n\t\t\"/organization/update-team\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: z.object({\n\t\t\t\tteamId: z.string().meta({\n\t\t\t\t\tdescription: `The ID of the team to be updated. Eg: \"team-id\"`,\n\t\t\t\t}),\n\t\t\t\tdata: z\n\t\t\t\t\t.object({\n\t\t\t\t\t\t...teamSchema.shape,\n\t\t\t\t\t\t...additionalFieldsSchema.shape,\n\t\t\t\t\t})\n\t\t\t\t\t.partial(),\n\t\t\t}),\n\t\t\trequireHeaders: true,\n\t\t\tuse: [orgMiddleware, orgSessionMiddleware],\n\t\t\tmetadata: {\n\t\t\t\t$Infer: { body: {} as Body },\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"Update an existing team in an organization\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Team updated successfully\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Unique identifier of the updated team\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Updated name of the team\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\torganizationId: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"ID of the organization the team belongs to\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Timestamp when the team was created\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Timestamp when the team was last updated\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\t\t\t\t\t\"name\",\n\t\t\t\t\t\t\t\t\t\t\t\"organizationId\",\n\t\t\t\t\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\t\t\t\t\"updatedAt\",\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = ctx.context.session;\n\t\t\tconst organizationId =\n\t\t\t\tctx.body.data.organizationId || session.session.activeOrganizationId;\n\t\t\tif (!organizationId) {\n\t\t\t\treturn ctx.json(null, {\n\t\t\t\t\tstatus: 400,\n\t\t\t\t\tbody: {\n\t\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst adapter = getOrgAdapter<O>(ctx.context, options);\n\t\t\tconst member = await adapter.findMemberByOrgId({\n\t\t\t\tuserId: session.user.id,\n\t\t\t\torganizationId,\n\t\t\t});\n\n\t\t\tif (!member) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_TEAM,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst canUpdate = await hasPermission(\n\t\t\t\t{\n\t\t\t\t\trole: member.role,\n\t\t\t\t\toptions: ctx.context.orgOptions,\n\t\t\t\t\tpermissions: {\n\t\t\t\t\t\tteam: [\"update\"],\n\t\t\t\t\t},\n\t\t\t\t\torganizationId,\n\t\t\t\t},\n\t\t\t\tctx,\n\t\t\t);\n\n\t\t\tif (!canUpdate) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_TEAM,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst team = await adapter.findTeamById({\n\t\t\t\tteamId: ctx.body.teamId,\n\t\t\t\torganizationId,\n\t\t\t});\n\n\t\t\tif (!team || team.organizationId !== organizationId) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.TEAM_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst { name, organizationId: __, ...additionalFields } = ctx.body.data;\n\n\t\t\tconst organization = await adapter.findOrganizationById(organizationId);\n\t\t\tif (!organization) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst updates = {\n\t\t\t\tname,\n\t\t\t\t...additionalFields,\n\t\t\t};\n\n\t\t\t// Run beforeUpdateTeam hook\n\t\t\tif (options?.organizationHooks?.beforeUpdateTeam) {\n\t\t\t\tconst response = await options?.organizationHooks.beforeUpdateTeam({\n\t\t\t\t\tteam,\n\t\t\t\t\tupdates,\n\t\t\t\t\tuser: session.user,\n\t\t\t\t\torganization,\n\t\t\t\t});\n\t\t\t\tif (response && typeof response === \"object\" && \"data\" in response) {\n\t\t\t\t\t// Allow the hook to modify the updates\n\t\t\t\t\tconst modifiedUpdates = response.data;\n\t\t\t\t\tconst updatedTeam = await adapter.updateTeam(\n\t\t\t\t\t\tteam.id,\n\t\t\t\t\t\tmodifiedUpdates,\n\t\t\t\t\t);\n\n\t\t\t\t\t// Run afterUpdateTeam hook\n\t\t\t\t\tif (options?.organizationHooks?.afterUpdateTeam) {\n\t\t\t\t\t\tawait options?.organizationHooks.afterUpdateTeam({\n\t\t\t\t\t\t\tteam: updatedTeam,\n\t\t\t\t\t\t\tuser: session.user,\n\t\t\t\t\t\t\torganization,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn ctx.json(updatedTeam);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst updatedTeam = await adapter.updateTeam(team.id, updates);\n\n\t\t\t// Run afterUpdateTeam hook\n\t\t\tif (options?.organizationHooks?.afterUpdateTeam) {\n\t\t\t\tawait options?.organizationHooks.afterUpdateTeam({\n\t\t\t\t\tteam: updatedTeam,\n\t\t\t\t\tuser: session.user,\n\t\t\t\t\torganization,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn ctx.json(updatedTeam);\n\t\t},\n\t);\n};\n\nconst listOrganizationTeamsQuerySchema = z.optional(\n\tz.object({\n\t\torganizationId: z\n\t\t\t.string()\n\t\t\t.meta({\n\t\t\t\tdescription: `The organization ID which the teams are under to list. Defaults to the users active organization. Eg: \"organization-id\"`,\n\t\t\t})\n\t\t\t.optional(),\n\t}),\n);\n\nexport const listOrganizationTeams = <O extends OrganizationOptions>(\n\toptions: O,\n) =>\n\tcreateAuthEndpoint(\n\t\t\"/organization/list-teams\",\n\t\t{\n\t\t\tmethod: \"GET\",\n\t\t\tquery: listOrganizationTeamsQuerySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"List all teams in an organization\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Teams retrieved successfully\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Unique identifier of the team\",\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Name of the team\",\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\torganizationId: {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"ID of the organization the team belongs to\",\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Timestamp when the team was created\",\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Timestamp when the team was last updated\",\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\trequired: [\n\t\t\t\t\t\t\t\t\t\t\t\t\"id\",\n\t\t\t\t\t\t\t\t\t\t\t\t\"name\",\n\t\t\t\t\t\t\t\t\t\t\t\t\"organizationId\",\n\t\t\t\t\t\t\t\t\t\t\t\t\"createdAt\",\n\t\t\t\t\t\t\t\t\t\t\t\t\"updatedAt\",\n\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\"Array of team objects within the organization\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\trequireHeaders: true,\n\t\t\tuse: [orgMiddleware, orgSessionMiddleware],\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = ctx.context.session;\n\t\t\tconst organizationId =\n\t\t\t\tctx.query?.organizationId || session?.session.activeOrganizationId;\n\t\t\tif (!organizationId) {\n\t\t\t\tthrow ctx.error(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst adapter = getOrgAdapter<O>(ctx.context, options);\n\t\t\tconst member = await adapter.findMemberByOrgId({\n\t\t\t\tuserId: session.user.id,\n\t\t\t\torganizationId: organizationId || \"\",\n\t\t\t});\n\t\t\tif (!member) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_ACCESS_THIS_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst teams = await adapter.listTeams(organizationId);\n\t\t\treturn ctx.json(teams);\n\t\t},\n\t);\n\nconst setActiveTeamBodySchema = z.object({\n\tteamId: z\n\t\t.string()\n\t\t.meta({\n\t\t\tdescription:\n\t\t\t\t\"The team id to set as active. It can be null to unset the active team\",\n\t\t})\n\t\t.nullable()\n\t\t.optional(),\n});\n\nexport const setActiveTeam = <O extends OrganizationOptions>(options: O) =>\n\tcreateAuthEndpoint(\n\t\t\"/organization/set-active-team\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: setActiveTeamBodySchema,\n\t\t\trequireHeaders: true,\n\t\t\tuse: [orgSessionMiddleware, orgMiddleware],\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"Set the active team\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"The team\",\n\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/Team\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst adapter = getOrgAdapter(ctx.context, ctx.context.orgOptions);\n\t\t\tconst session = ctx.context.session;\n\n\t\t\tif (ctx.body.teamId === null) {\n\t\t\t\tconst sessionTeamId = session.session.activeTeamId;\n\t\t\t\tif (!sessionTeamId) {\n\t\t\t\t\treturn ctx.json(null);\n\t\t\t\t}\n\n\t\t\t\tconst updatedSession = await adapter.setActiveTeam(\n\t\t\t\t\tsession.session.token,\n\t\t\t\t\tnull,\n\t\t\t\t\tctx,\n\t\t\t\t);\n\n\t\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\t\tsession: updatedSession,\n\t\t\t\t\tuser: session.user,\n\t\t\t\t});\n\n\t\t\t\treturn ctx.json(null);\n\t\t\t}\n\n\t\t\tlet teamId: string;\n\n\t\t\tif (!ctx.body.teamId) {\n\t\t\t\tconst sessionTeamId = session.session.activeTeamId;\n\t\t\t\tif (!sessionTeamId) {\n\t\t\t\t\treturn ctx.json(null);\n\t\t\t\t} else {\n\t\t\t\t\tteamId = sessionTeamId;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tteamId = ctx.body.teamId;\n\t\t\t}\n\n\t\t\tconst team = await adapter.findTeamById({ teamId });\n\n\t\t\tif (!team) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.TEAM_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst member = await adapter.findTeamMember({\n\t\t\t\tteamId,\n\t\t\t\tuserId: session.user.id,\n\t\t\t});\n\n\t\t\tif (!member) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.USER_IS_NOT_A_MEMBER_OF_THE_TEAM,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst updatedSession = await adapter.setActiveTeam(\n\t\t\t\tsession.session.token,\n\t\t\t\tteam.id,\n\t\t\t\tctx,\n\t\t\t);\n\n\t\t\tawait setSessionCookie(ctx, {\n\t\t\t\tsession: updatedSession,\n\t\t\t\tuser: session.user,\n\t\t\t});\n\n\t\t\treturn ctx.json(team);\n\t\t},\n\t);\n\nexport const listUserTeams = <O extends OrganizationOptions>(options: O) =>\n\tcreateAuthEndpoint(\n\t\t\"/organization/list-user-teams\",\n\t\t{\n\t\t\tmethod: \"GET\",\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"List all teams that the current user is a part of.\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Teams retrieved successfully\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"The team\",\n\t\t\t\t\t\t\t\t\t\t\t$ref: \"#/components/schemas/Team\",\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\"Array of team objects within the organization\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\trequireHeaders: true,\n\t\t\tuse: [orgMiddleware, orgSessionMiddleware],\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = ctx.context.session;\n\t\t\tconst adapter = getOrgAdapter(ctx.context, ctx.context.orgOptions);\n\t\t\tconst teams = await adapter.listTeamsByUser({\n\t\t\t\tuserId: session.user.id,\n\t\t\t});\n\n\t\t\treturn ctx.json(teams);\n\t\t},\n\t);\n\nconst listTeamMembersQuerySchema = z.optional(\n\tz.object({\n\t\tteamId: z.string().optional().meta({\n\t\t\tdescription:\n\t\t\t\t\"The team whose members we should return. If this is not provided the members of the current active team get returned.\",\n\t\t}),\n\t}),\n);\n\nexport const listTeamMembers = <O extends OrganizationOptions>(options: O) =>\n\tcreateAuthEndpoint(\n\t\t\"/organization/list-team-members\",\n\t\t{\n\t\t\tmethod: \"GET\",\n\t\t\tquery: listTeamMembersQuerySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"List the members of the given team.\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Teams retrieved successfully\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"array\",\n\t\t\t\t\t\t\t\t\t\titems: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"The team member\",\n\t\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Unique identifier of the team member\",\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\tuserId: {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"The user ID of the team member\",\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\tteamId: {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"The team ID of the team the team member is in\",\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"Timestamp when the team member was created\",\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\trequired: [\"id\", \"userId\", \"teamId\", \"createdAt\"],\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tdescription: \"Array of team member objects within the team\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\trequireHeaders: true,\n\t\t\tuse: [orgMiddleware, orgSessionMiddleware],\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = ctx.context.session;\n\t\t\tconst adapter = getOrgAdapter(ctx.context, ctx.context.orgOptions);\n\t\t\tconst teamId = ctx.query?.teamId || session?.session.activeTeamId;\n\t\t\tif (!teamId) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.YOU_DO_NOT_HAVE_AN_ACTIVE_TEAM,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst member = await adapter.findTeamMember({\n\t\t\t\tuserId: session.user.id,\n\t\t\t\tteamId,\n\t\t\t});\n\n\t\t\tif (!member) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.USER_IS_NOT_A_MEMBER_OF_THE_TEAM,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst members = await adapter.listTeamMembers({\n\t\t\t\tteamId,\n\t\t\t});\n\t\t\treturn ctx.json(members);\n\t\t},\n\t);\n\nconst addTeamMemberBodySchema = z.object({\n\tteamId: z.string().meta({\n\t\tdescription: \"The team the user should be a member of.\",\n\t}),\n\n\tuserId: z.coerce.string().meta({\n\t\tdescription:\n\t\t\t\"The user Id which represents the user to be added as a member.\",\n\t}),\n});\n\nexport const addTeamMember = <O extends OrganizationOptions>(options: O) =>\n\tcreateAuthEndpoint(\n\t\t\"/organization/add-team-member\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: addTeamMemberBodySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"The newly created member\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Team member created successfully\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tdescription: \"The team member\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"Unique identifier of the team member\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tuserId: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: \"The user ID of the team member\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tteamId: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"The team ID of the team the team member is in\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tformat: \"date-time\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Timestamp when the team member was created\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\trequired: [\"id\", \"userId\", \"teamId\", \"createdAt\"],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\trequireHeaders: true,\n\t\t\tuse: [orgMiddleware, orgSessionMiddleware],\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = ctx.context.session;\n\t\t\tconst adapter = getOrgAdapter(ctx.context, ctx.context.orgOptions);\n\n\t\t\tif (!session.session.activeOrganizationId) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst currentMember = await adapter.findMemberByOrgId({\n\t\t\t\tuserId: session.user.id,\n\t\t\t\torganizationId: session.session.activeOrganizationId,\n\t\t\t});\n\n\t\t\tif (!currentMember) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst canUpdateMember = await hasPermission(\n\t\t\t\t{\n\t\t\t\t\trole: currentMember.role,\n\t\t\t\t\toptions: ctx.context.orgOptions,\n\t\t\t\t\tpermissions: {\n\t\t\t\t\t\tmember: [\"update\"],\n\t\t\t\t\t},\n\t\t\t\t\torganizationId: session.session.activeOrganizationId,\n\t\t\t\t},\n\t\t\t\tctx,\n\t\t\t);\n\n\t\t\tif (!canUpdateMember) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_CREATE_A_NEW_TEAM_MEMBER,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst toBeAddedMember = await adapter.findMemberByOrgId({\n\t\t\t\tuserId: ctx.body.userId,\n\t\t\t\torganizationId: session.session.activeOrganizationId,\n\t\t\t});\n\n\t\t\tif (!toBeAddedMember) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst team = await adapter.findTeamById({\n\t\t\t\tteamId: ctx.body.teamId,\n\t\t\t\torganizationId: session.session.activeOrganizationId,\n\t\t\t});\n\n\t\t\tif (!team) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.TEAM_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst organization = await adapter.findOrganizationById(\n\t\t\t\tsession.session.activeOrganizationId,\n\t\t\t);\n\t\t\tif (!organization) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst userBeingAdded = await ctx.context.internalAdapter.findUserById(\n\t\t\t\tctx.body.userId,\n\t\t\t);\n\t\t\tif (!userBeingAdded) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: \"User not found\",\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Run beforeAddTeamMember hook\n\t\t\tif (options?.organizationHooks?.beforeAddTeamMember) {\n\t\t\t\tconst response = await options?.organizationHooks.beforeAddTeamMember({\n\t\t\t\t\tteamMember: {\n\t\t\t\t\t\tteamId: ctx.body.teamId,\n\t\t\t\t\t\tuserId: ctx.body.userId,\n\t\t\t\t\t},\n\t\t\t\t\tteam,\n\t\t\t\t\tuser: userBeingAdded,\n\t\t\t\t\torganization,\n\t\t\t\t});\n\t\t\t\tif (response && typeof response === \"object\" && \"data\" in response) {\n\t\t\t\t\t// Allow the hook to modify the data\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst teamMember = await adapter.findOrCreateTeamMember({\n\t\t\t\tteamId: ctx.body.teamId,\n\t\t\t\tuserId: ctx.body.userId,\n\t\t\t});\n\n\t\t\t// Run afterAddTeamMember hook\n\t\t\tif (options?.organizationHooks?.afterAddTeamMember) {\n\t\t\t\tawait options?.organizationHooks.afterAddTeamMember({\n\t\t\t\t\tteamMember,\n\t\t\t\t\tteam,\n\t\t\t\t\tuser: userBeingAdded,\n\t\t\t\t\torganization,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn ctx.json(teamMember);\n\t\t},\n\t);\n\nconst removeTeamMemberBodySchema = z.object({\n\tteamId: z.string().meta({\n\t\tdescription: \"The team the user should be removed from.\",\n\t}),\n\n\tuserId: z.coerce.string().meta({\n\t\tdescription: \"The user which should be removed from the team.\",\n\t}),\n});\n\nexport const removeTeamMember = <O extends OrganizationOptions>(options: O) =>\n\tcreateAuthEndpoint(\n\t\t\"/organization/remove-team-member\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\tbody: removeTeamMemberBodySchema,\n\t\t\tmetadata: {\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"Remove a member from a team\",\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Team member removed successfully\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\tmessage: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Confirmation message indicating successful removal\",\n\t\t\t\t\t\t\t\t\t\t\t\tenum: [\"Team member removed successfully.\"],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\trequired: [\"message\"],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\trequireHeaders: true,\n\t\t\tuse: [orgMiddleware, orgSessionMiddleware],\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst session = ctx.context.session;\n\t\t\tconst adapter = getOrgAdapter(ctx.context, ctx.context.orgOptions);\n\n\t\t\tif (!session.session.activeOrganizationId) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst currentMember = await adapter.findMemberByOrgId({\n\t\t\t\tuserId: session.user.id,\n\t\t\t\torganizationId: session.session.activeOrganizationId,\n\t\t\t});\n\n\t\t\tif (!currentMember) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst canDeleteMember = await hasPermission(\n\t\t\t\t{\n\t\t\t\t\trole: currentMember.role,\n\t\t\t\t\toptions: ctx.context.orgOptions,\n\t\t\t\t\tpermissions: {\n\t\t\t\t\t\tmember: [\"delete\"],\n\t\t\t\t\t},\n\t\t\t\t\torganizationId: session.session.activeOrganizationId,\n\t\t\t\t},\n\t\t\t\tctx,\n\t\t\t);\n\n\t\t\tif (!canDeleteMember) {\n\t\t\t\tthrow new APIError(\"FORBIDDEN\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.YOU_ARE_NOT_ALLOWED_TO_REMOVE_A_TEAM_MEMBER,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst toBeAddedMember = await adapter.findMemberByOrgId({\n\t\t\t\tuserId: ctx.body.userId,\n\t\t\t\torganizationId: session.session.activeOrganizationId,\n\t\t\t});\n\n\t\t\tif (!toBeAddedMember) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst team = await adapter.findTeamById({\n\t\t\t\tteamId: ctx.body.teamId,\n\t\t\t\torganizationId: session.session.activeOrganizationId,\n\t\t\t});\n\n\t\t\tif (!team) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.TEAM_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst organization = await adapter.findOrganizationById(\n\t\t\t\tsession.session.activeOrganizationId,\n\t\t\t);\n\t\t\tif (!organization) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.ORGANIZATION_NOT_FOUND,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst userBeingRemoved = await ctx.context.internalAdapter.findUserById(\n\t\t\t\tctx.body.userId,\n\t\t\t);\n\t\t\tif (!userBeingRemoved) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: \"User not found\",\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst teamMember = await adapter.findTeamMember({\n\t\t\t\tteamId: ctx.body.teamId,\n\t\t\t\tuserId: ctx.body.userId,\n\t\t\t});\n\n\t\t\tif (!teamMember) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.USER_IS_NOT_A_MEMBER_OF_THE_TEAM,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Run beforeRemoveTeamMember hook\n\t\t\tif (options?.organizationHooks?.beforeRemoveTeamMember) {\n\t\t\t\tawait options?.organizationHooks.beforeRemoveTeamMember({\n\t\t\t\t\tteamMember,\n\t\t\t\t\tteam,\n\t\t\t\t\tuser: userBeingRemoved,\n\t\t\t\t\torganization,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tawait adapter.removeTeamMember({\n\t\t\t\tteamId: ctx.body.teamId,\n\t\t\t\tuserId: ctx.body.userId,\n\t\t\t});\n\n\t\t\t// Run afterRemoveTeamMember hook\n\t\t\tif (options?.organizationHooks?.afterRemoveTeamMember) {\n\t\t\t\tawait options?.organizationHooks.afterRemoveTeamMember({\n\t\t\t\t\tteamMember,\n\t\t\t\t\tteam,\n\t\t\t\t\tuser: userBeingRemoved,\n\t\t\t\t\torganization,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn ctx.json({ message: \"Team member removed successfully.\" });\n\t\t},\n\t);\n"],"names":["updatedTeam","teamId: string"],"mappings":"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"}},
    {"offset": {"line": 5286, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/better-auth/dist/plugins/organization/organization.mjs","sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/src/plugins/organization/organization.ts"],"sourcesContent":["import type { AuthContext, BetterAuthPlugin } from \"@better-auth/core\";\nimport { createAuthEndpoint } from \"@better-auth/core/api\";\nimport type { BetterAuthPluginDBSchema } from \"@better-auth/core/db\";\nimport { APIError } from \"better-call\";\nimport * as z from \"zod\";\nimport { getSessionFromCtx } from \"../../api\";\nimport { shimContext } from \"../../utils/shim\";\nimport type { AccessControl } from \"../access\";\nimport type { defaultStatements } from \"./access\";\nimport { defaultRoles } from \"./access\";\nimport { getOrgAdapter } from \"./adapter\";\nimport { orgSessionMiddleware } from \"./call\";\nimport { ORGANIZATION_ERROR_CODES } from \"./error-codes\";\nimport { hasPermission } from \"./has-permission\";\nimport {\n\tcreateOrgRole,\n\tdeleteOrgRole,\n\tgetOrgRole,\n\tlistOrgRoles,\n\tupdateOrgRole,\n} from \"./routes/crud-access-control\";\nimport {\n\tacceptInvitation,\n\tcancelInvitation,\n\tcreateInvitation,\n\tgetInvitation,\n\tlistInvitations,\n\tlistUserInvitations,\n\trejectInvitation,\n} from \"./routes/crud-invites\";\nimport {\n\taddMember,\n\tgetActiveMember,\n\tgetActiveMemberRole,\n\tleaveOrganization,\n\tlistMembers,\n\tremoveMember,\n\tupdateMemberRole,\n} from \"./routes/crud-members\";\nimport {\n\tcheckOrganizationSlug,\n\tcreateOrganization,\n\tdeleteOrganization,\n\tgetFullOrganization,\n\tlistOrganizations,\n\tsetActiveOrganization,\n\tupdateOrganization,\n} from \"./routes/crud-org\";\nimport {\n\taddTeamMember,\n\tcreateTeam,\n\tlistOrganizationTeams,\n\tlistTeamMembers,\n\tlistUserTeams,\n\tremoveTeam,\n\tremoveTeamMember,\n\tsetActiveTeam,\n\tupdateTeam,\n} from \"./routes/crud-team\";\nimport type {\n\tInferInvitation,\n\tInferMember,\n\tInferOrganization,\n\tInferTeam,\n\tOrganizationSchema,\n\tTeam,\n\tTeamMember,\n} from \"./schema\";\nimport type { OrganizationOptions } from \"./types\";\n\nexport type DefaultOrganizationPlugin<Options extends OrganizationOptions> = {\n\tid: \"organization\";\n\tendpoints: OrganizationEndpoints<Options>;\n\tschema: OrganizationSchema<Options>;\n\t$Infer: {\n\t\tOrganization: InferOrganization<Options>;\n\t\tInvitation: InferInvitation<Options>;\n\t\tMember: InferMember<Options>;\n\t\tTeam: Options[\"teams\"] extends { enabled: true } ? Team : any;\n\t\tTeamMember: Options[\"teams\"] extends { enabled: true } ? TeamMember : any;\n\t\tActiveOrganization: Options[\"teams\"] extends { enabled: true }\n\t\t\t? {\n\t\t\t\t\tmembers: InferMember<Options, false>[];\n\t\t\t\t\tinvitations: InferInvitation<Options, false>[];\n\t\t\t\t\tteams: InferTeam<Options, false>[];\n\t\t\t\t} & InferOrganization<Options, false>\n\t\t\t: {\n\t\t\t\t\tmembers: InferMember<Options, false>[];\n\t\t\t\t\tinvitations: InferInvitation<Options, false>[];\n\t\t\t\t} & InferOrganization<Options, false>;\n\t};\n\t$ERROR_CODES: typeof ORGANIZATION_ERROR_CODES;\n\toptions: NoInfer<Options>;\n};\n\nexport interface OrganizationCreator {\n\t<Options extends OrganizationOptions>(\n\t\toptions?: Options | undefined,\n\t): DefaultOrganizationPlugin<Options>;\n}\n\nexport function parseRoles(roles: string | string[]): string {\n\treturn Array.isArray(roles) ? roles.join(\",\") : roles;\n}\n\nexport type DynamicAccessControlEndpoints<O extends OrganizationOptions> = {\n\tcreateOrgRole: ReturnType<typeof createOrgRole<O>>;\n\tdeleteOrgRole: ReturnType<typeof deleteOrgRole<O>>;\n\tlistOrgRoles: ReturnType<typeof listOrgRoles<O>>;\n\tgetOrgRole: ReturnType<typeof getOrgRole<O>>;\n\tupdateOrgRole: ReturnType<typeof updateOrgRole<O>>;\n};\n\nexport type TeamEndpoints<O extends OrganizationOptions> = {\n\tcreateTeam: ReturnType<typeof createTeam<O>>;\n\tlistOrganizationTeams: ReturnType<typeof listOrganizationTeams<O>>;\n\tremoveTeam: ReturnType<typeof removeTeam<O>>;\n\tupdateTeam: ReturnType<typeof updateTeam<O>>;\n\tsetActiveTeam: ReturnType<typeof setActiveTeam<O>>;\n\tlistUserTeams: ReturnType<typeof listUserTeams<O>>;\n\tlistTeamMembers: ReturnType<typeof listTeamMembers<O>>;\n\taddTeamMember: ReturnType<typeof addTeamMember<O>>;\n\tremoveTeamMember: ReturnType<typeof removeTeamMember<O>>;\n};\n\nexport type OrganizationEndpoints<O extends OrganizationOptions> = {\n\tcreateOrganization: ReturnType<typeof createOrganization<O>>;\n\tupdateOrganization: ReturnType<typeof updateOrganization<O>>;\n\tdeleteOrganization: ReturnType<typeof deleteOrganization<O>>;\n\tsetActiveOrganization: ReturnType<typeof setActiveOrganization<O>>;\n\tgetFullOrganization: ReturnType<typeof getFullOrganization<O>>;\n\tlistOrganizations: ReturnType<typeof listOrganizations<O>>;\n\tcreateInvitation: ReturnType<typeof createInvitation<O>>;\n\tcancelInvitation: ReturnType<typeof cancelInvitation<O>>;\n\tacceptInvitation: ReturnType<typeof acceptInvitation<O>>;\n\tgetInvitation: ReturnType<typeof getInvitation<O>>;\n\trejectInvitation: ReturnType<typeof rejectInvitation<O>>;\n\tlistInvitations: ReturnType<typeof listInvitations<O>>;\n\tgetActiveMember: ReturnType<typeof getActiveMember<O>>;\n\tcheckOrganizationSlug: ReturnType<typeof checkOrganizationSlug<O>>;\n\taddMember: ReturnType<typeof addMember<O>>;\n\tremoveMember: ReturnType<typeof removeMember<O>>;\n\tupdateMemberRole: ReturnType<typeof updateMemberRole<O>>;\n\tleaveOrganization: ReturnType<typeof leaveOrganization<O>>;\n\tlistUserInvitations: ReturnType<typeof listUserInvitations<O>>;\n\tlistMembers: ReturnType<typeof listMembers<O>>;\n\tgetActiveMemberRole: ReturnType<typeof getActiveMemberRole<O>>;\n\thasPermission: ReturnType<typeof createHasPermission<O>>;\n};\n\nconst createHasPermissionBodySchema = z\n\t.object({\n\t\torganizationId: z.string().optional(),\n\t})\n\t.and(\n\t\tz.union([\n\t\t\tz.object({\n\t\t\t\tpermission: z.record(z.string(), z.array(z.string())),\n\t\t\t\tpermissions: z.undefined(),\n\t\t\t}),\n\t\t\tz.object({\n\t\t\t\tpermission: z.undefined(),\n\t\t\t\tpermissions: z.record(z.string(), z.array(z.string())),\n\t\t\t}),\n\t\t]),\n\t);\n\nconst createHasPermission = <O extends OrganizationOptions>(options: O) => {\n\ttype DefaultStatements = typeof defaultStatements;\n\ttype Statements =\n\t\tO[\"ac\"] extends AccessControl<infer S> ? S : DefaultStatements;\n\ttype PermissionType = {\n\t\t[key in keyof Statements]?: Array<\n\t\t\tStatements[key] extends readonly unknown[]\n\t\t\t\t? Statements[key][number]\n\t\t\t\t: never\n\t\t>;\n\t};\n\ttype PermissionExclusive =\n\t\t| {\n\t\t\t\t/**\n\t\t\t\t * @deprecated Use `permissions` instead\n\t\t\t\t */\n\t\t\t\tpermission: PermissionType;\n\t\t\t\tpermissions?: never | undefined;\n\t\t  }\n\t\t| {\n\t\t\t\tpermissions: PermissionType;\n\t\t\t\tpermission?: never | undefined;\n\t\t  };\n\n\treturn createAuthEndpoint(\n\t\t\"/organization/has-permission\",\n\t\t{\n\t\t\tmethod: \"POST\",\n\t\t\trequireHeaders: true,\n\t\t\tbody: createHasPermissionBodySchema,\n\t\t\tuse: [orgSessionMiddleware],\n\t\t\tmetadata: {\n\t\t\t\t$Infer: {\n\t\t\t\t\tbody: {} as PermissionExclusive & {\n\t\t\t\t\t\torganizationId?: string | undefined;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\topenapi: {\n\t\t\t\t\tdescription: \"Check if the user has permission\",\n\t\t\t\t\trequestBody: {\n\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\tpermission: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"The permission to check\",\n\t\t\t\t\t\t\t\t\t\t\tdeprecated: true,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tpermissions: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\t\tdescription: \"The permission to check\",\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\trequired: [\"permissions\"],\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tresponses: {\n\t\t\t\t\t\t\"200\": {\n\t\t\t\t\t\t\tdescription: \"Success\",\n\t\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\t\t\"application/json\": {\n\t\t\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\t\t\terror: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tsuccess: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: \"boolean\",\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\trequired: [\"success\"],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\tasync (ctx) => {\n\t\t\tconst activeOrganizationId =\n\t\t\t\tctx.body.organizationId ||\n\t\t\t\tctx.context.session.session.activeOrganizationId;\n\t\t\tif (!activeOrganizationId) {\n\t\t\t\tthrow new APIError(\"BAD_REQUEST\", {\n\t\t\t\t\tmessage: ORGANIZATION_ERROR_CODES.NO_ACTIVE_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst adapter = getOrgAdapter<O>(ctx.context, options);\n\t\t\tconst member = await adapter.findMemberByOrgId({\n\t\t\t\tuserId: ctx.context.session.user.id,\n\t\t\t\torganizationId: activeOrganizationId,\n\t\t\t});\n\t\t\tif (!member) {\n\t\t\t\tthrow new APIError(\"UNAUTHORIZED\", {\n\t\t\t\t\tmessage:\n\t\t\t\t\t\tORGANIZATION_ERROR_CODES.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION,\n\t\t\t\t});\n\t\t\t}\n\t\t\tconst result = await hasPermission(\n\t\t\t\t{\n\t\t\t\t\trole: member.role,\n\t\t\t\t\toptions: options,\n\t\t\t\t\tpermissions: (ctx.body.permissions ?? ctx.body.permission) as any,\n\t\t\t\t\torganizationId: activeOrganizationId,\n\t\t\t\t},\n\t\t\t\tctx,\n\t\t\t);\n\n\t\t\treturn ctx.json({\n\t\t\t\terror: null,\n\t\t\t\tsuccess: result,\n\t\t\t});\n\t\t},\n\t);\n};\n\nexport type OrganizationPlugin<O extends OrganizationOptions> = {\n\tid: \"organization\";\n\tendpoints: OrganizationEndpoints<O> &\n\t\t(O extends { teams: { enabled: true } } ? TeamEndpoints<O> : {}) &\n\t\t(O extends { dynamicAccessControl: { enabled: true } }\n\t\t\t? DynamicAccessControlEndpoints<O>\n\t\t\t: {});\n\tschema: OrganizationSchema<O>;\n\t$Infer: {\n\t\tOrganization: InferOrganization<O>;\n\t\tInvitation: InferInvitation<O>;\n\t\tMember: InferMember<O>;\n\t\tTeam: O[\"teams\"] extends { enabled: true } ? Team : any;\n\t\tTeamMember: O[\"teams\"] extends { enabled: true } ? TeamMember : any;\n\t\tActiveOrganization: O[\"teams\"] extends { enabled: true }\n\t\t\t? {\n\t\t\t\t\tmembers: InferMember<O, false>[];\n\t\t\t\t\tinvitations: InferInvitation<O, false>[];\n\t\t\t\t\tteams: InferTeam<O, false>[];\n\t\t\t\t} & InferOrganization<O, false>\n\t\t\t: {\n\t\t\t\t\tmembers: InferMember<O, false>[];\n\t\t\t\t\tinvitations: InferInvitation<O, false>[];\n\t\t\t\t} & InferOrganization<O, false>;\n\t};\n\t$ERROR_CODES: typeof ORGANIZATION_ERROR_CODES;\n\toptions: NoInfer<O>;\n};\n\n/**\n * Organization plugin for Better Auth. Organization allows you to create teams, members,\n * and manage access control for your users.\n *\n * @example\n * ```ts\n * const auth = betterAuth({\n *  plugins: [\n *    organization({\n *      allowUserToCreateOrganization: true,\n *    }),\n *  ],\n * });\n * ```\n */\nexport function organization<\n\tO extends OrganizationOptions & {\n\t\tteams: { enabled: true };\n\t\tdynamicAccessControl?:\n\t\t\t| {\n\t\t\t\t\tenabled?: false | undefined;\n\t\t\t  }\n\t\t\t| undefined;\n\t},\n>(\n\toptions?: O | undefined,\n): {\n\tid: \"organization\";\n\tendpoints: OrganizationEndpoints<O> & TeamEndpoints<O>;\n\tschema: OrganizationSchema<O>;\n\t$Infer: {\n\t\tOrganization: InferOrganization<O>;\n\t\tInvitation: InferInvitation<O>;\n\t\tMember: InferMember<O>;\n\t\tTeam: O[\"teams\"] extends { enabled: true } ? Team : unknown;\n\t\tTeamMember: O[\"teams\"] extends { enabled: true } ? TeamMember : unknown;\n\t\tActiveOrganization: O[\"teams\"] extends { enabled: true }\n\t\t\t? {\n\t\t\t\t\tmembers: InferMember<O, false>[];\n\t\t\t\t\tinvitations: InferInvitation<O, false>[];\n\t\t\t\t\tteams: InferTeam<O, false>[];\n\t\t\t\t} & InferOrganization<O, false>\n\t\t\t: {\n\t\t\t\t\tmembers: InferMember<O, false>[];\n\t\t\t\t\tinvitations: InferInvitation<O, false>[];\n\t\t\t\t} & InferOrganization<O, false>;\n\t};\n\t$ERROR_CODES: typeof ORGANIZATION_ERROR_CODES;\n\toptions: NoInfer<O>;\n};\nexport function organization<\n\tO extends OrganizationOptions & {\n\t\tteams: { enabled: true };\n\t\tdynamicAccessControl: { enabled: true };\n\t},\n>(\n\toptions?: O | undefined,\n): {\n\tid: \"organization\";\n\tendpoints: OrganizationEndpoints<O> &\n\t\tTeamEndpoints<O> &\n\t\tDynamicAccessControlEndpoints<O>;\n\tschema: OrganizationSchema<O>;\n\t$Infer: {\n\t\tOrganization: InferOrganization<O>;\n\t\tInvitation: InferInvitation<O>;\n\t\tMember: InferMember<O>;\n\t\tTeam: O[\"teams\"] extends { enabled: true } ? Team : any;\n\t\tTeamMember: O[\"teams\"] extends { enabled: true } ? TeamMember : any;\n\t\tActiveOrganization: O[\"teams\"] extends { enabled: true }\n\t\t\t? {\n\t\t\t\t\tmembers: InferMember<O, false>[];\n\t\t\t\t\tinvitations: InferInvitation<O, false>[];\n\t\t\t\t\tteams: InferTeam<O, false>[];\n\t\t\t\t} & InferOrganization<O, false>\n\t\t\t: {\n\t\t\t\t\tmembers: InferMember<O, false>[];\n\t\t\t\t\tinvitations: InferInvitation<O, false>[];\n\t\t\t\t} & InferOrganization<O, false>;\n\t};\n\t$ERROR_CODES: typeof ORGANIZATION_ERROR_CODES;\n\toptions: NoInfer<O>;\n};\nexport function organization<\n\tO extends OrganizationOptions & {\n\t\tdynamicAccessControl: { enabled: true };\n\t\tteams?: { enabled?: false | undefined } | undefined;\n\t},\n>(\n\toptions?: O | undefined,\n): {\n\tid: \"organization\";\n\tendpoints: OrganizationEndpoints<O> & DynamicAccessControlEndpoints<O>;\n\tschema: OrganizationSchema<O>;\n\t$Infer: {\n\t\tOrganization: InferOrganization<O>;\n\t\tInvitation: InferInvitation<O>;\n\t\tMember: InferMember<O>;\n\t\tTeam: O[\"teams\"] extends { enabled: true } ? Team : any;\n\t\tTeamMember: O[\"teams\"] extends { enabled: true } ? TeamMember : any;\n\t\tActiveOrganization: O[\"teams\"] extends { enabled: true }\n\t\t\t? {\n\t\t\t\t\tmembers: InferMember<O, false>[];\n\t\t\t\t\tinvitations: InferInvitation<O, false>[];\n\t\t\t\t\tteams: InferTeam<O, false>[];\n\t\t\t\t} & InferOrganization<O, false>\n\t\t\t: {\n\t\t\t\t\tmembers: InferMember<O, false>[];\n\t\t\t\t\tinvitations: InferInvitation<O, false>[];\n\t\t\t\t} & InferOrganization<O, false>;\n\t};\n\t$ERROR_CODES: typeof ORGANIZATION_ERROR_CODES;\n\toptions: NoInfer<O>;\n};\nexport function organization<O extends OrganizationOptions>(\n\toptions?: O | undefined,\n): DefaultOrganizationPlugin<O>;\nexport function organization<O extends OrganizationOptions>(options?: O) {\n\tconst opts = (options || {}) as O;\n\tlet endpoints = {\n\t\t/**\n\t\t * ### Endpoint\n\t\t *\n\t\t * POST `/organization/create`\n\t\t *\n\t\t * ### API Methods\n\t\t *\n\t\t * **server:**\n\t\t * `auth.api.createOrganization`\n\t\t *\n\t\t * **client:**\n\t\t * `authClient.organization.create`\n\t\t *\n\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/organization#api-method-organization-create)\n\t\t */\n\t\tcreateOrganization: createOrganization(opts),\n\t\t/**\n\t\t * ### Endpoint\n\t\t *\n\t\t * POST `/organization/update`\n\t\t *\n\t\t * ### API Methods\n\t\t *\n\t\t * **server:**\n\t\t * `auth.api.updateOrganization`\n\t\t *\n\t\t * **client:**\n\t\t * `authClient.organization.update`\n\t\t *\n\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/organization#api-method-organization-update)\n\t\t */\n\t\tupdateOrganization: updateOrganization(opts),\n\t\t/**\n\t\t * ### Endpoint\n\t\t *\n\t\t * POST `/organization/delete`\n\t\t *\n\t\t * ### API Methods\n\t\t *\n\t\t * **server:**\n\t\t * `auth.api.deleteOrganization`\n\t\t *\n\t\t * **client:**\n\t\t * `authClient.organization.delete`\n\t\t *\n\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/organization#api-method-organization-delete)\n\t\t */\n\t\tdeleteOrganization: deleteOrganization(opts),\n\t\t/**\n\t\t * ### Endpoint\n\t\t *\n\t\t * POST `/organization/set-active`\n\t\t *\n\t\t * ### API Methods\n\t\t *\n\t\t * **server:**\n\t\t * `auth.api.setActiveOrganization`\n\t\t *\n\t\t * **client:**\n\t\t * `authClient.organization.setActive`\n\t\t *\n\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/organization#api-method-organization-set-active)\n\t\t */\n\t\tsetActiveOrganization: setActiveOrganization(opts),\n\t\t/**\n\t\t * ### Endpoint\n\t\t *\n\t\t * GET `/organization/get-full-organization`\n\t\t *\n\t\t * ### API Methods\n\t\t *\n\t\t * **server:**\n\t\t * `auth.api.getFullOrganization`\n\t\t *\n\t\t * **client:**\n\t\t * `authClient.organization.getFullOrganization`\n\t\t *\n\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/organization#api-method-organization-get-full-organization)\n\t\t */\n\t\tgetFullOrganization: getFullOrganization(opts),\n\t\t/**\n\t\t * ### Endpoint\n\t\t *\n\t\t * GET `/organization/list`\n\t\t *\n\t\t * ### API Methods\n\t\t *\n\t\t * **server:**\n\t\t * `auth.api.listOrganizations`\n\t\t *\n\t\t * **client:**\n\t\t * `authClient.organization.list`\n\t\t *\n\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/organization#api-method-organization-list)\n\t\t */\n\t\tlistOrganizations: listOrganizations(opts),\n\t\t/**\n\t\t * ### Endpoint\n\t\t *\n\t\t * POST `/organization/invite-member`\n\t\t *\n\t\t * ### API Methods\n\t\t *\n\t\t * **server:**\n\t\t * `auth.api.createInvitation`\n\t\t *\n\t\t * **client:**\n\t\t * `authClient.organization.inviteMember`\n\t\t *\n\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/organization#api-method-organization-invite-member)\n\t\t */\n\t\tcreateInvitation: createInvitation(opts),\n\t\t/**\n\t\t * ### Endpoint\n\t\t *\n\t\t * POST `/organization/cancel-invitation`\n\t\t *\n\t\t * ### API Methods\n\t\t *\n\t\t * **server:**\n\t\t * `auth.api.cancelInvitation`\n\t\t *\n\t\t * **client:**\n\t\t * `authClient.organization.cancelInvitation`\n\t\t *\n\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/organization#api-method-organization-cancel-invitation)\n\t\t */\n\t\tcancelInvitation: cancelInvitation(opts),\n\t\t/**\n\t\t * ### Endpoint\n\t\t *\n\t\t * POST `/organization/accept-invitation`\n\t\t *\n\t\t * ### API Methods\n\t\t *\n\t\t * **server:**\n\t\t * `auth.api.acceptInvitation`\n\t\t *\n\t\t * **client:**\n\t\t * `authClient.organization.acceptInvitation`\n\t\t *\n\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/organization#api-method-organization-accept-invitation)\n\t\t */\n\t\tacceptInvitation: acceptInvitation(opts),\n\t\t/**\n\t\t * ### Endpoint\n\t\t *\n\t\t * GET `/organization/get-invitation`\n\t\t *\n\t\t * ### API Methods\n\t\t *\n\t\t * **server:**\n\t\t * `auth.api.getInvitation`\n\t\t *\n\t\t * **client:**\n\t\t * `authClient.organization.getInvitation`\n\t\t *\n\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/organization#api-method-organization-get-invitation)\n\t\t */\n\t\tgetInvitation: getInvitation(opts),\n\t\t/**\n\t\t * ### Endpoint\n\t\t *\n\t\t * POST `/organization/reject-invitation`\n\t\t *\n\t\t * ### API Methods\n\t\t *\n\t\t * **server:**\n\t\t * `auth.api.rejectInvitation`\n\t\t *\n\t\t * **client:**\n\t\t * `authClient.organization.rejectInvitation`\n\t\t *\n\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/organization#api-method-organization-reject-invitation)\n\t\t */\n\t\trejectInvitation: rejectInvitation(opts),\n\t\t/**\n\t\t * ### Endpoint\n\t\t *\n\t\t * GET `/organization/list-invitations`\n\t\t *\n\t\t * ### API Methods\n\t\t *\n\t\t * **server:**\n\t\t * `auth.api.listInvitations`\n\t\t *\n\t\t * **client:**\n\t\t * `authClient.organization.listInvitations`\n\t\t *\n\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/organization#api-method-organization-list-invitations)\n\t\t */\n\t\tlistInvitations: listInvitations(opts),\n\t\t/**\n\t\t * ### Endpoint\n\t\t *\n\t\t * GET `/organization/get-active-member`\n\t\t *\n\t\t * ### API Methods\n\t\t *\n\t\t * **server:**\n\t\t * `auth.api.getActiveMember`\n\t\t *\n\t\t * **client:**\n\t\t * `authClient.organization.getActiveMember`\n\t\t *\n\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/organization#api-method-organization-get-active-member)\n\t\t */\n\t\tgetActiveMember: getActiveMember(opts),\n\t\t/**\n\t\t * ### Endpoint\n\t\t *\n\t\t * POST `/organization/check-slug`\n\t\t *\n\t\t * ### API Methods\n\t\t *\n\t\t * **server:**\n\t\t * `auth.api.checkOrganizationSlug`\n\t\t *\n\t\t * **client:**\n\t\t * `authClient.organization.checkSlug`\n\t\t *\n\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/organization#api-method-organization-check-slug)\n\t\t */\n\t\tcheckOrganizationSlug: checkOrganizationSlug(opts),\n\t\t/**\n\t\t * ### Endpoint\n\t\t *\n\t\t * POST `/organization/add-member`\n\t\t *\n\t\t * ### API Methods\n\t\t *\n\t\t * **server:**\n\t\t * `auth.api.addMember`\n\t\t *\n\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/organization#api-method-organization-add-member)\n\t\t */\n\n\t\taddMember: addMember<O>(opts),\n\t\t/**\n\t\t * ### Endpoint\n\t\t *\n\t\t * POST `/organization/remove-member`\n\t\t *\n\t\t * ### API Methods\n\t\t *\n\t\t * **server:**\n\t\t * `auth.api.removeMember`\n\t\t *\n\t\t * **client:**\n\t\t * `authClient.organization.removeMember`\n\t\t *\n\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/organization#api-method-organization-remove-member)\n\t\t */\n\t\tremoveMember: removeMember(opts),\n\t\t/**\n\t\t * ### Endpoint\n\t\t *\n\t\t * POST `/organization/update-member-role`\n\t\t *\n\t\t * ### API Methods\n\t\t *\n\t\t * **server:**\n\t\t * `auth.api.updateMemberRole`\n\t\t *\n\t\t * **client:**\n\t\t * `authClient.organization.updateMemberRole`\n\t\t *\n\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/organization#api-method-organization-update-member-role)\n\t\t */\n\t\tupdateMemberRole: updateMemberRole(opts),\n\t\t/**\n\t\t * ### Endpoint\n\t\t *\n\t\t * POST `/organization/leave`\n\t\t *\n\t\t * ### API Methods\n\t\t *\n\t\t * **server:**\n\t\t * `auth.api.leaveOrganization`\n\t\t *\n\t\t * **client:**\n\t\t * `authClient.organization.leave`\n\t\t *\n\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/organization#api-method-organization-leave)\n\t\t */\n\t\tleaveOrganization: leaveOrganization(opts),\n\t\tlistUserInvitations: listUserInvitations(opts),\n\t\t/**\n\t\t * ### Endpoint\n\t\t *\n\t\t * GET `/organization/list-members`\n\t\t *\n\t\t * ### API Methods\n\t\t *\n\t\t * **server:**\n\t\t * `auth.api.listMembers`\n\t\t *\n\t\t * **client:**\n\t\t * `authClient.organization.listMembers`\n\t\t */\n\t\tlistMembers: listMembers(opts),\n\t\t/**\n\t\t * ### Endpoint\n\t\t *\n\t\t * GET `/organization/get-active-member-role`\n\t\t *\n\t\t * ### API Methods\n\t\t *\n\t\t * **server:**\n\t\t * `auth.api.getActiveMemberRole`\n\t\t *\n\t\t * **client:**\n\t\t * `authClient.organization.getActiveMemberRole`\n\t\t *\n\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/organization#api-method-organization-get-active-member-role)\n\t\t */\n\t\tgetActiveMemberRole: getActiveMemberRole(opts),\n\t};\n\tconst teamSupport = opts.teams?.enabled;\n\tconst teamEndpoints = {\n\t\t/**\n\t\t * ### Endpoint\n\t\t *\n\t\t * POST `/organization/create-team`\n\t\t *\n\t\t * ### API Methods\n\t\t *\n\t\t * **server:**\n\t\t * `auth.api.createTeam`\n\t\t *\n\t\t * **client:**\n\t\t * `authClient.organization.createTeam`\n\t\t *\n\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/organization#api-method-organization-create-team)\n\t\t */\n\t\tcreateTeam: createTeam(opts),\n\t\t/**\n\t\t * ### Endpoint\n\t\t *\n\t\t * GET `/organization/list-teams`\n\t\t *\n\t\t * ### API Methods\n\t\t *\n\t\t * **server:**\n\t\t * `auth.api.listOrganizationTeams`\n\t\t *\n\t\t * **client:**\n\t\t * `authClient.organization.listTeams`\n\t\t *\n\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/organization#api-method-organization-list-teams)\n\t\t */\n\t\tlistOrganizationTeams: listOrganizationTeams(opts),\n\t\t/**\n\t\t * ### Endpoint\n\t\t *\n\t\t * POST `/organization/remove-team`\n\t\t *\n\t\t * ### API Methods\n\t\t *\n\t\t * **server:**\n\t\t * `auth.api.removeTeam`\n\t\t *\n\t\t * **client:**\n\t\t * `authClient.organization.removeTeam`\n\t\t *\n\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/organization#api-method-organization-remove-team)\n\t\t */\n\t\tremoveTeam: removeTeam(opts),\n\t\t/**\n\t\t * ### Endpoint\n\t\t *\n\t\t * POST `/organization/update-team`\n\t\t *\n\t\t * ### API Methods\n\t\t *\n\t\t * **server:**\n\t\t * `auth.api.updateTeam`\n\t\t *\n\t\t * **client:**\n\t\t * `authClient.organization.updateTeam`\n\t\t *\n\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/organization#api-method-organization-update-team)\n\t\t */\n\t\tupdateTeam: updateTeam(opts),\n\t\t/**\n\t\t * ### Endpoint\n\t\t *\n\t\t * POST `/organization/set-active-team`\n\t\t *\n\t\t * ### API Methods\n\t\t *\n\t\t * **server:**\n\t\t * `auth.api.setActiveTeam`\n\t\t *\n\t\t * **client:**\n\t\t * `authClient.organization.setActiveTeam`\n\t\t *\n\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/organization#api-set-active-team)\n\t\t */\n\t\tsetActiveTeam: setActiveTeam(opts),\n\t\t/**\n\t\t * ### Endpoint\n\t\t *\n\t\t * GET `/organization/list-user-teams`\n\t\t *\n\t\t * ### API Methods\n\t\t *\n\t\t * **server:**\n\t\t * `auth.api.listUserTeams`\n\t\t *\n\t\t * **client:**\n\t\t * `authClient.organization.listUserTeams`\n\t\t *\n\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/organization#api-set-active-team)\n\t\t */\n\t\tlistUserTeams: listUserTeams(opts),\n\t\t/**\n\t\t * ### Endpoint\n\t\t *\n\t\t * POST `/organization/list-team-members`\n\t\t *\n\t\t * ### API Methods\n\t\t *\n\t\t * **server:**\n\t\t * `auth.api.listTeamMembers`\n\t\t *\n\t\t * **client:**\n\t\t * `authClient.organization.listTeamMembers`\n\t\t *\n\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/organization#api-set-active-team)\n\t\t */\n\t\tlistTeamMembers: listTeamMembers(opts),\n\t\t/**\n\t\t * ### Endpoint\n\t\t *\n\t\t * POST `/organization/add-team-member`\n\t\t *\n\t\t * ### API Methods\n\t\t *\n\t\t * **server:**\n\t\t * `auth.api.addTeamMember`\n\t\t *\n\t\t * **client:**\n\t\t * `authClient.organization.addTeamMember`\n\t\t *\n\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/organization#api-add-team-member)\n\t\t */\n\t\taddTeamMember: addTeamMember(opts),\n\t\t/**\n\t\t * ### Endpoint\n\t\t *\n\t\t * POST `/organization/remove-team-member`\n\t\t *\n\t\t * ### API Methods\n\t\t *\n\t\t * **server:**\n\t\t * `auth.api.removeTeamMember`\n\t\t *\n\t\t * **client:**\n\t\t * `authClient.organization.removeTeamMember`\n\t\t *\n\t\t * @see [Read our docs to learn more.](https://better-auth.com/docs/plugins/organization#api-remove-team-member)\n\t\t */\n\t\tremoveTeamMember: removeTeamMember(opts),\n\t};\n\tif (teamSupport) {\n\t\tendpoints = {\n\t\t\t...endpoints,\n\t\t\t...teamEndpoints,\n\t\t};\n\t}\n\n\tconst dynamicAccessControlEndpoints = {\n\t\tcreateOrgRole: createOrgRole(opts),\n\t\tdeleteOrgRole: deleteOrgRole(opts),\n\t\tlistOrgRoles: listOrgRoles(opts),\n\t\tgetOrgRole: getOrgRole(opts),\n\t\tupdateOrgRole: updateOrgRole(opts),\n\t};\n\tif (opts.dynamicAccessControl?.enabled) {\n\t\tendpoints = {\n\t\t\t...endpoints,\n\t\t\t...dynamicAccessControlEndpoints,\n\t\t};\n\t}\n\tconst roles = {\n\t\t...defaultRoles,\n\t\t...opts.roles,\n\t};\n\n\t// Build team schema in a way that never introduces undefined values when spreading\n\tconst teamSchema = teamSupport\n\t\t? ({\n\t\t\t\tteam: {\n\t\t\t\t\tmodelName: opts.schema?.team?.modelName,\n\t\t\t\t\tfields: {\n\t\t\t\t\t\tname: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\t\tfieldName: opts.schema?.team?.fields?.name,\n\t\t\t\t\t\t},\n\t\t\t\t\t\torganizationId: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\t\treferences: {\n\t\t\t\t\t\t\t\tmodel: \"organization\",\n\t\t\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfieldName: opts.schema?.team?.fields?.organizationId,\n\t\t\t\t\t\t\tindex: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\ttype: \"date\",\n\t\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\t\tfieldName: opts.schema?.team?.fields?.createdAt,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\ttype: \"date\",\n\t\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\t\tfieldName: opts.schema?.team?.fields?.updatedAt,\n\t\t\t\t\t\t\tonUpdate: () => new Date(),\n\t\t\t\t\t\t},\n\t\t\t\t\t\t...(opts.schema?.team?.additionalFields || {}),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tteamMember: {\n\t\t\t\t\tmodelName: opts.schema?.teamMember?.modelName,\n\t\t\t\t\tfields: {\n\t\t\t\t\t\tteamId: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\t\treferences: {\n\t\t\t\t\t\t\t\tmodel: \"team\",\n\t\t\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfieldName: opts.schema?.teamMember?.fields?.teamId,\n\t\t\t\t\t\t\tindex: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tuserId: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\t\treferences: {\n\t\t\t\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfieldName: opts.schema?.teamMember?.fields?.userId,\n\t\t\t\t\t\t\tindex: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\ttype: \"date\",\n\t\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\t\tfieldName: opts.schema?.teamMember?.fields?.createdAt,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t} satisfies BetterAuthPluginDBSchema)\n\t\t: {};\n\n\tconst organizationRoleSchema = opts.dynamicAccessControl?.enabled\n\t\t? ({\n\t\t\t\torganizationRole: {\n\t\t\t\t\tfields: {\n\t\t\t\t\t\torganizationId: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\t\treferences: {\n\t\t\t\t\t\t\t\tmodel: \"organization\",\n\t\t\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfieldName: opts.schema?.organizationRole?.fields?.organizationId,\n\t\t\t\t\t\t\tindex: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t\trole: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\t\tfieldName: opts.schema?.organizationRole?.fields?.role,\n\t\t\t\t\t\t\tindex: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpermission: {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\t\tfieldName: opts.schema?.organizationRole?.fields?.permission,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\t\ttype: \"date\",\n\t\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\t\tdefaultValue: () => new Date(),\n\t\t\t\t\t\t\tfieldName: opts.schema?.organizationRole?.fields?.createdAt,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tupdatedAt: {\n\t\t\t\t\t\t\ttype: \"date\",\n\t\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\t\tfieldName: opts.schema?.organizationRole?.fields?.updatedAt,\n\t\t\t\t\t\t\tonUpdate: () => new Date(),\n\t\t\t\t\t\t},\n\t\t\t\t\t\t...(opts.schema?.organizationRole?.additionalFields || {}),\n\t\t\t\t\t},\n\t\t\t\t\tmodelName: opts.schema?.organizationRole?.modelName,\n\t\t\t\t},\n\t\t\t} satisfies BetterAuthPluginDBSchema)\n\t\t: {};\n\n\tconst schema = {\n\t\t...({\n\t\t\torganization: {\n\t\t\t\tmodelName: opts.schema?.organization?.modelName,\n\t\t\t\tfields: {\n\t\t\t\t\tname: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\tsortable: true,\n\t\t\t\t\t\tfieldName: opts.schema?.organization?.fields?.name,\n\t\t\t\t\t},\n\t\t\t\t\tslug: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\tunique: true,\n\t\t\t\t\t\tsortable: true,\n\t\t\t\t\t\tfieldName: opts.schema?.organization?.fields?.slug,\n\t\t\t\t\t\tindex: true,\n\t\t\t\t\t},\n\t\t\t\t\tlogo: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\tfieldName: opts.schema?.organization?.fields?.logo,\n\t\t\t\t\t},\n\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\ttype: \"date\",\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\tfieldName: opts.schema?.organization?.fields?.createdAt,\n\t\t\t\t\t},\n\t\t\t\t\tmetadata: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\tfieldName: opts.schema?.organization?.fields?.metadata,\n\t\t\t\t\t},\n\t\t\t\t\t...(opts.schema?.organization?.additionalFields || {}),\n\t\t\t\t},\n\t\t\t},\n\t\t} satisfies BetterAuthPluginDBSchema),\n\t\t...organizationRoleSchema,\n\t\t...teamSchema,\n\t\t...({\n\t\t\tmember: {\n\t\t\t\tmodelName: opts.schema?.member?.modelName,\n\t\t\t\tfields: {\n\t\t\t\t\torganizationId: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\treferences: {\n\t\t\t\t\t\t\tmodel: \"organization\",\n\t\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfieldName: opts.schema?.member?.fields?.organizationId,\n\t\t\t\t\t\tindex: true,\n\t\t\t\t\t},\n\t\t\t\t\tuserId: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\tfieldName: opts.schema?.member?.fields?.userId,\n\t\t\t\t\t\treferences: {\n\t\t\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\tindex: true,\n\t\t\t\t\t},\n\t\t\t\t\trole: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\tsortable: true,\n\t\t\t\t\t\tdefaultValue: \"member\",\n\t\t\t\t\t\tfieldName: opts.schema?.member?.fields?.role,\n\t\t\t\t\t},\n\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\ttype: \"date\",\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\tfieldName: opts.schema?.member?.fields?.createdAt,\n\t\t\t\t\t},\n\t\t\t\t\t...(opts.schema?.member?.additionalFields || {}),\n\t\t\t\t},\n\t\t\t},\n\t\t\tinvitation: {\n\t\t\t\tmodelName: opts.schema?.invitation?.modelName,\n\t\t\t\tfields: {\n\t\t\t\t\torganizationId: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\treferences: {\n\t\t\t\t\t\t\tmodel: \"organization\",\n\t\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfieldName: opts.schema?.invitation?.fields?.organizationId,\n\t\t\t\t\t\tindex: true,\n\t\t\t\t\t},\n\t\t\t\t\temail: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\tsortable: true,\n\t\t\t\t\t\tfieldName: opts.schema?.invitation?.fields?.email,\n\t\t\t\t\t\tindex: true,\n\t\t\t\t\t},\n\t\t\t\t\trole: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\tsortable: true,\n\t\t\t\t\t\tfieldName: opts.schema?.invitation?.fields?.role,\n\t\t\t\t\t},\n\t\t\t\t\t...(teamSupport\n\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\tteamId: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\t\t\t\tsortable: true,\n\t\t\t\t\t\t\t\t\tfieldName: opts.schema?.invitation?.fields?.teamId,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t: {}),\n\t\t\t\t\tstatus: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\tsortable: true,\n\t\t\t\t\t\tdefaultValue: \"pending\",\n\t\t\t\t\t\tfieldName: opts.schema?.invitation?.fields?.status,\n\t\t\t\t\t},\n\t\t\t\t\texpiresAt: {\n\t\t\t\t\t\ttype: \"date\",\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\tfieldName: opts.schema?.invitation?.fields?.expiresAt,\n\t\t\t\t\t},\n\t\t\t\t\tcreatedAt: {\n\t\t\t\t\t\ttype: \"date\",\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t\tfieldName: opts.schema?.invitation?.fields?.createdAt,\n\t\t\t\t\t\tdefaultValue: () => new Date(),\n\t\t\t\t\t},\n\t\t\t\t\tinviterId: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\treferences: {\n\t\t\t\t\t\t\tmodel: \"user\",\n\t\t\t\t\t\t\tfield: \"id\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfieldName: opts.schema?.invitation?.fields?.inviterId,\n\t\t\t\t\t\trequired: true,\n\t\t\t\t\t},\n\t\t\t\t\t...(opts.schema?.invitation?.additionalFields || {}),\n\t\t\t\t},\n\t\t\t},\n\t\t} satisfies BetterAuthPluginDBSchema),\n\t};\n\n\t/**\n\t * the orgMiddleware type-asserts an empty object representing org options, roles, and a getSession function.\n\t * This `shimContext` function is used to add those missing properties to the context object.\n\t */\n\tconst api = shimContext(endpoints, {\n\t\torgOptions: opts,\n\t\troles,\n\t\tgetSession: async (context: AuthContext) => {\n\t\t\t//@ts-expect-error\n\t\t\treturn await getSessionFromCtx(context);\n\t\t},\n\t});\n\n\treturn {\n\t\tid: \"organization\",\n\t\tendpoints: {\n\t\t\t...(api as OrganizationEndpoints<O>),\n\t\t\thasPermission: createHasPermission(opts),\n\t\t},\n\t\tschema: {\n\t\t\t...(schema as BetterAuthPluginDBSchema),\n\t\t\tsession: {\n\t\t\t\tfields: {\n\t\t\t\t\tactiveOrganizationId: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\tfieldName: opts.schema?.session?.fields?.activeOrganizationId,\n\t\t\t\t\t},\n\t\t\t\t\t...(teamSupport\n\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\tactiveTeamId: {\n\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\trequired: false,\n\t\t\t\t\t\t\t\t\tfieldName: opts.schema?.session?.fields?.activeTeamId,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t: {}),\n\t\t\t\t} as unknown as O[\"teams\"] extends {\n\t\t\t\t\tenabled: true;\n\t\t\t\t}\n\t\t\t\t\t? {\n\t\t\t\t\t\t\tactiveTeamId: {\n\t\t\t\t\t\t\t\ttype: \"string\";\n\t\t\t\t\t\t\t\trequired: false;\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tactiveOrganizationId: {\n\t\t\t\t\t\t\t\ttype: \"string\";\n\t\t\t\t\t\t\t\trequired: false;\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t: {\n\t\t\t\t\t\t\tactiveOrganizationId: {\n\t\t\t\t\t\t\t\ttype: \"string\";\n\t\t\t\t\t\t\t\trequired: false;\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\t$Infer: {\n\t\t\tOrganization: {} as InferOrganization<O>,\n\t\t\tInvitation: {} as InferInvitation<O>,\n\t\t\tMember: {} as InferMember<O>,\n\t\t\tTeam: teamSupport ? ({} as Team) : ({} as any),\n\t\t\tTeamMember: teamSupport ? ({} as TeamMember) : ({} as any),\n\t\t\tActiveOrganization: {} as O[\"teams\"] extends { enabled: true }\n\t\t\t\t? {\n\t\t\t\t\t\tmembers: InferMember<O, false>[];\n\t\t\t\t\t\tinvitations: InferInvitation<O, false>[];\n\t\t\t\t\t\tteams: InferTeam<O, false>[];\n\t\t\t\t\t} & InferOrganization<O, false>\n\t\t\t\t: {\n\t\t\t\t\t\tmembers: InferMember<O, false>[];\n\t\t\t\t\t\tinvitations: InferInvitation<O, false>[];\n\t\t\t\t\t} & InferOrganization<O, false>,\n\t\t},\n\t\t$ERROR_CODES: ORGANIZATION_ERROR_CODES,\n\t\toptions: opts as NoInfer<O>,\n\t} satisfies BetterAuthPlugin;\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5780, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/node_modules/better-auth/dist/plugins/organization/index.mjs"],"sourcesContent":["import { getOrgAdapter } from \"./adapter.mjs\";\nimport { organization, parseRoles } from \"./organization.mjs\";\n\nexport { getOrgAdapter, organization, parseRoles };"],"names":[],"mappings":";AAAA;AACA","ignoreList":[0]}}]
}