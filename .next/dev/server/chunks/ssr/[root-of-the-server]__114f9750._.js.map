{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 30, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/config.ts"],"sourcesContent":["import { Capacitor } from '@capacitor/core';\n\n// Detect if running natively (iOS or Android)\nconst isNative = Capacitor.isNativePlatform();\n\n// Use env variable or fallback\n// Set NEXT_PUBLIC_SERVER_URL in .env to your local IP (e.g. http://192.168.1.x:3000)\nexport const API_BASE_URL = isNative\n    ? (process.env.NEXT_PUBLIC_SERVER_URL || 'http://localhost:3000')\n    : '';\n\nif (isNative) {\n    console.log(\"[ChatConfig] Native Platform Detected. API_BASE_URL:\", API_BASE_URL);\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEA,8CAA8C;AAC9C,MAAM,WAAW,iKAAS,CAAC,gBAAgB;AAIpC,MAAM,eAAe,WACrB,iEAAsC,0BACvC;AAEN,IAAI,UAAU;IACV,QAAQ,GAAG,CAAC,wDAAwD;AACxE"}},
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/services/apiService.ts"],"sourcesContent":["import { API_BASE_URL } from \"@/config\";\nimport { Message } from \"@/types\";\n\nexport const clientResolveTenant = async (urlNasId?: string, bssid?: string): Promise<string | null> => {\n    const params = new URLSearchParams();\n    if (bssid) params.append('bssid', bssid);\n    if (urlNasId) params.append('nas_id', urlNasId);\n\n    const query = params.toString() ? `?${params.toString()}` : '';\n    const res = await fetch(`${API_BASE_URL}/api/validate-nas${query}`);\n    if (!res.ok) return null;\n    const data = await res.json();\n    return data.valid ? data.tenantSlug : null;\n};\n\nexport const clientGetTenantBySlug = async (slug: string) => {\n    const res = await fetch(`${API_BASE_URL}/api/tenants/${slug}`);\n    if (!res.ok) return null;\n    return await res.json();\n};\n\nexport const clientGetMessages = async (tenantSlug: string): Promise<Message[]> => {\n    const res = await fetch(`${API_BASE_URL}/api/messages?tenant=${tenantSlug}`);\n    if (!res.ok) return [];\n    return await res.json();\n};\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAGO,MAAM,sBAAsB,OAAO,UAAmB;IACzD,MAAM,SAAS,IAAI;IACnB,IAAI,OAAO,OAAO,MAAM,CAAC,SAAS;IAClC,IAAI,UAAU,OAAO,MAAM,CAAC,UAAU;IAEtC,MAAM,QAAQ,OAAO,QAAQ,KAAK,CAAC,CAAC,EAAE,OAAO,QAAQ,IAAI,GAAG;IAC5D,MAAM,MAAM,MAAM,MAAM,GAAG,sHAAY,CAAC,iBAAiB,EAAE,OAAO;IAClE,IAAI,CAAC,IAAI,EAAE,EAAE,OAAO;IACpB,MAAM,OAAO,MAAM,IAAI,IAAI;IAC3B,OAAO,KAAK,KAAK,GAAG,KAAK,UAAU,GAAG;AAC1C;AAEO,MAAM,wBAAwB,OAAO;IACxC,MAAM,MAAM,MAAM,MAAM,GAAG,sHAAY,CAAC,aAAa,EAAE,MAAM;IAC7D,IAAI,CAAC,IAAI,EAAE,EAAE,OAAO;IACpB,OAAO,MAAM,IAAI,IAAI;AACzB;AAEO,MAAM,oBAAoB,OAAO;IACpC,MAAM,MAAM,MAAM,MAAM,GAAG,sHAAY,CAAC,qBAAqB,EAAE,YAAY;IAC3E,IAAI,CAAC,IAAI,EAAE,EAAE,OAAO,EAAE;IACtB,OAAO,MAAM,IAAI,IAAI;AACzB"}},
    {"offset": {"line": 80, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/lib/wifi.ts"],"sourcesContent":["import { Capacitor } from '@capacitor/core';\n\n// Dynamic import to avoid issues on web\nlet CapacitorWifi: any = null;\n\nasync function loadWifiPlugin() {\n    if (Capacitor.isNativePlatform() && !CapacitorWifi) {\n        try {\n            const module = await import('@capgo/capacitor-wifi');\n            CapacitorWifi = module.CapacitorWifi;\n        } catch (err) {\n            console.error('Failed to load WiFi plugin:', err);\n        }\n    }\n    return CapacitorWifi;\n}\n\nexport interface WifiInfo {\n    ssid: string | null;\n    bssid: string | null;\n    isConnected: boolean;\n}\n\n/**\n * Get the BSSID of the currently connected WiFi network.\n * Returns null on web or if not connected to WiFi.\n */\nexport async function getConnectedWifiInfo(): Promise<WifiInfo> {\n    if (!Capacitor.isNativePlatform()) {\n        return { ssid: null, bssid: null, isConnected: false };\n    }\n\n    const wifi = await loadWifiPlugin();\n    if (!wifi) {\n        return { ssid: null, bssid: null, isConnected: false };\n    }\n\n    try {\n        const info = await wifi.getWifiInfo();\n        return {\n            ssid: info.ssid || null,\n            bssid: info.bssid || null,\n            isConnected: !!info.ssid\n        };\n    } catch (err) {\n        console.error('Error getting WiFi info:', err);\n        return { ssid: null, bssid: null, isConnected: false };\n    }\n}\n\n/**\n * Check and request location permissions required for WiFi info.\n * Returns true if permissions are granted, false otherwise.\n */\nexport async function checkAndRequestLocationPermissions(): Promise<boolean> {\n    if (!Capacitor.isNativePlatform()) {\n        return true; // Not needed on web\n    }\n\n    const wifi = await loadWifiPlugin();\n    if (!wifi) {\n        return false;\n    }\n\n    try {\n        // Check current permission status\n        const status = await wifi.checkPermissions();\n\n        if (status.location === 'granted') {\n            return true;\n        }\n\n        // Request permissions if not granted\n        const result = await wifi.requestPermissions();\n        return result.location === 'granted';\n    } catch (err) {\n        console.error('Error checking/requesting permissions:', err);\n        return false;\n    }\n}\n\n/**\n * Check if WiFi is enabled on the device.\n */\nexport async function isWifiEnabled(): Promise<boolean> {\n    if (!Capacitor.isNativePlatform()) {\n        return true; // Assume true on web\n    }\n\n    const wifi = await loadWifiPlugin();\n    if (!wifi) {\n        return false;\n    }\n\n    try {\n        const status = await wifi.getStatus();\n        return status.enabled;\n    } catch (err) {\n        console.error('Error checking WiFi status:', err);\n        return false;\n    }\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEA,wCAAwC;AACxC,IAAI,gBAAqB;AAEzB,eAAe;IACX,IAAI,iKAAS,CAAC,gBAAgB,MAAM,CAAC,eAAe;QAChD,IAAI;YACA,MAAM,SAAS;YACf,gBAAgB,OAAO,aAAa;QACxC,EAAE,OAAO,KAAK;YACV,QAAQ,KAAK,CAAC,+BAA+B;QACjD;IACJ;IACA,OAAO;AACX;AAYO,eAAe;IAClB,IAAI,CAAC,iKAAS,CAAC,gBAAgB,IAAI;QAC/B,OAAO;YAAE,MAAM;YAAM,OAAO;YAAM,aAAa;QAAM;IACzD;IAEA,MAAM,OAAO,MAAM;IACnB,IAAI,CAAC,MAAM;QACP,OAAO;YAAE,MAAM;YAAM,OAAO;YAAM,aAAa;QAAM;IACzD;IAEA,IAAI;QACA,MAAM,OAAO,MAAM,KAAK,WAAW;QACnC,OAAO;YACH,MAAM,KAAK,IAAI,IAAI;YACnB,OAAO,KAAK,KAAK,IAAI;YACrB,aAAa,CAAC,CAAC,KAAK,IAAI;QAC5B;IACJ,EAAE,OAAO,KAAK;QACV,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO;YAAE,MAAM;YAAM,OAAO;YAAM,aAAa;QAAM;IACzD;AACJ;AAMO,eAAe;IAClB,IAAI,CAAC,iKAAS,CAAC,gBAAgB,IAAI;QAC/B,OAAO,MAAM,oBAAoB;IACrC;IAEA,MAAM,OAAO,MAAM;IACnB,IAAI,CAAC,MAAM;QACP,OAAO;IACX;IAEA,IAAI;QACA,kCAAkC;QAClC,MAAM,SAAS,MAAM,KAAK,gBAAgB;QAE1C,IAAI,OAAO,QAAQ,KAAK,WAAW;YAC/B,OAAO;QACX;QAEA,qCAAqC;QACrC,MAAM,SAAS,MAAM,KAAK,kBAAkB;QAC5C,OAAO,OAAO,QAAQ,KAAK;IAC/B,EAAE,OAAO,KAAK;QACV,QAAQ,KAAK,CAAC,0CAA0C;QACxD,OAAO;IACX;AACJ;AAKO,eAAe;IAClB,IAAI,CAAC,iKAAS,CAAC,gBAAgB,IAAI;QAC/B,OAAO,MAAM,qBAAqB;IACtC;IAEA,MAAM,OAAO,MAAM;IACnB,IAAI,CAAC,MAAM;QACP,OAAO;IACX;IAEA,IAAI;QACA,MAAM,SAAS,MAAM,KAAK,SAAS;QACnC,OAAO,OAAO,OAAO;IACzB,EAAE,OAAO,KAAK;QACV,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO;IACX;AACJ"}},
    {"offset": {"line": 177, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/app/page.tsx"],"sourcesContent":["import { useEffect, useState, Suspense } from \"react\";\nimport { useRouter, useSearchParams } from \"next/navigation\";\nimport { clientResolveTenant } from \"@/services/apiService\";\nimport { Capacitor } from \"@capacitor/core\";\nimport { checkAndRequestLocationPermissions, getConnectedWifiInfo } from \"@/lib/wifi\";\nimport { API_BASE_URL } from \"@/config\";\n\ntype InitState = 'loading' | 'permission_denied' | 'wifi_disconnected' | 'tenant_not_found' | 'error';\n\nfunction HomeContent() {\n    const router = useRouter();\n    const searchParams = useSearchParams();\n    const [state, setState] = useState<InitState>('loading');\n    const [errorMessage, setErrorMessage] = useState<string | null>(null);\n\n    useEffect(() => {\n        async function init() {\n            try {\n                const isNative = Capacitor.isNativePlatform();\n\n                const nasId = searchParams.get('nas_id') || undefined;\n                let bssid: string | undefined = undefined;\n\n                // Native app: attempt to get BSSID, but don't block if failed\n                if (isNative) {\n                    try {\n                        const wifiCheckPromise = async () => {\n                            const hasPermission = await checkAndRequestLocationPermissions();\n                            if (hasPermission) {\n                                const wifiInfo = await getConnectedWifiInfo();\n                                if (wifiInfo.isConnected && wifiInfo.bssid) {\n                                    bssid = wifiInfo.bssid;\n                                }\n                            }\n                        };\n\n                        const timeoutPromise = new Promise((_, reject) =>\n                            setTimeout(() => reject(new Error(\"Timeout\")), 1500)\n                        );\n\n                        await Promise.race([wifiCheckPromise(), timeoutPromise]);\n\n                    } catch (e) {\n                        console.warn(\"WiFi detection skipped or failed:\", e);\n                    }\n                }\n\n                // Resolve tenant\n                const tenantSlug = await clientResolveTenant(nasId, bssid);\n\n                if (tenantSlug) {\n                    router.replace(`/${tenantSlug}`);\n                } else {\n                    setState('tenant_not_found');\n                }\n            } catch (err: any) {\n                console.error(\"Failed to resolve tenant\", err);\n                setErrorMessage(\"Errore durante l'identificazione dello spazio chat.\");\n                setState('error');\n            }\n        }\n        init();\n    }, [router, searchParams]);\n\n    // Loading state\n    if (state === 'loading') {\n        return (\n            <div className=\"h-screen w-full flex flex-col items-center justify-center bg-gray-50 p-4\">\n                <div className=\"w-24 h-24 mb-6 flex items-center justify-center\">\n                    <img src=\"/local_logo.svg\" alt=\"Local Logo\" className=\"w-full h-full object-contain animate-pulse\" />\n                </div>\n                <div className=\"text-gray-400 font-medium\">Inizializzazione in corso...</div>\n\n                <footer className=\"absolute bottom-6 w-full text-center\">\n                    <p className=\"text-gray-400 text-xs font-medium\">\n                        Powered by Local - Copyright 2025\n                    </p>\n                </footer>\n            </div>\n        );\n    }\n\n    // Error states\n    const errorConfig = {\n        permission_denied: {\n            title: \"Permessi Richiesti\",\n            message: \"Per identificare la tua posizione, l'app ha bisogno del permesso di localizzazione.\",\n            hint: \"Vai nelle Impostazioni del telefono e abilita i permessi di localizzazione per TrenoChat.\"\n        },\n        wifi_disconnected: {\n            title: \"WiFi Non Connesso\",\n            message: \"Devi essere connesso alla rete WiFi del locale per accedere alla chat.\",\n            hint: \"Connettiti al WiFi del treno o del locale e riprova.\"\n        },\n        tenant_not_found: {\n            title: \"Accesso Negato\",\n            message: \"Impossibile identificare lo spazio chat.\",\n            hint: \"Assicurati di essere connesso al WiFi corretto (es. Treno WiFi).\"\n        },\n        error: {\n            title: \"Errore\",\n            message: errorMessage || \"Si è verificato un errore imprevisto.\",\n            hint: \"Riprova più tardi.\"\n        }\n    };\n\n    const config = errorConfig[state];\n\n    return (\n        <div className=\"h-screen w-full flex items-center justify-center bg-gray-100 p-4\">\n            <div className=\"text-center p-8 bg-white rounded-2xl shadow-lg max-w-md\">\n                <div className=\"w-24 h-24 mx-auto mb-6 flex items-center justify-center\">\n                    <img src=\"/local_logo.svg\" alt=\"Local Logo\" className=\"w-full h-full object-contain\" />\n                </div>\n                <h1 className=\"text-2xl font-bold text-gray-800 mb-2\">{config.title}</h1>\n                <p className=\"text-gray-600 mb-2\">{config.message}</p>\n                <p className=\"text-gray-400 text-sm\">{config.hint}</p>\n\n                <button\n                    onClick={() => window.location.reload()}\n                    className=\"mt-6 px-6 py-2.5 bg-emerald-500 text-white rounded-full font-medium hover:bg-emerald-600 transition-colors\"\n                >\n                    Riprova\n                </button>\n            </div>\n\n            <footer className=\"absolute bottom-6 w-full text-center\">\n                <p className=\"text-gray-400 text-xs font-medium\">\n                    Powered by Local - Copyright 2025\n                </p>\n            </footer>\n        </div>\n    );\n}\n\nexport default function Home() {\n    return (\n        <Suspense fallback={\n            <div className=\"h-screen w-full flex items-center justify-center bg-gray-50\">\n                <div className=\"animate-pulse text-gray-400 font-medium\">Inizializzazione in corso...</div>\n            </div>\n        }>\n            <HomeContent />\n        </Suspense>\n    );\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;AAAA;AACA;AACA;AACA;;;;;;;AAKA,SAAS;IACL,MAAM,SAAS,IAAA,kMAAS;IACxB,MAAM,eAAe,IAAA,wMAAe;IACpC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAY;IAC9C,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iNAAQ,EAAgB;IAEhE,IAAA,kNAAS,EAAC;QACN,eAAe;YACX,IAAI;gBACA,MAAM,WAAW,iKAAS,CAAC,gBAAgB;gBAE3C,MAAM,QAAQ,aAAa,GAAG,CAAC,aAAa;gBAC5C,IAAI,QAA4B;gBAEhC,8DAA8D;gBAC9D,IAAI,UAAU;oBACV,IAAI;wBACA,MAAM,mBAAmB;4BACrB,MAAM,gBAAgB,MAAM,IAAA,iJAAkC;4BAC9D,IAAI,eAAe;gCACf,MAAM,WAAW,MAAM,IAAA,mIAAoB;gCAC3C,IAAI,SAAS,WAAW,IAAI,SAAS,KAAK,EAAE;oCACxC,QAAQ,SAAS,KAAK;gCAC1B;4BACJ;wBACJ;wBAEA,MAAM,iBAAiB,IAAI,QAAQ,CAAC,GAAG,SACnC,WAAW,IAAM,OAAO,IAAI,MAAM,aAAa;wBAGnD,MAAM,QAAQ,IAAI,CAAC;4BAAC;4BAAoB;yBAAe;oBAE3D,EAAE,OAAO,GAAG;wBACR,QAAQ,IAAI,CAAC,qCAAqC;oBACtD;gBACJ;gBAEA,iBAAiB;gBACjB,MAAM,aAAa,MAAM,IAAA,6IAAmB,EAAC,OAAO;gBAEpD,IAAI,YAAY;oBACZ,OAAO,OAAO,CAAC,CAAC,CAAC,EAAE,YAAY;gBACnC,OAAO;oBACH,SAAS;gBACb;YACJ,EAAE,OAAO,KAAU;gBACf,QAAQ,KAAK,CAAC,4BAA4B;gBAC1C,gBAAgB;gBAChB,SAAS;YACb;QACJ;QACA;IACJ,GAAG;QAAC;QAAQ;KAAa;IAEzB,gBAAgB;IAChB,IAAI,UAAU,WAAW;QACrB,qBACI,8OAAC;YAAI,WAAU;;8BACX,8OAAC;oBAAI,WAAU;8BACX,cAAA,8OAAC;wBAAI,KAAI;wBAAkB,KAAI;wBAAa,WAAU;;;;;;;;;;;8BAE1D,8OAAC;oBAAI,WAAU;8BAA4B;;;;;;8BAE3C,8OAAC;oBAAO,WAAU;8BACd,cAAA,8OAAC;wBAAE,WAAU;kCAAoC;;;;;;;;;;;;;;;;;IAMjE;IAEA,eAAe;IACf,MAAM,cAAc;QAChB,mBAAmB;YACf,OAAO;YACP,SAAS;YACT,MAAM;QACV;QACA,mBAAmB;YACf,OAAO;YACP,SAAS;YACT,MAAM;QACV;QACA,kBAAkB;YACd,OAAO;YACP,SAAS;YACT,MAAM;QACV;QACA,OAAO;YACH,OAAO;YACP,SAAS,gBAAgB;YACzB,MAAM;QACV;IACJ;IAEA,MAAM,SAAS,WAAW,CAAC,MAAM;IAEjC,qBACI,8OAAC;QAAI,WAAU;;0BACX,8OAAC;gBAAI,WAAU;;kCACX,8OAAC;wBAAI,WAAU;kCACX,cAAA,8OAAC;4BAAI,KAAI;4BAAkB,KAAI;4BAAa,WAAU;;;;;;;;;;;kCAE1D,8OAAC;wBAAG,WAAU;kCAAyC,OAAO,KAAK;;;;;;kCACnE,8OAAC;wBAAE,WAAU;kCAAsB,OAAO,OAAO;;;;;;kCACjD,8OAAC;wBAAE,WAAU;kCAAyB,OAAO,IAAI;;;;;;kCAEjD,8OAAC;wBACG,SAAS,IAAM,OAAO,QAAQ,CAAC,MAAM;wBACrC,WAAU;kCACb;;;;;;;;;;;;0BAKL,8OAAC;gBAAO,WAAU;0BACd,cAAA,8OAAC;oBAAE,WAAU;8BAAoC;;;;;;;;;;;;;;;;;AAMjE;AAEe,SAAS;IACpB,qBACI,8OAAC,iNAAQ;QAAC,wBACN,8OAAC;YAAI,WAAU;sBACX,cAAA,8OAAC;gBAAI,WAAU;0BAA0C;;;;;;;;;;;kBAG7D,cAAA,8OAAC;;;;;;;;;;AAGb"}}]
}