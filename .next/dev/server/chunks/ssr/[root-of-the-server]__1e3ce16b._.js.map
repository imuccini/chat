{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 14, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivanmuccini/Apps/Antigravity/chat/chat/lib/db.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = globalThis as unknown as {\n    prisma: PrismaClient | undefined\n}\n\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient()\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,sMAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 27, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivanmuccini/Apps/Antigravity/chat/chat/services/messageService.ts"],"sourcesContent":["import { prisma } from \"@/lib/db\";\n\n// SERVICE: Tenant Resolution\nexport const getTenantByNasId = async (nasId: string) => {\n    return await prisma.tenant.findFirst({\n        where: {\n            devices: {\n                some: {\n                    nasId: nasId\n                }\n            }\n        }\n    });\n};\n\nexport const getTenantBySlug = async (slug: string) => {\n    return await prisma.tenant.findUnique({\n        where: { slug },\n    });\n};\n\n// SERVICE: Messagging (Multi-tenant Filtered)\nexport const getMessages = async (tenantId: string, limit = 50) => {\n    return await prisma.message.findMany({\n        where: { tenantId },\n        orderBy: { createdAt: \"desc\" },\n        take: limit,\n        include: { user: true }, // Include sender details\n    });\n};\n\nexport const createMessage = async (content: string, userId: string, tenantId: string) => {\n    return await prisma.message.create({\n        data: {\n            content,\n            userId,\n            tenantId,\n        },\n    });\n};\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAGO,MAAM,mBAAmB,OAAO;IACnC,OAAO,MAAM,mHAAM,CAAC,MAAM,CAAC,SAAS,CAAC;QACjC,OAAO;YACH,SAAS;gBACL,MAAM;oBACF,OAAO;gBACX;YACJ;QACJ;IACJ;AACJ;AAEO,MAAM,kBAAkB,OAAO;IAClC,OAAO,MAAM,mHAAM,CAAC,MAAM,CAAC,UAAU,CAAC;QAClC,OAAO;YAAE;QAAK;IAClB;AACJ;AAGO,MAAM,cAAc,OAAO,UAAkB,QAAQ,EAAE;IAC1D,OAAO,MAAM,mHAAM,CAAC,OAAO,CAAC,QAAQ,CAAC;QACjC,OAAO;YAAE;QAAS;QAClB,SAAS;YAAE,WAAW;QAAO;QAC7B,MAAM;QACN,SAAS;YAAE,MAAM;QAAK;IAC1B;AACJ;AAEO,MAAM,gBAAgB,OAAO,SAAiB,QAAgB;IACjE,OAAO,MAAM,mHAAM,CAAC,OAAO,CAAC,MAAM,CAAC;QAC/B,MAAM;YACF;YACA;YACA;QACJ;IACJ;AACJ"}},
    {"offset": {"line": 84, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivanmuccini/Apps/Antigravity/chat/chat/app/page.tsx"],"sourcesContent":["import { getTenantByNasId } from \"@/services/messageService\";\nimport { redirect } from \"next/navigation\";\n\ninterface PageProps {\n    searchParams: Promise<{ [key: string]: string | string[] | undefined }>\n}\n\nexport default async function Home(props: PageProps) {\n    const searchParams = await props.searchParams;\n    const nasId = searchParams.nas_id;\n\n    if (typeof nasId === 'string') {\n        const tenant = await getTenantByNasId(nasId);\n\n        if (tenant) {\n            redirect(`/${tenant.slug}`);\n        } else {\n            return (\n                <div className=\"h-screen w-full flex items-center justify-center bg-gray-100 p-4\">\n                    <div className=\"text-center p-8 bg-white rounded-lg shadow-lg max-w-md\">\n                        <h1 className=\"text-2xl font-bold text-red-500 mb-4\">Accesso Negato</h1>\n                        <p className=\"text-gray-700\">La chat in questo spazio non e' attiva.</p>\n                        <p className=\"text-xs text-gray-400 mt-4\">ID Router non riconosciuto: {nasId}</p>\n                    </div>\n                </div>\n            );\n        }\n    }\n\n    // Fallback for direct access without NAS ID (Demo/Test)\n    // In production you might want to block this too, or show a tenant selector\n    return (\n        <main className=\"flex min-h-screen flex-col items-center justify-center p-24\">\n            <h1 className=\"text-4xl font-bold mb-8\">Benvenuto su Treno Chat</h1>\n            <p className=\"mb-4\">Per accedere, connettiti al Wi-Fi del treno.</p>\n        </main>\n    );\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;AAAA;;;;AAMe,eAAe,KAAK,KAAgB;IAC/C,MAAM,eAAe,MAAM,MAAM,YAAY;IAC7C,MAAM,QAAQ,aAAa,MAAM;IAEjC,IAAI,OAAO,UAAU,UAAU;QAC3B,MAAM,SAAS,MAAM,IAAA,8IAAgB,EAAC;QAEtC,IAAI,QAAQ;YACR,IAAA,iMAAQ,EAAC,CAAC,CAAC,EAAE,OAAO,IAAI,EAAE;QAC9B,OAAO;YACH,qBACI,8OAAC;gBAAI,WAAU;0BACX,cAAA,8OAAC;oBAAI,WAAU;;sCACX,8OAAC;4BAAG,WAAU;sCAAuC;;;;;;sCACrD,8OAAC;4BAAE,WAAU;sCAAgB;;;;;;sCAC7B,8OAAC;4BAAE,WAAU;;gCAA6B;gCAA6B;;;;;;;;;;;;;;;;;;QAIvF;IACJ;IAEA,wDAAwD;IACxD,4EAA4E;IAC5E,qBACI,8OAAC;QAAK,WAAU;;0BACZ,8OAAC;gBAAG,WAAU;0BAA0B;;;;;;0BACxC,8OAAC;gBAAE,WAAU;0BAAO;;;;;;;;;;;;AAGhC"}}]
}