{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/config.ts"],"sourcesContent":["import { Capacitor } from '@capacitor/core';\n\n// Detect if running natively (iOS or Android)\nconst isNative = Capacitor.isNativePlatform();\n\n// Use env variable or fallback\n// Set NEXT_PUBLIC_SERVER_URL in .env to your local IP (e.g. http://192.168.1.x:3000)\nexport const API_BASE_URL = isNative\n    ? (process.env.NEXT_PUBLIC_SERVER_URL || 'http://localhost:3000')\n    : '';\n\nif (isNative) {\n    console.log(\"[ChatConfig] Native Platform Detected. API_BASE_URL:\", API_BASE_URL);\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEA,8CAA8C;AAC9C,MAAM,WAAW,iKAAS,CAAC,gBAAgB;AAIpC,MAAM,eAAe,WACrB,iEAAsC,0BACvC;AAEN,IAAI,UAAU;IACV,QAAQ,GAAG,CAAC,wDAAwD;AACxE"}},
    {"offset": {"line": 128, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/lib/sqlite.ts"],"sourcesContent":["import { CapacitorSQLite, SQLiteConnection, SQLiteDBConnection } from '@capacitor-community/sqlite';\nimport { Capacitor } from '@capacitor/core';\nimport { Message } from '../types';\n\nclass SQLiteService {\n    private sqlite: SQLiteConnection | null = null;\n    private db: SQLiteDBConnection | null = null;\n    private dbName: string = 'chat_cache';\n\n    async initialize() {\n        console.log(\"SQLite: Disabled for debugging.\");\n        return;\n\n        if (!Capacitor.isNativePlatform()) {\n            console.log(\"SQLite: Skipping initialization on non-native platform (Web).\");\n            return;\n        }\n        if (this.db) return;\n\n        this.sqlite = new SQLiteConnection(CapacitorSQLite);\n\n        try {\n            // Check if connection exists and close it if necessary (for hot-reload)\n            const isConn = await this.sqlite.isConnection(this.dbName, false);\n            if (isConn.result) {\n                await this.sqlite.retrieveConnection(this.dbName, false);\n            }\n\n            this.db = await this.sqlite.createConnection(this.dbName, false, 'no-encryption', 1, false);\n            await this.db.open();\n\n            const schema = `\n                CREATE TABLE IF NOT EXISTS messages (\n                    id TEXT PRIMARY KEY,\n                    text TEXT,\n                    senderId TEXT,\n                    senderAlias TEXT,\n                    senderGender TEXT,\n                    timestamp TEXT,\n                    recipientId TEXT,\n                    isGlobal INTEGER DEFAULT 1\n                );\n            `;\n            await this.db.execute(schema);\n            console.log(\"SQLite DB Initialized with schema\");\n        } catch (err) {\n            console.error('SQLite initialization error:', err);\n        }\n    }\n\n    async saveMessage(msg: Message, isGlobal: boolean = true) {\n        if (!this.db) await this.initialize();\n        if (!this.db) return;\n\n        const query = `\n            INSERT OR REPLACE INTO messages (id, text, senderId, senderAlias, senderGender, timestamp, recipientId, isGlobal)\n            VALUES (?, ?, ?, ?, ?, ?, ?, ?);\n        `;\n        const params = [\n            msg.id,\n            msg.text,\n            msg.senderId,\n            msg.senderAlias,\n            msg.senderGender,\n            msg.timestamp,\n            msg.recipientId || null,\n            isGlobal ? 1 : 0\n        ];\n\n        try {\n            await this.db.run(query, params);\n        } catch (err) {\n            console.error('Error saving message to SQLite:', err);\n        }\n    }\n\n    async purgeOldMessages() {\n        if (!this.db) await this.initialize();\n        if (!this.db) return;\n\n        const threeHoursAgo = new Date(Date.now() - 3 * 60 * 60 * 1000).toISOString();\n        try {\n            await this.db.run('DELETE FROM messages WHERE timestamp < ?;', [threeHoursAgo]);\n            console.log(\"SQLite: Purged messages older than:\", threeHoursAgo);\n        } catch (err) {\n            console.error('Error purging old messages from SQLite:', err);\n        }\n    }\n\n    async getMessages(isGlobal: boolean = true, recipientId?: string): Promise<Message[]> {\n        await this.purgeOldMessages();\n        if (!this.db) return [];\n\n        const threeHoursAgo = new Date(Date.now() - 3 * 60 * 60 * 1000).toISOString();\n        let query = '';\n        let params: any[] = [];\n\n        if (isGlobal) {\n            query = `SELECT * FROM messages WHERE isGlobal = 1 AND timestamp >= ? ORDER BY timestamp ASC LIMIT 100;`;\n            params = [threeHoursAgo];\n        } else {\n            query = `SELECT * FROM messages WHERE isGlobal = 0 AND (recipientId = ? OR senderId = ?) AND timestamp >= ? ORDER BY timestamp ASC LIMIT 100;`;\n            params = [recipientId, recipientId, threeHoursAgo];\n        }\n\n        try {\n            const res = await this.db.query(query, params);\n            return (res.values || []).map((m: any) => ({\n                ...m,\n                isGlobal: undefined // Clean up type for app\n            }));\n        } catch (err) {\n            console.error('Error fetching messages from SQLite:', err);\n            return [];\n        }\n    }\n\n    async clearMessages() {\n        if (!this.db) await this.initialize();\n        if (!this.db) return;\n\n        try {\n            await this.db.run('DELETE FROM messages;', []);\n        } catch (err) {\n            console.error('Error clearing messages from SQLite:', err);\n        }\n    }\n\n    async getPrivateChats(currentUserId: string): Promise<{ peerId: string; messages: Message[] }[]> {\n        await this.purgeOldMessages();\n        if (!this.db) return [];\n\n        try {\n            const threeHoursAgo = new Date(Date.now() - 3 * 60 * 60 * 1000).toISOString();\n            const res = await this.db.query(\n                `SELECT * FROM messages WHERE isGlobal = 0 AND timestamp >= ? ORDER BY timestamp ASC;`,\n                [threeHoursAgo]\n            );\n\n            const messages = (res.values || []).map((m: any) => ({\n                id: m.id,\n                text: m.text,\n                senderId: m.senderId,\n                senderAlias: m.senderAlias,\n                senderGender: m.senderGender,\n                timestamp: m.timestamp,\n                recipientId: m.recipientId\n            })) as Message[];\n\n            // Group by peer ID\n            const chatMap = new Map<string, Message[]>();\n            for (const msg of messages) {\n                const peerId = msg.senderId === currentUserId ? msg.recipientId! : msg.senderId;\n                if (!chatMap.has(peerId)) {\n                    chatMap.set(peerId, []);\n                }\n                chatMap.get(peerId)!.push(msg);\n            }\n\n            return Array.from(chatMap.entries()).map(([peerId, msgs]) => ({\n                peerId,\n                messages: msgs\n            }));\n        } catch (err) {\n            console.error('Error loading private chats from SQLite:', err);\n            return [];\n        }\n    }\n}\n\nexport const sqliteService = new SQLiteService();\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 262, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/lib/auth-client.ts"],"sourcesContent":["import { createAuthClient } from \"better-auth/react\";\nimport { passkeyClient } from \"@better-auth/passkey/client\";\nimport { anonymousClient } from \"better-auth/client/plugins\";\n\nexport const authClient = createAuthClient({\n    baseURL: typeof window !== 'undefined' ? window.location.origin : (process.env.NEXT_PUBLIC_BETTER_AUTH_URL || \"http://localhost:3000\"),\n    plugins: [\n        passkeyClient(),\n        anonymousClient()\n    ]\n});\n\nexport const { signIn, signUp, useSession, signOut } = authClient;\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AACA;AACA;AAAA;;;;AAEO,MAAM,aAAa,IAAA,uMAAgB,EAAC;IACvC,SAAS,sCAAgC,0BAA0B,QAAQ,GAAG,CAAC,2BAA2B,IAAI;IAC9G,SAAS;QACL,IAAA,+KAAa;QACb,IAAA,4LAAe;KAClB;AACL;AAEO,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,UAAU,EAAE,OAAO,EAAE,GAAG"}},
    {"offset": {"line": 293, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/components/Login.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { authClient, signIn, signUp } from '@/lib/auth-client';\nimport { User, Gender } from '@/types';\nimport { Capacitor } from '@capacitor/core';\n\ninterface LoginProps {\n  onLogin: (user: User) => void;\n  tenantName: string;\n}\n\ntype View = 'choice' | 'anonymous' | 'passkey_reg' | 'loading';\n\nconst Login: React.FC<LoginProps> = ({ onLogin, tenantName }) => {\n  const [view, setView] = useState<View>('choice');\n  const [alias, setAlias] = useState('');\n  const [gender, setGender] = useState<Gender>('male');\n  const [phone, setPhone] = useState('');\n  const [error, setError] = useState<string | null>(null);\n\n  // Feature detection for WebAuthn/Passkeys\n  const isWebAuthnSupported = typeof window !== 'undefined' &&\n    !!window.PublicKeyCredential &&\n    (window.isSecureContext || window.location.hostname === 'localhost');\n\n  // Platform & Social visibility\n  const platform = Capacitor.getPlatform();\n  const isApple = platform === 'ios' || (typeof window !== 'undefined' && /Mac|iPhone|iPad|iPod/.test(navigator.userAgent));\n  const isAndroid = platform === 'android' || (typeof window !== 'undefined' && /Android/.test(navigator.userAgent));\n\n  const showApple = isApple && !!process.env.NEXT_PUBLIC_APPLE_CLIENT_ID;\n  const showGoogle = isAndroid && !!process.env.NEXT_PUBLIC_GOOGLE_CLIENT_ID;\n  const anySocial = showApple || showGoogle;\n\n  const handleAnonymousSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!alias.trim()) return;\n\n    if (document.activeElement instanceof HTMLElement) {\n      document.activeElement.blur();\n    }\n\n    onLogin({\n      id: `guest_${Math.random().toString(36).substr(2, 9)}`,\n      alias: alias.trim(),\n      gender,\n      joinedAt: Date.now(),\n    });\n  };\n\n  const handlePasskeyLogin = async () => {\n    setError(null);\n    setView('loading');\n    try {\n      console.log(\"[Passkey] Starting authentication...\");\n      const { data, error } = await authClient.signIn.passkey();\n      if (error) {\n        console.error(\"[Passkey] Login error:\", error);\n        if (error.status === 404 || (error as any).code === \"PASSKEY_NOT_FOUND\") {\n          setError(\"Nessuna Passkey trovata per questo dispositivo. Registrati prima!\");\n        } else {\n          setError(error.message || \"Errore durante l'accesso\");\n        }\n        setView('choice');\n      }\n    } catch (err: any) {\n      console.error(\"[Passkey] Unexpected login error:\", err);\n      if (err.name === 'NotAllowedError') {\n        setError(\"L'operazione non è permessa in questo contesto. Assicurati di usare 'localhost' o HTTPS per accedere alla chat.\");\n      } else {\n        setError(err.message || \"Errore inaspettato\");\n      }\n      setView('choice');\n    }\n  };\n\n  const handleSocialLogin = async (provider: 'google' | 'apple') => {\n    setError(null);\n    try {\n      await authClient.signIn.social({\n        provider,\n        callbackURL: window.location.href, // Return to current page/tenant\n      });\n    } catch (err: any) {\n      console.error(`[Social] ${provider} login error:`, err);\n      setError(`Errore durante l'accesso con ${provider}`);\n    }\n  };\n\n  const handlePasskeyRegister = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!alias.trim() || !phone.trim()) return;\n\n    setError(null);\n    setView('loading');\n    try {\n      // Set a flag so ChatInterface doesn't redirect immediately upon anonymous session creation\n      localStorage.setItem('waiting_for_passkey', 'true');\n\n      // 1. Create anonymous session first (Passkey registration requires a session)\n      const { data: anonData, error: anonError } = await authClient.signIn.anonymous();\n      if (anonError) {\n        localStorage.removeItem('waiting_for_passkey');\n        setError(anonError.message || \"Errore durante l'inizializzazione\");\n        setView('passkey_reg');\n        return;\n      }\n\n      // 2. Update user profile\n      const { error: updateError } = await authClient.updateUser({\n        name: alias.trim(),\n        // @ts-ignore - custom fields\n        phoneNumber: phone.trim(),\n        gender: gender\n      });\n      if (updateError) {\n        console.warn(\"Profile update failed, continuing with passkey\", updateError);\n      }\n\n      // 3. Register the Passkey\n      console.log(\"[Passkey] Starting biometric registration...\");\n      const { data, error: passkeyError } = await authClient.passkey.addPasskey({\n        name: 'Passkey Principale'\n      });\n\n      if (passkeyError) {\n        console.error(\"[Passkey] Registration error:\", passkeyError);\n        localStorage.removeItem('waiting_for_passkey');\n        setError(passkeyError.message || \"Errore durante la registrazione biometrica\");\n        setView('passkey_reg');\n      } else {\n        console.log(\"[Passkey] Registration successful!\");\n\n        // Final \"Account Upgrade\": Set isAnonymous to false\n        await authClient.updateUser({\n          // @ts-ignore\n          isAnonymous: false\n        });\n\n        localStorage.removeItem('waiting_for_passkey');\n        // Force session refresh or manually callback\n        setTimeout(() => {\n          window.location.reload();\n        }, 500);\n      }\n    } catch (err: any) {\n      console.error(\"[Passkey] Unexpected error:\", err);\n      localStorage.removeItem('waiting_for_passkey');\n      if (err.name === 'NotAllowedError') {\n        setError(\"L'operazione non è permessa in questo contesto. Assicurati di usare 'localhost' o HTTPS per accedere alla chat.\");\n      } else {\n        setError(err.message || \"Errore inaspettato\");\n      }\n      setView('passkey_reg');\n    }\n  };\n\n  const genderLabels: Record<Gender, string> = {\n    male: 'Maschio',\n    female: 'Femmina',\n    other: 'Altro'\n  };\n\n  if (view === 'loading') {\n    return (\n      <div className=\"bg-white p-6 sm:p-8 w-full h-full sm:h-auto sm:max-w-md sm:rounded-2xl sm:shadow-xl sm:border border-gray-100 flex flex-col items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-500 mb-4\" />\n        <p className=\"text-gray-500\">In attesa...</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-white p-6 sm:p-8 w-full h-full sm:h-auto sm:max-w-md sm:rounded-2xl sm:shadow-xl sm:border border-gray-100 flex flex-col justify-center\">\n      <div className=\"text-center mb-8\">\n        <div className=\"w-24 h-24 mx-auto mb-6 flex items-center justify-center\">\n          <img src=\"/local_logo.svg\" alt=\"Local Logo\" className=\"w-full h-full object-contain\" />\n        </div>\n        <h1 className=\"text-2xl font-bold text-gray-800 tracking-tight\">{tenantName}</h1>\n        {view === 'choice' && <p className=\"text-gray-500 mt-2 text-sm\">chatta in modo anonimo o crea un profilo sicuro</p>}\n      </div>\n\n      {error && (\n        <div className=\"mb-6 p-4 bg-red-50 border border-red-100 text-red-600 text-sm rounded-xl text-center\">\n          {error}\n        </div>\n      )}\n\n      {view === 'choice' && (\n        <div className=\"space-y-4\">\n          <button\n            onClick={() => setView('anonymous')}\n            className=\"w-full bg-white hover:bg-gray-50 text-gray-700 font-semibold py-4 rounded-xl border border-gray-200 transition-all flex items-center justify-center gap-2\"\n          >\n            Accesso anonimo\n          </button>\n\n          {(anySocial || isWebAuthnSupported) && (\n            <div className=\"relative py-2\">\n              <div className=\"absolute inset-0 flex items-center\"><div className=\"w-full border-t border-gray-100\"></div></div>\n              <div className=\"relative flex justify-center text-xs uppercase\"><span className=\"bg-white px-2 text-gray-400\">Oppure</span></div>\n            </div>\n          )}\n\n          {anySocial && (\n            <div className=\"flex gap-3\">\n              {showApple && (\n                <button\n                  onClick={() => handleSocialLogin('apple')}\n                  className=\"flex-1 bg-black hover:bg-zinc-900 text-white font-semibold py-3.5 rounded-xl transition-all flex items-center justify-center gap-2 text-sm\"\n                >\n                  <svg className=\"w-5 h-5\" viewBox=\"0 0 24 24\" fill=\"currentColor\"><path d=\"M17.05 20.28c-.98.95-2.05.8-3.08.35-1.09-.46-2.09-.48-3.24 0-1.44.62-2.2.44-3.06-.35C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.78 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.88-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.53 4.02zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.34 4.5-3.74 4.25z\" /></svg>\n                  Apple\n                </button>\n              )}\n              {showGoogle && (\n                <button\n                  onClick={() => handleSocialLogin('google')}\n                  className=\"flex-1 bg-white hover:bg-gray-50 text-gray-700 font-semibold py-3.5 rounded-xl border border-gray-200 transition-all flex items-center justify-center gap-2 text-sm\"\n                >\n                  <svg className=\"w-5 h-5\" viewBox=\"0 0 24 24\"><path fill=\"#4285F4\" d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\" /><path fill=\"#34A853\" d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\" /><path fill=\"#FBBC05\" d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z\" /><path fill=\"#EA4335\" d=\"M12 5.38c1.62 0 3.06.56 4.21 1.66l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\" /></svg>\n                  Google\n                </button>\n              )}\n            </div>\n          )}\n\n          {isWebAuthnSupported && (\n            <>\n              <button\n                onClick={handlePasskeyLogin}\n                className=\"w-full bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-4 rounded-xl transition-all shadow-lg shadow-emerald-200 flex items-center justify-center gap-2\"\n              >\n                Accedi con Passkey\n              </button>\n              <button\n                onClick={() => setView('passkey_reg')}\n                className=\"w-full text-emerald-600 font-semibold text-sm hover:underline py-2\"\n              >\n                Non hai un account? Registrati con Passkey\n              </button>\n            </>\n          )}\n        </div>\n      )}\n\n      {view === 'anonymous' && (\n        <form onSubmit={handleAnonymousSubmit} className=\"space-y-6\">\n          <button onClick={() => setView('choice')} className=\"text-gray-400 text-sm flex items-center gap-1 hover:text-gray-600 mb-2\">\n            ← Torna indietro\n          </button>\n          <div>\n            <label className=\"block text-sm font-semibold text-gray-700 mb-2\">Il tuo Alias</label>\n            <input\n              type=\"text\"\n              required\n              maxLength={20}\n              value={alias}\n              onChange={(e) => setAlias(e.target.value)}\n              placeholder=\"es. ShadowHunter\"\n              className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500 transition-all text-gray-800\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-semibold text-gray-700 mb-2\">Identità di Genere</label>\n            <div className=\"grid grid-cols-3 gap-3\">\n              {(['male', 'female', 'other'] as Gender[]).map((g) => (\n                <button\n                  key={g}\n                  type=\"button\"\n                  onClick={() => setGender(g)}\n                  className={`py-2 rounded-xl text-xs font-bold uppercase tracking-wider border transition-all ${gender === g\n                    ? 'bg-emerald-500 text-white border-emerald-500 shadow-md'\n                    : 'bg-white text-gray-500 border-gray-200 hover:border-emerald-200'\n                    }`}\n                >\n                  {genderLabels[g]}\n                </button>\n              ))}\n            </div>\n          </div>\n          <button type=\"submit\" className=\"w-full bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-4 rounded-xl transition-all shadow-lg shadow-emerald-200\">\n            Entra nella Stanza\n          </button>\n        </form>\n      )}\n\n      {isWebAuthnSupported && view === 'passkey_reg' && (\n        <form onSubmit={handlePasskeyRegister} className=\"space-y-6\">\n          <button onClick={() => setView('choice')} className=\"text-gray-400 text-sm flex items-center gap-1 hover:text-gray-600 mb-2\">\n            ← Torna indietro\n          </button>\n          <div>\n            <label className=\"block text-sm font-semibold text-gray-700 mb-2\">Scegli un Alias</label>\n            <input\n              type=\"text\"\n              required\n              maxLength={20}\n              value={alias}\n              onChange={(e) => setAlias(e.target.value)}\n              placeholder=\"es. MarcoPass\"\n              className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500 transition-all text-gray-800\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-semibold text-gray-700 mb-2\">Cellulare (per il recupero)</label>\n            <input\n              type=\"tel\"\n              required\n              value={phone}\n              onChange={(e) => setPhone(e.target.value)}\n              placeholder=\"+39 333 1234567\"\n              className=\"w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500 transition-all text-gray-800\"\n            />\n          </div>\n          <button type=\"submit\" className=\"w-full bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-4 rounded-xl transition-all shadow-lg shadow-emerald-200 flex items-center justify-center gap-2\">\n            Crea Account con Passkey\n          </button>\n          <p className=\"text-[11px] text-gray-400 leading-relaxed\">\n            Il tuo numero verrà utilizzato esclusivamente per permetterti di recuperare l'accesso in caso di smarrimento del dispositivo.\n          </p>\n        </form>\n      )}\n\n      <p className=\"text-center text-[10px] text-gray-400 mt-8 uppercase tracking-widest\">\n        Powered by Local - Copyright 2025\n      </p>\n    </div>\n  );\n};\n\nexport default Login;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 887, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/components/GlobalChat.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect, memo, useCallback } from 'react';\nimport { User, Message, Gender } from '@/types';\nimport { Virtuoso, VirtuosoHandle } from 'react-virtuoso';\n\ninterface GlobalChatProps {\n  user: User;\n  messages: Message[];\n  onSendMessage: (text: string) => void;\n  onlineCount: number;\n  isOnline: boolean;\n  hideHeader?: boolean;\n  headerTitle?: string;\n  showBottomNavPadding?: boolean;\n  isFocused?: boolean;\n  onInputFocusChange?: (isFocused: boolean) => void;\n  isSyncing?: boolean;\n}\n\nconst GenderIcon = memo(({ gender, className }: { gender: Gender; className?: string }) => {\n  if (gender === 'male') {\n    return (\n      <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className={className}>\n        <path d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\"></path>\n        <circle cx=\"12\" cy=\"7\" r=\"4\"></circle>\n      </svg>\n    );\n  }\n  if (gender === 'female') {\n    return (\n      <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className={className}>\n        <path d=\"M12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10Z\"></path>\n        <path d=\"M18 22H6c0-4 4-3 6-3s6-1 6 3Z\"></path>\n      </svg>\n    );\n  }\n  return (\n    <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className={className}>\n      <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\n      <circle cx=\"12\" cy=\"10\" r=\"3\"></circle>\n      <path d=\"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662\"></path>\n    </svg>\n  );\n});\n\nconst ChatInput = memo(({ onSendMessage, showBottomNavPadding, onFocusChange, isFocused }: {\n  onSendMessage: (text: string) => void,\n  showBottomNavPadding?: boolean,\n  onFocusChange?: (isFocused: boolean) => void,\n  isFocused?: boolean\n}) => {\n  const [text, setText] = useState('');\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  // Removed unnecessary blur on mount that could interfere with initial user interaction\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (text.trim()) {\n      onSendMessage(text.trim());\n      setText('');\n      inputRef.current?.blur();\n    }\n  };\n\n  // Stabilized padding calculation to prevent the input from jumping and cancelling taps\n  const footerPadding = isFocused\n    ? 'pb-4 pt-3'\n    : showBottomNavPadding\n      ? 'pb-[calc(70px+env(safe-area-inset-bottom,0px)+12px)] md:pb-[90px] pt-4'\n      : 'py-4';\n\n  return (\n    <footer className={`px-3 py-3 md:p-4 bg-gray-50 border-t border-gray-200 shrink-0 ${footerPadding}`}>\n      <form onSubmit={handleSubmit} className=\"flex items-center gap-2 md:gap-3 max-w-5xl mx-auto\">\n        <input\n          ref={inputRef}\n          type=\"text\"\n          value={text}\n          onChange={(e) => setText(e.target.value)}\n          onFocus={() => onFocusChange?.(true)}\n          onBlur={() => onFocusChange?.(false)}\n          placeholder=\"Messaggio alla stanza...\"\n          className=\"flex-1 px-4 py-2.5 bg-white border border-gray-200 rounded-full focus:outline-none focus:ring-2 focus:ring-emerald-500 transition-all text-sm md:text-base placeholder-gray-400\"\n          style={{ fontSize: '16px' }}\n        />\n        <button\n          type=\"submit\"\n          className=\"w-10 h-10 flex items-center justify-center rounded-full bg-emerald-500 text-white shadow-md active:scale-95 transition-transform\"\n          onMouseDown={(e) => e.preventDefault()}\n        >\n          <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 rotate-45\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2.5} d=\"M12 19l9 2-9-18-9 18 9-2zm0 0v-8\" />\n          </svg>\n        </button>\n      </form>\n    </footer>\n  );\n});\n\nconst GlobalChat: React.FC<GlobalChatProps> = ({\n  user,\n  messages,\n  onSendMessage,\n  onlineCount,\n  isOnline,\n  hideHeader,\n  headerTitle,\n  showBottomNavPadding,\n  onInputFocusChange,\n  isFocused,\n  isSyncing\n}) => {\n  const virtuosoRef = useRef<VirtuosoHandle>(null);\n\n  const getAvatarColor = (gender: string) => {\n    switch (gender) {\n      case 'male': return 'bg-blue-500';\n      case 'female': return 'bg-pink-500';\n      default: return 'bg-purple-500';\n    }\n  };\n\n  const renderMessage = useCallback((index: number, msg: Message) => {\n    const isMe = msg.senderId === user.id;\n    const showSenderInfo = index === 0 || messages[index - 1].senderId !== msg.senderId;\n\n    return (\n      <div className={`flex ${isMe ? 'justify-end' : 'justify-start'} animate-message pb-4 px-4`}>\n        <div className={`flex flex-col max-w-[85%] ${isMe ? 'items-end' : 'items-start'}`}>\n          {showSenderInfo && (\n            <span className={`text-[10px] font-bold mb-1 px-2 uppercase tracking-tight flex items-center gap-1.5 ${isMe ? 'text-emerald-700' : 'text-gray-600'}`}>\n              {!isMe && (\n                <div className={`w-3.5 h-3.5 rounded-full flex items-center justify-center ${getAvatarColor(msg.senderGender)}`}>\n                  <GenderIcon gender={msg.senderGender} className=\"w-2 h-2 text-white\" />\n                </div>\n              )}\n              {isMe ? 'Tu' : msg.senderAlias}\n            </span>\n          )}\n          <div className={`px-3 py-2 rounded-2xl shadow-sm ${isMe ? 'bg-emerald-500 text-white rounded-tr-none' : 'bg-white text-gray-800 rounded-tl-none border border-gray-100'}`}>\n            <p className=\"whitespace-pre-wrap break-words leading-relaxed text-[15px]\">{msg.text}</p>\n          </div>\n          <span className=\"text-[9px] text-gray-400 px-1 mt-0.5 opacity-70\">\n            {new Date(msg.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n          </span>\n        </div>\n      </div>\n    );\n  }, [user.id, messages]);\n\n  return (\n    <div className=\"w-full h-full flex flex-col bg-white\">\n      {!hideHeader && (\n        <header className=\"bg-white pt-safe border-b border-gray-100 sticky top-0 z-10 shrink-0\">\n          <div className=\"h-[60px] px-4 flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-10 h-10 rounded-full bg-emerald-50 flex items-center justify-center border border-emerald-100\">\n                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 text-emerald-600\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2.5} d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\" />\n                </svg>\n              </div>\n              <div>\n                <h2 className=\"font-extrabold text-2xl text-gray-900 leading-tight tracking-tight\">{headerTitle || 'Stanza'}</h2>\n                <div className=\"flex items-center gap-1.5\">\n                  <span className={`w-2 h-2 rounded-full ${isOnline ? 'bg-emerald-500' : 'bg-red-500'}`}></span>\n                  <p className=\"text-[11px] font-bold text-emerald-600 uppercase tracking-wide\">\n                    {isOnline ? `${onlineCount} persone qui` : 'Disconnesso'}\n                  </p>\n                </div>\n              </div>\n            </div>\n            {isSyncing && (\n              <div className=\"flex items-center gap-1.5 bg-emerald-50 px-2.5 py-1 rounded-full border border-emerald-100 animate-pulse\">\n                <svg className=\"animate-spin h-3 w-3 text-emerald-600\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n                  <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\n                  <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n                </svg>\n                <span className=\"text-[10px] font-bold text-emerald-700 tracking-wide uppercase\">Sincronizzazione</span>\n              </div>\n            )}\n          </div>\n        </header>\n      )}\n\n      <div className=\"flex-1 overflow-hidden relative chat-bg\">\n        <Virtuoso\n          ref={virtuosoRef}\n          data={messages}\n          initialTopMostItemIndex={messages.length - 1}\n          itemContent={renderMessage}\n          followOutput=\"smooth\"\n          className=\"h-full w-full\"\n          alignToBottom={true}\n        />\n      </div>\n\n      <ChatInput\n        onSendMessage={onSendMessage}\n        showBottomNavPadding={showBottomNavPadding}\n        onFocusChange={onInputFocusChange}\n        isFocused={isFocused}\n      />\n    </div>\n  );\n};\n\nexport default GlobalChat;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1356, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/components/BottomNav.tsx"],"sourcesContent":["import React from 'react';\n\ntype Tab = 'room' | 'users' | 'chats' | 'settings';\n\ninterface BottomNavProps {\n    activeTab: Tab;\n    onTabChange: (tab: Tab) => void;\n    usersCount: number;\n    unreadChatsCount: number;\n}\n\nconst BottomNav: React.FC<BottomNavProps> = ({ activeTab, onTabChange, usersCount, unreadChatsCount }) => {\n    return (\n        <nav className=\"bg-white border-t border-gray-200 fixed bottom-0 left-0 right-0 z-50 h-[calc(70px+env(safe-area-inset-bottom,0px))] md:h-[80px] flex justify-around items-start pt-3 pb-[calc(env(safe-area-inset-bottom,0px)+8px)] shadow-[0_-1px_3px_rgba(0,0,0,0.05)]\">\n\n            {/* Tab 1: Room */}\n            <button\n                onClick={() => onTabChange('room')}\n                className={`flex flex-col items-center justify-center w-full relative ${activeTab === 'room' ? 'text-emerald-700' : 'text-gray-500'}`}\n            >\n                <div className=\"relative\">\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6 md:h-7 md:w-7\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={activeTab === 'room' ? 2.6 : 2.2} d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\" />\n                    </svg>\n                    {usersCount > 0 && (\n                        <span className=\"absolute -top-0.5 -right-1.5 bg-emerald-500 text-white text-[9px] font-bold px-1.5 py-0.5 rounded-full min-w-[16px] flex items-center justify-center border-2 border-white\">\n                            {usersCount}\n                        </span>\n                    )}\n                </div>\n                <span className={`text-[10px] mt-1 ${activeTab === 'room' ? 'font-bold' : 'font-semibold'}`}>Stanza</span>\n            </button>\n\n            {/* Tab 2: Users */}\n            <button\n                onClick={() => onTabChange('users')}\n                className={`flex flex-col items-center justify-center w-full relative ${activeTab === 'users' ? 'text-emerald-700' : 'text-gray-500'}`}\n            >\n                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6 md:h-7 md:w-7\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={activeTab === 'users' ? 2.6 : 2.2} d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z\" />\n                </svg>\n                <span className={`text-[10px] mt-1 ${activeTab === 'users' ? 'font-bold' : 'font-semibold'}`}>Utenti</span>\n            </button>\n\n            {/* Tab 3: Chats */}\n            <button\n                onClick={() => onTabChange('chats')}\n                className={`flex flex-col items-center justify-center w-full relative ${activeTab === 'chats' ? 'text-emerald-700' : 'text-gray-500'}`}\n            >\n                <div className=\"relative\">\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6 md:h-7 md:w-7\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={activeTab === 'chats' ? 2.6 : 2.2} d=\"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z\" />\n                    </svg>\n                    {unreadChatsCount > 0 && (\n                        <span className=\"absolute -top-0.5 -right-1.5 bg-red-500 text-white text-[9px] font-bold px-1.5 py-0.5 rounded-full min-w-[16px] flex items-center justify-center border-2 border-white\">\n                            {unreadChatsCount}\n                        </span>\n                    )}\n                </div>\n                <span className={`text-[10px] mt-1 ${activeTab === 'chats' ? 'font-bold' : 'font-semibold'}`}>Chats</span>\n            </button>\n\n            {/* Tab 4: Settings */}\n            <button\n                onClick={() => onTabChange('settings')}\n                className={`flex flex-col items-center justify-center w-full relative ${activeTab === 'settings' ? 'text-emerald-700' : 'text-gray-500'}`}\n            >\n                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6 md:h-7 md:w-7\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={activeTab === 'settings' ? 2.6 : 2.2} d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\" />\n                </svg>\n                <span className={`text-[10px] mt-1 ${activeTab === 'settings' ? 'font-bold' : 'font-semibold'}`}>Me</span>\n            </button>\n        </nav>\n    );\n};\n\nexport default BottomNav;\n\n"],"names":[],"mappings":";;;;;;AAWA,MAAM,YAAsC,CAAC,EAAE,SAAS,EAAE,WAAW,EAAE,UAAU,EAAE,gBAAgB,EAAE;IACjG,qBACI,8OAAC;QAAI,WAAU;;0BAGX,8OAAC;gBACG,SAAS,IAAM,YAAY;gBAC3B,WAAW,CAAC,0DAA0D,EAAE,cAAc,SAAS,qBAAqB,iBAAiB;;kCAErI,8OAAC;wBAAI,WAAU;;0CACX,8OAAC;gCAAI,OAAM;gCAA6B,WAAU;gCAAwB,MAAK;gCAAO,SAAQ;gCAAY,QAAO;0CAC7G,cAAA,8OAAC;oCAAK,eAAc;oCAAQ,gBAAe;oCAAQ,aAAa,cAAc,SAAS,MAAM;oCAAK,GAAE;;;;;;;;;;;4BAEvG,aAAa,mBACV,8OAAC;gCAAK,WAAU;0CACX;;;;;;;;;;;;kCAIb,8OAAC;wBAAK,WAAW,CAAC,iBAAiB,EAAE,cAAc,SAAS,cAAc,iBAAiB;kCAAE;;;;;;;;;;;;0BAIjG,8OAAC;gBACG,SAAS,IAAM,YAAY;gBAC3B,WAAW,CAAC,0DAA0D,EAAE,cAAc,UAAU,qBAAqB,iBAAiB;;kCAEtI,8OAAC;wBAAI,OAAM;wBAA6B,WAAU;wBAAwB,MAAK;wBAAO,SAAQ;wBAAY,QAAO;kCAC7G,cAAA,8OAAC;4BAAK,eAAc;4BAAQ,gBAAe;4BAAQ,aAAa,cAAc,UAAU,MAAM;4BAAK,GAAE;;;;;;;;;;;kCAEzG,8OAAC;wBAAK,WAAW,CAAC,iBAAiB,EAAE,cAAc,UAAU,cAAc,iBAAiB;kCAAE;;;;;;;;;;;;0BAIlG,8OAAC;gBACG,SAAS,IAAM,YAAY;gBAC3B,WAAW,CAAC,0DAA0D,EAAE,cAAc,UAAU,qBAAqB,iBAAiB;;kCAEtI,8OAAC;wBAAI,WAAU;;0CACX,8OAAC;gCAAI,OAAM;gCAA6B,WAAU;gCAAwB,MAAK;gCAAO,SAAQ;gCAAY,QAAO;0CAC7G,cAAA,8OAAC;oCAAK,eAAc;oCAAQ,gBAAe;oCAAQ,aAAa,cAAc,UAAU,MAAM;oCAAK,GAAE;;;;;;;;;;;4BAExG,mBAAmB,mBAChB,8OAAC;gCAAK,WAAU;0CACX;;;;;;;;;;;;kCAIb,8OAAC;wBAAK,WAAW,CAAC,iBAAiB,EAAE,cAAc,UAAU,cAAc,iBAAiB;kCAAE;;;;;;;;;;;;0BAIlG,8OAAC;gBACG,SAAS,IAAM,YAAY;gBAC3B,WAAW,CAAC,0DAA0D,EAAE,cAAc,aAAa,qBAAqB,iBAAiB;;kCAEzI,8OAAC;wBAAI,OAAM;wBAA6B,WAAU;wBAAwB,MAAK;wBAAO,SAAQ;wBAAY,QAAO;kCAC7G,cAAA,8OAAC;4BAAK,eAAc;4BAAQ,gBAAe;4BAAQ,aAAa,cAAc,aAAa,MAAM;4BAAK,GAAE;;;;;;;;;;;kCAE5G,8OAAC;wBAAK,WAAW,CAAC,iBAAiB,EAAE,cAAc,aAAa,cAAc,iBAAiB;kCAAE;;;;;;;;;;;;;;;;;;AAIjH;uCAEe"}},
    {"offset": {"line": 1568, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/components/UserList.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { User, Gender } from '@/types';\n\ninterface UserListProps {\n    currentUser: User;\n    users: (User & { socketId: string })[];\n    onStartChat: (targetUser: User) => void;\n}\n\nconst UserList: React.FC<UserListProps> = ({ currentUser, users, onStartChat }) => {\n    const [searchQuery, setSearchQuery] = useState('');\n\n    // Filter out self and apply search query\n    const otherUsers = users.filter(u =>\n        u.id !== currentUser.id &&\n        u.alias.toLowerCase().includes(searchQuery.toLowerCase())\n    );\n\n    const getAvatarColor = (gender: Gender) => {\n        switch (gender) {\n            case 'male': return 'bg-blue-500';\n            case 'female': return 'bg-pink-500';\n            default: return 'bg-purple-500';\n        }\n    };\n\n    return (\n        <div className=\"flex flex-col h-full bg-white\">\n            <header className=\"bg-white pt-safe border-b border-gray-100 sticky top-0 z-10 transition-all\">\n                <div className=\"h-[60px] px-4 flex items-center justify-between\">\n                    <h1 className=\"text-2xl font-extrabold text-gray-900 tracking-tight\">Utenti</h1>\n                    <span className=\"text-xs font-bold text-emerald-600 bg-emerald-50 px-2.5 py-1 rounded-full uppercase tracking-wide\">\n                        {users.length} Online\n                    </span>\n                </div>\n\n                {/* Search Bar */}\n                <div className=\"px-4 pb-3\">\n                    <div className=\"relative group\">\n                        <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4 text-gray-400 group-focus-within:text-emerald-500 transition-colors\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2.5} d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\" />\n                            </svg>\n                        </div>\n                        <input\n                            type=\"text\"\n                            placeholder=\"Cerca utente per nome...\"\n                            value={searchQuery}\n                            onChange={(e) => setSearchQuery(e.target.value)}\n                            className=\"w-full pl-9 pr-10 py-2 bg-gray-50 border border-gray-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:bg-white transition-all text-sm\"\n                        />\n                        {searchQuery && (\n                            <button\n                                onClick={() => setSearchQuery('')}\n                                className=\"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 transition-colors\"\n                            >\n                                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2.5} d=\"M6 18L18 6M6 6l12 12\" />\n                                </svg>\n                            </button>\n                        )}\n                    </div>\n                </div>\n            </header>\n\n            <main className=\"flex-1 overflow-y-auto p-4 pb-[80px]\">\n                {otherUsers.length === 0 ? (\n                    <div className=\"flex flex-col items-center justify-center h-full text-gray-400 space-y-4\">\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-16 w-16 opacity-20\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z\" />\n                        </svg>\n                        <p className=\"text-center font-medium\">\n                            {searchQuery ? 'Nessun utente trovato.' : 'Nessun altro utente online al momento.'}\n                        </p>\n                    </div>\n                ) : (\n                    <ul className=\"space-y-4\">\n                        {otherUsers.map(user => (\n                            <li key={user.id} className=\"flex items-center gap-4 p-3 bg-white rounded-xl active:bg-gray-50 transition-colors border-b border-gray-50 last:border-0\">\n                                <div className={`w-12 h-12 rounded-full ${getAvatarColor(user.gender)} flex items-center justify-center text-white shrink-0 shadow-sm relative`}>\n                                    <span className=\"font-bold text-lg uppercase\">{user.alias.charAt(0)}</span>\n                                    <div className=\"absolute bottom-0 right-0 w-3.5 h-3.5 bg-emerald-500 border-2 border-white rounded-full\"></div>\n                                </div>\n                                <div className=\"flex-1 min-w-0\">\n                                    <h3 className=\"font-bold text-gray-900 truncate text-base\">{user.alias}</h3>\n                                    <p className=\"text-sm text-gray-500 truncate\">\n                                        {user.status || <span className=\"capitalize\">{user.gender}</span>}\n                                    </p>\n                                </div>\n                                <button\n                                    onClick={() => onStartChat(user)}\n                                    className=\"p-2 text-emerald-600 hover:bg-emerald-50 rounded-full transition-colors\"\n                                >\n                                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\" />\n                                    </svg>\n                                </button>\n                            </li>\n                        ))}\n                    </ul>\n                )}\n            </main>\n        </div>\n    );\n};\n\nexport default UserList;\n"],"names":[],"mappings":";;;;;AAAA;;;AASA,MAAM,WAAoC,CAAC,EAAE,WAAW,EAAE,KAAK,EAAE,WAAW,EAAE;IAC1E,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAC;IAE/C,yCAAyC;IACzC,MAAM,aAAa,MAAM,MAAM,CAAC,CAAA,IAC5B,EAAE,EAAE,KAAK,YAAY,EAAE,IACvB,EAAE,KAAK,CAAC,WAAW,GAAG,QAAQ,CAAC,YAAY,WAAW;IAG1D,MAAM,iBAAiB,CAAC;QACpB,OAAQ;YACJ,KAAK;gBAAQ,OAAO;YACpB,KAAK;gBAAU,OAAO;YACtB;gBAAS,OAAO;QACpB;IACJ;IAEA,qBACI,8OAAC;QAAI,WAAU;;0BACX,8OAAC;gBAAO,WAAU;;kCACd,8OAAC;wBAAI,WAAU;;0CACX,8OAAC;gCAAG,WAAU;0CAAuD;;;;;;0CACrE,8OAAC;gCAAK,WAAU;;oCACX,MAAM,MAAM;oCAAC;;;;;;;;;;;;;kCAKtB,8OAAC;wBAAI,WAAU;kCACX,cAAA,8OAAC;4BAAI,WAAU;;8CACX,8OAAC;oCAAI,WAAU;8CACX,cAAA,8OAAC;wCAAI,OAAM;wCAA6B,WAAU;wCAA8E,MAAK;wCAAO,SAAQ;wCAAY,QAAO;kDACnK,cAAA,8OAAC;4CAAK,eAAc;4CAAQ,gBAAe;4CAAQ,aAAa;4CAAK,GAAE;;;;;;;;;;;;;;;;8CAG/E,8OAAC;oCACG,MAAK;oCACL,aAAY;oCACZ,OAAO;oCACP,UAAU,CAAC,IAAM,eAAe,EAAE,MAAM,CAAC,KAAK;oCAC9C,WAAU;;;;;;gCAEb,6BACG,8OAAC;oCACG,SAAS,IAAM,eAAe;oCAC9B,WAAU;8CAEV,cAAA,8OAAC;wCAAI,OAAM;wCAA6B,WAAU;wCAAU,MAAK;wCAAO,SAAQ;wCAAY,QAAO;kDAC/F,cAAA,8OAAC;4CAAK,eAAc;4CAAQ,gBAAe;4CAAQ,aAAa;4CAAK,GAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;0BAQ/F,8OAAC;gBAAK,WAAU;0BACX,WAAW,MAAM,KAAK,kBACnB,8OAAC;oBAAI,WAAU;;sCACX,8OAAC;4BAAI,OAAM;4BAA6B,WAAU;4BAAuB,MAAK;4BAAO,SAAQ;4BAAY,QAAO;sCAC5G,cAAA,8OAAC;gCAAK,eAAc;gCAAQ,gBAAe;gCAAQ,aAAa;gCAAG,GAAE;;;;;;;;;;;sCAEzE,8OAAC;4BAAE,WAAU;sCACR,cAAc,2BAA2B;;;;;;;;;;;6EAIlD,8OAAC;oBAAG,WAAU;8BACT,WAAW,GAAG,CAAC,CAAA,qBACZ,8OAAC;4BAAiB,WAAU;;8CACxB,8OAAC;oCAAI,WAAW,CAAC,uBAAuB,EAAE,eAAe,KAAK,MAAM,EAAE,wEAAwE,CAAC;;sDAC3I,8OAAC;4CAAK,WAAU;sDAA+B,KAAK,KAAK,CAAC,MAAM,CAAC;;;;;;sDACjE,8OAAC;4CAAI,WAAU;;;;;;;;;;;;8CAEnB,8OAAC;oCAAI,WAAU;;sDACX,8OAAC;4CAAG,WAAU;sDAA8C,KAAK,KAAK;;;;;;sDACtE,8OAAC;4CAAE,WAAU;sDACR,KAAK,MAAM,kBAAI,8OAAC;gDAAK,WAAU;0DAAc,KAAK,MAAM;;;;;;;;;;;;;;;;;8CAGjE,8OAAC;oCACG,SAAS,IAAM,YAAY;oCAC3B,WAAU;8CAEV,cAAA,8OAAC;wCAAI,OAAM;wCAA6B,WAAU;wCAAU,MAAK;wCAAO,SAAQ;wCAAY,QAAO;kDAC/F,cAAA,8OAAC;4CAAK,eAAc;4CAAQ,gBAAe;4CAAQ,aAAa;4CAAG,GAAE;;;;;;;;;;;;;;;;;2BAhBxE,KAAK,EAAE;;;;;;;;;;;;;;;;;;;;;AA0B5C;uCAEe"}},
    {"offset": {"line": 1871, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/components/ChatList.tsx"],"sourcesContent":["import React from 'react';\nimport { User, Message, Gender } from '@/types';\n\ninterface PrivateChatSession {\n    peer: User;\n    messages: Message[];\n    unreadCount: number;\n}\n\ninterface ChatListProps {\n    chats: PrivateChatSession[];\n    onSelectChat: (peerId: string) => void;\n    onDeleteChat: (peerId: string) => void;\n}\n\nconst ChatList: React.FC<ChatListProps> = ({ chats, onSelectChat, onDeleteChat }) => {\n    const getAvatarColor = (gender: Gender) => {\n        switch (gender) {\n            case 'male': return 'bg-blue-500';\n            case 'female': return 'bg-pink-500';\n            default: return 'bg-purple-500';\n        }\n    };\n\n    const getLastMessage = (msgs: Message[]) => {\n        if (msgs.length === 0) return 'Inizia la conversazione...';\n        return msgs[msgs.length - 1].text;\n    };\n\n    const getLastTime = (msgs: Message[]) => {\n        if (msgs.length === 0) return '';\n        const date = new Date(msgs[msgs.length - 1].timestamp);\n        // Se oggi mostra l'ora, altrimenti data\n        const now = new Date();\n        if (date.toDateString() === now.toDateString()) {\n            return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n        }\n        return date.toLocaleDateString([], { day: '2-digit', month: '2-digit' });\n    };\n\n    return (\n        <div className=\"flex flex-col h-full bg-white\">\n            <header className=\"bg-white pt-safe border-b border-gray-100 sticky top-0 z-10\">\n                <div className=\"h-[60px] px-4 flex items-center justify-between\">\n                    <h1 className=\"text-2xl font-extrabold text-gray-900 tracking-tight\">Chat private</h1>\n                </div>\n            </header>\n\n            <main className=\"flex-1 overflow-y-auto p-4 pb-[80px]\">\n                {chats.length === 0 ? (\n                    <div className=\"flex flex-col items-center justify-center h-full text-gray-400 space-y-4\">\n                        <div className=\"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center\">\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-8 w-8 text-gray-300\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\" />\n                            </svg>\n                        </div>\n                        <p className=\"text-center font-medium\">Nessuna chat attiva.<br />Cerca utenti nella scheda Utenti.</p>\n                    </div>\n                ) : (\n                    <ul className=\"space-y-4\">\n                        {chats.map((chat) => (\n                            <li\n                                key={chat.peer.id}\n                                onClick={() => onSelectChat(chat.peer.id)}\n                                className=\"flex items-center gap-4 p-3 bg-white hover:bg-gray-50 rounded-xl transition-colors cursor-pointer border-b border-gray-50 last:border-0\"\n                            >\n                                <div className={`w-14 h-14 rounded-full ${getAvatarColor(chat.peer.gender)} flex items-center justify-center text-white shrink-0 shadow-sm relative`}>\n                                    <span className=\"font-bold text-xl uppercase\">{chat.peer.alias.charAt(0)}</span>\n                                </div>\n\n                                <div className=\"flex-1 min-w-0\">\n                                    <div className=\"flex justify-between items-baseline mb-1\">\n                                        <h3 className=\"font-bold text-gray-900 truncate text-base\">{chat.peer.alias}</h3>\n                                        <span className=\"text-[11px] text-gray-400 font-medium\">{getLastTime(chat.messages)}</span>\n                                    </div>\n                                    <p className=\"text-sm text-gray-500 truncate\">{getLastMessage(chat.messages)}</p>\n                                </div>\n\n                                <div className=\"flex items-center gap-2\">\n                                    {chat.unreadCount > 0 && (\n                                        <div className=\"min-w-[20px] h-5 px-1.5 bg-emerald-500 rounded-full flex items-center justify-center\">\n                                            <span className=\"text-[10px] font-bold text-white\">{chat.unreadCount}</span>\n                                        </div>\n                                    )}\n\n                                    <button\n                                        onClick={(e) => {\n                                            e.stopPropagation();\n                                            onDeleteChat(chat.peer.id);\n                                        }}\n                                        className=\"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-full transition-colors\"\n                                    >\n                                        <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n                                        </svg>\n                                    </button>\n                                </div>\n                            </li>\n                        ))}\n                    </ul>\n                )}\n            </main>\n        </div>\n    );\n};\n\nexport default ChatList;\n"],"names":[],"mappings":";;;;;;AAeA,MAAM,WAAoC,CAAC,EAAE,KAAK,EAAE,YAAY,EAAE,YAAY,EAAE;IAC5E,MAAM,iBAAiB,CAAC;QACpB,OAAQ;YACJ,KAAK;gBAAQ,OAAO;YACpB,KAAK;gBAAU,OAAO;YACtB;gBAAS,OAAO;QACpB;IACJ;IAEA,MAAM,iBAAiB,CAAC;QACpB,IAAI,KAAK,MAAM,KAAK,GAAG,OAAO;QAC9B,OAAO,IAAI,CAAC,KAAK,MAAM,GAAG,EAAE,CAAC,IAAI;IACrC;IAEA,MAAM,cAAc,CAAC;QACjB,IAAI,KAAK,MAAM,KAAK,GAAG,OAAO;QAC9B,MAAM,OAAO,IAAI,KAAK,IAAI,CAAC,KAAK,MAAM,GAAG,EAAE,CAAC,SAAS;QACrD,wCAAwC;QACxC,MAAM,MAAM,IAAI;QAChB,IAAI,KAAK,YAAY,OAAO,IAAI,YAAY,IAAI;YAC5C,OAAO,KAAK,kBAAkB,CAAC,EAAE,EAAE;gBAAE,MAAM;gBAAW,QAAQ;YAAU;QAC5E;QACA,OAAO,KAAK,kBAAkB,CAAC,EAAE,EAAE;YAAE,KAAK;YAAW,OAAO;QAAU;IAC1E;IAEA,qBACI,8OAAC;QAAI,WAAU;;0BACX,8OAAC;gBAAO,WAAU;0BACd,cAAA,8OAAC;oBAAI,WAAU;8BACX,cAAA,8OAAC;wBAAG,WAAU;kCAAuD;;;;;;;;;;;;;;;;0BAI7E,8OAAC;gBAAK,WAAU;0BACX,MAAM,MAAM,KAAK,kBACd,8OAAC;oBAAI,WAAU;;sCACX,8OAAC;4BAAI,WAAU;sCACX,cAAA,8OAAC;gCAAI,OAAM;gCAA6B,WAAU;gCAAwB,MAAK;gCAAO,SAAQ;gCAAY,QAAO;0CAC7G,cAAA,8OAAC;oCAAK,eAAc;oCAAQ,gBAAe;oCAAQ,aAAa;oCAAG,GAAE;;;;;;;;;;;;;;;;sCAG7E,8OAAC;4BAAE,WAAU;;gCAA0B;8CAAoB,8OAAC;;;;;gCAAK;;;;;;;;;;;;6EAGrE,8OAAC;oBAAG,WAAU;8BACT,MAAM,GAAG,CAAC,CAAC,qBACR,8OAAC;4BAEG,SAAS,IAAM,aAAa,KAAK,IAAI,CAAC,EAAE;4BACxC,WAAU;;8CAEV,8OAAC;oCAAI,WAAW,CAAC,uBAAuB,EAAE,eAAe,KAAK,IAAI,CAAC,MAAM,EAAE,wEAAwE,CAAC;8CAChJ,cAAA,8OAAC;wCAAK,WAAU;kDAA+B,KAAK,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC;;;;;;;;;;;8CAG1E,8OAAC;oCAAI,WAAU;;sDACX,8OAAC;4CAAI,WAAU;;8DACX,8OAAC;oDAAG,WAAU;8DAA8C,KAAK,IAAI,CAAC,KAAK;;;;;;8DAC3E,8OAAC;oDAAK,WAAU;8DAAyC,YAAY,KAAK,QAAQ;;;;;;;;;;;;sDAEtF,8OAAC;4CAAE,WAAU;sDAAkC,eAAe,KAAK,QAAQ;;;;;;;;;;;;8CAG/E,8OAAC;oCAAI,WAAU;;wCACV,KAAK,WAAW,GAAG,mBAChB,8OAAC;4CAAI,WAAU;sDACX,cAAA,8OAAC;gDAAK,WAAU;0DAAoC,KAAK,WAAW;;;;;;;;;;;sDAI5E,8OAAC;4CACG,SAAS,CAAC;gDACN,EAAE,eAAe;gDACjB,aAAa,KAAK,IAAI,CAAC,EAAE;4CAC7B;4CACA,WAAU;sDAEV,cAAA,8OAAC;gDAAI,OAAM;gDAA6B,WAAU;gDAAU,MAAK;gDAAO,SAAQ;gDAAY,QAAO;0DAC/F,cAAA,8OAAC;oDAAK,eAAc;oDAAQ,gBAAe;oDAAQ,aAAa;oDAAG,GAAE;;;;;;;;;;;;;;;;;;;;;;;2BA/B5E,KAAK,IAAI,CAAC,EAAE;;;;;;;;;;;;;;;;;;;;;AA0CjD;uCAEe"}},
    {"offset": {"line": 2134, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/components/Settings.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { User } from '@/types';\n\ninterface SettingsProps {\n    user: User;\n    onLogout: () => void;\n    onUpdateAlias: (newAlias: string) => void;\n    onUpdateStatus: (newStatus: string) => void;\n}\n\nconst Settings: React.FC<SettingsProps> = ({ user, onLogout, onUpdateAlias, onUpdateStatus }) => {\n    const [isEditingAlias, setIsEditingAlias] = useState(false);\n    const [isEditingStatus, setIsEditingStatus] = useState(false);\n    const [newAlias, setNewAlias] = useState(user.alias);\n    const [newStatus, setNewStatus] = useState(user.status || '');\n\n    const handleSaveAlias = () => {\n        if (newAlias.trim() && newAlias !== user.alias) {\n            onUpdateAlias(newAlias.trim());\n        }\n        setIsEditingAlias(false);\n    };\n\n    const handleSaveStatus = () => {\n        if (newStatus.trim() !== (user.status || '')) {\n            onUpdateStatus(newStatus.trim());\n        }\n        setIsEditingStatus(false);\n    };\n\n    const genderLabels: Record<string, string> = {\n        male: 'maschio',\n        female: 'femmina',\n        other: 'altro'\n    };\n\n    return (\n        <div className=\"flex flex-col h-full bg-gray-50\">\n            <header className=\"bg-white pt-safe border-b border-gray-100 sticky top-0 z-10\">\n                <div className=\"h-[60px] px-4 flex items-center\">\n                    <h1 className=\"text-2xl font-extrabold text-gray-900 tracking-tight\">Profilo</h1>\n                </div>\n            </header>\n\n            <main className=\"flex-1 overflow-y-auto\">\n                <div className=\"pb-32\">\n\n                    {/* Avatar Section - Photo edit removed as requested */}\n                    <div className=\"py-8 flex flex-col items-center bg-white border-b border-gray-100\">\n                        <div className=\"relative group\">\n                            <div className=\"w-24 h-24 bg-emerald-500 rounded-full flex items-center justify-center text-white text-4xl font-bold shadow-sm overflow-hidden\">\n                                {user.alias.charAt(0).toUpperCase()}\n                            </div>\n                        </div>\n                    </div>\n\n                    {/* Info Groups */}\n                    <div className=\"mt-6 space-y-6\">\n                        {/* About Section */}\n                        <div>\n                            <h3 className=\"px-4 mb-2 text-xs font-medium text-gray-500 uppercase tracking-wider\">Stato</h3>\n                            <div className=\"bg-white border-y border-gray-100\">\n                                <button\n                                    onClick={() => setIsEditingStatus(true)}\n                                    className=\"w-full px-4 py-3.5 flex items-center justify-between hover:bg-gray-50 transition-colors\"\n                                >\n                                    <div className=\"flex flex-col items-start truncate overflow-hidden\">\n                                        {isEditingStatus ? (\n                                            <input\n                                                type=\"text\"\n                                                value={newStatus}\n                                                onChange={(e) => setNewStatus(e.target.value)}\n                                                onBlur={handleSaveStatus}\n                                                onKeyDown={(e) => e.key === 'Enter' && handleSaveStatus()}\n                                                maxLength={50}\n                                                className=\"text-[17px] text-gray-900 focus:outline-none w-full bg-transparent\"\n                                                autoFocus\n                                            />\n                                        ) : (\n                                            <span className=\"text-[17px] text-gray-900 truncate overflow-hidden w-full text-left\">\n                                                {user.status || 'Disponibile'}\n                                            </span>\n                                        )}\n                                    </div>\n                                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 text-gray-300 shrink-0 ml-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 5l7 7-7 7\" />\n                                    </svg>\n                                </button>\n                            </div>\n                        </div>\n\n                        {/* Name Section */}\n                        <div>\n                            <h3 className=\"px-4 mb-2 text-xs font-medium text-gray-500 uppercase tracking-wider\">Alias</h3>\n                            <div className=\"bg-white border-y border-gray-100\">\n                                <button\n                                    onClick={() => setIsEditingAlias(true)}\n                                    className=\"w-full px-4 py-3.5 flex items-center justify-between hover:bg-gray-50 transition-colors\"\n                                >\n                                    <div className=\"flex flex-col items-start\">\n                                        {isEditingAlias ? (\n                                            <input\n                                                type=\"text\"\n                                                value={newAlias}\n                                                onChange={(e) => setNewAlias(e.target.value)}\n                                                onBlur={handleSaveAlias}\n                                                onKeyDown={(e) => e.key === 'Enter' && handleSaveAlias()}\n                                                maxLength={20}\n                                                className=\"text-[17px] text-gray-900 focus:outline-none w-full bg-transparent\"\n                                                autoFocus\n                                            />\n                                        ) : (\n                                            <span className=\"text-[17px] text-gray-900\">\n                                                {user.alias}\n                                            </span>\n                                        )}\n                                    </div>\n                                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 text-gray-300 shrink-0 ml-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11 5l7 7-7 7\" />\n                                    </svg>\n                                </button>\n                            </div>\n                        </div>\n\n                        {/* Account Info Section */}\n                        <div>\n                            <h3 className=\"px-4 mb-2 text-xs font-medium text-gray-500 uppercase tracking-wider\">Informazioni</h3>\n                            <div className=\"bg-white border-y border-gray-100 divide-y divide-gray-50\">\n                                <div className=\"px-4 py-3.5 flex items-center justify-between\">\n                                    <span className=\"text-[17px] text-gray-400\">Sesso</span>\n                                    <span className=\"text-[17px] text-gray-900 capitalize\">{genderLabels[user.gender] || user.gender}</span>\n                                </div>\n                                <div className=\"px-4 py-3.5 flex items-center justify-between\">\n                                    <span className=\"text-[17px] text-gray-400\">User ID</span>\n                                    <span className=\"text-xs font-mono text-gray-400 uppercase tracking-wider\">{user.id}</span>\n                                </div>\n                            </div>\n                        </div>\n\n                        {/* Actions Section */}\n                        <div className=\"pt-4\">\n                            <div className=\"bg-white border-y border-gray-100\">\n                                <button\n                                    onClick={onLogout}\n                                    className=\"w-full px-4 py-4 flex items-center justify-center text-red-600 font-semibold text-lg hover:bg-red-50 transition-colors\"\n                                >\n                                    Esci\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </main>\n        </div>\n    );\n};\n\nexport default Settings;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2510, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/hooks/useSwipeBack.ts"],"sourcesContent":["import { useState, useRef, useCallback, TouchEvent } from 'react';\n\ninterface UseSwipeBackOptions {\n    onSwipeBack: () => void;\n    edgeWidth?: number;      // How far from left edge to start gesture (default: 30px)\n    threshold?: number;      // Min swipe distance to trigger back (default: 100px)\n    enabled?: boolean;       // Enable/disable the gesture\n}\n\ninterface SwipeBackState {\n    isDragging: boolean;\n    translateX: number;\n    opacity: number;\n}\n\nexport function useSwipeBack({\n    onSwipeBack,\n    edgeWidth = 30,\n    threshold = 100,\n    enabled = true\n}: UseSwipeBackOptions) {\n    const [state, setState] = useState<SwipeBackState>({\n        isDragging: false,\n        translateX: 0,\n        opacity: 1\n    });\n\n    const startX = useRef(0);\n    const startY = useRef(0);\n    const isEdgeSwipe = useRef(false);\n    const hasTriggered = useRef(false);\n\n    const handleTouchStart = useCallback((e: TouchEvent) => {\n        if (!enabled) return;\n\n        const touch = e.touches[0];\n        startX.current = touch.clientX;\n        startY.current = touch.clientY;\n\n        // Check if touch started from left edge\n        isEdgeSwipe.current = touch.clientX <= edgeWidth;\n        hasTriggered.current = false;\n\n        if (isEdgeSwipe.current) {\n            setState({ isDragging: true, translateX: 0, opacity: 1 });\n        }\n    }, [enabled, edgeWidth]);\n\n    const handleTouchMove = useCallback((e: TouchEvent) => {\n        if (!enabled || !isEdgeSwipe.current || hasTriggered.current) return;\n\n        const touch = e.touches[0];\n        const deltaX = touch.clientX - startX.current;\n        const deltaY = Math.abs(touch.clientY - startY.current);\n\n        // If vertical movement is greater, it's a scroll - cancel swipe\n        if (deltaY > 30 && deltaX < 30) {\n            isEdgeSwipe.current = false;\n            setState({ isDragging: false, translateX: 0, opacity: 1 });\n            return;\n        }\n\n        // Only allow right-to-left swipe (positive deltaX)\n        if (deltaX > 0) {\n            // Calculate translateX with some resistance\n            const translateX = Math.min(deltaX * 0.8, window.innerWidth);\n            const opacity = 1 - (translateX / window.innerWidth) * 0.3;\n\n            setState({ isDragging: true, translateX, opacity });\n\n            // Prevent scroll while swiping\n            e.preventDefault();\n        }\n    }, [enabled]);\n\n    const handleTouchEnd = useCallback(() => {\n        if (!enabled || !isEdgeSwipe.current || hasTriggered.current) {\n            setState({ isDragging: false, translateX: 0, opacity: 1 });\n            return;\n        }\n\n        const { translateX } = state;\n\n        if (translateX >= threshold) {\n            // Trigger back navigation\n            hasTriggered.current = true;\n            setState({ isDragging: false, translateX: window.innerWidth, opacity: 0 });\n\n            // Delay callback to allow animation\n            setTimeout(() => {\n                onSwipeBack();\n                setState({ isDragging: false, translateX: 0, opacity: 1 });\n            }, 150);\n        } else {\n            // Spring back to original position\n            setState({ isDragging: false, translateX: 0, opacity: 1 });\n        }\n\n        isEdgeSwipe.current = false;\n    }, [enabled, state, threshold, onSwipeBack]);\n\n    const swipeHandlers = {\n        onTouchStart: handleTouchStart,\n        onTouchMove: handleTouchMove,\n        onTouchEnd: handleTouchEnd,\n    };\n\n    const swipeStyle = {\n        transform: `translateX(${state.translateX}px)`,\n        transition: state.isDragging ? 'none' : 'transform 0.2s ease-out, opacity 0.2s ease-out',\n        opacity: state.opacity,\n    };\n\n    return {\n        swipeHandlers,\n        swipeStyle,\n        isDragging: state.isDragging,\n        translateX: state.translateX\n    };\n}\n"],"names":[],"mappings":";;;;AAAA;;AAeO,SAAS,aAAa,EACzB,WAAW,EACX,YAAY,EAAE,EACd,YAAY,GAAG,EACf,UAAU,IAAI,EACI;IAClB,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAiB;QAC/C,YAAY;QACZ,YAAY;QACZ,SAAS;IACb;IAEA,MAAM,SAAS,IAAA,+MAAM,EAAC;IACtB,MAAM,SAAS,IAAA,+MAAM,EAAC;IACtB,MAAM,cAAc,IAAA,+MAAM,EAAC;IAC3B,MAAM,eAAe,IAAA,+MAAM,EAAC;IAE5B,MAAM,mBAAmB,IAAA,oNAAW,EAAC,CAAC;QAClC,IAAI,CAAC,SAAS;QAEd,MAAM,QAAQ,EAAE,OAAO,CAAC,EAAE;QAC1B,OAAO,OAAO,GAAG,MAAM,OAAO;QAC9B,OAAO,OAAO,GAAG,MAAM,OAAO;QAE9B,wCAAwC;QACxC,YAAY,OAAO,GAAG,MAAM,OAAO,IAAI;QACvC,aAAa,OAAO,GAAG;QAEvB,IAAI,YAAY,OAAO,EAAE;YACrB,SAAS;gBAAE,YAAY;gBAAM,YAAY;gBAAG,SAAS;YAAE;QAC3D;IACJ,GAAG;QAAC;QAAS;KAAU;IAEvB,MAAM,kBAAkB,IAAA,oNAAW,EAAC,CAAC;QACjC,IAAI,CAAC,WAAW,CAAC,YAAY,OAAO,IAAI,aAAa,OAAO,EAAE;QAE9D,MAAM,QAAQ,EAAE,OAAO,CAAC,EAAE;QAC1B,MAAM,SAAS,MAAM,OAAO,GAAG,OAAO,OAAO;QAC7C,MAAM,SAAS,KAAK,GAAG,CAAC,MAAM,OAAO,GAAG,OAAO,OAAO;QAEtD,gEAAgE;QAChE,IAAI,SAAS,MAAM,SAAS,IAAI;YAC5B,YAAY,OAAO,GAAG;YACtB,SAAS;gBAAE,YAAY;gBAAO,YAAY;gBAAG,SAAS;YAAE;YACxD;QACJ;QAEA,mDAAmD;QACnD,IAAI,SAAS,GAAG;YACZ,4CAA4C;YAC5C,MAAM,aAAa,KAAK,GAAG,CAAC,SAAS,KAAK,OAAO,UAAU;YAC3D,MAAM,UAAU,IAAI,AAAC,aAAa,OAAO,UAAU,GAAI;YAEvD,SAAS;gBAAE,YAAY;gBAAM;gBAAY;YAAQ;YAEjD,+BAA+B;YAC/B,EAAE,cAAc;QACpB;IACJ,GAAG;QAAC;KAAQ;IAEZ,MAAM,iBAAiB,IAAA,oNAAW,EAAC;QAC/B,IAAI,CAAC,WAAW,CAAC,YAAY,OAAO,IAAI,aAAa,OAAO,EAAE;YAC1D,SAAS;gBAAE,YAAY;gBAAO,YAAY;gBAAG,SAAS;YAAE;YACxD;QACJ;QAEA,MAAM,EAAE,UAAU,EAAE,GAAG;QAEvB,IAAI,cAAc,WAAW;YACzB,0BAA0B;YAC1B,aAAa,OAAO,GAAG;YACvB,SAAS;gBAAE,YAAY;gBAAO,YAAY,OAAO,UAAU;gBAAE,SAAS;YAAE;YAExE,oCAAoC;YACpC,WAAW;gBACP;gBACA,SAAS;oBAAE,YAAY;oBAAO,YAAY;oBAAG,SAAS;gBAAE;YAC5D,GAAG;QACP,OAAO;YACH,mCAAmC;YACnC,SAAS;gBAAE,YAAY;gBAAO,YAAY;gBAAG,SAAS;YAAE;QAC5D;QAEA,YAAY,OAAO,GAAG;IAC1B,GAAG;QAAC;QAAS;QAAO;QAAW;KAAY;IAE3C,MAAM,gBAAgB;QAClB,cAAc;QACd,aAAa;QACb,YAAY;IAChB;IAEA,MAAM,aAAa;QACf,WAAW,CAAC,WAAW,EAAE,MAAM,UAAU,CAAC,GAAG,CAAC;QAC9C,YAAY,MAAM,UAAU,GAAG,SAAS;QACxC,SAAS,MAAM,OAAO;IAC1B;IAEA,OAAO;QACH;QACA;QACA,YAAY,MAAM,UAAU;QAC5B,YAAY,MAAM,UAAU;IAChC;AACJ"}},
    {"offset": {"line": 2639, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/components/ChatInterface.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport { io, Socket } from 'socket.io-client';\nimport { User, Message, Tenant } from '@/types';\nimport { API_BASE_URL } from '@/config';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { sqliteService } from '@/lib/sqlite';\nimport { Keyboard, KeyboardResize } from '@capacitor/keyboard';\nimport { Haptics, ImpactStyle } from '@capacitor/haptics';\nimport { StatusBar, Style } from '@capacitor/status-bar';\nimport { Capacitor } from '@capacitor/core';\n\n// UI Components\nimport Login from './Login';\nimport GlobalChat from './GlobalChat';\nimport BottomNav from './BottomNav';\nimport UserList from './UserList';\nimport ChatList from './ChatList';\nimport Settings from './Settings';\nimport { useSwipeBack } from '@/hooks/useSwipeBack';\nimport { useSession, signOut } from '@/lib/auth-client';\n\ninterface ChatInterfaceProps {\n    tenant: Tenant;\n    initialMessages: Message[];\n}\n\ntype Tab = 'room' | 'users' | 'chats' | 'settings';\ntype PrivateChatsMap = Record<string, { peer: User; messages: Message[]; unread: number }>;\n\nexport default function ChatInterface({ tenant, initialMessages }: ChatInterfaceProps) {\n    const [currentUser, setCurrentUser] = useState<User | null>(null);\n    const [socket, setSocket] = useState<Socket | null>(null);\n    const { data: session, isPending: isSessionLoading } = useSession();\n\n    // UI State\n    const [activeTab, setActiveTab] = useState<Tab>('room');\n    const [selectedChatPeerId, setSelectedChatPeerId] = useState<string | null>(null);\n    const [isInputFocused, setIsInputFocused] = useState(false);\n\n    // Data State\n    const [onlineUsers, setOnlineUsers] = useState<(User & { socketId: string })[]>([]);\n    const [privateChats, setPrivateChats] = useState<PrivateChatsMap>({});\n    const [isConnected, setIsConnected] = useState(false);\n\n\n    const queryClient = useQueryClient();\n\n    // 1. Initial Data Fetching (Offline-First)\n    const { data: messages = initialMessages, isFetching: isFetchingGlobal } = useQuery({\n        queryKey: ['messages', 'global', tenant.slug],\n        queryFn: async () => {\n            // First load from SQLite\n            const localMessages = await sqliteService.getMessages(true);\n\n            // In a real app, you'd fetch from API here and update SQLite\n            // For now, we simulate API fetch by returning initialMessages if SQLite is empty\n            // or just returning what we have.\n\n            // Simulate background sync from server\n            try {\n                const response = await fetch(`${API_BASE_URL}/api/messages?tenant=${tenant.slug}`);\n                if (response.ok) {\n                    const serverMessages: Message[] = await response.json();\n                    for (const msg of serverMessages) {\n                        await sqliteService.saveMessage(msg, true);\n                    }\n                    return serverMessages;\n                }\n            } catch (e) {\n                console.warn(\"Failed to fetch from server, using local data\", e);\n            }\n\n            return localMessages.length > 0 ? localMessages : initialMessages;\n        },\n        initialData: initialMessages,\n    });\n\n    // 2. Initialize User, Keyboard and Haptics\n    useEffect(() => {\n        console.log(`[Session] Loading: ${isSessionLoading}, User: ${session?.user?.id}, Name: ${session?.user?.name}`);\n\n        if (!isSessionLoading && session?.user) {\n            // If we are in the middle of passkey registration, don't set currentUser yet\n            const isWaiting = localStorage.getItem('waiting_for_passkey') === 'true';\n            console.log(`[Session] Waiting for passkey: ${isWaiting}`);\n\n            if (isWaiting) {\n                return;\n            }\n\n            const authUser: User = {\n                id: session.user.id,\n                alias: session.user.name || \"User\",\n                gender: (session.user as any).gender || \"other\",\n                status: (session.user as any).status || \"\",\n                phoneNumber: (session.user as any).phoneNumber,\n                joinedAt: new Date(session.user.createdAt).getTime()\n            };\n            console.log(\"[Session] Setting authenticated user:\", authUser);\n            setCurrentUser(authUser);\n            localStorage.setItem('chat_user', JSON.stringify(authUser));\n        }\n    }, [session, isSessionLoading]);\n\n    useEffect(() => {\n        if (typeof window !== 'undefined') {\n            const savedUser = localStorage.getItem('chat_user');\n            const isWaiting = localStorage.getItem('waiting_for_passkey') === 'true';\n\n            if (savedUser && !session && !isSessionLoading && !isWaiting) {\n                try {\n                    const user = JSON.parse(savedUser);\n                    setCurrentUser(user);\n\n                    // Restore private chats from SQLite (native only)\n                    if (Capacitor.isNativePlatform()) {\n                        sqliteService.getPrivateChats(user.id).then(chats => {\n                            if (chats.length > 0) {\n                                const restoredChats: PrivateChatsMap = {};\n                                for (const chat of chats) {\n                                    const lastMsg = chat.messages[chat.messages.length - 1];\n                                    restoredChats[chat.peerId] = {\n                                        peer: {\n                                            id: chat.peerId,\n                                            alias: lastMsg.senderId === user.id ? 'Chat' : lastMsg.senderAlias,\n                                            gender: lastMsg.senderId === user.id ? 'other' : lastMsg.senderGender,\n                                            joinedAt: Date.now()\n                                        },\n                                        messages: chat.messages,\n                                        unread: 0\n                                    };\n                                }\n                                setPrivateChats(restoredChats);\n                                console.log(`Restored ${chats.length} private chats from SQLite`);\n                            }\n                        }).catch(err => console.error('Error restoring private chats:', err));\n                    }\n                } catch (e) {\n                    console.error(\"Invalid saved user\", e);\n                }\n            }\n\n            // Add platform class to body for targeted CSS\n            const platform = Capacitor.getPlatform();\n            document.documentElement.classList.add(`platform-${platform}`);\n\n            // Keyboard Configuration & Listeners\n            if (Capacitor.isNativePlatform()) {\n                // Use Body resize with zero-delay native patch\n                Keyboard.setResizeMode({ mode: KeyboardResize.Body }).catch(err => {\n                    console.error(\"Error setting keyboard resize mode\", err);\n                });\n\n                // StatusBar Configuration (Programmatic fix for white header standardization)\n                StatusBar.setOverlaysWebView({ overlay: false }).catch(err => {\n                    console.error(\"Error setting StatusBar overlay\", err);\n                });\n                StatusBar.setBackgroundColor({ color: '#ffffff' }).catch(err => {\n                    console.warn(\"StatusBar background color not supported on this platform\", err);\n                });\n                StatusBar.setStyle({ style: Style.Light }).catch(err => {\n                    console.error(\"Error setting StatusBar style\", err);\n                });\n\n                let showListener: any;\n                let hideListener: any;\n\n                const setup = async () => {\n                    showListener = await Keyboard.addListener('keyboardWillShow', () => {\n                        setIsInputFocused(true);\n                    });\n\n                    hideListener = await Keyboard.addListener('keyboardWillHide', () => {\n                        setIsInputFocused(false);\n                    });\n                };\n\n                setup();\n\n                return () => {\n                    if (showListener) showListener.remove();\n                    if (hideListener) hideListener.remove();\n                };\n            }\n        }\n    }, [tenant.slug]);\n\n    // 3. Connect Socket & Handlers\n    useEffect(() => {\n        if (!currentUser) return;\n\n        const newSocket = io(API_BASE_URL || undefined, {\n            query: {\n                tenantSlug: tenant.slug,\n                userId: currentUser.id\n            },\n            transports: ['websocket'],\n            reconnectionAttempts: 5,\n            timeout: 10000\n        });\n\n        setSocket(newSocket);\n\n        newSocket.on('connect_error', (err) => {\n            console.error(\"[Socket] Connect Error:\", err.message, err);\n        });\n\n        newSocket.on('error', (err) => {\n            console.error(\"[Socket] General Error:\", err);\n        });\n\n        newSocket.on('connect', () => {\n            console.log(\"Socket connected\");\n            setIsConnected(true);\n            newSocket.emit('join', { user: currentUser, tenantSlug: tenant.slug });\n        });\n\n        newSocket.on('disconnect', () => {\n            setIsConnected(false);\n        });\n\n        newSocket.on('presenceUpdate', (users: (User & { socketId: string })[]) => {\n            setOnlineUsers(users);\n        });\n\n        newSocket.on('newMessage', async (msg: Message) => {\n            await sqliteService.saveMessage(msg, true);\n            queryClient.invalidateQueries({ queryKey: ['messages', 'global', tenant.slug] });\n        });\n\n        newSocket.on('privateMessage', async (msg: Message) => {\n            const isMe = msg.senderId === currentUser.id;\n            const peerId = isMe ? msg.recipientId! : msg.senderId;\n\n            await sqliteService.saveMessage(msg, false);\n\n            // Haptic feedback for incoming private messages\n            if (!isMe && Capacitor.isNativePlatform()) {\n                Haptics.impact({ style: ImpactStyle.Light }).catch(() => { });\n            }\n\n            setPrivateChats(prev => {\n                const existing = prev[peerId] || {\n                    peer: {\n                        id: peerId,\n                        alias: isMe ? 'Unknown' : msg.senderAlias,\n                        gender: isMe ? 'male' : msg.senderGender,\n                        joinedAt: Date.now()\n                    },\n                    messages: [],\n                    unread: 0\n                };\n\n                if (existing.messages.some(m => m.id === msg.id)) return prev;\n\n                return {\n                    ...prev,\n                    [peerId]: {\n                        ...existing,\n                        messages: [...existing.messages, msg],\n                        unread: existing.unread + 1\n                    }\n                };\n            });\n        });\n\n        return () => {\n            newSocket.disconnect();\n        }\n    }, [currentUser, tenant.slug, queryClient]);\n\n    // 3. Mark read when viewing chat\n    useEffect(() => {\n        if (activeTab === 'chats' && selectedChatPeerId && privateChats[selectedChatPeerId]?.unread > 0) {\n            setPrivateChats(prev => ({\n                ...prev,\n                [selectedChatPeerId]: {\n                    ...prev[selectedChatPeerId],\n                    unread: 0\n                }\n            }));\n        }\n    }, [activeTab, selectedChatPeerId, privateChats]);\n\n\n    // Handlers\n    const handleLogin = (user: User) => {\n        setCurrentUser(user);\n        localStorage.setItem('chat_user', JSON.stringify(user));\n    };\n\n    const handleLogout = async () => {\n        if (session) {\n            await signOut();\n        }\n        setCurrentUser(null);\n        setSocket(null);\n        localStorage.removeItem('chat_user');\n        setPrivateChats({});\n        sqliteService.clearMessages();\n        queryClient.setQueryData(['messages', 'global', tenant.slug], initialMessages);\n        setSelectedChatPeerId(null);\n        setActiveTab('room');\n    };\n\n    const handleUpdateAlias = (newAlias: string) => {\n        if (!currentUser || !socket) return;\n\n        const updatedUser = { ...currentUser, alias: newAlias };\n        setCurrentUser(updatedUser);\n        localStorage.setItem('chat_user', JSON.stringify(updatedUser));\n\n        // Notify server - assuming server handles 'updateAlias' event or just re-join\n        // For simplicity reusing join or we could implement updateAlias on server\n        socket.emit('join', { user: updatedUser, tenantSlug: tenant.slug });\n    };\n\n    const handleUpdateStatus = (newStatus: string) => {\n        if (!currentUser || !socket) return;\n\n        const updatedUser = { ...currentUser, status: newStatus };\n        setCurrentUser(updatedUser);\n        localStorage.setItem('chat_user', JSON.stringify(updatedUser));\n\n        // Notify server of status update\n        socket.emit('join', { user: updatedUser, tenantSlug: tenant.slug });\n    };\n\n    const handleGlobalSend = async (text: string) => {\n        if (!currentUser || !socket) return;\n\n        const tempId = Date.now().toString();\n        const optimisticMsg: Message = {\n            id: tempId,\n            text: text,\n            senderId: currentUser.id,\n            senderAlias: currentUser.alias,\n            senderGender: currentUser.gender,\n            timestamp: new Date().toISOString()\n        };\n\n        // Haptic feedback for local send\n        if (Capacitor.isNativePlatform()) {\n            Haptics.impact({ style: ImpactStyle.Light }).catch(() => { });\n        }\n\n        // Persist to local SQLite immediately\n        await sqliteService.saveMessage(optimisticMsg, true);\n\n        // Update TanStack Query cache optimistically\n        queryClient.setQueryData(['messages', 'global', tenant.slug], (prev: Message[] | undefined) => {\n            return [...(prev || []), optimisticMsg];\n        });\n\n        socket.emit('sendMessage', {\n            ...optimisticMsg,\n            tenantSlug: tenant.slug\n        });\n    };\n\n    const handlePrivateSend = async (text: string) => {\n        if (!currentUser || !socket || !selectedChatPeerId) return;\n\n        const msg: Message = {\n            id: Date.now().toString(),\n            text,\n            senderId: currentUser.id,\n            senderAlias: currentUser.alias,\n            senderGender: currentUser.gender,\n            timestamp: new Date().toISOString(),\n            recipientId: selectedChatPeerId\n        };\n\n        // Haptic feedback for local send\n        if (Capacitor.isNativePlatform()) {\n            Haptics.impact({ style: ImpactStyle.Light }).catch(() => { });\n        }\n\n        // Save to SQLite for offline persistence\n        await sqliteService.saveMessage(msg, false);\n\n        // Optimistic update\n        setPrivateChats(prev => ({\n            ...prev,\n            [selectedChatPeerId]: {\n                ...prev[selectedChatPeerId],\n                messages: [...prev[selectedChatPeerId].messages, msg]\n            }\n        }));\n\n        socket.emit('sendMessage', {\n            ...msg,\n            tenantSlug: tenant.slug,\n            isPrivate: true // Signal to server\n        });\n    }\n\n    const handleStartChat = (peer: User) => {\n        if (!privateChats[peer.id]) {\n            setPrivateChats(prev => ({\n                ...prev,\n                [peer.id]: { peer, messages: [], unread: 0 }\n            }));\n        }\n        setSelectedChatPeerId(peer.id);\n        setActiveTab('chats');\n    };\n\n    const handleDeleteChat = (peerId: string) => {\n        setPrivateChats(prev => {\n            const next = { ...prev };\n            delete next[peerId];\n            return next;\n        });\n        if (selectedChatPeerId === peerId) {\n            setSelectedChatPeerId(null);\n        }\n    };\n\n\n    // Swipe back gesture for private chat\n    const { swipeHandlers, swipeStyle, isDragging } = useSwipeBack({\n        onSwipeBack: () => setSelectedChatPeerId(null),\n        enabled: Capacitor.isNativePlatform() && selectedChatPeerId !== null\n    });\n\n    // Render Login\n    if (!currentUser) {\n        return (\n            <div className=\"h-full w-full flex items-center justify-center bg-white sm:bg-gray-50 flex-col\">\n                <Login onLogin={handleLogin} tenantName={tenant.name} />\n            </div>\n        );\n    }\n\n    // Render Private Chat View\n    if (selectedChatPeerId && activeTab === 'chats') {\n        const chat = privateChats[selectedChatPeerId];\n        // If chat was deleted but we are here, go back\n        if (!chat) {\n            setSelectedChatPeerId(null);\n            return null;\n        }\n\n        return (\n            <div\n                className=\"flex flex-col w-full h-full max-w-3xl mx-auto bg-white shadow-xl overflow-hidden relative\"\n                style={swipeStyle}\n                {...swipeHandlers}\n            >\n                {/* Shadow overlay when dragging */}\n                {isDragging && (\n                    <div\n                        className=\"absolute inset-y-0 -left-8 w-8 bg-gradient-to-r from-black/10 to-transparent z-50 pointer-events-none\"\n                    />\n                )}\n\n                <header className=\"bg-white border-b border-gray-100 pt-safe text-gray-800 z-10 sticky top-0\">\n                    <div className=\"h-[60px] px-4 flex items-center gap-3\">\n                        <button onClick={() => setSelectedChatPeerId(null)} className=\"p-2 -ml-2 rounded-full hover:bg-gray-100 text-gray-600\">\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\n                            </svg>\n                        </button>\n                        <div className=\"flex flex-col\">\n                            <h2 className=\"font-bold text-lg leading-tight\">{chat.peer.alias}</h2>\n                            {onlineUsers.some(u => u.id === selectedChatPeerId) && (\n                                <span className=\"text-xs text-emerald-500 font-medium\">Online</span>\n                            )}\n                        </div>\n                    </div>\n                </header>\n\n                <div className=\"flex-1 overflow-hidden relative\">\n                    <GlobalChat\n                        user={currentUser}\n                        messages={chat.messages}\n                        onSendMessage={handlePrivateSend}\n                        onlineCount={0}\n                        isOnline={true}\n                        hideHeader={true}\n                        showBottomNavPadding={false}\n                        onInputFocusChange={setIsInputFocused}\n                        isFocused={isInputFocused}\n                        isSyncing={false} // Private chat sync is separate\n                    />\n                </div>\n            </div>\n        );\n    }\n\n    const totalUnread = Object.values(privateChats).reduce((acc, chat) => acc + chat.unread, 0);\n\n    return (\n        <div\n            className=\"flex flex-col w-full h-full max-w-3xl mx-auto bg-white shadow-xl overflow-hidden relative\"\n        >\n            <div className=\"flex-1 overflow-hidden relative\">\n                {activeTab === 'room' && (\n                    <GlobalChat\n                        user={currentUser}\n                        messages={messages}\n                        onSendMessage={handleGlobalSend}\n                        onlineCount={onlineUsers.length}\n                        isOnline={isConnected}\n                        headerTitle={tenant.name}\n                        showBottomNavPadding={true}\n                        onInputFocusChange={setIsInputFocused}\n                        isFocused={isInputFocused}\n                        isSyncing={isFetchingGlobal}\n                    />\n                )}\n                {activeTab === 'users' && (\n                    <UserList\n                        currentUser={currentUser}\n                        users={onlineUsers}\n                        onStartChat={handleStartChat}\n                    />\n                )}\n                {activeTab === 'chats' && (\n                    <ChatList\n                        chats={Object.values(privateChats).map(c => ({ ...c, unreadCount: c.unread })).sort((a, b) => {\n                            const tA = a.messages.length ? new Date(a.messages[a.messages.length - 1].timestamp).getTime() : 0;\n                            const tB = b.messages.length ? new Date(b.messages[b.messages.length - 1].timestamp).getTime() : 0;\n                            return tB - tA;\n                        })}\n                        onSelectChat={setSelectedChatPeerId}\n                        onDeleteChat={handleDeleteChat}\n                    />\n                )}\n                {activeTab === 'settings' && (\n                    <Settings\n                        user={currentUser}\n                        onLogout={handleLogout}\n                        onUpdateAlias={handleUpdateAlias}\n                        onUpdateStatus={handleUpdateStatus}\n                    />\n                )}\n            </div>\n\n            {/* Bottom Navigation - Managed via React state for visibility */}\n            <div\n                className={`transition-all duration-300 ease-in-out border-t border-gray-100 bg-white z-20 overflow-hidden ${isInputFocused ? 'opacity-0 pointer-events-none h-0' : 'opacity-100 h-auto'\n                    }`}\n            >\n                <BottomNav\n                    activeTab={activeTab}\n                    onTabChange={(t) => {\n                        setActiveTab(t);\n                        setSelectedChatPeerId(null);\n                    }}\n                    usersCount={onlineUsers.length}\n                    unreadChatsCount={totalUnread}\n                />\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3248, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/services/apiService.ts"],"sourcesContent":["import { API_BASE_URL } from \"@/config\";\nimport { Message } from \"@/types\";\n\nexport const clientResolveTenant = async (urlNasId?: string, bssid?: string): Promise<string | null> => {\n    const params = new URLSearchParams();\n    if (bssid) params.append('bssid', bssid);\n    if (urlNasId) params.append('nas_id', urlNasId);\n\n    const query = params.toString() ? `?${params.toString()}` : '';\n    const res = await fetch(`${API_BASE_URL}/api/validate-nas${query}`);\n    if (!res.ok) return null;\n    const data = await res.json();\n    return data.valid ? data.tenantSlug : null;\n};\n\nexport const clientGetTenantBySlug = async (slug: string) => {\n    const res = await fetch(`${API_BASE_URL}/api/tenants/${slug}`);\n    if (!res.ok) return null;\n    return await res.json();\n};\n\nexport const clientGetMessages = async (tenantSlug: string): Promise<Message[]> => {\n    const res = await fetch(`${API_BASE_URL}/api/messages?tenant=${tenantSlug}`);\n    if (!res.ok) return [];\n    return await res.json();\n};\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAGO,MAAM,sBAAsB,OAAO,UAAmB;IACzD,MAAM,SAAS,IAAI;IACnB,IAAI,OAAO,OAAO,MAAM,CAAC,SAAS;IAClC,IAAI,UAAU,OAAO,MAAM,CAAC,UAAU;IAEtC,MAAM,QAAQ,OAAO,QAAQ,KAAK,CAAC,CAAC,EAAE,OAAO,QAAQ,IAAI,GAAG;IAC5D,MAAM,MAAM,MAAM,MAAM,GAAG,sHAAY,CAAC,iBAAiB,EAAE,OAAO;IAClE,IAAI,CAAC,IAAI,EAAE,EAAE,OAAO;IACpB,MAAM,OAAO,MAAM,IAAI,IAAI;IAC3B,OAAO,KAAK,KAAK,GAAG,KAAK,UAAU,GAAG;AAC1C;AAEO,MAAM,wBAAwB,OAAO;IACxC,MAAM,MAAM,MAAM,MAAM,GAAG,sHAAY,CAAC,aAAa,EAAE,MAAM;IAC7D,IAAI,CAAC,IAAI,EAAE,EAAE,OAAO;IACpB,OAAO,MAAM,IAAI,IAAI;AACzB;AAEO,MAAM,oBAAoB,OAAO;IACpC,MAAM,MAAM,MAAM,MAAM,GAAG,sHAAY,CAAC,qBAAqB,EAAE,YAAY;IAC3E,IAAI,CAAC,IAAI,EAAE,EAAE,OAAO,EAAE;IACtB,OAAO,MAAM,IAAI,IAAI;AACzB"}},
    {"offset": {"line": 3282, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivanmuccini/Desktop/chatapp/chat/app/%5BtenantSlug%5D/TenantChatClient.tsx"],"sourcesContent":["'use client';\n\nimport React, { useEffect, useState } from \"react\";\nimport { useParams, notFound } from \"next/navigation\";\nimport ChatInterface from \"@/components/ChatInterface\";\nimport { clientGetTenantBySlug, clientGetMessages } from \"@/services/apiService\";\nimport { Tenant, Message } from \"@/types\";\n\nexport default function TenantChatClient() {\n    const params = useParams();\n    const tenantSlug = params.tenantSlug as string;\n\n    const [tenant, setTenant] = useState<Tenant | null>(null);\n    const [initialMessages, setInitialMessages] = useState<Message[]>([]);\n    const [loading, setLoading] = useState(true);\n    const [error, setError] = useState(false);\n\n    useEffect(() => {\n        async function loadData() {\n            try {\n                const tenantData = await clientGetTenantBySlug(tenantSlug);\n                if (!tenantData) {\n                    setError(true);\n                    setLoading(false);\n                    return;\n                }\n                setTenant(tenantData);\n\n                const dbMessages = await clientGetMessages(tenantSlug);\n                const mappedMessages: Message[] = dbMessages.map((msg: any) => ({\n                    id: msg.id,\n                    text: msg.text,\n                    senderId: msg.senderId || msg.userId,\n                    senderAlias: msg.senderAlias || msg.user?.name || \"Anonymous\",\n                    senderGender: msg.senderGender || \"other\",\n                    timestamp: new Date(msg.timestamp || msg.createdAt).toISOString(),\n                }));\n                setInitialMessages(mappedMessages);\n                setLoading(false);\n            } catch (err) {\n                console.error(\"Error loading chat data\", err);\n                setError(true);\n                setLoading(false);\n            }\n        }\n        loadData();\n    }, [tenantSlug]);\n\n    if (loading) {\n        return (\n            <div className=\"h-screen w-full flex items-center justify-center bg-gray-50\">\n                <div className=\"animate-pulse text-gray-400 font-medium\">Caricamento chat...</div>\n            </div>\n        );\n    }\n\n    if (error || !tenant) {\n        notFound();\n    }\n\n    return (\n        <main className=\"flex h-full flex-col items-center justify-between\">\n            <ChatInterface\n                tenant={tenant}\n                initialMessages={initialMessages}\n            />\n        </main>\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AALA;;;;;;AAQe,SAAS;IACpB,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,aAAa,OAAO,UAAU;IAEpC,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,iNAAQ,EAAgB;IACpD,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,iNAAQ,EAAY,EAAE;IACpE,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAC;IAEnC,IAAA,kNAAS,EAAC;QACN,eAAe;YACX,IAAI;gBACA,MAAM,aAAa,MAAM,IAAA,+IAAqB,EAAC;gBAC/C,IAAI,CAAC,YAAY;oBACb,SAAS;oBACT,WAAW;oBACX;gBACJ;gBACA,UAAU;gBAEV,MAAM,aAAa,MAAM,IAAA,2IAAiB,EAAC;gBAC3C,MAAM,iBAA4B,WAAW,GAAG,CAAC,CAAC,MAAa,CAAC;wBAC5D,IAAI,IAAI,EAAE;wBACV,MAAM,IAAI,IAAI;wBACd,UAAU,IAAI,QAAQ,IAAI,IAAI,MAAM;wBACpC,aAAa,IAAI,WAAW,IAAI,IAAI,IAAI,EAAE,QAAQ;wBAClD,cAAc,IAAI,YAAY,IAAI;wBAClC,WAAW,IAAI,KAAK,IAAI,SAAS,IAAI,IAAI,SAAS,EAAE,WAAW;oBACnE,CAAC;gBACD,mBAAmB;gBACnB,WAAW;YACf,EAAE,OAAO,KAAK;gBACV,QAAQ,KAAK,CAAC,2BAA2B;gBACzC,SAAS;gBACT,WAAW;YACf;QACJ;QACA;IACJ,GAAG;QAAC;KAAW;IAEf,IAAI,SAAS;QACT,qBACI,8OAAC;YAAI,WAAU;sBACX,cAAA,8OAAC;gBAAI,WAAU;0BAA0C;;;;;;;;;;;IAGrE;IAEA,IAAI,SAAS,CAAC,QAAQ;QAClB,IAAA,8IAAQ;IACZ;IAEA,qBACI,8OAAC;QAAK,WAAU;kBACZ,cAAA,8OAAC,uIAAa;YACV,QAAQ;YACR,iBAAiB;;;;;;;;;;;AAIjC"}}]
}