module.exports = [
"[project]/node_modules/better-auth/dist/plugins/api-key/adapter.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "batchMigrateLegacyMetadata",
    ()=>batchMigrateLegacyMetadata,
    "deleteApiKey",
    ()=>deleteApiKey,
    "getApiKey",
    ()=>getApiKey,
    "getApiKeyById",
    ()=>getApiKeyById,
    "listApiKeys",
    ()=>listApiKeys,
    "migrateDoubleStringifiedMetadata",
    ()=>migrateDoubleStringifiedMetadata,
    "parseDoubleStringifiedMetadata",
    ()=>parseDoubleStringifiedMetadata,
    "setApiKey",
    ()=>setApiKey
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$json$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/json.mjs [app-route] (ecmascript)");
;
//#region src/plugins/api-key/adapter.ts
/**
* Parses double-stringified metadata synchronously without updating the database.
* Use this for reading metadata, then call migrateLegacyMetadataInBackground for DB updates.
*
* @returns The properly parsed metadata object, or the original if already an object
*/ function parseDoubleStringifiedMetadata(metadata) {
    if (metadata == null) return null;
    if (typeof metadata === "object") return metadata;
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$json$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["safeJSONParse"])(metadata);
}
/**
* Checks if metadata needs migration (is a string instead of object)
*/ function needsMetadataMigration(metadata) {
    return metadata != null && typeof metadata === "string";
}
/**
* Batch migrates double-stringified metadata for multiple API keys.
* Runs all updates in parallel to avoid N sequential database calls.
*/ async function batchMigrateLegacyMetadata(ctx, apiKeys, opts) {
    if (opts.storage !== "database" && !opts.fallbackToDatabase) return;
    const keysToMigrate = apiKeys.filter((key)=>needsMetadataMigration(key.metadata));
    if (keysToMigrate.length === 0) return;
    const migrationPromises = keysToMigrate.map(async (apiKey)=>{
        const parsed = parseDoubleStringifiedMetadata(apiKey.metadata);
        try {
            await ctx.context.adapter.update({
                model: "apikey",
                where: [
                    {
                        field: "id",
                        value: apiKey.id
                    }
                ],
                update: {
                    metadata: parsed
                }
            });
        } catch (error) {
            ctx.context.logger.warn(`Failed to migrate double-stringified metadata for API key ${apiKey.id}:`, error);
        }
    });
    await Promise.all(migrationPromises);
}
/**
* Migrates double-stringified metadata to properly parsed object.
*
* This handles legacy data where metadata was incorrectly double-stringified.
* If metadata is a string (should be object after adapter's transform.output),
* it parses it and optionally updates the database.
*
* @returns The properly parsed metadata object
*/ async function migrateDoubleStringifiedMetadata(ctx, apiKey, opts) {
    const parsed = parseDoubleStringifiedMetadata(apiKey.metadata);
    if (needsMetadataMigration(apiKey.metadata) && (opts.storage === "database" || opts.fallbackToDatabase)) try {
        await ctx.context.adapter.update({
            model: "apikey",
            where: [
                {
                    field: "id",
                    value: apiKey.id
                }
            ],
            update: {
                metadata: parsed
            }
        });
    } catch (error) {
        ctx.context.logger.warn(`Failed to migrate double-stringified metadata for API key ${apiKey.id}:`, error);
    }
    return parsed;
}
/**
* Generate storage key for API key by hashed key
*/ function getStorageKeyByHashedKey(hashedKey) {
    return `api-key:${hashedKey}`;
}
/**
* Generate storage key for API key by ID
*/ function getStorageKeyById(id) {
    return `api-key:by-id:${id}`;
}
/**
* Generate storage key for user's API key list
*/ function getStorageKeyByUserId(userId) {
    return `api-key:by-user:${userId}`;
}
/**
* Serialize API key for storage
*/ function serializeApiKey(apiKey) {
    return JSON.stringify({
        ...apiKey,
        createdAt: apiKey.createdAt.toISOString(),
        updatedAt: apiKey.updatedAt.toISOString(),
        expiresAt: apiKey.expiresAt?.toISOString() ?? null,
        lastRefillAt: apiKey.lastRefillAt?.toISOString() ?? null,
        lastRequest: apiKey.lastRequest?.toISOString() ?? null
    });
}
/**
* Deserialize API key from storage
*/ function deserializeApiKey(data) {
    if (!data || typeof data !== "string") return null;
    try {
        const parsed = JSON.parse(data);
        return {
            ...parsed,
            createdAt: new Date(parsed.createdAt),
            updatedAt: new Date(parsed.updatedAt),
            expiresAt: parsed.expiresAt ? new Date(parsed.expiresAt) : null,
            lastRefillAt: parsed.lastRefillAt ? new Date(parsed.lastRefillAt) : null,
            lastRequest: parsed.lastRequest ? new Date(parsed.lastRequest) : null
        };
    } catch  {
        return null;
    }
}
/**
* Get the storage instance to use (custom methods take precedence)
*/ function getStorageInstance(ctx, opts) {
    if (opts.customStorage) return opts.customStorage;
    return ctx.context.secondaryStorage || null;
}
/**
* Calculate TTL in seconds for an API key
*/ function calculateTTL(apiKey) {
    if (apiKey.expiresAt) {
        const now = Date.now();
        const expiresAt = new Date(apiKey.expiresAt).getTime();
        const ttlSeconds = Math.floor((expiresAt - now) / 1e3);
        if (ttlSeconds > 0) return ttlSeconds;
    }
}
/**
* Get API key from secondary storage by hashed key
*/ async function getApiKeyFromStorage(ctx, hashedKey, storage) {
    const key = getStorageKeyByHashedKey(hashedKey);
    return deserializeApiKey(await storage.get(key));
}
/**
* Get API key from secondary storage by ID
*/ async function getApiKeyByIdFromStorage(ctx, id, storage) {
    const key = getStorageKeyById(id);
    return deserializeApiKey(await storage.get(key));
}
/**
* Store API key in secondary storage
*/ async function setApiKeyInStorage(ctx, apiKey, storage, ttl) {
    const serialized = serializeApiKey(apiKey);
    const hashedKey = apiKey.key;
    const id = apiKey.id;
    await storage.set(getStorageKeyByHashedKey(hashedKey), serialized, ttl);
    await storage.set(getStorageKeyById(id), serialized, ttl);
    const userKey = getStorageKeyByUserId(apiKey.userId);
    const userListData = await storage.get(userKey);
    let userIds = [];
    if (userListData && typeof userListData === "string") try {
        userIds = JSON.parse(userListData);
    } catch  {
        userIds = [];
    }
    else if (Array.isArray(userListData)) userIds = userListData;
    if (!userIds.includes(id)) {
        userIds.push(id);
        await storage.set(userKey, JSON.stringify(userIds));
    }
}
/**
* Delete API key from secondary storage
*/ async function deleteApiKeyFromStorage(ctx, apiKey, storage) {
    const hashedKey = apiKey.key;
    const id = apiKey.id;
    const userId = apiKey.userId;
    await storage.delete(getStorageKeyByHashedKey(hashedKey));
    await storage.delete(getStorageKeyById(id));
    const userKey = getStorageKeyByUserId(userId);
    const userListData = await storage.get(userKey);
    let userIds = [];
    if (userListData && typeof userListData === "string") try {
        userIds = JSON.parse(userListData);
    } catch  {
        userIds = [];
    }
    else if (Array.isArray(userListData)) userIds = userListData;
    const filteredIds = userIds.filter((keyId)=>keyId !== id);
    if (filteredIds.length === 0) await storage.delete(userKey);
    else await storage.set(userKey, JSON.stringify(filteredIds));
}
/**
* Unified getter for API keys with support for all storage modes
*/ async function getApiKey(ctx, hashedKey, opts) {
    const storage = getStorageInstance(ctx, opts);
    if (opts.storage === "database") return await ctx.context.adapter.findOne({
        model: "apikey",
        where: [
            {
                field: "key",
                value: hashedKey
            }
        ]
    });
    if (opts.storage === "secondary-storage" && opts.fallbackToDatabase) {
        if (storage) {
            const cached = await getApiKeyFromStorage(ctx, hashedKey, storage);
            if (cached) return cached;
        }
        const dbKey = await ctx.context.adapter.findOne({
            model: "apikey",
            where: [
                {
                    field: "key",
                    value: hashedKey
                }
            ]
        });
        if (dbKey && storage) await setApiKeyInStorage(ctx, dbKey, storage, calculateTTL(dbKey));
        return dbKey;
    }
    if (opts.storage === "secondary-storage") {
        if (!storage) return null;
        return await getApiKeyFromStorage(ctx, hashedKey, storage);
    }
    return await ctx.context.adapter.findOne({
        model: "apikey",
        where: [
            {
                field: "key",
                value: hashedKey
            }
        ]
    });
}
/**
* Unified getter for API keys by ID
*/ async function getApiKeyById(ctx, id, opts) {
    const storage = getStorageInstance(ctx, opts);
    if (opts.storage === "database") return await ctx.context.adapter.findOne({
        model: "apikey",
        where: [
            {
                field: "id",
                value: id
            }
        ]
    });
    if (opts.storage === "secondary-storage" && opts.fallbackToDatabase) {
        if (storage) {
            const cached = await getApiKeyByIdFromStorage(ctx, id, storage);
            if (cached) return cached;
        }
        const dbKey = await ctx.context.adapter.findOne({
            model: "apikey",
            where: [
                {
                    field: "id",
                    value: id
                }
            ]
        });
        if (dbKey && storage) await setApiKeyInStorage(ctx, dbKey, storage, calculateTTL(dbKey));
        return dbKey;
    }
    if (opts.storage === "secondary-storage") {
        if (!storage) return null;
        return await getApiKeyByIdFromStorage(ctx, id, storage);
    }
    return await ctx.context.adapter.findOne({
        model: "apikey",
        where: [
            {
                field: "id",
                value: id
            }
        ]
    });
}
/**
* Unified setter for API keys with support for all storage modes
*/ async function setApiKey(ctx, apiKey, opts) {
    const storage = getStorageInstance(ctx, opts);
    const ttl = calculateTTL(apiKey);
    if (opts.storage === "database") return;
    if (opts.storage === "secondary-storage") {
        if (!storage) throw new Error("Secondary storage is required when storage mode is 'secondary-storage'");
        await setApiKeyInStorage(ctx, apiKey, storage, ttl);
        return;
    }
}
/**
* Unified deleter for API keys with support for all storage modes
*/ async function deleteApiKey(ctx, apiKey, opts) {
    const storage = getStorageInstance(ctx, opts);
    if (opts.storage === "database") return;
    if (opts.storage === "secondary-storage") {
        if (!storage) throw new Error("Secondary storage is required when storage mode is 'secondary-storage'");
        await deleteApiKeyFromStorage(ctx, apiKey, storage);
        return;
    }
}
/**
* List API keys for a user with support for all storage modes
*/ async function listApiKeys(ctx, userId, opts) {
    const storage = getStorageInstance(ctx, opts);
    if (opts.storage === "database") return await ctx.context.adapter.findMany({
        model: "apikey",
        where: [
            {
                field: "userId",
                value: userId
            }
        ]
    });
    if (opts.storage === "secondary-storage" && opts.fallbackToDatabase) {
        const userKey = getStorageKeyByUserId(userId);
        if (storage) {
            const userListData = await storage.get(userKey);
            let userIds = [];
            if (userListData && typeof userListData === "string") try {
                userIds = JSON.parse(userListData);
            } catch  {
                userIds = [];
            }
            else if (Array.isArray(userListData)) userIds = userListData;
            if (userIds.length > 0) {
                const apiKeys = [];
                for (const id of userIds){
                    const apiKey = await getApiKeyByIdFromStorage(ctx, id, storage);
                    if (apiKey) apiKeys.push(apiKey);
                }
                return apiKeys;
            }
        }
        const dbKeys = await ctx.context.adapter.findMany({
            model: "apikey",
            where: [
                {
                    field: "userId",
                    value: userId
                }
            ]
        });
        if (storage && dbKeys.length > 0) {
            const userIds = [];
            for (const apiKey of dbKeys){
                await setApiKeyInStorage(ctx, apiKey, storage, calculateTTL(apiKey));
                userIds.push(apiKey.id);
            }
            await storage.set(userKey, JSON.stringify(userIds));
        }
        return dbKeys;
    }
    if (opts.storage === "secondary-storage") {
        if (!storage) return [];
        const userKey = getStorageKeyByUserId(userId);
        const userListData = await storage.get(userKey);
        let userIds = [];
        if (userListData && typeof userListData === "string") try {
            userIds = JSON.parse(userListData);
        } catch  {
            return [];
        }
        else if (Array.isArray(userListData)) userIds = userListData;
        else return [];
        const apiKeys = [];
        for (const id of userIds){
            const apiKey = await getApiKeyByIdFromStorage(ctx, id, storage);
            if (apiKey) apiKeys.push(apiKey);
        }
        return apiKeys;
    }
    return await ctx.context.adapter.findMany({
        model: "apikey",
        where: [
            {
                field: "userId",
                value: userId
            }
        ]
    });
}
;
 //# sourceMappingURL=adapter.mjs.map
}),
"[project]/node_modules/better-auth/dist/plugins/api-key/rate-limit.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "isRateLimited",
    ()=>isRateLimited
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/api-key/index.mjs [app-route] (ecmascript)");
;
//#region src/plugins/api-key/rate-limit.ts
/**
* Determines if a request is allowed based on rate limiting parameters.
*
* @returns An object indicating whether the request is allowed and, if not,
*          a message and updated ApiKey data.
*/ function isRateLimited(apiKey, opts) {
    const now = /* @__PURE__ */ new Date();
    const lastRequest = apiKey.lastRequest;
    const rateLimitTimeWindow = apiKey.rateLimitTimeWindow;
    const rateLimitMax = apiKey.rateLimitMax;
    let requestCount = apiKey.requestCount;
    if (opts.rateLimit.enabled === false) return {
        success: true,
        message: null,
        update: {
            lastRequest: now
        },
        tryAgainIn: null
    };
    if (apiKey.rateLimitEnabled === false) return {
        success: true,
        message: null,
        update: {
            lastRequest: now
        },
        tryAgainIn: null
    };
    if (rateLimitTimeWindow === null || rateLimitMax === null) return {
        success: true,
        message: null,
        update: null,
        tryAgainIn: null
    };
    if (lastRequest === null) return {
        success: true,
        message: null,
        update: {
            lastRequest: now,
            requestCount: 1
        },
        tryAgainIn: null
    };
    const timeSinceLastRequest = now.getTime() - new Date(lastRequest).getTime();
    if (timeSinceLastRequest > rateLimitTimeWindow) return {
        success: true,
        message: null,
        update: {
            lastRequest: now,
            requestCount: 1
        },
        tryAgainIn: null
    };
    if (requestCount >= rateLimitMax) return {
        success: false,
        message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].RATE_LIMIT_EXCEEDED,
        update: null,
        tryAgainIn: Math.ceil(rateLimitTimeWindow - timeSinceLastRequest)
    };
    requestCount++;
    return {
        success: true,
        message: null,
        tryAgainIn: null,
        update: {
            lastRequest: now,
            requestCount
        }
    };
}
;
 //# sourceMappingURL=rate-limit.mjs.map
}),
"[project]/node_modules/better-auth/dist/plugins/api-key/routes/verify-api-key.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "validateApiKey",
    ()=>validateApiKey,
    "verifyApiKey",
    ()=>verifyApiKey
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/error.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$access$2f$access$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/access/access.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$access$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/access/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/api-key/adapter.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$rate$2d$limit$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/api-key/rate-limit.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/api-key/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$json$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/json.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
//#region src/plugins/api-key/routes/verify-api-key.ts
async function validateApiKey({ hashedKey, ctx, opts, schema, permissions }) {
    const apiKey = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getApiKey"])(ctx, hashedKey, opts);
    if (!apiKey) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
        message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].INVALID_API_KEY
    });
    if (apiKey.enabled === false) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
        message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].KEY_DISABLED,
        code: "KEY_DISABLED"
    });
    if (apiKey.expiresAt) {
        if (Date.now() > new Date(apiKey.expiresAt).getTime()) {
            const deleteExpiredKey = async ()=>{
                if (opts.storage === "secondary-storage" && opts.fallbackToDatabase) {
                    await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["deleteApiKey"])(ctx, apiKey, opts);
                    await ctx.context.adapter.delete({
                        model: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["API_KEY_TABLE_NAME"],
                        where: [
                            {
                                field: "id",
                                value: apiKey.id
                            }
                        ]
                    });
                } else if (opts.storage === "secondary-storage") await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["deleteApiKey"])(ctx, apiKey, opts);
                else await ctx.context.adapter.delete({
                    model: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["API_KEY_TABLE_NAME"],
                    where: [
                        {
                            field: "id",
                            value: apiKey.id
                        }
                    ]
                });
            };
            if (opts.deferUpdates) ctx.context.runInBackground(deleteExpiredKey().catch((error)=>{
                ctx.context.logger.error("Deferred update failed:", error);
            }));
            else await deleteExpiredKey();
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].KEY_EXPIRED,
                code: "KEY_EXPIRED"
            });
        }
    }
    if (permissions) {
        const apiKeyPermissions = apiKey.permissions ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$json$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["safeJSONParse"])(apiKey.permissions) : null;
        if (!apiKeyPermissions) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].KEY_NOT_FOUND,
            code: "KEY_NOT_FOUND"
        });
        if (!(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$access$2f$access$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["role"])(apiKeyPermissions).authorize(permissions).success) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].KEY_NOT_FOUND,
            code: "KEY_NOT_FOUND"
        });
    }
    let remaining = apiKey.remaining;
    let lastRefillAt = apiKey.lastRefillAt;
    if (apiKey.remaining === 0 && apiKey.refillAmount === null) {
        const deleteExhaustedKey = async ()=>{
            if (opts.storage === "secondary-storage" && opts.fallbackToDatabase) {
                await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["deleteApiKey"])(ctx, apiKey, opts);
                await ctx.context.adapter.delete({
                    model: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["API_KEY_TABLE_NAME"],
                    where: [
                        {
                            field: "id",
                            value: apiKey.id
                        }
                    ]
                });
            } else if (opts.storage === "secondary-storage") await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["deleteApiKey"])(ctx, apiKey, opts);
            else await ctx.context.adapter.delete({
                model: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["API_KEY_TABLE_NAME"],
                where: [
                    {
                        field: "id",
                        value: apiKey.id
                    }
                ]
            });
        };
        if (opts.deferUpdates) ctx.context.runInBackground(deleteExhaustedKey().catch((error)=>{
            ctx.context.logger.error("Deferred update failed:", error);
        }));
        else await deleteExhaustedKey();
        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("TOO_MANY_REQUESTS", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].USAGE_EXCEEDED,
            code: "USAGE_EXCEEDED"
        });
    } else if (remaining !== null) {
        const now = Date.now();
        const refillInterval = apiKey.refillInterval;
        const refillAmount = apiKey.refillAmount;
        const lastTime = new Date(lastRefillAt ?? apiKey.createdAt).getTime();
        if (refillInterval && refillAmount) {
            if (now - lastTime > refillInterval) {
                remaining = refillAmount;
                lastRefillAt = /* @__PURE__ */ new Date();
            }
        }
        if (remaining === 0) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("TOO_MANY_REQUESTS", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].USAGE_EXCEEDED,
            code: "USAGE_EXCEEDED"
        });
        else remaining--;
    }
    const { message, success, update, tryAgainIn } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$rate$2d$limit$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["isRateLimited"])(apiKey, opts);
    if (success === false) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
        message: message ?? void 0,
        code: "RATE_LIMITED",
        details: {
            tryAgainIn
        }
    });
    const updated = {
        ...apiKey,
        ...update,
        remaining,
        lastRefillAt,
        updatedAt: /* @__PURE__ */ new Date()
    };
    const performUpdate = async ()=>{
        if (opts.storage === "database") return ctx.context.adapter.update({
            model: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["API_KEY_TABLE_NAME"],
            where: [
                {
                    field: "id",
                    value: apiKey.id
                }
            ],
            update: {
                ...updated,
                id: void 0
            }
        });
        else if (opts.storage === "secondary-storage" && opts.fallbackToDatabase) {
            const dbUpdated = await ctx.context.adapter.update({
                model: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["API_KEY_TABLE_NAME"],
                where: [
                    {
                        field: "id",
                        value: apiKey.id
                    }
                ],
                update: {
                    ...updated,
                    id: void 0
                }
            });
            if (dbUpdated) await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["setApiKey"])(ctx, dbUpdated, opts);
            return dbUpdated;
        } else {
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["setApiKey"])(ctx, updated, opts);
            return updated;
        }
    };
    let newApiKey = null;
    if (opts.deferUpdates) {
        ctx.context.runInBackground(performUpdate().catch((error)=>{
            ctx.context.logger.error("Failed to update API key:", error);
        }));
        newApiKey = updated;
    } else {
        newApiKey = await performUpdate();
        if (!newApiKey) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].FAILED_TO_UPDATE_API_KEY,
            code: "INTERNAL_SERVER_ERROR"
        });
    }
    return newApiKey;
}
const verifyApiKeyBodySchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    key: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The key to verify"
    }),
    permissions: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["record"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["array"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]())).meta({
        description: "The permissions to verify."
    }).optional()
});
function verifyApiKey({ opts, schema, deleteAllExpiredApiKeys }) {
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])({
        method: "POST",
        body: verifyApiKeyBodySchema
    }, async (ctx)=>{
        const { key } = ctx.body;
        if (opts.customAPIKeyValidator) {
            if (!await opts.customAPIKeyValidator({
                ctx,
                key
            })) return ctx.json({
                valid: false,
                error: {
                    message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].INVALID_API_KEY,
                    code: "KEY_NOT_FOUND"
                },
                key: null
            });
        }
        const hashed = opts.disableKeyHashing ? key : await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["defaultKeyHasher"])(key);
        let apiKey = null;
        try {
            apiKey = await validateApiKey({
                hashedKey: hashed,
                permissions: ctx.body.permissions,
                ctx,
                opts,
                schema
            });
            if (opts.deferUpdates) ctx.context.runInBackground(deleteAllExpiredApiKeys(ctx.context).catch((err)=>{
                ctx.context.logger.error("Failed to delete expired API keys:", err);
            }));
        } catch (error) {
            ctx.context.logger.error("Failed to validate API key:", error);
            if (error instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]) return ctx.json({
                valid: false,
                error: {
                    message: error.body?.message,
                    code: error.body?.code
                },
                key: null
            });
            return ctx.json({
                valid: false,
                error: {
                    message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].INVALID_API_KEY,
                    code: "INVALID_API_KEY"
                },
                key: null
            });
        }
        const { key: _, ...returningApiKey } = apiKey ?? {
            key: 1,
            permissions: void 0
        };
        let migratedMetadata = null;
        if (apiKey) migratedMetadata = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["migrateDoubleStringifiedMetadata"])(ctx, apiKey, opts);
        returningApiKey.permissions = returningApiKey.permissions ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$json$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["safeJSONParse"])(returningApiKey.permissions) : null;
        return ctx.json({
            valid: true,
            error: null,
            key: apiKey === null ? null : {
                ...returningApiKey,
                metadata: migratedMetadata
            }
        });
    });
}
;
 //# sourceMappingURL=verify-api-key.mjs.map
}),
"[project]/node_modules/better-auth/dist/plugins/api-key/routes/create-api-key.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "createApiKey",
    ()=>createApiKey
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2f$date$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/utils/date.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$routes$2f$session$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api/routes/session.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/utils/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$id$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/id.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/error.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/api-key/adapter.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/api-key/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$json$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/json.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/external.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
//#region src/plugins/api-key/routes/create-api-key.ts
const createApiKeyBodySchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    name: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "Name of the Api Key"
    }).optional(),
    expiresIn: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["number"]().meta({
        description: "Expiration time of the Api Key in seconds"
    }).min(1).optional().nullable().default(null),
    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["coerce"].string().meta({
        description: "User Id of the user that the Api Key belongs to. server-only. Eg: \"user-id\""
    }).optional(),
    prefix: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "Prefix of the Api Key"
    }).regex(/^[a-zA-Z0-9_-]+$/, {
        message: "Invalid prefix format, must be alphanumeric and contain only underscores and hyphens."
    }).optional(),
    remaining: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["number"]().meta({
        description: "Remaining number of requests. Server side only"
    }).min(0).optional().nullable().default(null),
    metadata: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["any"]().optional(),
    refillAmount: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["number"]().meta({
        description: "Amount to refill the remaining count of the Api Key. server-only. Eg: 100"
    }).min(1).optional(),
    refillInterval: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["number"]().meta({
        description: "Interval to refill the Api Key in milliseconds. server-only. Eg: 1000"
    }).optional(),
    rateLimitTimeWindow: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["number"]().meta({
        description: "The duration in milliseconds where each request is counted. Once the `maxRequests` is reached, the request will be rejected until the `timeWindow` has passed, at which point the `timeWindow` will be reset. server-only. Eg: 1000"
    }).optional(),
    rateLimitMax: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["number"]().meta({
        description: "Maximum amount of requests allowed within a window. Once the `maxRequests` is reached, the request will be rejected until the `timeWindow` has passed, at which point the `timeWindow` will be reset. server-only. Eg: 100"
    }).optional(),
    rateLimitEnabled: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["boolean"]().meta({
        description: "Whether the key has rate limiting enabled. server-only. Eg: true"
    }).optional(),
    permissions: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["record"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["array"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]())).meta({
        description: "Permissions of the Api Key."
    }).optional()
});
function createApiKey({ keyGenerator, opts, schema, deleteAllExpiredApiKeys }) {
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/api-key/create", {
        method: "POST",
        body: createApiKeyBodySchema,
        metadata: {
            openapi: {
                description: "Create a new API key for a user",
                responses: {
                    "200": {
                        description: "API key created successfully",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    properties: {
                                        id: {
                                            type: "string",
                                            description: "Unique identifier of the API key"
                                        },
                                        createdAt: {
                                            type: "string",
                                            format: "date-time",
                                            description: "Creation timestamp"
                                        },
                                        updatedAt: {
                                            type: "string",
                                            format: "date-time",
                                            description: "Last update timestamp"
                                        },
                                        name: {
                                            type: "string",
                                            nullable: true,
                                            description: "Name of the API key"
                                        },
                                        prefix: {
                                            type: "string",
                                            nullable: true,
                                            description: "Prefix of the API key"
                                        },
                                        start: {
                                            type: "string",
                                            nullable: true,
                                            description: "Starting characters of the key (if configured)"
                                        },
                                        key: {
                                            type: "string",
                                            description: "The full API key (only returned on creation)"
                                        },
                                        enabled: {
                                            type: "boolean",
                                            description: "Whether the key is enabled"
                                        },
                                        expiresAt: {
                                            type: "string",
                                            format: "date-time",
                                            nullable: true,
                                            description: "Expiration timestamp"
                                        },
                                        userId: {
                                            type: "string",
                                            description: "ID of the user owning the key"
                                        },
                                        lastRefillAt: {
                                            type: "string",
                                            format: "date-time",
                                            nullable: true,
                                            description: "Last refill timestamp"
                                        },
                                        lastRequest: {
                                            type: "string",
                                            format: "date-time",
                                            nullable: true,
                                            description: "Last request timestamp"
                                        },
                                        metadata: {
                                            type: "object",
                                            nullable: true,
                                            additionalProperties: true,
                                            description: "Metadata associated with the key"
                                        },
                                        rateLimitMax: {
                                            type: "number",
                                            nullable: true,
                                            description: "Maximum requests in time window"
                                        },
                                        rateLimitTimeWindow: {
                                            type: "number",
                                            nullable: true,
                                            description: "Rate limit time window in milliseconds"
                                        },
                                        remaining: {
                                            type: "number",
                                            nullable: true,
                                            description: "Remaining requests"
                                        },
                                        refillAmount: {
                                            type: "number",
                                            nullable: true,
                                            description: "Amount to refill"
                                        },
                                        refillInterval: {
                                            type: "number",
                                            nullable: true,
                                            description: "Refill interval in milliseconds"
                                        },
                                        rateLimitEnabled: {
                                            type: "boolean",
                                            description: "Whether rate limiting is enabled"
                                        },
                                        requestCount: {
                                            type: "number",
                                            description: "Current request count in window"
                                        },
                                        permissions: {
                                            type: "object",
                                            nullable: true,
                                            additionalProperties: {
                                                type: "array",
                                                items: {
                                                    type: "string"
                                                }
                                            },
                                            description: "Permissions associated with the key"
                                        }
                                    },
                                    required: [
                                        "id",
                                        "createdAt",
                                        "updatedAt",
                                        "key",
                                        "enabled",
                                        "userId",
                                        "rateLimitEnabled",
                                        "requestCount"
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (ctx)=>{
        const { name, expiresIn, prefix, remaining, metadata, refillAmount, refillInterval, permissions, rateLimitMax, rateLimitTimeWindow, rateLimitEnabled } = ctx.body;
        const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$routes$2f$session$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getSessionFromCtx"])(ctx);
        const authRequired = ctx.request || ctx.headers;
        const user = authRequired && !session ? null : session?.user || {
            id: ctx.body.userId
        };
        if (!user?.id) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].UNAUTHORIZED_SESSION
        });
        if (session && ctx.body.userId && session?.user.id !== ctx.body.userId) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].UNAUTHORIZED_SESSION
        });
        if (authRequired) {
            if (refillAmount !== void 0 || refillInterval !== void 0 || rateLimitMax !== void 0 || rateLimitTimeWindow !== void 0 || rateLimitEnabled !== void 0 || permissions !== void 0 || remaining !== null) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].SERVER_ONLY_PROPERTY
            });
        }
        if (metadata) {
            if (opts.enableMetadata === false) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].METADATA_DISABLED
            });
            if (typeof metadata !== "object") throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].INVALID_METADATA_TYPE
            });
        }
        if (refillAmount && !refillInterval) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].REFILL_AMOUNT_AND_INTERVAL_REQUIRED
        });
        if (refillInterval && !refillAmount) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].REFILL_INTERVAL_AND_AMOUNT_REQUIRED
        });
        if (expiresIn) {
            if (opts.keyExpiration.disableCustomExpiresTime === true) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].KEY_DISABLED_EXPIRATION
            });
            const expiresIn_in_days = expiresIn / (3600 * 24);
            if (opts.keyExpiration.minExpiresIn > expiresIn_in_days) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].EXPIRES_IN_IS_TOO_SMALL
            });
            else if (opts.keyExpiration.maxExpiresIn < expiresIn_in_days) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].EXPIRES_IN_IS_TOO_LARGE
            });
        }
        if (prefix) {
            if (prefix.length < opts.minimumPrefixLength) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].INVALID_PREFIX_LENGTH
            });
            if (prefix.length > opts.maximumPrefixLength) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].INVALID_PREFIX_LENGTH
            });
        }
        if (name) {
            if (name.length < opts.minimumNameLength) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].INVALID_NAME_LENGTH
            });
            if (name.length > opts.maximumNameLength) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].INVALID_NAME_LENGTH
            });
        } else if (opts.requireName) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].NAME_REQUIRED
        });
        deleteAllExpiredApiKeys(ctx.context);
        const key = await keyGenerator({
            length: opts.defaultKeyLength,
            prefix: prefix || opts.defaultPrefix
        });
        const hashed = opts.disableKeyHashing ? key : await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["defaultKeyHasher"])(key);
        let start = null;
        if (opts.startingCharactersConfig.shouldStore) start = key.substring(0, opts.startingCharactersConfig.charactersLength);
        const defaultPermissions = opts.permissions?.defaultPermissions ? typeof opts.permissions.defaultPermissions === "function" ? await opts.permissions.defaultPermissions(user.id, ctx) : opts.permissions.defaultPermissions : void 0;
        const permissionsToApply = permissions ? JSON.stringify(permissions) : defaultPermissions ? JSON.stringify(defaultPermissions) : void 0;
        const data = {
            createdAt: /* @__PURE__ */ new Date(),
            updatedAt: /* @__PURE__ */ new Date(),
            name: name ?? null,
            prefix: prefix ?? opts.defaultPrefix ?? null,
            start,
            key: hashed,
            enabled: true,
            expiresAt: expiresIn ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2f$date$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDate"])(expiresIn, "sec") : opts.keyExpiration.defaultExpiresIn ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2f$date$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDate"])(opts.keyExpiration.defaultExpiresIn, "sec") : null,
            userId: user.id,
            lastRefillAt: null,
            lastRequest: null,
            metadata: null,
            rateLimitMax: rateLimitMax ?? opts.rateLimit.maxRequests ?? null,
            rateLimitTimeWindow: rateLimitTimeWindow ?? opts.rateLimit.timeWindow ?? null,
            remaining: remaining === null ? remaining : remaining ?? refillAmount ?? null,
            refillAmount: refillAmount ?? null,
            refillInterval: refillInterval ?? null,
            rateLimitEnabled: rateLimitEnabled === void 0 ? opts.rateLimit.enabled ?? true : rateLimitEnabled,
            requestCount: 0,
            permissions: permissionsToApply
        };
        if (metadata) data.metadata = metadata;
        let apiKey;
        if (opts.storage === "secondary-storage" && opts.fallbackToDatabase) {
            apiKey = await ctx.context.adapter.create({
                model: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["API_KEY_TABLE_NAME"],
                data
            });
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["setApiKey"])(ctx, apiKey, opts);
        } else if (opts.storage === "secondary-storage") {
            const id = ctx.context.generateId({
                model: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["API_KEY_TABLE_NAME"]
            }) || (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$id$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["generateId"])();
            apiKey = {
                ...data,
                id
            };
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["setApiKey"])(ctx, apiKey, opts);
        } else apiKey = await ctx.context.adapter.create({
            model: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["API_KEY_TABLE_NAME"],
            data
        });
        return ctx.json({
            ...apiKey,
            key,
            metadata: metadata ?? null,
            permissions: apiKey.permissions ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$json$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["safeJSONParse"])(apiKey.permissions) : null
        });
    });
}
;
 //# sourceMappingURL=create-api-key.mjs.map
}),
"[project]/node_modules/better-auth/dist/plugins/api-key/routes/delete-all-expired-api-keys.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "deleteAllExpiredApiKeysEndpoint",
    ()=>deleteAllExpiredApiKeysEndpoint
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
;
//#region src/plugins/api-key/routes/delete-all-expired-api-keys.ts
function deleteAllExpiredApiKeysEndpoint({ deleteAllExpiredApiKeys }) {
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])({
        method: "POST"
    }, async (ctx)=>{
        try {
            await deleteAllExpiredApiKeys(ctx.context, true);
        } catch (error) {
            ctx.context.logger.error("[API KEY PLUGIN] Failed to delete expired API keys:", error);
            return ctx.json({
                success: false,
                error
            });
        }
        return ctx.json({
            success: true,
            error: null
        });
    });
}
;
 //# sourceMappingURL=delete-all-expired-api-keys.mjs.map
}),
"[project]/node_modules/better-auth/dist/plugins/api-key/routes/delete-api-key.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "deleteApiKey",
    ()=>deleteApiKey$1
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$routes$2f$session$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api/routes/session.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/error.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/api-key/adapter.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/api-key/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
//#region src/plugins/api-key/routes/delete-api-key.ts
const deleteApiKeyBodySchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    keyId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The id of the Api Key"
    })
});
function deleteApiKey$1({ opts, schema, deleteAllExpiredApiKeys }) {
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/api-key/delete", {
        method: "POST",
        body: deleteApiKeyBodySchema,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$routes$2f$session$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sessionMiddleware"]
        ],
        metadata: {
            openapi: {
                description: "Delete an existing API key",
                requestBody: {
                    content: {
                        "application/json": {
                            schema: {
                                type: "object",
                                properties: {
                                    keyId: {
                                        type: "string",
                                        description: "The id of the API key to delete"
                                    }
                                },
                                required: [
                                    "keyId"
                                ]
                            }
                        }
                    }
                },
                responses: {
                    "200": {
                        description: "API key deleted successfully",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    properties: {
                                        success: {
                                            type: "boolean",
                                            description: "Indicates if the API key was successfully deleted"
                                        }
                                    },
                                    required: [
                                        "success"
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (ctx)=>{
        const { keyId } = ctx.body;
        const session = ctx.context.session;
        if (session.user.banned === true) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].USER_BANNED
        });
        let apiKey = null;
        apiKey = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getApiKeyById"])(ctx, keyId, opts);
        if (!apiKey || apiKey.userId !== session.user.id) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("NOT_FOUND", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].KEY_NOT_FOUND
        });
        try {
            if (opts.storage === "secondary-storage" && opts.fallbackToDatabase) {
                await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["deleteApiKey"])(ctx, apiKey, opts);
                await ctx.context.adapter.delete({
                    model: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["API_KEY_TABLE_NAME"],
                    where: [
                        {
                            field: "id",
                            value: apiKey.id
                        }
                    ]
                });
            } else if (opts.storage === "database") await ctx.context.adapter.delete({
                model: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["API_KEY_TABLE_NAME"],
                where: [
                    {
                        field: "id",
                        value: apiKey.id
                    }
                ]
            });
            else await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["deleteApiKey"])(ctx, apiKey, opts);
        } catch (error) {
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
                message: error?.message
            });
        }
        deleteAllExpiredApiKeys(ctx.context);
        return ctx.json({
            success: true
        });
    });
}
;
 //# sourceMappingURL=delete-api-key.mjs.map
}),
"[project]/node_modules/better-auth/dist/plugins/api-key/routes/get-api-key.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "getApiKey",
    ()=>getApiKey
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$routes$2f$session$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api/routes/session.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/api-key/adapter.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/api-key/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$json$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/json.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/error.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
//#region src/plugins/api-key/routes/get-api-key.ts
const getApiKeyQuerySchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The id of the Api Key"
    })
});
function getApiKey({ opts, schema, deleteAllExpiredApiKeys }) {
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/api-key/get", {
        method: "GET",
        query: getApiKeyQuerySchema,
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$routes$2f$session$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sessionMiddleware"]
        ],
        metadata: {
            openapi: {
                description: "Retrieve an existing API key by ID",
                responses: {
                    "200": {
                        description: "API key retrieved successfully",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    properties: {
                                        id: {
                                            type: "string",
                                            description: "ID"
                                        },
                                        name: {
                                            type: "string",
                                            nullable: true,
                                            description: "The name of the key"
                                        },
                                        start: {
                                            type: "string",
                                            nullable: true,
                                            description: "Shows the first few characters of the API key, including the prefix. This allows you to show those few characters in the UI to make it easier for users to identify the API key."
                                        },
                                        prefix: {
                                            type: "string",
                                            nullable: true,
                                            description: "The API Key prefix. Stored as plain text."
                                        },
                                        userId: {
                                            type: "string",
                                            description: "The owner of the user id"
                                        },
                                        refillInterval: {
                                            type: "number",
                                            nullable: true,
                                            description: "The interval in milliseconds between refills of the `remaining` count. Example: 3600000 // refill every hour (3600000ms = 1h)"
                                        },
                                        refillAmount: {
                                            type: "number",
                                            nullable: true,
                                            description: "The amount to refill"
                                        },
                                        lastRefillAt: {
                                            type: "string",
                                            format: "date-time",
                                            nullable: true,
                                            description: "The last refill date"
                                        },
                                        enabled: {
                                            type: "boolean",
                                            description: "Sets if key is enabled or disabled",
                                            default: true
                                        },
                                        rateLimitEnabled: {
                                            type: "boolean",
                                            description: "Whether the key has rate limiting enabled"
                                        },
                                        rateLimitTimeWindow: {
                                            type: "number",
                                            nullable: true,
                                            description: "The duration in milliseconds"
                                        },
                                        rateLimitMax: {
                                            type: "number",
                                            nullable: true,
                                            description: "Maximum amount of requests allowed within a window"
                                        },
                                        requestCount: {
                                            type: "number",
                                            description: "The number of requests made within the rate limit time window"
                                        },
                                        remaining: {
                                            type: "number",
                                            nullable: true,
                                            description: "Remaining requests (every time api key is used this should updated and should be updated on refill as well)"
                                        },
                                        lastRequest: {
                                            type: "string",
                                            format: "date-time",
                                            nullable: true,
                                            description: "When last request occurred"
                                        },
                                        expiresAt: {
                                            type: "string",
                                            format: "date-time",
                                            nullable: true,
                                            description: "Expiry date of a key"
                                        },
                                        createdAt: {
                                            type: "string",
                                            format: "date-time",
                                            description: "created at"
                                        },
                                        updatedAt: {
                                            type: "string",
                                            format: "date-time",
                                            description: "updated at"
                                        },
                                        metadata: {
                                            type: "object",
                                            nullable: true,
                                            additionalProperties: true,
                                            description: "Extra metadata about the apiKey"
                                        },
                                        permissions: {
                                            type: "string",
                                            nullable: true,
                                            description: "Permissions for the api key (stored as JSON string)"
                                        }
                                    },
                                    required: [
                                        "id",
                                        "userId",
                                        "enabled",
                                        "rateLimitEnabled",
                                        "requestCount",
                                        "createdAt",
                                        "updatedAt"
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (ctx)=>{
        const { id } = ctx.query;
        const session = ctx.context.session;
        let apiKey = null;
        apiKey = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getApiKeyById"])(ctx, id, opts);
        if (apiKey && apiKey.userId !== session.user.id) apiKey = null;
        if (!apiKey) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("NOT_FOUND", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].KEY_NOT_FOUND
        });
        deleteAllExpiredApiKeys(ctx.context);
        const metadata = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["migrateDoubleStringifiedMetadata"])(ctx, apiKey, opts);
        const { key: _key, ...returningApiKey } = apiKey;
        return ctx.json({
            ...returningApiKey,
            metadata,
            permissions: returningApiKey.permissions ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$json$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["safeJSONParse"])(returningApiKey.permissions) : null
        });
    });
}
;
 //# sourceMappingURL=get-api-key.mjs.map
}),
"[project]/node_modules/better-auth/dist/plugins/api-key/routes/list-api-keys.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "listApiKeys",
    ()=>listApiKeys$1
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$routes$2f$session$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api/routes/session.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/api-key/adapter.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$json$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/json.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
;
;
;
;
;
//#region src/plugins/api-key/routes/list-api-keys.ts
function listApiKeys$1({ opts, schema, deleteAllExpiredApiKeys }) {
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/api-key/list", {
        method: "GET",
        use: [
            __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$routes$2f$session$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sessionMiddleware"]
        ],
        metadata: {
            openapi: {
                description: "List all API keys for the authenticated user",
                responses: {
                    "200": {
                        description: "API keys retrieved successfully",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "array",
                                    items: {
                                        type: "object",
                                        properties: {
                                            id: {
                                                type: "string",
                                                description: "ID"
                                            },
                                            name: {
                                                type: "string",
                                                nullable: true,
                                                description: "The name of the key"
                                            },
                                            start: {
                                                type: "string",
                                                nullable: true,
                                                description: "Shows the first few characters of the API key, including the prefix. This allows you to show those few characters in the UI to make it easier for users to identify the API key."
                                            },
                                            prefix: {
                                                type: "string",
                                                nullable: true,
                                                description: "The API Key prefix. Stored as plain text."
                                            },
                                            userId: {
                                                type: "string",
                                                description: "The owner of the user id"
                                            },
                                            refillInterval: {
                                                type: "number",
                                                nullable: true,
                                                description: "The interval in milliseconds between refills of the `remaining` count. Example: 3600000 // refill every hour (3600000ms = 1h)"
                                            },
                                            refillAmount: {
                                                type: "number",
                                                nullable: true,
                                                description: "The amount to refill"
                                            },
                                            lastRefillAt: {
                                                type: "string",
                                                format: "date-time",
                                                nullable: true,
                                                description: "The last refill date"
                                            },
                                            enabled: {
                                                type: "boolean",
                                                description: "Sets if key is enabled or disabled",
                                                default: true
                                            },
                                            rateLimitEnabled: {
                                                type: "boolean",
                                                description: "Whether the key has rate limiting enabled"
                                            },
                                            rateLimitTimeWindow: {
                                                type: "number",
                                                nullable: true,
                                                description: "The duration in milliseconds"
                                            },
                                            rateLimitMax: {
                                                type: "number",
                                                nullable: true,
                                                description: "Maximum amount of requests allowed within a window"
                                            },
                                            requestCount: {
                                                type: "number",
                                                description: "The number of requests made within the rate limit time window"
                                            },
                                            remaining: {
                                                type: "number",
                                                nullable: true,
                                                description: "Remaining requests (every time api key is used this should updated and should be updated on refill as well)"
                                            },
                                            lastRequest: {
                                                type: "string",
                                                format: "date-time",
                                                nullable: true,
                                                description: "When last request occurred"
                                            },
                                            expiresAt: {
                                                type: "string",
                                                format: "date-time",
                                                nullable: true,
                                                description: "Expiry date of a key"
                                            },
                                            createdAt: {
                                                type: "string",
                                                format: "date-time",
                                                description: "created at"
                                            },
                                            updatedAt: {
                                                type: "string",
                                                format: "date-time",
                                                description: "updated at"
                                            },
                                            metadata: {
                                                type: "object",
                                                nullable: true,
                                                additionalProperties: true,
                                                description: "Extra metadata about the apiKey"
                                            },
                                            permissions: {
                                                type: "string",
                                                nullable: true,
                                                description: "Permissions for the api key (stored as JSON string)"
                                            }
                                        },
                                        required: [
                                            "id",
                                            "userId",
                                            "enabled",
                                            "rateLimitEnabled",
                                            "requestCount",
                                            "createdAt",
                                            "updatedAt"
                                        ]
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (ctx)=>{
        const session = ctx.context.session;
        const apiKeys = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["listApiKeys"])(ctx, session.user.id, opts);
        deleteAllExpiredApiKeys(ctx.context);
        const returningApiKeys = apiKeys.map((apiKey)=>{
            const { key: _key, ...rest } = apiKey;
            return {
                ...rest,
                metadata: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["parseDoubleStringifiedMetadata"])(apiKey.metadata),
                permissions: rest.permissions ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$json$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["safeJSONParse"])(rest.permissions) : null
            };
        });
        await ctx.context.runInBackgroundOrAwait((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["batchMigrateLegacyMetadata"])(ctx, apiKeys, opts));
        return ctx.json(returningApiKeys);
    });
}
;
 //# sourceMappingURL=list-api-keys.mjs.map
}),
"[project]/node_modules/better-auth/dist/plugins/api-key/routes/update-api-key.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "updateApiKey",
    ()=>updateApiKey
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2f$date$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/utils/date.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$routes$2f$session$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api/routes/session.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/api-key/adapter.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/api-key/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$json$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/json.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/error.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/schemas.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/v4/classic/external.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
//#region src/plugins/api-key/routes/update-api-key.ts
const updateApiKeyBodySchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["object"]({
    keyId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The id of the Api Key"
    }),
    userId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["coerce"].string().meta({
        description: "The id of the user which the api key belongs to. server-only. Eg: \"some-user-id\""
    }).optional(),
    name: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]().meta({
        description: "The name of the key"
    }).optional(),
    enabled: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["boolean"]().meta({
        description: "Whether the Api Key is enabled or not"
    }).optional(),
    remaining: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["number"]().meta({
        description: "The number of remaining requests"
    }).min(1).optional(),
    refillAmount: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["number"]().meta({
        description: "The refill amount"
    }).optional(),
    refillInterval: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["number"]().meta({
        description: "The refill interval"
    }).optional(),
    metadata: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["any"]().optional(),
    expiresIn: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["number"]().meta({
        description: "Expiration time of the Api Key in seconds"
    }).min(1).optional().nullable(),
    rateLimitEnabled: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["boolean"]().meta({
        description: "Whether the key has rate limiting enabled."
    }).optional(),
    rateLimitTimeWindow: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["number"]().meta({
        description: "The duration in milliseconds where each request is counted. server-only. Eg: 1000"
    }).optional(),
    rateLimitMax: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["number"]().meta({
        description: "Maximum amount of requests allowed within a window. Once the `maxRequests` is reached, the request will be rejected until the `timeWindow` has passed, at which point the `timeWindow` will be reset. server-only. Eg: 100"
    }).optional(),
    permissions: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["record"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"](), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["array"](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$v4$2f$classic$2f$schemas$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["string"]())).meta({
        description: "Update the permissions on the API Key. server-only."
    }).optional().nullable()
});
function updateApiKey({ opts, schema, deleteAllExpiredApiKeys }) {
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthEndpoint"])("/api-key/update", {
        method: "POST",
        body: updateApiKeyBodySchema,
        metadata: {
            openapi: {
                description: "Update an existing API key by ID",
                responses: {
                    "200": {
                        description: "API key updated successfully",
                        content: {
                            "application/json": {
                                schema: {
                                    type: "object",
                                    properties: {
                                        id: {
                                            type: "string",
                                            description: "ID"
                                        },
                                        name: {
                                            type: "string",
                                            nullable: true,
                                            description: "The name of the key"
                                        },
                                        start: {
                                            type: "string",
                                            nullable: true,
                                            description: "Shows the first few characters of the API key, including the prefix. This allows you to show those few characters in the UI to make it easier for users to identify the API key."
                                        },
                                        prefix: {
                                            type: "string",
                                            nullable: true,
                                            description: "The API Key prefix. Stored as plain text."
                                        },
                                        userId: {
                                            type: "string",
                                            description: "The owner of the user id"
                                        },
                                        refillInterval: {
                                            type: "number",
                                            nullable: true,
                                            description: "The interval in milliseconds between refills of the `remaining` count. Example: 3600000 // refill every hour (3600000ms = 1h)"
                                        },
                                        refillAmount: {
                                            type: "number",
                                            nullable: true,
                                            description: "The amount to refill"
                                        },
                                        lastRefillAt: {
                                            type: "string",
                                            format: "date-time",
                                            nullable: true,
                                            description: "The last refill date"
                                        },
                                        enabled: {
                                            type: "boolean",
                                            description: "Sets if key is enabled or disabled",
                                            default: true
                                        },
                                        rateLimitEnabled: {
                                            type: "boolean",
                                            description: "Whether the key has rate limiting enabled"
                                        },
                                        rateLimitTimeWindow: {
                                            type: "number",
                                            nullable: true,
                                            description: "The duration in milliseconds"
                                        },
                                        rateLimitMax: {
                                            type: "number",
                                            nullable: true,
                                            description: "Maximum amount of requests allowed within a window"
                                        },
                                        requestCount: {
                                            type: "number",
                                            description: "The number of requests made within the rate limit time window"
                                        },
                                        remaining: {
                                            type: "number",
                                            nullable: true,
                                            description: "Remaining requests (every time api key is used this should updated and should be updated on refill as well)"
                                        },
                                        lastRequest: {
                                            type: "string",
                                            format: "date-time",
                                            nullable: true,
                                            description: "When last request occurred"
                                        },
                                        expiresAt: {
                                            type: "string",
                                            format: "date-time",
                                            nullable: true,
                                            description: "Expiry date of a key"
                                        },
                                        createdAt: {
                                            type: "string",
                                            format: "date-time",
                                            description: "created at"
                                        },
                                        updatedAt: {
                                            type: "string",
                                            format: "date-time",
                                            description: "updated at"
                                        },
                                        metadata: {
                                            type: "object",
                                            nullable: true,
                                            additionalProperties: true,
                                            description: "Extra metadata about the apiKey"
                                        },
                                        permissions: {
                                            type: "string",
                                            nullable: true,
                                            description: "Permissions for the api key (stored as JSON string)"
                                        }
                                    },
                                    required: [
                                        "id",
                                        "userId",
                                        "enabled",
                                        "rateLimitEnabled",
                                        "requestCount",
                                        "createdAt",
                                        "updatedAt"
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        }
    }, async (ctx)=>{
        const { keyId, expiresIn, enabled, metadata, refillAmount, refillInterval, remaining, name, permissions, rateLimitEnabled, rateLimitTimeWindow, rateLimitMax } = ctx.body;
        const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$routes$2f$session$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getSessionFromCtx"])(ctx);
        const authRequired = ctx.request || ctx.headers;
        const user = authRequired && !session ? null : session?.user || {
            id: ctx.body.userId
        };
        if (!user?.id) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].UNAUTHORIZED_SESSION
        });
        if (session && ctx.body.userId && session?.user.id !== ctx.body.userId) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].UNAUTHORIZED_SESSION
        });
        if (authRequired) {
            if (refillAmount !== void 0 || refillInterval !== void 0 || rateLimitMax !== void 0 || rateLimitTimeWindow !== void 0 || rateLimitEnabled !== void 0 || remaining !== void 0 || permissions !== void 0) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].SERVER_ONLY_PROPERTY
            });
        }
        let apiKey = null;
        apiKey = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getApiKeyById"])(ctx, keyId, opts);
        if (apiKey && apiKey.userId !== user.id) apiKey = null;
        if (!apiKey) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("NOT_FOUND", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].KEY_NOT_FOUND
        });
        const newValues = {};
        if (name !== void 0) {
            if (name.length < opts.minimumNameLength) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].INVALID_NAME_LENGTH
            });
            else if (name.length > opts.maximumNameLength) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].INVALID_NAME_LENGTH
            });
            newValues.name = name;
        }
        if (enabled !== void 0) newValues.enabled = enabled;
        if (expiresIn !== void 0) {
            if (opts.keyExpiration.disableCustomExpiresTime === true) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].KEY_DISABLED_EXPIRATION
            });
            if (expiresIn !== null) {
                const expiresIn_in_days = expiresIn / (3600 * 24);
                if (expiresIn_in_days < opts.keyExpiration.minExpiresIn) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].EXPIRES_IN_IS_TOO_SMALL
                });
                else if (expiresIn_in_days > opts.keyExpiration.maxExpiresIn) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                    message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].EXPIRES_IN_IS_TOO_LARGE
                });
            }
            newValues.expiresAt = expiresIn ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2f$date$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDate"])(expiresIn, "sec") : null;
        }
        if (metadata !== void 0 && opts.enableMetadata === true) {
            if (typeof metadata !== "object") throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].INVALID_METADATA_TYPE
            });
            newValues.metadata = metadata;
        }
        if (remaining !== void 0) newValues.remaining = remaining;
        if (refillAmount !== void 0 || refillInterval !== void 0) {
            if (refillAmount !== void 0 && refillInterval === void 0) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].REFILL_AMOUNT_AND_INTERVAL_REQUIRED
            });
            else if (refillInterval !== void 0 && refillAmount === void 0) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].REFILL_INTERVAL_AND_AMOUNT_REQUIRED
            });
            newValues.refillAmount = refillAmount;
            newValues.refillInterval = refillInterval;
        }
        if (rateLimitEnabled !== void 0) newValues.rateLimitEnabled = rateLimitEnabled;
        if (rateLimitTimeWindow !== void 0) newValues.rateLimitTimeWindow = rateLimitTimeWindow;
        if (rateLimitMax !== void 0) newValues.rateLimitMax = rateLimitMax;
        if (permissions !== void 0) newValues.permissions = JSON.stringify(permissions);
        if (Object.keys(newValues).length === 0) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
            message: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ERROR_CODES"].NO_VALUES_TO_UPDATE
        });
        let newApiKey = apiKey;
        try {
            if (opts.storage === "secondary-storage" && opts.fallbackToDatabase) {
                const dbUpdated = await ctx.context.adapter.update({
                    model: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["API_KEY_TABLE_NAME"],
                    where: [
                        {
                            field: "id",
                            value: apiKey.id
                        }
                    ],
                    update: newValues
                });
                if (dbUpdated) {
                    await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["setApiKey"])(ctx, dbUpdated, opts);
                    newApiKey = dbUpdated;
                }
            } else if (opts.storage === "database") {
                const result = await ctx.context.adapter.update({
                    model: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["API_KEY_TABLE_NAME"],
                    where: [
                        {
                            field: "id",
                            value: apiKey.id
                        }
                    ],
                    update: newValues
                });
                if (result) newApiKey = result;
            } else {
                const updated = {
                    ...apiKey,
                    ...newValues,
                    updatedAt: /* @__PURE__ */ new Date()
                };
                await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["setApiKey"])(ctx, updated, opts);
                newApiKey = updated;
            }
        } catch (error) {
            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("INTERNAL_SERVER_ERROR", {
                message: error?.message
            });
        }
        deleteAllExpiredApiKeys(ctx.context);
        const migratedMetadata = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$adapter$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["migrateDoubleStringifiedMetadata"])(ctx, newApiKey, opts);
        const { key: _key, ...returningApiKey } = newApiKey;
        return ctx.json({
            ...returningApiKey,
            metadata: migratedMetadata,
            permissions: returningApiKey.permissions ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$json$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["safeJSONParse"])(returningApiKey.permissions) : null
        });
    });
}
;
 //# sourceMappingURL=update-api-key.mjs.map
}),
"[project]/node_modules/better-auth/dist/plugins/api-key/routes/index.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "createApiKeyRoutes",
    ()=>createApiKeyRoutes,
    "deleteAllExpiredApiKeys",
    ()=>deleteAllExpiredApiKeys
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$routes$2f$create$2d$api$2d$key$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/api-key/routes/create-api-key.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$routes$2f$delete$2d$all$2d$expired$2d$api$2d$keys$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/api-key/routes/delete-all-expired-api-keys.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$routes$2f$delete$2d$api$2d$key$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/api-key/routes/delete-api-key.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$routes$2f$get$2d$api$2d$key$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/api-key/routes/get-api-key.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$routes$2f$list$2d$api$2d$keys$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/api-key/routes/list-api-keys.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$routes$2f$update$2d$api$2d$key$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/api-key/routes/update-api-key.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$routes$2f$verify$2d$api$2d$key$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/api-key/routes/verify-api-key.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/api-key/index.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
//#region src/plugins/api-key/routes/index.ts
let lastChecked = null;
async function deleteAllExpiredApiKeys(ctx, byPassLastCheckTime = false) {
    if (lastChecked && !byPassLastCheckTime) {
        if (/* @__PURE__ */ new Date().getTime() - lastChecked.getTime() < 1e4) return;
    }
    lastChecked = /* @__PURE__ */ new Date();
    await ctx.adapter.deleteMany({
        model: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["API_KEY_TABLE_NAME"],
        where: [
            {
                field: "expiresAt",
                operator: "lt",
                value: /* @__PURE__ */ new Date()
            },
            {
                field: "expiresAt",
                operator: "ne",
                value: null
            }
        ]
    }).catch((error)=>{
        ctx.logger.error(`Failed to delete expired API keys:`, error);
    });
}
function createApiKeyRoutes({ keyGenerator, opts, schema }) {
    return {
        createApiKey: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$routes$2f$create$2d$api$2d$key$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createApiKey"])({
            keyGenerator,
            opts,
            schema,
            deleteAllExpiredApiKeys
        }),
        verifyApiKey: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$routes$2f$verify$2d$api$2d$key$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["verifyApiKey"])({
            opts,
            schema,
            deleteAllExpiredApiKeys
        }),
        getApiKey: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$routes$2f$get$2d$api$2d$key$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getApiKey"])({
            opts,
            schema,
            deleteAllExpiredApiKeys
        }),
        updateApiKey: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$routes$2f$update$2d$api$2d$key$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["updateApiKey"])({
            opts,
            schema,
            deleteAllExpiredApiKeys
        }),
        deleteApiKey: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$routes$2f$delete$2d$api$2d$key$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["deleteApiKey"])({
            opts,
            schema,
            deleteAllExpiredApiKeys
        }),
        listApiKeys: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$routes$2f$list$2d$api$2d$keys$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["listApiKeys"])({
            opts,
            schema,
            deleteAllExpiredApiKeys
        }),
        deleteAllExpiredApiKeys: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$routes$2f$delete$2d$all$2d$expired$2d$api$2d$keys$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["deleteAllExpiredApiKeysEndpoint"])({
            deleteAllExpiredApiKeys
        })
    };
}
;
 //# sourceMappingURL=index.mjs.map
}),
"[project]/node_modules/better-auth/dist/plugins/api-key/schema.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "apiKeySchema",
    ()=>apiKeySchema
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$client$2f$parser$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/client/parser.mjs [app-route] (ecmascript)");
;
//#region src/plugins/api-key/schema.ts
const apiKeySchema = ({ timeWindow, rateLimitMax })=>({
        apikey: {
            fields: {
                name: {
                    type: "string",
                    required: false,
                    input: false
                },
                start: {
                    type: "string",
                    required: false,
                    input: false
                },
                prefix: {
                    type: "string",
                    required: false,
                    input: false
                },
                key: {
                    type: "string",
                    required: true,
                    input: false,
                    index: true
                },
                userId: {
                    type: "string",
                    references: {
                        model: "user",
                        field: "id",
                        onDelete: "cascade"
                    },
                    required: true,
                    input: false,
                    index: true
                },
                refillInterval: {
                    type: "number",
                    required: false,
                    input: false
                },
                refillAmount: {
                    type: "number",
                    required: false,
                    input: false
                },
                lastRefillAt: {
                    type: "date",
                    required: false,
                    input: false
                },
                enabled: {
                    type: "boolean",
                    required: false,
                    input: false,
                    defaultValue: true
                },
                rateLimitEnabled: {
                    type: "boolean",
                    required: false,
                    input: false,
                    defaultValue: true
                },
                rateLimitTimeWindow: {
                    type: "number",
                    required: false,
                    input: false,
                    defaultValue: timeWindow
                },
                rateLimitMax: {
                    type: "number",
                    required: false,
                    input: false,
                    defaultValue: rateLimitMax
                },
                requestCount: {
                    type: "number",
                    required: false,
                    input: false,
                    defaultValue: 0
                },
                remaining: {
                    type: "number",
                    required: false,
                    input: false
                },
                lastRequest: {
                    type: "date",
                    required: false,
                    input: false
                },
                expiresAt: {
                    type: "date",
                    required: false,
                    input: false
                },
                createdAt: {
                    type: "date",
                    required: true,
                    input: false
                },
                updatedAt: {
                    type: "date",
                    required: true,
                    input: false
                },
                permissions: {
                    type: "string",
                    required: false,
                    input: false
                },
                metadata: {
                    type: "string",
                    required: false,
                    input: true,
                    transform: {
                        input (value) {
                            return JSON.stringify(value);
                        },
                        output (value) {
                            if (!value) return null;
                            return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$client$2f$parser$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["parseJSON"])(value);
                        }
                    }
                }
            }
        }
    });
;
 //# sourceMappingURL=schema.mjs.map
}),
"[project]/node_modules/better-auth/dist/plugins/api-key/index.mjs [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "API_KEY_TABLE_NAME",
    ()=>API_KEY_TABLE_NAME,
    "ERROR_CODES",
    ()=>ERROR_CODES,
    "apiKey",
    ()=>apiKey,
    "defaultKeyHasher",
    ()=>defaultKeyHasher
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2f$date$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/utils/date.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2f$get$2d$request$2d$ip$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/utils/get-request-ip.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$db$2f$schema$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/db/schema.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$db$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/db/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2f$random$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/crypto/random.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/api/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-call/dist/error.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$routes$2f$verify$2d$api$2d$key$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/api-key/routes/verify-api-key.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$routes$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/api-key/routes/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$schema$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/better-auth/dist/plugins/api-key/schema.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/utils/error-codes.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/core/dist/api/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hash$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/utils/dist/hash.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$base64$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@better-auth/utils/dist/base64.mjs [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
;
;
;
;
//#region src/plugins/api-key/index.ts
const defaultKeyHasher = async (key)=>{
    const hash = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$hash$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createHash"])("SHA-256").digest(new TextEncoder().encode(key));
    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$utils$2f$dist$2f$base64$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["base64Url"].encode(new Uint8Array(hash), {
        padding: false
    });
};
const ERROR_CODES = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$utils$2f$error$2d$codes$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["defineErrorCodes"])({
    INVALID_METADATA_TYPE: "metadata must be an object or undefined",
    REFILL_AMOUNT_AND_INTERVAL_REQUIRED: "refillAmount is required when refillInterval is provided",
    REFILL_INTERVAL_AND_AMOUNT_REQUIRED: "refillInterval is required when refillAmount is provided",
    USER_BANNED: "User is banned",
    UNAUTHORIZED_SESSION: "Unauthorized or invalid session",
    KEY_NOT_FOUND: "API Key not found",
    KEY_DISABLED: "API Key is disabled",
    KEY_EXPIRED: "API Key has expired",
    USAGE_EXCEEDED: "API Key has reached its usage limit",
    KEY_NOT_RECOVERABLE: "API Key is not recoverable",
    EXPIRES_IN_IS_TOO_SMALL: "The expiresIn is smaller than the predefined minimum value.",
    EXPIRES_IN_IS_TOO_LARGE: "The expiresIn is larger than the predefined maximum value.",
    INVALID_REMAINING: "The remaining count is either too large or too small.",
    INVALID_PREFIX_LENGTH: "The prefix length is either too large or too small.",
    INVALID_NAME_LENGTH: "The name length is either too large or too small.",
    METADATA_DISABLED: "Metadata is disabled.",
    RATE_LIMIT_EXCEEDED: "Rate limit exceeded.",
    NO_VALUES_TO_UPDATE: "No values to update.",
    KEY_DISABLED_EXPIRATION: "Custom key expiration values are disabled.",
    INVALID_API_KEY: "Invalid API key.",
    INVALID_USER_ID_FROM_API_KEY: "The user id from the API key is invalid.",
    INVALID_API_KEY_GETTER_RETURN_TYPE: "API Key getter returned an invalid key type. Expected string.",
    SERVER_ONLY_PROPERTY: "The property you're trying to set can only be set from the server auth instance only.",
    FAILED_TO_UPDATE_API_KEY: "Failed to update API key",
    NAME_REQUIRED: "API Key name is required."
});
const API_KEY_TABLE_NAME = "apikey";
const apiKey = (options)=>{
    const opts = {
        ...options,
        apiKeyHeaders: options?.apiKeyHeaders ?? "x-api-key",
        defaultKeyLength: options?.defaultKeyLength || 64,
        maximumPrefixLength: options?.maximumPrefixLength ?? 32,
        minimumPrefixLength: options?.minimumPrefixLength ?? 1,
        maximumNameLength: options?.maximumNameLength ?? 32,
        minimumNameLength: options?.minimumNameLength ?? 1,
        enableMetadata: options?.enableMetadata ?? false,
        disableKeyHashing: options?.disableKeyHashing ?? false,
        requireName: options?.requireName ?? false,
        storage: options?.storage ?? "database",
        rateLimit: {
            enabled: options?.rateLimit?.enabled === void 0 ? true : options?.rateLimit?.enabled,
            timeWindow: options?.rateLimit?.timeWindow ?? 1e3 * 60 * 60 * 24,
            maxRequests: options?.rateLimit?.maxRequests ?? 10
        },
        keyExpiration: {
            defaultExpiresIn: options?.keyExpiration?.defaultExpiresIn ?? null,
            disableCustomExpiresTime: options?.keyExpiration?.disableCustomExpiresTime ?? false,
            maxExpiresIn: options?.keyExpiration?.maxExpiresIn ?? 365,
            minExpiresIn: options?.keyExpiration?.minExpiresIn ?? 1
        },
        startingCharactersConfig: {
            shouldStore: options?.startingCharactersConfig?.shouldStore ?? true,
            charactersLength: options?.startingCharactersConfig?.charactersLength ?? 6
        },
        enableSessionForAPIKeys: options?.enableSessionForAPIKeys ?? false,
        fallbackToDatabase: options?.fallbackToDatabase ?? false,
        customStorage: options?.customStorage,
        deferUpdates: options?.deferUpdates ?? false
    };
    const schema = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$db$2f$schema$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["mergeSchema"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$schema$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["apiKeySchema"])({
        rateLimitMax: opts.rateLimit.maxRequests,
        timeWindow: opts.rateLimit.timeWindow
    }), opts.schema);
    const getter = opts.customAPIKeyGetter || ((ctx)=>{
        if (Array.isArray(opts.apiKeyHeaders)) for (const header of opts.apiKeyHeaders){
            const value = ctx.headers?.get(header);
            if (value) return value;
        }
        else return ctx.headers?.get(opts.apiKeyHeaders);
    });
    const routes = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$routes$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createApiKeyRoutes"])({
        keyGenerator: opts.customKeyGenerator || (async (options$1)=>{
            const key = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$crypto$2f$random$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["generateRandomString"])(options$1.length, "a-z", "A-Z");
            return `${options$1.prefix || ""}${key}`;
        }),
        opts,
        schema
    });
    return {
        id: "api-key",
        $ERROR_CODES: ERROR_CODES,
        hooks: {
            before: [
                {
                    matcher: (ctx)=>!!getter(ctx) && opts.enableSessionForAPIKeys,
                    handler: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$better$2d$auth$2f$core$2f$dist$2f$api$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createAuthMiddleware"])(async (ctx)=>{
                        const key = getter(ctx);
                        if (typeof key !== "string") throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("BAD_REQUEST", {
                            message: ERROR_CODES.INVALID_API_KEY_GETTER_RETURN_TYPE
                        });
                        if (key.length < opts.defaultKeyLength) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
                            message: ERROR_CODES.INVALID_API_KEY
                        });
                        if (opts.customAPIKeyValidator) {
                            if (!await opts.customAPIKeyValidator({
                                ctx,
                                key
                            })) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("FORBIDDEN", {
                                message: ERROR_CODES.INVALID_API_KEY
                            });
                        }
                        const apiKey$1 = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$routes$2f$verify$2d$api$2d$key$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["validateApiKey"])({
                            hashedKey: opts.disableKeyHashing ? key : await defaultKeyHasher(key),
                            ctx,
                            opts,
                            schema
                        });
                        const cleanupTask = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$plugins$2f$api$2d$key$2f$routes$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["deleteAllExpiredApiKeys"])(ctx.context).catch((err)=>{
                            ctx.context.logger.error("Failed to delete expired API keys:", err);
                        });
                        if (opts.deferUpdates) ctx.context.runInBackground(cleanupTask);
                        const user = await ctx.context.internalAdapter.findUserById(apiKey$1.userId);
                        if (!user) throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$call$2f$dist$2f$error$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]("UNAUTHORIZED", {
                            message: ERROR_CODES.INVALID_USER_ID_FROM_API_KEY
                        });
                        const session = {
                            user,
                            session: {
                                id: apiKey$1.id,
                                token: key,
                                userId: apiKey$1.userId,
                                userAgent: ctx.request?.headers.get("user-agent") ?? null,
                                ipAddress: ctx.request ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2f$get$2d$request$2d$ip$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getIp"])(ctx.request, ctx.context.options) : null,
                                createdAt: /* @__PURE__ */ new Date(),
                                updatedAt: /* @__PURE__ */ new Date(),
                                expiresAt: apiKey$1.expiresAt || (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$better$2d$auth$2f$dist$2f$utils$2f$date$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDate"])(ctx.context.options.session?.expiresIn || 3600 * 24 * 7, "ms")
                            }
                        };
                        ctx.context.session = session;
                        if (ctx.path === "/get-session") return session;
                        else return {
                            context: ctx
                        };
                    })
                }
            ]
        },
        endpoints: {
            createApiKey: routes.createApiKey,
            verifyApiKey: routes.verifyApiKey,
            getApiKey: routes.getApiKey,
            updateApiKey: routes.updateApiKey,
            deleteApiKey: routes.deleteApiKey,
            listApiKeys: routes.listApiKeys,
            deleteAllExpiredApiKeys: routes.deleteAllExpiredApiKeys
        },
        schema,
        options
    };
};
;
 //# sourceMappingURL=index.mjs.map
}),
];

//# sourceMappingURL=node_modules_better-auth_dist_plugins_api-key_9526ebaf._.js.map