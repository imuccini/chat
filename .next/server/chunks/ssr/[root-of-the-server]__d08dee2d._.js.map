{"version":3,"sources":["../../../../lib/db.ts","../../../../services/messageService.ts","../../../../app/page.tsx"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = globalThis as unknown as {\n    prisma: PrismaClient | undefined\n}\n\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient()\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n","import { prisma } from \"@/lib/db\";\n\n// SERVICE: Tenant Resolution\nexport const getTenantByNasId = async (nasId: string) => {\n    return await prisma.tenant.findFirst({\n        where: {\n            devices: {\n                some: {\n                    nasId: nasId\n                }\n            }\n        }\n    });\n};\n\nexport const getTenantBySlug = async (slug: string) => {\n    return await prisma.tenant.findUnique({\n        where: { slug },\n    });\n};\n\n// SERVICE: Messagging (Multi-tenant Filtered)\nexport const getMessages = async (tenantId: string, limit = 50) => {\n    return await prisma.message.findMany({\n        where: { tenantId },\n        orderBy: { createdAt: \"desc\" },\n        take: limit,\n        include: { user: true }, // Include sender details\n    });\n};\n\nexport const createMessage = async (content: string, userId: string, tenantId: string) => {\n    return await prisma.message.create({\n        data: {\n            content,\n            userId,\n            tenantId,\n        },\n    });\n};\n","import { getTenantByNasId } from \"@/services/messageService\";\nimport { redirect } from \"next/navigation\";\n\ninterface PageProps {\n    searchParams: Promise<{ [key: string]: string | string[] | undefined }>\n}\n\nexport default async function Home(props: PageProps) {\n    const searchParams = await props.searchParams;\n    const nasId = searchParams.nas_id;\n\n    if (typeof nasId === 'string') {\n        const tenant = await getTenantByNasId(nasId);\n\n        if (tenant) {\n            redirect(`/${tenant.slug}`);\n        } else {\n            return (\n                <div className=\"h-screen w-full flex items-center justify-center bg-gray-100 p-4\">\n                    <div className=\"text-center p-8 bg-white rounded-lg shadow-lg max-w-md\">\n                        <h1 className=\"text-2xl font-bold text-red-500 mb-4\">Accesso Negato</h1>\n                        <p className=\"text-gray-700\">La chat in questo spazio non e' attiva.</p>\n                        <p className=\"text-xs text-gray-400 mt-4\">ID Router non riconosciuto: {nasId}</p>\n                    </div>\n                </div>\n            );\n        }\n    }\n\n    // Fallback for direct access without NAS ID (Demo/Test)\n    // In production you might want to block this too, or show a tenant selector\n    return (\n        <main className=\"flex min-h-screen flex-col items-center justify-center p-24\">\n            <h1 className=\"text-4xl font-bold mb-8\">Benvenuto su Treno Chat</h1>\n            <p className=\"mb-4\">Per accedere, connettiti al Wi-Fi del treno.</p>\n        </main>\n    );\n}\n"],"names":[],"mappings":"+RAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OAMO,IAAM,EAJW,AAIF,WAAgB,MAAM,EAAI,IAAI,EAAA,YAAY,4CCNhE,IAAA,EAAA,EAAA,CAAA,CAAA,OAGO,IAAM,EAAmB,MAAO,GAC5B,MAAM,EAAA,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,CACjC,MAAO,CACH,QAAS,CACL,KAAM,CACF,MAAO,CACX,CACJ,CACJ,CACJ,GAGS,EAAkB,MAAO,GAC3B,MAAM,EAAA,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,CAClC,MAAO,MAAE,CAAK,CAClB,GAIS,EAAc,MAAO,EAAkB,EAAQ,EAAE,GACnD,MAAM,EAAA,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,CACjC,MAAO,UAAE,CAAS,EAClB,QAAS,CAAE,UAAW,MAAO,EAC7B,KAAM,EACN,QAAS,CAAE,MAAM,CAAK,CAC1B,iHC5BJ,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OAMe,eAAe,EAAK,CAAgB,EAE/C,IAAM,EAAQ,CADO,MAAM,EAAM,YAAA,AAAY,EAClB,MAAM,CAEjC,GAAqB,UAAjB,OAAO,EAAoB,CAC3B,IAAM,EAAS,MAAM,CAAA,EAAA,EAAA,gBAAA,AAAgB,EAAC,GAEtC,IAAI,EAGA,MAHQ,AAIJ,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,4EACX,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,mEACX,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,gDAAuC,mBACrD,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,yBAAgB,4CAC7B,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAU,uCAA6B,+BAA6B,UAPnF,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,CAAC,CAAC,EAAE,EAAO,IAAI,CAAA,CAAE,CAYlC,CAIA,MACI,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAU,wEACZ,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,mCAA0B,4BACxC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,gBAAO,mDAGhC"}