{"version":3,"sources":["../../../../lib/db.ts","../../../../services/messageService.ts","../../../../components/ChatInterface.tsx/__nextjs-internal-proxy.mjs","../../../../app/%5BtenantSlug%5D/page.tsx"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = globalThis as unknown as {\n    prisma: PrismaClient | undefined\n}\n\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient()\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n","import { prisma } from \"@/lib/db\";\n\n// SERVICE: Tenant Resolution\nexport const getTenantByNasId = async (nasId: string) => {\n    return await prisma.tenant.findFirst({\n        where: {\n            devices: {\n                some: {\n                    nasId: nasId\n                }\n            }\n        }\n    });\n};\n\nexport const getTenantBySlug = async (slug: string) => {\n    return await prisma.tenant.findUnique({\n        where: { slug },\n    });\n};\n\n// SERVICE: Messagging (Multi-tenant Filtered)\nexport const getMessages = async (tenantId: string, limit = 50) => {\n    return await prisma.message.findMany({\n        where: { tenantId },\n        orderBy: { createdAt: \"desc\" },\n        take: limit,\n        include: { user: true }, // Include sender details\n    });\n};\n\nexport const createMessage = async (content: string, userId: string, tenantId: string) => {\n    return await prisma.message.create({\n        data: {\n            content,\n            userId,\n            tenantId,\n        },\n    });\n};\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/components/ChatInterface.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/components/ChatInterface.tsx\",\n    \"default\",\n);\n","import { getTenantBySlug, getMessages } from \"@/services/messageService\";\nimport { notFound } from \"next/navigation\";\nimport ChatInterface from \"@/components/ChatInterface\";\nimport { User, Message } from \"@/types\"; // We will ensure this exists/is compatible\n\ninterface PageProps {\n    params: Promise<{ tenantSlug: string }>\n}\n\nexport default async function TenantChatPage(props: PageProps) {\n    const params = await props.params;\n    const tenantSlug = params.tenantSlug;\n\n    // 1. Fetch Tenant\n    const tenant = await getTenantBySlug(tenantSlug);\n    if (!tenant) {\n        notFound();\n    }\n\n    // 2. Fetch History (Server-side)\n    // Note: getMessages returns Prisma objects, we might need to map them to our UI types\n    const dbMessages = await getMessages(tenant.id);\n\n    // Transform to UI Message type\n    const initialMessages: Message[] = dbMessages.map(msg => ({\n        id: msg.id,\n        text: msg.content,\n        senderId: msg.userId,\n        senderAlias: msg.user?.name || \"Anonymous\", // Fallback\n        senderGender: \"other\", // Database doesn't have gender yet, default/mock\n        timestamp: msg.createdAt.toISOString(),\n        // Add other fields if necessary\n    }));\n\n    return (\n        <main className=\"flex h-screen flex-col items-center justify-between\">\n            <ChatInterface\n                tenant={tenant}\n                initialMessages={initialMessages}\n            />\n        </main>\n    );\n}\n"],"names":[],"mappings":"+RAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OAMO,IAAM,EAJW,AAIF,WAAgB,MAAM,EAAI,IAAI,EAAA,YAAY,4CCNhE,IAAA,EAAA,EAAA,CAAA,CAAA,OAGO,IAAM,EAAmB,MAAO,GAC5B,MAAM,EAAA,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,CACjC,MAAO,CACH,QAAS,CACL,KAAM,CACF,MAAO,CACX,CACJ,CACJ,CACJ,GAGS,EAAkB,MAAO,GAC3B,MAAM,EAAA,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,CAClC,MAAO,MAAE,CAAK,CAClB,GAIS,EAAc,MAAO,EAAkB,EAAQ,EAAE,GACnD,MAAM,EAAA,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,CACjC,MAAO,UAAE,CAAS,EAClB,QAAS,CAAE,UAAW,MAAO,EAC7B,KAAM,EACN,QAAS,CAAE,MAAM,CAAK,CAC1B,8HC1BW,CAAA,EADf,AACe,EADf,CAAA,CAAA,OACe,uBAAA,AAAuB,EAClC,WAAa,MAAM,AAAI,MAAM,8RAAgS,EAC7T,6DACA,gEAHW,CAAA,EAAA,AADf,EAAA,CAAA,CAAA,OACe,uBAAA,AAAuB,EAClC,WAAa,MAAM,AAAI,MAAM,0QAA4Q,EACzS,yCACA,8GCLJ,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAOe,eAAe,EAAe,CAAgB,EAEzD,IAAM,EAAa,CADJ,MAAM,EAAM,MAAA,AAAM,EACP,UAAU,CAG9B,EAAS,MAAM,CAAA,EAAA,EAAA,eAAA,AAAe,EAAC,EACjC,CAAC,GACD,CAAA,EAAA,EADS,AACT,QAAA,AAAQ,IAQZ,IAAM,EAA6B,CAHhB,MAAM,CAAA,EAAA,EAAA,WAAA,AAAW,EAAC,EAAO,GAAE,EAGA,GAAG,CAAC,IAAQ,CACtD,CADqD,EACjD,EAAI,EAAE,CACV,KAAM,EAAI,OAAO,CACjB,SAAU,EAAI,MAAM,CACpB,YAAa,EAAI,IAAI,EAAE,MAAQ,YAC/B,aAAc,QACd,UAAW,EAAI,SAAS,CAAC,WAAW,GAExC,CAAC,EAED,MACI,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,+DACZ,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAa,CAAA,CACV,OAAQ,EACR,gBAAiB,KAIjC","ignoreList":[2]}